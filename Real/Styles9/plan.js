/* 
 *  Copyright (c) 2012-2014, Inspirock Corporation.
 *  All rights reserved.
 */

/* 
 *  Copyright (c) 2012-2015, Inspirock Corporation.
 *  All rights reserved.
 */

/* 
 *  Copyright (c) 2012-2016, Inspirock Corporation.
 *  All rights reserved.
 */

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 * jQuery UI Selectmenu version 1.5.0pre
 *
 * Copyright (c) 2009-2010 filament group, http://filamentgroup.com
 * Copyright (c) 2010-2013 Felix Nagel, http://www.felixnagel.com
 * Licensed under the MIT (MIT-LICENSE.txt)
 *
 * https://github.com/fnagel/jquery-ui/wiki/Selectmenu
 */

/* 
 *  Copyright (c) 2012-2013, Inspirock Corporation.
 *  All rights reserved.
 */

/*!
	Autosize v1.17.2 - 2013-07-30
	Automatically adjust textarea height based on user input.
	(c) 2013 Jack Moore - http://www.jacklmoore.com/autosize
	license: http://www.opensource.org/licenses/mit-license.php
*/

/*
 *  Copyright (c) 2012-2015, Inspirock Corporation.
 *  All rights reserved.
 */

/*! fancyBox v2.1.5 fancyapps.com | fancyapps.com/fancybox/#license */

/* 
 *  Copyright (c) 2012-2014, Inspirock Corporation.
 *  All rights reserved.pla
 */

/*!
 * FullCalendar v2.0.2
 * Docs & License: http://arshaw.com/fullcalendar/
 * (c) 2013 Adam Shaw
 */

/*
 *  Copyright (c) 2012-2014, Inspirock Corporation.
 *  All rights reserved.
 */

/*
 *  Copyright (c) 2012-2013, Inspirock Corporation.
 *  All rights reserved.
 */

/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011â€“2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */

/*
 RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/text for details
*/
define("modules/fbutil","modules/analytics modules/utils modules/mixpanel modules/ajax jquery jqueryui".split(" "),function(a,c){var d={},e=[];d.FBLoginPermissions=["email","public_profile","user_friends"];d.addToQueue=function(a){void 0===window.currentFacebookUserId?e.push(a):a()};d.processQueue=function(){for(var a=e.shift();a;)a(),a=e.shift()};d.loginToFB=function(a,d,e){a=c.getParameterByName("post-login-url");!a&&e.postLoginURL&&(a=e.postLoginURL);a=a?a:window.contextPath;d=[];a&&d.push("post-login-url="+
a);e.partner&&d.push("partner="+e.partner);e.partnerUserId&&d.push("partnerUserId="+e.partnerUserId);e.rerequest&&d.push("rerequest="+e.rerequest);e=d.join("&");window.location.href=window.contextPath+"/sociallogin/facebook"+(e?"?":"")+e};return d});
define("plan/loading",["jquery"],function(){return{showLoading:function(a,c,d){c.css("opacity",0);a.find(".progress-txt").text(d);a.removeClass("hidden");c=Math.max(140,$(window).scrollTop()+200-$("#planContent").offset().top);a.css("top",c+"px")},hideLoading:function(a,c){c.css("opacity",1);a.addClass("hidden")}}});
define("plan/view",["modules/utils","modules/events","jquery"],function(a,c){var d={},e,h;d.scrollElementIntoView=function(d,c,b){d=$(document.getElementById(d));if(d.length){void 0===c&&(c=0);var j={left:d.offset().left,top:d.offset().top,right:d.offset().left+d.outerWidth(),bottom:d.offset().top+d.outerHeight()},m={left:window.pageXOffset,top:window.pageYOffset+h,right:window.pageXOffset+$(window).width(),bottom:window.pageYOffset+$(window).height()};a.isRectInRect(j,m)||(c=d.offset().top-10+c,
e=!0,b?(window.scrollTo(0,c),e=!1):$("html, body").animate({scrollTop:c},500,function(){e=!1}))}};d.scrollAndUpdate=function(){c.triggerEvent("view","scroll",{manualScrollEvent:e})};d.initialize=function(){h=$("#tabBackground").outerHeight(!0);$(window).scroll(function(){d.scrollAndUpdate()})};return d});
define("plan/history",["plan/loading","modules/events","plan/view","modules/utils","jquery"],function(a,c,d,e){return{push:function(a,d,e,b){if(window.history.pushState&&e){var c=window.history.state;c&&(c.pageYOffset=window.pageYOffset,window.history.replaceState(c,""));window.history.pushState({id:a,tabId:d,url:e,data:b,pageYOffset:window.pageYOffset},"",e)}},replace:function(a,d,e,b){window.history.replaceState&&e&&window.history.replaceState({id:a,tabId:d,url:e,data:b,pageYOffset:window.pageYOffset},
"",e)},pop:function(){window.history&&window.history.back()},initialize:function(){window.onpopstate=function(h){h=h.state;window.history&&null!==h&&(c.triggerEvent("history","back-btn",{}),"explore"===h.tabId||h.data&&"explore"===h.data.modal?((!h.data||"explore"!==h.data.modal)&&c.triggerEvent("history","show-tab-explore",{addToHistory:!1}),"exploreAttractionDetails"===h.id?(!e.isMobile()&&(!h.data||"explore"!==h.data.modal)&&a.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Loading..."),
c.triggerEvent("history","explore-subnav",{targetId:"attractions",subnavLinkId:"attractionslink",preventShowLanding:!0}),c.triggerEvent("history","explore-attraction-details",{url:h.data.detailsUrl,analyticsEventCategory:h.data.eventSource,shouldScroll:!1,backText:h.data.backText})):"exploreDestinationDetails"===h.id?(!e.isMobile()&&(!h.data||"explore"!==h.data.modal)&&a.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Loading..."),c.triggerEvent("history","explore-subnav",{targetId:"destinations",
subnavLinkId:"destinations",preventShowLanding:!0}),c.triggerEvent("history","explore-destination-details",{url:h.data.detailsUrl,analyticsEventCategory:h.data.eventSource,shouldScroll:!1,backText:h.data.backText})):"browseAttractions"===h.id?!h.data||"explore"!==h.data.modal?(c.triggerEvent("history","explore-subnav",{targetId:"attractions",subnavLinkId:"attractionslink",preventShowLanding:!0}),c.triggerEvent("history","explore-attraction-browse",{targetId:h.data.targetId,requestData:h.data.requestData})):
(h.data.history={},c.triggerEvent("history","explore-load-attraction-in-modal",h.data)):"browseDestinations"===h.id?!h.data||"explore"!==h.data.modal?c.triggerEvent("history","explore-destinations-browse",{targetId:h.data.targetId,requestData:h.data.requestData}):(h.data.history={},c.triggerEvent("history","explore-destinations-browse-in-modal",h.data)):c.triggerEvent("history","explore-subnav",{targetId:h.data&&h.data.targetId?h.data.targetId:"attractions",subnavLinkId:h.data&&h.data.subnavLinkId?
h.data.subnavLinkId:"attractionslink"})):"itinerary"===h.tabId?(c.triggerEvent("history","show-tab-itinerary",{addToHistory:!1}),"itineraryDetails"===h.id?(a.showLoading($("#itineraryLoadingPane"),$("#itineraryMainPane"),"Loading..."),c.triggerEvent("history","itinerary-details",{url:h.data.detailsUrl,eventSource:h.data.eventSource})):c.triggerEvent("history","itinerary-subnav",{targetId:h.data&&h.data.targetId?h.data.targetId:"daybyday",subnavLinkId:h.data&&h.data.subnavLinkId?h.data.subnavLinkId:
"daybydaylink"})):"overview"===h.tabId||h.data&&"overview"===h.data.modal?c.triggerEvent("history","show-tab-overview",{addToHistory:!1}):"notifications"===h.tabId||h.data&&"notifications"===h.data.modal?c.triggerEvent("history","show-tab-notifications",{addToHistory:!1}):$(".tab-"+h.tabId).trigger("click"),window.scrollTo(0,h.pageYOffset),d.scrollAndUpdate())}}}});
define("modules/attributions",["jquery","jqueryui"],function(){return{clearPhotoAttributions:function(){var a=$(".page-footer").find(".attributions"),c=a.find(".load-more");a.find(".attribs").empty();c.addClass("hidden");a.addClass("hidden")},updatePhotoAttributions:function(){var a=$(".page-footer"),c=a.find(".attributions"),d=c.find(".load-more"),e=c.find(".attribs"),h=0,g={};e.empty();$(".photo-attrib:visible").each(function(){var a=$(this),b=a.data("artist"),d=a.data("license"),c=a.data("sourceUrl"),
a=a.data("name");if(b&&c){if(g.hasOwnProperty(c))return!0;g[c]=1;h++;d=d?" ("+d+")":"";b=$("<div></div>").html('<span class="name">'+a+'</span> by: <a href="'+c+'" class="artist" rel="nofollow" target="_blank">'+b+"</a>"+d).addClass("attrib").appendTo(e);1<h&&b.addClass("hidden")}});1<h?(d.removeClass("hidden"),c.off("click.more").on("click.more",".load-more",function(){d.addClass("hidden");e.find(".attrib").removeClass("hidden");$("#pageContent").css("padding-bottom",a.outerHeight(!0)+50)})):d.addClass("hidden");
0<h?c.removeClass("hidden"):c.addClass("hidden");$("#pageContent").css("padding-bottom",a.outerHeight(!0)+50)}}});
define("plan/planUtils","modules/analytics modules/mixpanel modules/ajax modules/events modules/utils plan/loading moment jquery jqueryui".split(" "),function(a,c,d,e,h,g,f){return{adjustRouteClick:function(b,f,m){var q=$("#resultpageContent"),r=$("#planRecalculating");d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/adjustRoute",success:function(p){var t=$(p),n=function(){var b=$(this).parents(".stay-row"),a=b.index();0<a&&b.insertBefore(t.find(".stay-row").eq(a-
1));t.find(".destination-index").each(function(b){$(this).text(b+1)})},z=function(){var b=$(this).parents(".stay-row"),a=t.find(".stay-row"),d=b.index();d<a.length-1&&b.insertAfter(a.eq(d+1));t.find(".destination-index").each(function(b){$(this).text(b+1)})};a.trackEvent(b,"adjust-route");t.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-route",buttons:[{html:"Save Route",click:function(){var k="";t.find(".stay-row").map(function(){0!==$(this).index()&&(k+=",");k+=$(this).data("stayId")});
t.dialog("close");g.showLoading(r,q,"Updating Your Plan...");var l=$.extend({stayOrder:k},f);d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/adjustRoute",data:l,synchronize:!0,success:function(k,d,l){g.hideLoading(r,q);m&&m(k,d,l);a.trackEvent(b,"adjust-route-confirm");c.logEvent("adjust_route_saved",{source:b});e.triggerEvent("plan","mmt_track_link",{linkName:"Edit Route"})}})}}],open:function(){c.logEvent("adjust_route_dialog_show",{source:b});t.on("click.moveup",
".move-up",n);t.on("click.movedown",".move-down",z);h.setupDialogOverlay(t,!1)},close:function(){$(this).dialog("destroy").remove()}})}})},showEditDatesDialog:function(b){var a=$("#resultpageContent"),m=$("#planRecalculating");d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/dates",success:function(q){function r(b){var k=n.datepicker("getDate"),a=z.val();if(null!==k){z.datepicker("option","minDate",k);var d=new Date(k.valueOf());d.setDate(k.getDate()+60-1);z.datepicker("option",
"maxDate",d)}else z.datepicker("option","minDate","+1d"),z.datepicker("option","maxDate","+60d");b&&z.val(a)}function p(){var b=f.utc(f(n.datepicker("getDate")).format("MM-DD-YYYY"),"MM-DD-YYYY"),a=f.utc(f(z.datepicker("getDate")).format("MM-DD-YYYY"),"MM-DD-YYYY"),d=f.duration(a-b).asDays()+1;t.find(".num-days").text(d);var e=1===l?" day":" days",c=1===Math.abs(d-l)?" day":" days";d===l?k.text(""):d>l?k.text("Your plan has "+l+e+", which leaves "+(d-l)+c+" open."):k.text("Your plan has "+l+e+", which is "+
(l-d)+c+" past your end date.");b.isSame(v)&&a.isSame(i)?t.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").prop("disabled",!0):t.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").prop("disabled",!1)}var t=$(q),n=t.find("#startDate"),z=t.find("#endDate"),k=t.find(".message"),l=t.data("planDays"),v,i;t.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-dates",buttons:[{html:"Save",click:function(){t.parents(".ui-dialog").find(".ui-dialog-buttonset").find("button").prop("disabled",
!0);var k=f(n.datepicker("getDate")),l=f(z.datepicker("getDate")),i=a.find(".tab-content").filter(":visible").attr("id"),k={startDate:k.format("MMM DD, YYYY"),endDate:l.format("MMM DD, YYYY")};t.dialog("close");g.showLoading(m,a,"Updating your plan...");d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/dates",data:k,synchronize:!0,success:function(){c.logEvent("edit_dates_saved",{source:b});e.triggerEvent("plan","mmt_track_link",{linkName:"Edit Dates"});g.hideLoading(m,
a);e.triggerEvent("plan","plan-update",{uiSource:b});"overview"===i&&e.triggerEvent("plan","refresh-overview")}})}}],open:function(){c.logEvent("edit_dates_dialog_show",{source:b});n.datepicker({minDate:"+1d",maxDate:"+3y",dateFormat:"M dd, yy",onSelect:function(){r(!1);p()}}).click(function(){n.datepicker("show")});z.datepicker({maxDate:null,dateFormat:"M dd, yy",onSelect:function(){p()}}).click(function(){z.datepicker("show")});r(!0);v=f(n.datepicker("getDate"));i=f(z.datepicker("getDate"));h.setupDialogOverlay(t,
!1);p()},close:function(){$(this).dialog("destroy").remove()}})}})}}});
define("plan/dock",["modules/events","jquery"],function(a){var c={},d={};c.dockUndockViews=function(){var a,c=$(window).height(),g=$(window).scrollTop()-$("#pageWrapper").offset().top;$("#pageHeader");var f=$("#planHeader");for(a in d)if(d.hasOwnProperty(a)){var b=d[a][0];if(b.is(":visible")){var j=d[a][1],m=j.dockTopAt,q=j.dockBottomAt,r=j.shouldDockBottom,p=j.canScroll,t=b.prop("scrollHeight"),n=j.scrollHeight;if(!j.disable){var z=t>j.contentHeight,k=g+f.height()+t+23;j.subNav&&(k+=j.subNav.height());
z&&!p?(b.removeClass("dock-top"),b.removeClass("dock-bottom"),n||b.removeClass("scrollable")):g<=m?(n||(b.removeClass("scrollable"),b.height("")),b.removeClass("dock-top"),b.removeClass("dock-bottom"),b.css("top","")):r&&k>q?b.hasClass("dock-bottom")||(b.addClass("dock-bottom"),b.removeClass("dock-top"),n||b.height(""),b.css("top","")):g>m&&(b.hasClass("dock-top")||(b.addClass("dock-top"),b.removeClass("dock-bottom")),m=Math.min(c,q-g+23),m-=f.height(),m-=23,m-=23,j.subNav&&(m-=j.subNav.height()),
n&&(m=n,t<m&&(m=t)),p&&(t>=m||z)?(b.css({height:m+"px"}),b.addClass("scrollable")):n||(b.height(""),b.removeClass("scrollable")),b.css("top",""))}}}};c.dockView=function(a,c,g,f,b,j,m,q,r){g={dockTopAt:g,dockBottomAt:f,contentHeight:b,shouldDockBottom:j,canScroll:m,subNav:q,scrollHeight:r};if(!d[a]||!d[a][1].disable)d[a]=[c,g]};c.undockView=function(a){d[a]&&(d[a][0].removeClass("dock-top").removeClass("dock-bottom").removeClass("scrollable").css({height:"",top:""}),delete d[a])};c.disableDock=function(a){d[a]&&
(d[a][0].removeClass("dock-top").removeClass("dock-bottom").removeClass("scrollable").css({height:"",top:""}),d[a][1].disable=!0)};c.enableDock=function(a){d[a]&&(d[a][1].disable=!1)};c.changeDockAttr=function(a,h){if(d[a])for(var g in h)if(d[a]){var f=d[a][1];f[g]&&(f[g]=h[g])}c.dockUndockViews()};c.initialize=function(){a.addObserver("scroll","dock",c.dockUndockViews)};return c});
define("modules/map",["jquery","qtip"],function(){var a=[],c={addToQueue:function(d){void 0===window.google||void 0===window.google.maps?a.push(d):d()},processQueue:function(){for(var d=a.shift();d;)d(),d=a.shift()},initializeOnLoad:function(){if("complete"===document.readyState)$.getScript("http://maps.googleapis.com/maps/api/js?sensor=false&callback=onGoogleMapsApiLoaded");else $(window).on("load",function(){$.getScript("http://maps.googleapis.com/maps/api/js?sensor=false&callback=onGoogleMapsApiLoaded")})}};
window.onGoogleMapsApiLoaded=function(){window.console.log("google maps api loaded");window.LabelMapMarker=function(a,c,h,g,f,b,j,m,q,r){a=$(document.createElement("span")).css({position:"absolute"}).addClass("sheet map-marker marker"+c).text(a);h&&a.addClass("checked");m&&a.addClass("map-marker-ring");void 0!==q&&a.data("stayId",q);r&&a.data("destinationId",r);this.span_=a[0];this.position_=g;this.infoWindow_=f;this.map_=b;this.controller_=j};window.LabelMapMarker.prototype=new window.google.maps.OverlayView;
window.LabelMapMarker.prototype.getMarkerSpan=function(){return this.span_};window.LabelMapMarker.prototype.onAdd=function(){this.getPanes().overlayMouseTarget.appendChild(this.span_);var a=this;this.listeners_=this.infoWindow_?[window.google.maps.event.addDomListener(this.span_,"click",function(){a.controller_?a.controller_.showInfoWindow(a.infoWindow_,!0,!0):a.infoWindow_.open(a.map_)}),window.google.maps.event.addDomListener(this.span_,"mouseover",function(){a.controller_?a.controller_.showInfoWindow(a.infoWindow_,
!1,!1):a.infoWindow_.open(a.map_)}),window.google.maps.event.addDomListener(this.span_,"mouseout",function(){a.controller_?a.controller_.hideInfoWindow(a.infoWindow_,!1):a.infoWindow_.close()})]:[]};window.LabelMapMarker.prototype.onRemove=function(){this.span_.parentNode.removeChild(this.span_);for(var a=0,a=0;a<this.listeners_.length;a++)window.google.maps.event.removeListener(this.listeners_[a])};window.LabelMapMarker.prototype.draw=function(){var a=this.getProjection().fromLatLngToDivPixel(this.position_),
c=this.span_;c.style.left=a.x-$(c).outerWidth()/2+"px";c.style.top=a.y-$(c).outerHeight()+5+"px";c.style.display="block"};c.processQueue()};return c});
define("jQueryExtensions/inspirockAutocomplete",["modules/ajax","jquery","jqueryui"],function(a){var c={id:void 0,label:"Start typing...",nightstay:!1,value:void 0,selectable:!1};c.li="<li>"+c.label+"</li>";var d={id:void 0,label:"Type another character...",nightstay:!1,value:void 0,selectable:!1};d.li="<li>"+d.label+"</li>";var e={id:void 0,label:"Searching...",nightstay:!1,value:void 0,selectable:!1};e.li="<li>"+e.label+"</li>";$.fn.inspirockAutocomplete=function(h){var g={};$(this).each(function(){var f=
$(this),b=null;f.data("id")&&f.data("label")&&(b=[{id:f.data("id"),label:f.data("label"),value:f.data("label")}]);var j;f.autocomplete({delay:100,minLength:0,appendTo:h.appendTo||".page-content",position:{my:"center top",at:"center bottom"},source:function(b,f){var p=b.term;j&&0===p.length||(0===p.length?f([c]):1===p.length?f([d]):(j&&(h.onDelete&&h.onDelete.call(this),j=void 0),g.hasOwnProperty(p)?f(g[p]):(f([e]),a.makeAJAXcall({url:h.url,type:"POST",data:b,success:function(b){try{var b=JSON.parse(b),
a;for(a=0;a<b.length;a++){var d=b[a].label;b[a].selectable=!0;for(var k=b[a],l=d,c=p.split(" "),i=void 0,i=0;i<c.length;i++)var e=c[i],e=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),l=l.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+e+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>");k.li="<li>"+l+"</li>"}h.onResult&&h.onResult.call(this,b,p);g[p]=b;f(b)}catch(y){}}}))))},focus:function(b,a){a.item.selectable||b.preventDefault()},select:function(b,a){if(a.item.selectable){j=a.item;b.preventDefault();if(a.item.id){var d=
$(a.item.label.replace(a.item.value,"")).text();f.val(a.item.value+d)}h.onSelect&&h.onSelect.call(this,b,a.item)}},response:function(b,a){1===a.content.length&&(!a.content[0].id||!a.content[0].selectable)?f.autocomplete("option","autoFocus",!1):f.autocomplete("option","autoFocus",!0)}}).focus(function(){var b=j?"":f.val();f.autocomplete("search",b)}).blur(function(){!f.val()&&j&&(j=void 0)}).keypress(function(b){13===b.keyCode&&(j&&h.onSubmit)&&h.onSubmit.call(this)});if(null!==b)for(var m=0;m<b.length;m++)j=
b[m];else f.val().length&&f.autocomplete("search",f.val());f.data("autocomplete")._renderItem=function(b,a){var d=$(a.li).html(),c=a.id?"":" invalid-data",d=$(a.li).empty().addClass("ui-menu-item").attr("role","presentation").attr("data-value",a.value).append(!a.selectable?$('<span class="nonselectable">'+d+"</span>"):$("<a class="+c+">"+d+"</a>").addClass("ui-corner-all").addClass("menu-list")).appendTo(b);h.extendDropdown&&(c=parseInt(d.children().css("paddingLeft"))+h.extendDropdown,d.children().css("paddingLeft",
c+"px").css("paddingRight",c+"px"));return d};h.extendDropdown&&(f.data("autocomplete")._resizeMenu=function(){this.menu.element.outerWidth(f.outerWidth()+2*h.extendDropdown)});f.data("inspirockAutocomplete",{getSelectedItem:function(){return j},clearPreviousItems:function(){f.val("");j=void 0},setItem:function(b){j=b;f.val(j.value)}});f.blur(function(){void 0===j&&f.val("")})})}});
define("jQueryExtensions/linkToCalendarAndMap",["modules/utils","jquery","jqueryui"],function(a){$.fn.linkToCalendarAndMinimap=function(c){var d=$(this),e=c.staySelector,h=c.stayListTitleSelector,g=c.stayListHighlightedClass,f=c.$calendar,b=c.$minimap,j=c.onlyHighlightedInteractive,m=c.highlightColor||"#fa8c00",q=c.listKey||"stayId",r=c.mapKey||"destinationId",p=c.calendarKey||"stayId",t=function(b){void 0!==f&&f.find("td").each(function(){var a=$(this);void 0!==a.data(p)&&a.data(p)===b&&a.addClass("highlighted")})},
n=function(b){void 0!==f&&f.find("td").each(function(){var a=$(this);void 0!==a.data(p)&&a.data(p)===b&&a.removeClass("highlighted")})},z=function(a,k){var l=b.data("infoWindowController");l&&l.showInfoWindowForStay(a,k,k,!0)},k=function(a,k){var l=b.data("infoWindowController");l&&l.hideInfoWindowForStay(a,k,!0)},l,v=function(b,a){var k;d.find(e).each(function(){if($(this).data(q)===b&&$(this).is(":visible"))return k=$(this),!1});void 0!==k&&(k.find(".marker").css({"background-color":"#fa8c00"}),
g?k.addClass(g):h&&k.find(h).css({color:m}),a&&(l=k))},i=function(b,k){var c,i;d.find(e).each(function(a){if($(this).data(q)===b&&$(this).is(":visible"))return c=$(this),i=a,!1});if(void 0!==c&&(k||!l||l&&c.data(q)!==l.data(q)))c.find(".marker").css({"background-color":a.getColor(i)}),g?c.removeClass(g):h&&c.find(h).css({color:""});k&&(l=void 0)};d.off("mouseenter.linkToCalendarAndMinimap").on("mouseenter.linkToCalendarAndMinimap",e,function(){var b=$(this).data(q),a=$(this).data(p),k=$(this).data(r);
v(b,!1);t(a);z(k,!1)});d.off("mouseleave.linkToCalendarAndMinimap").on("mouseleave.linkToCalendarAndMinimap",e,function(){var b=$(this).data(q),a=$(this).data(p),l=$(this).data(r);i(b,!1);n(a);k(l,!1)});void 0!==f&&(f.off("mouseenter.linkToCalendarAndMinimap").on("mouseenter.linkToCalendarAndMinimap","td",function(){var b=$(this).data(q),a=$(this).data(p),k=$(this).data(r);if(void 0!==b&&void 0!==a&&void 0!==k&&(!j||$(this).hasClass("highlight")))v(b),t(a),z(k)}),f.off("mouseleave.linkToCalendarAndMinimap").on("mouseleave.linkToCalendarAndMinimap",
"td",function(){var b=$(this).data(q),a=$(this).data(p),l=$(this).data(r);if(void 0!==b&&void 0!==a&&void 0!==l&&(!j||$(this).hasClass("highlight")))i(b),n(a),k(l)}));b.data("onInfoWindowShow",function(b,a,k){if(void 0===b||null===b)b=a;v(b,k);t(b);z(a,k)});b.data("onInfoWindowHide",function(b,a,l){if(void 0===b||null===b)b=a;i(b,l);n(b);k(a,l)})}});
define("jQueryExtensions/pager",["jquery"],function(){$.fn.preparePaging=function(a,c){function d(){var c=parseInt(e.data("currentPage"),10),d=a.find(".prev-page"),h=a.find(".next-page");0===c||0===g?d.addClass("disabled").removeAttr("title"):d.removeClass("disabled").attr("title",f);c===g-1||0===g?h.addClass("disabled").removeAttr("title"):h.removeClass("disabled").attr("title",b)}var e=$(this),h=e.find(".page"),g=h.length,f,b;e.width(100*g+"%");0<g&&h.css({width:100/g+"%"});if(a.length){var j=a.find(".prev-page"),
m=a.find(".next-page");f=j.attr("title");b=m.attr("title")}a.find(".next-page").click(function(){if(!$(this).hasClass("disabled")){var b=parseInt(e.data("currentPage"),10);e.is(":animated")||(e.animate({marginLeft:100*-(b+1)+"%"}),e.data("currentPage",b+1),d(),c&&e.height(h.eq(b+1).outerHeight()))}});a.find(".prev-page").click(function(){if(!$(this).hasClass("disabled")){var b=parseInt(e.data("currentPage"),10);e.is(":animated")||(e.animate({marginLeft:100*-(b-1)+"%"}),e.data("currentPage",b-1),d(),
c&&e.height(h.eq(b-1).outerHeight()))}});d()}});
define("jQueryExtensions/colorCalendar",["modules/utils","jquery","jqueryui"],function(a){$.fn.colorCalendar=function(){$(this).find("td").each(function(){var c=$(this),d=c.find(".day"),e=c.data("stayIndex");void 0!==e&&(e=a.getColor(e),c.removeClass("highlighted").find(".background").css({background:e}));d.hasClass("empty")?c.qtip({content:"You have open days in your plan.",style:{classes:"error-qtip qtip-light qtip-shadow"},position:{viewport:$(window)}}):d.hasClass("extra")&&c.qtip({content:"Your plan is going past your end date.",
style:{classes:"error-qtip qtip-light qtip-shadow"},position:{viewport:$(window)}})})}});
define("jQueryExtensions/minimap",["modules/utils","jquery","jqueryui"],function(a){$.fn.prepareMiniMap=function(c,d,e,h,g,f,b){var j=$(this).find(".mini-map, .large-map"),m=j.data("unit"),g=g||"destinationId",b=b||!1;if(j.length){h||(h=0);var q={center:new window.google.maps.LatLng(0,0),zoomControl:!b,scaleControl:j.hasClass("large-map"),mapTypeId:window.google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,keyboardShortcuts:!1,overviewMapControl:!1,scrollwheel:!1,streetViewControl:!1,draggable:!b,styles:[{featureType:"poi",
elementType:"labels",stylers:[{visibility:"off"}]}]},r=new window.google.maps.Map(j[0],q),p=new window.google.maps.LatLngBounds,t=[],n={},z={},k={},l;if(m)var v=window.google.maps.event.addListener(r,"idle",function(){var b=j.find(".gm-style-cc:not(.gmnoprint):contains(' m'),.gm-style-cc:not(.gmnoprint):contains(' km')").filter(function(){return"MILES"===m&&(a.endsWith($(this).text()," km")||a.endsWith($(this).text()," m"))||"KILOMETERS"===m&&!a.endsWith($(this).text()," km")&&!a.endsWith($(this).text(),
" m")});b.length&&b.click();window.google.maps.event.removeListener(v)});var i={showInfoWindow:function(a,c,d,e){if(!b){if(d&&void 0!==l&&l.uniqueId!==a){$(z[l.uniqueId].getMarkerSpan()).removeClass("highlight");var v=l.stayId,h=l.uniqueId;delete k[h];l.close();!e&&j.data("onInfoWindowHide")&&j.data("onInfoWindowHide")(v,h,d)}d=k[a]||i.createInfoWindow(a);f&&c&&(l=d);d.open(r);$(z[a].getMarkerSpan()).addClass("highlight");!e&&j.data("onInfoWindowShow")&&j.data("onInfoWindowShow")(d.stayId,d.uniqueId,
f&&c)}},hideInfoWindow:function(a,d,c){if(!b){if(d&&void 0!==l){$(z[l.uniqueId].getMarkerSpan()).removeClass("highlight");var i=l.stayId,e=l.uniqueId;l.close();l=void 0;!c&&j.data("onInfoWindowHide")&&j.data("onInfoWindowHide")(i,e,d)}i=k[a];void 0!==i&&i!==l&&($(z[a].getMarkerSpan()).removeClass("highlight"),delete k[a],i.close(),!c&&j.data("onInfoWindowHide")&&j.data("onInfoWindowHide")(i.stayId,i.uniqueId,d))}},showInfoWindowForStay:function(a,k,l,d){b||($(z[a].getMarkerSpan()).css({"z-index":10}).addClass("highlight"),
i.showInfoWindow(a,k,l,d))},hideInfoWindowForStay:function(a,k,l){b||($(z[a].getMarkerSpan()).css({"z-index":""}).removeClass("highlight"),i.hideInfoWindow(a,k,l))},createInfoWindow:function(a){if(!b){var a=n[a],l=a.data(g||"destinationId"),d=a.data("lat"),c=a.data("lng"),e=void 0!==a.data("stayId")?a.data("stayId"):a.data("targetStay"),v=a.data("name"),d=new window.google.maps.LatLng(d,c),c='<div class="info-window-content">';"attractionId"===g&&j.hasClass("landing")?(c+='<div class="attractionImage" style="background-image: url(\''+
a.data("imageLink")+"');\"></div>",c=c+'<div class="attractionText">'+('<a class="title clickable-text" href='+a.data("link")+">"+v+"</a>"),c+=a.find(".ins-rating")[0].outerHTML,c+="</div>",c+='<div class="clear"></div>'):"attractionId"===g?(c+='<div class="attractionImage" style="background-image: url(\''+a.data("imageLink")+"');\"></div>",c+='<div class="attractionText">',c+='<span class="title attractionDetailsLink clickable-text info-content" data-event-src="attraction-details.info-window" data-link='+
a.data("link")+">"+v+"</span>",c+='<div class="plan-schedule">',a.data("inPlan")?c+='<div class="in-your-plan">In your plan</div>':$("body").hasClass("edit-enabled")&&(c+='<button class="add-nearbyAttraction-button cta-button small" data-destination-id='+a.data("destinationId")+" data-attraction-id="+a.data("attractionId")+" data-name="+a.data("name")+" data-container-in-plan="+a.data("containerInPlan")+" data-in-plan="+a.data("inPlan")+" data-target-stay="+a.data("targetStay")+" data-is-schedulable="+
a.data("isSchedulable")+">+ Add</button>"),c+="</div></div>",c+='<div class="clear"></div>'):"destinationId"===g&&$("#plan").length&&j.parents(".top-cities").length&&j.hasClass("large-map")?(c+='<img src="'+a.data("photo")+'"></img>',c+='<div class="info-text">',c+='<div class="title">'+v+"</div>",c+='<div class="link"><span class="text-link clickable-text destinationDetailsLink" data-link="'+a.find(".text-link").attr("href")+'" data-event-src="destination-details.top-cities.map-info-window">details &raquo;</span></div>',
!a.data("inPlan")&&$("body").hasClass("edit-enabled")&&(c+='<button class="add-to-plan cta-button small" data-destination-id="'+a.data("destinationId")+'" data-name="'+a.data("name")+'">Add to plan</button>'),c+="</div>"):"destinationId"===g&&$("#plan").length&&j.parents(".nearby-nightstays").length&&j.hasClass("large-map")?(c+='<img src="'+a.data("photo")+'"></img>',c+='<div class="info-text">',c+='<div class="title">'+v+"</div>",c+='<div class="link"><span class="destinationDetailsLink clickable-text text-link" data-event-src="destination-details.nearby-nightstays.info-window" data-link="'+
a.find(".text-link").attr("href")+'">details &raquo;</span></div>',!a.data("inPlan")&&($("body").hasClass("edit-enabled")&&a.data("validDomain"))&&(c+='<button class="add-nearby-nightstay cta-button small" data-destination-id="'+a.data("destinationId")+'" data-name="'+a.data("name")+'">Add to plan</button>'),c+="</div>"):"destinationId"===g&&j.parents(".nearby-nightstays").length&&j.hasClass("large-map")?(c+='<img src="'+a.data("photo")+'"></img>',c+='<div class="info-text">',c+='<div class="title">'+
v+"</div>",c+='<div class="link"><a class="text-link" href="'+a.find(".text-link").attr("href")+'">details &raquo;</a></div>',c+="</div>"):"destinationId"===g&&j.hasClass("large-map")?(c+='<img src="'+a.data("photo")+'"></img>',c+='<div class="info-text">',c+='<div class="title">'+v+"</div>",c+='<div class="link"><a class="text-link" href="'+a.find(".text-link").attr("href")+'">details &raquo;</a></div>',c+='<button class="startplan cta-button small" data-destination-id="'+a.data("destinationId")+
'">Start a plan</button>',c+="</div>"):"destinationId"===g&&a.data("mapImg")?(c+='<img src="'+a.data("mapImg")+'"></img>',c+='<div class="info-text">',c+='<div class="title">'+v+"</div>",c+='<div class="link"><a class="text-link" href="'+a.find(".mobile-plan-title").data("link")+'">view details &raquo;</a></div>',c+="</div>"):c+='<div class="title">'+v+"</div>";c+="</div>";a=new window.google.maps.InfoWindow({content:c,position:d,disableAutoPan:!1,pixelOffset:new window.google.maps.Size(0,-38,"px",
"px"),stayId:e,uniqueId:l});window.google.maps.event.addListener(a,"closeclick",function(){i.hideInfoWindow(l,!0)});return k[l]=a}}};j.data("infoWindowController",i);d.each(function(b){var c=$(this),k=c.data(g),l=c.data("lat"),d=c.data("lng"),v=c.data("ignoreBounds")?!0:!1,f=void 0!==c.data("stayId")?c.data("stayId"):c.data("targetStay"),l=new window.google.maps.LatLng(l,d),d=c.data("mapMarkerColorIndex")||(j.data("singleColor")?5:b%a.getNumColors()),b=e?h+b+1:"",y=c.data("inPlan")?!0:!1;if(z[k])return!0;
n[k]=c;c=new window.LabelMapMarker(b,d,y,l,k,r,i,c.data("showMarkerRing"),f,k);c.setMap(r);z[k]=c;v||(p.extend(l),t.push(l))});var L=void 0===g||"destinationId"===g?7:16,y=void 0===g||"destinationId"===g?1===t.length?7:j.hasClass("large-map")?12:9:20,J=j.data("zoom"),u=!1,d=function(){if(j.is(":visible")&&(window.google.maps.event.trigger(r,"resize"),r&&p&&!u)){j.css("opacity",0);r.setCenter(p.getCenter());r.setZoom(L);var a=!0;window.google.maps.event.addListener(r,"idle",function(){var b,c=r.getBounds(),
k=c.getNorthEast();b=c.getSouthWest();c=c.toSpan();c=new window.google.maps.LatLng(0.1*c.lat(),0.1*c.lng());k=new window.google.maps.LatLng(k.lat()-c.lat(),k.lng()-c.lng());b=new window.google.maps.LatLng(b.lat()+c.lat(),b.lng()+c.lng());k=new window.google.maps.LatLngBounds(b,k);if(!J){for(b=0;b<t.length;b++)if(!k.contains(t[b])&&0<r.getZoom()){r.setZoom(r.getZoom()-1);a=!1;return}if(a&&r.getZoom()<y){r.setZoom(r.getZoom()+1);return}}window.google.maps.event.clearListeners(r,"idle");j.css("opacity",
1);u=!0})}};j.on("resize",d);if(c&&c.length)c.off("isVisible.init").on("isVisible.init",d);d()}}});
define("plan/route","modules/analytics modules/utils modules/ajax modules/events modules/attributions plan/loading plan/planUtils plan/dock plan/view modules/map jquery jqueryui jQueryExtensions/inspirockAutocomplete qtip jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager jQueryExtensions/colorCalendar jQueryExtensions/minimap".split(" "),function(a,c,d,e,h,g,f,b,j){function m(){C.find(".stay-row .marker").each(function(b){b=c.getColor(b);$(this).css({"background-color":b})})}function q(){$("#planHeader");
j.scrollAndUpdate()}function r(){var b=$(this).parents(".stay-row"),a=b.data("stayId"),c=b.data("duration"),b=b.data("name");M.updateStayDuration(a,b,c+1,"route.stay","route.stayRow.plusminus")}function p(){var b=$(this).parents(".stay-row"),a=b.data("stayId"),c=b.data("duration"),b=b.data("name");1<c&&M.updateStayDuration(a,b,c-1,"route.stay","route.stayRow.plusminus")}function t(){var b=$(this),c=$(this).parents(".stay-row"),k=c.data("name"),l=c.data("stayId"),c=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button" value="Delete Destination?"></div>'),
v=$(document.createElement("div"));a.trackEvent("route.stay","delete-stay",k.toLowerCase());c.click(function(){b.qtip("api").destroy();g.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan...");a.trackEvent("route.stay","delete-stay-confirm",k.toLowerCase());d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay/"+l+"/delete",data:{view:"overview"},type:"POST",synchronize:!0,complete:function(){g.hideLoading($("#planRecalculating"),$("#resultpageContent"))},
success:function(b){w.html(b);e.triggerEvent("route","overview-init");i();e.triggerEvent("route","stay-remove",{uiSource:"route.stayRow"});q()}})});v.append(c);b.qtip({overwrite:!0,content:v,position:{my:"top right",at:"top right",container:$("#route")},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(b,a){a.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}})}function n(){var b=$(this).siblings(".options-content"),a=$(this).find(".fa"),
c=$(this).siblings(".content");b.hasClass("hidden")?(a.removeClass("fa-chevron-down"),a.addClass("fa-chevron-up"),b.removeClass("hidden"),c.css("opacity","0")):(a.removeClass("fa-chevron-up"),a.addClass("fa-chevron-down"),b.addClass("hidden"),c.css("opacity","1"));q()}function z(){var b=$(this),c=b.siblings(".search-box").find("#dest-search").data("inspirockAutocomplete").getSelectedItem();if(!(void 0===c||null===c)){b.prop("disabled",!0);g.showLoading($("#planRecalculating"),$("#resultpageContent"),
"Updating Your Plan...");var k=c.id,l=c.value;d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",synchronize:!0,data:{destinationId:k,view:"overview"},complete:function(){b.prop("disabled",!1);g.hideLoading($("#planRecalculating"),$("#resultpageContent"))},success:function(b){w.html(b);e.triggerEvent("route","overview-init");i();e.triggerEvent("route","stay-add",{uiSource:"route.destinations.recalculate"});q();a.trackEvent("route.add","add-destination",l.toLowerCase());
e.triggerEvent("route","mmt_track_link",{linkName:"Recalculate"})}})}}function k(b){var c=$(this),k=c.parents(".dest-tile"),l=k.data("destinationId"),v=k.data("name");c.prop("disabled",!0);g.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan...");d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",synchronize:!0,data:{destinationId:l,view:"overview"},complete:function(){c.prop("disabled",!1);g.hideLoading($("#planRecalculating"),
$("#resultpageContent"))},success:function(b){w.html(b);e.triggerEvent("route","overview-init");i();e.triggerEvent("route","stay-add",{uiSource:"route.destinations.recommendation"});q();a.trackEvent("route.recommendations","add-recommended-destination",v.toLowerCase());e.triggerEvent("route","mmt_track_link",{linkName:"Add and Recalculate"})}});b.stopPropagation()}function l(){f.showEditDatesDialog("route")}function v(){C.find(".route").find(".marker").each(function(b){$(this).css("background-color",
c.getColor(b))})}function i(b,a){if(M.isExpanded()){if(a){if(a.destinationId&&(void 0===a.stayId||null===a.stayId))a.stayId=$(".route-rows [data-destination-id='"+a.destinationId+"']").data("stayId");N(a?a.stayId:void 0,!0)}}else C.find(".title-row").addClass("expanded"),C.find(".route-rows").removeClass("hidden"),C.find(".route-bottom-pane").removeClass("hidden"),C.find(".route-pane-content").addClass("hidden"),C.find(".title-row .routeLink").addClass("hidden"),C.find(".title-row .hideRouteLink").removeClass("hidden"),
C.find(".route-right-pane .mini-calendar").show(),C.find(".route-right-pane .edit-dates").removeClass("hidden"),e.triggerEvent("overview","show-tab-overview",a?a:{}),a&&(a.destinationId&&!a.stayId)&&(a.stayId=$(".route-rows [data-destination-id='"+a.destinationId+"']").data("stayId")),N(a?a.stayId:void 0,!1),v(),m()}function L(){M.isExpanded()&&(C.find(".title-row").removeClass("expanded"),C.find(".route-rows").addClass("hidden"),C.find(".route-bottom-pane").addClass("hidden"),C.find(".route-pane-content").removeClass("hidden"),
C.find(".title-row .routeLink").removeClass("hidden"),C.find(".title-row .hideRouteLink").addClass("hidden"),C.find(".route-right-pane .mini-calendar").hide(),C.find(".route-right-pane .edit-dates").addClass("hidden"),v(),m())}function y(){f.adjustRouteClick("route",{view:"overview"},function(b){w.html(b);e.triggerEvent("route","overview-init");i();e.triggerEvent("route","stay-update",{uiSource:"route.adjustRoute"});q()})}function J(){q()}function u(){b.undockView("route-right-pane")}function N(b,
a){var c=$(this),b=void 0!==b&&null!==b?b:c.data("stayId");window.setTimeout(function(){j.scrollElementIntoView("destinations-stay-row-"+b,-90,!a)},0)}var M={},w,C,s,P,O,R,D=!1;M.isDirty=function(){return D};M.refreshIfInvalid=function(){D&&(C.empty(),d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/route",type:"GET",success:function(b){C.html(b);M.initialize();q();D=!1}}))};M.updateStayDuration=function(b,c,k,l,i){g.showLoading($("#planRecalculating"),$("#resultpageContent"),
"Updating Your Plan...");var v=M.isExpanded();d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay/"+b+"/duration",data:{numDays:k,view:"overview"},type:"POST",synchronize:!0,complete:function(){g.hideLoading($("#planRecalculating"),$("#resultpageContent"))},success:function(b){w.html(b);e.triggerEvent("route","overview-init");v?M.expand():M.collapse();b={uiSource:i};a.trackEvent(l,"update-stay-duration",c.toLowerCase());e.triggerEvent("route","stay-update",b);q()}})};
M.isExpanded=function(){return C.find(".title-row .routeLink").hasClass("hidden")};M.expand=function(){i()};M.collapse=function(){L()};M.initialize=function(){w=$("#overview");C=$("#route");if(C.length){s=C.find("#routeMainPane");P=C.find("#routeRightPane");C.find("#routeBottomPane");O=C.find("#routeAddPane");R=C.find("#routeRecoPane");e.addObserver("refresh-route","route",M.refreshIfInvalid);e.addObserver("expand-route-section","route",i);e.addObserver("collapse-route-section","route",L);R.find(".pages").preparePaging(R.find(".paging"));
P.find(".mini-calendar").colorCalendar();$("#dest-search").inspirockAutocomplete({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/nightStayAutocomplete",appendTo:$("#routeAddPane"),onSelect:function(b){b.originalEvent&&b.originalEvent.originalEvent&&(b=b.originalEvent.originalEvent,("click"===b.type||"keydown"===b.type&&13===b.which)&&O.find(".recalc").trigger("click"))}});C.off("click.route").on("click.route",function(b){var b=$(b.target),c=b.data("eventLabel"),k=b.data("stayId");if(b.parents(".stay-title").length)k=
b.parents(".stay-title").data("stayId"),c="stay-title";else if(b.parents(".mini-calendar .no-highlight").length)k=b.parents(".mini-calendar .no-highlight").data("stayId"),c="calendar-box";else if(b.is(".map-marker")||b.parents(".mini-map .map-marker").length)k=b.is(".map-marker")?k:b.parents(".mini-map .map-marker").data("stayId"),c="map-marker";M.isExpanded()?b.is(".title-row")||b.parents(".title-row").length?(a.trackEvent("overview.route","collapse-route",c),L()):(b.parents(".mini-calendar").length||
b.parents(".mini-map").length)&&N(k,!0):(a.trackEvent("overview.route","expand-route",c),i("",{stayId:k}))});$(".route-row.stay-row").first().addClass("first");$(".route-row.stay-row").last().addClass("last");v();m();if($("#plan").data("editEnabled")){var b=s.find(".stay-row"),c=s.find(".drop-row");b.draggable({cursor:"move",helper:"clone",handle:".draggable-area",stack:"body",start:function(b,a){var c=$(this);c.addClass("dragging");a.helper.width(c.width())},stop:function(){$(this).removeClass("dragging");
c.removeClass("drop-ready")},drag:function(b,a){var k=$(this),l=a.helper.offset().top,d=l+a.helper.outerHeight(),i;c.each(function(){var b=$(this);if(2>=Math.abs(b.index()-k.index()))return!0;var a=b.offset().top-0,c=b.offset().top+b.outerHeight()+0;if(l<=c&&d>=a)return i=b,!1});i?i.hasClass("drop-ready")||(c.removeClass("drop-ready"),i.addClass("drop-ready")):c.removeClass("drop-ready")}});s.find(".drop-row").droppable({accept:".stay-row",tolerance:"touch",drop:function(c,k){var l=$(this),A=k.draggable,
v=A.data("stayId"),h=l.data("insertPos");A.index()<l.index()&&(h-=1);b.index(A)!==h&&(g.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan..."),d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay/"+v+"/move",data:{position:h},type:"POST",synchronize:!0,complete:function(){g.hideLoading($("#planRecalculating"),$("#resultpageContent"))},success:function(b){w.html(b);e.triggerEvent("route","overview-init");i();e.triggerEvent("route","stay-update",
{uiSource:"route.stayRow.drag"});a.trackEvent("route.stay","drag-drop",A.data("name").toLowerCase());q()}}))}})}s.off("click.plus-day").on("click.plus-day",".plus-day",r).off("click.minus-day").on("click.minus-day",".minus-day",p).off("click.delete").on("click.delete",".delete",t).off("click.options").on("click.options",".options",n).off("click.adjust").on("click.adjust",".adjust-route",y);O.off("click.add-dest").on("click.add-dest",".recalc",z);R.off("click.add-dest").on("click.add-dest",".add-dest",
k);P.off("click.edit-dates").on("click.edit-dates",".edit-dates",l);C.off("isVisible").on("isVisible",J).off("isHidden").on("isHidden",u);C.is(":visible")&&q()}};return M});
define("modules/modal","modules/utils modules/events modules/analytics modules/ajax plan/history jquery jqueryui".split(" "),function(a,c,d,e,h){function g(a){if(f.isOpen()||a)f.param.parentElement&&(f.param.element.appendTo(f.param.parentElement),f.staticData.isHidden&&f.param.element.addClass("hidden")),f.param.close&&f.param.close(b),f.content("")}var f={},b;f.open=function(d){g();f.param=d;if(!f.isOpen()){if(window.history.state)f.staticData=window.history.state.data&&window.history.state.data.parentId?
{history:{id:window.history.state.data.parentId,tabId:window.history.state.data.parentTabId},path:window.history.state.data.pathname}:{history:{id:window.history.state.id,tabId:window.history.state.tabId},path:location.pathname};else{var m=location.pathname.split("/modal/"),q=m[0].split("/")[3];f.staticData={history:{id:q,tabId:q},path:m[0]}}f.nestingLevel=0;m=d.dialogClass?d.dialogClass:"";f.scrollTop=$(window).scrollTop();$("#pageWrapper").addClass("modal-open").css("top",-f.scrollTop);b.dialog({title:d.title,
resizable:!1,modal:!0,draggable:!1,width:"970px",position:{my:"center top",at:"center top+75",of:$("body"),collision:"none"},dialogClass:"modal-box "+m,buttons:d.buttons,close:function(){var a=$("#pageWrapper");g(!0);a.removeClass("modal-open").css("top","");b.dialog("destroy").remove();f.param.close&&f.param.close(b);a.css({"max-height":"",overflow:""});$(window).scrollTop(f.scrollTop);h.push(f.staticData.history.id,f.staticData.history.tabId,f.staticData.path);a=$("#plan-nav").find("ul.tabs li.active").data("target");
c.triggerEvent("modal","refresh-"+a,{})},open:function(){a.setupDialogOverlay(b,!1);$(".modal-box .ui-dialog-titlebar .ui-dialog-titlebar-back").off("click.modalBox_back").on("click.modalBox_back",function(){f.back()});$(".modal-box .ui-dialog-titlebar").off("mousedown");$(".modal-box .ui-dialog-content").css("min-height","450px")},create:function(a,c){$(".modal-box .ui-dialog-titlebar").append('<a href="javascript:void(0);" class="ui-dialog-titlebar-back hidden" role="button"><span class="fa fa-angle-left"></span> Back</a>');
b.html("");b.append('<div class="modal-content"></div>');b.append('<div id="modalLoadingPane" class="modal-loading-pane hidden"><img class="progress-img" src="/res/images/assets/bulb.gif" alt="Loading..."><div class="progress-txt"></div></div>');d.create&&d.create(a,c)}});b.close=function(){b.dialog("close")}}if((m=f.param.data)&&m.history)m.history.data.parentId=f.staticData.history.id,m.history.data.parentTabId=f.staticData.history.tabId,m.history.data.pathname=f.staticData.path,h.push(m.history.id,
m.history.tabId,m.history.url,m.history.data);var r=function(){f.content(f.param.message);f.param.element&&0===f.param.element.parents(".modal-box").length&&(f.content(""),f.param.parentElement=f.param.element.parent(),f.staticData.isHidden=f.param.element.hasClass("hidden"),f.param.element.removeClass("hidden").show().appendTo(b.find(".modal-content").removeClass("hidden")),b.find("#modalLoadingPane").addClass("hidden"));f.param.open&&f.param.open(b);$(window).scrollTop(0)};0<f.nestingLevel++&&b.parent(".modal-box").find(".ui-dialog-titlebar-back").removeClass("hidden");
f.loading();f.param.ajaxParams&&(f.param.ajaxParams.success=function(b){f.param.message=b;f.param.ajaxParams.func&&f.param.ajaxParams.func.success&&(f.param.message=f.param.ajaxParams.func.success(b));r()},f.param.ajaxParams.complete=function(){f.param.ajaxParams.func&&f.param.ajaxParams.func.complete&&f.param.ajaxParams.func.complete()},e.makeAJAXcall(f.param.ajaxParams));r();return b};f.isOpen=function(){return $(".modal-box").length};f.loading=function(){b.find(".modal-content").addClass("hidden");
b.find("#modalLoadingPane").removeClass("hidden")};f.loadingComplete=function(){b.find(".modal-content").removeClass("hidden");b.find("#modalLoadingPane").addClass("hidden")};f.content=function(a){void 0!==a&&(b.find(".modal-content").html(a),f.loadingComplete())};f.back=function(){f.loading();h.pop()};f.getTab=function(){var b=location.pathname.split("/modal/");if(1!==b.length)return b[0].split("/")[3]};f.initialize=function(){b=$(document.createElement("div"));c.addObserver("back-btn","modal",function(){f.isOpen()&&
(f.loading(),1>=--f.nestingLevel&&$(".modal-box .ui-dialog-titlebar .ui-dialog-titlebar-back").addClass("hidden"),0>=f.nestingLevel&&b.dialog("close"),f.nestingLevel--)})};f.initialize();return f});
define("text",["module"],function(a){var c,d,e,h,g,f=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],b=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,j=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,m="undefined"!==typeof location&&location.href,q=m&&location.protocol&&location.protocol.replace(/\:/,""),r=m&&location.hostname,p=m&&(location.port||void 0),t={},n=a.config&&a.config()||{};c={version:"2.0.14",strip:function(a){if(a){var a=a.replace(b,""),c=a.match(j);c&&(a=c[1])}else a=
"";return a},jsEscape:function(b){return b.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:n.createXhr||function(){var b,a,c;if("undefined"!==typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!==typeof ActiveXObject)for(a=0;3>a;a+=1){c=f[a];try{b=new ActiveXObject(c)}catch(d){}if(b){f=[c];break}}return b},parseName:function(b){var a,
c,d=!1,i=b.lastIndexOf(".");a=0===b.indexOf("./")||0===b.indexOf("../");-1!==i&&(!a||1<i)?(a=b.substring(0,i),c=b.substring(i+1)):a=b;b=c||a;i=b.indexOf("!");-1!==i&&(d="strip"===b.substring(i+1),b=b.substring(0,i),c?c=b:a=b);return{moduleName:a,ext:c,strip:d}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(b,a,d,e){var i,h;i=c.xdRegExp.exec(b);if(!i)return!0;b=i[2];i=i[3];i=i.split(":");h=i[1];i=i[0];return(!b||b===a)&&(!i||i.toLowerCase()===d.toLowerCase())&&(!h&&!i||h===e)},finishLoad:function(b,
a,d,e){d=a?c.strip(d):d;n.isBuild&&(t[b]=d);e(d)},load:function(b,a,d,e){if(e&&e.isBuild&&!e.inlineText)d();else{n.isBuild=e&&e.isBuild;var i=c.parseName(b),e=i.moduleName+(i.ext?"."+i.ext:""),h=a.toUrl(e),f=n.useXhr||c.useXhr;0===h.indexOf("empty:")?d():!m||f(h,q,r,p)?c.get(h,function(a){c.finishLoad(b,i.strip,a,d)},function(b){d.error&&d.error(b)}):a([e],function(b){c.finishLoad(i.moduleName+"."+i.ext,i.strip,b,d)})}},write:function(b,a,d){if(t.hasOwnProperty(a)){var e=c.jsEscape(t[a]);d.asModule(b+
"!"+a,"define(function () { return '"+e+"';});\n")}},writeFile:function(b,a,d,e,i){var a=c.parseName(a),h=a.ext?"."+a.ext:"",f=a.moduleName+h,g=d.toUrl(a.moduleName+h)+".js";c.load(f,d,function(){var a=function(b){return e(g,b)};a.asModule=function(b,a){return e.asModule(b,g,a)};c.write(b,f,a,i)},i)}};if("node"===n.env||!n.env&&"undefined"!==typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])d=require.nodeRequire("fs"),c.get=
function(b,a,c){try{var e=d.readFileSync(b,"utf8");"\ufeff"===e[0]&&(e=e.substring(1));a(e)}catch(i){c&&c(i)}};else if("xhr"===n.env||!n.env&&c.createXhr())c.get=function(b,a,d,e){var i=c.createXhr(),h;i.open("GET",b,!0);if(e)for(h in e)e.hasOwnProperty(h)&&i.setRequestHeader(h.toLowerCase(),e[h]);if(n.onXhr)n.onXhr(i,b);i.onreadystatechange=function(){var c;if(4===i.readyState&&(c=i.status||0,399<c&&600>c?(c=Error(b+" HTTP status: "+c),c.xhr=i,d&&d(c)):a(i.responseText),n.onXhrComplete))n.onXhrComplete(i,
b)};i.send(null)};else if("rhino"===n.env||!n.env&&"undefined"!==typeof Packages&&"undefined"!==typeof java)c.get=function(b,a){var c,d,i=new java.io.File(b),e=java.lang.System.getProperty("line.separator"),i=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),"utf-8")),h="";try{c=new java.lang.StringBuffer;(d=i.readLine())&&(d.length()&&65279===d.charAt(0))&&(d=d.substring(1));for(null!==d&&c.append(d);null!==(d=i.readLine());)c.append(e),c.append(d);h=String(c.toString())}finally{i.close()}a(h)};
else if("xpconnect"===n.env||!n.env&&"undefined"!==typeof Components&&Components.classes&&Components.interfaces)e=Components.classes,h=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),g="@mozilla.org/windows-registry-key;1"in e,c.get=function(b,a){var c,d,i,f={};g&&(b=b.replace(/\//g,"\\"));i=new FileUtils.File(b);try{c=e["@mozilla.org/network/file-input-stream;1"].createInstance(h.nsIFileInputStream),c.init(i,1,0,!1),d=e["@mozilla.org/intl/converter-input-stream;1"].createInstance(h.nsIConverterInputStream),
d.init(c,"utf-8",c.available(),h.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),d.readString(c.available(),f),d.close(),c.close(),a(f.value)}catch(n){throw Error((i&&i.path||"")+": "+n);}};return c});define("text!templates/userComment.html",[],function(){return'<li class="comment">\n    <div>\n        <span class="username"></span>\n        <span class="time"></span>\n    </div>\n    <div class="message"><span class="answer"></span><a href="javascript:void(0);" class="delete"><i class="fa fa-times"></i> delete</a></div>\n</li>'});
define("text!templates/newCollaborator.html",[],function(){return'<div class="collaborator">\n    <div class="title"></div>\n    <input type="text" class="shaded name" placeholder="Name * (so you know who\'s who as you plan)">\n    <input type="text" class="shaded email" placeholder="Email * (we\'ll send an invitation to join this plan)">\n</div>'});define("text!templates/manageCollaborator.html",[],function(){return'<div class="collaborator clearfix">\n    <div class="name pull-left"></div>\n    <div class="email pull-left"></div>\n    <i class="delete fa fa-times pull-right clickable-text"></i>\n    <div class="clearfix"></div>\n    <div class="invite">has not joined <a href="javascript:void(0);" class="resend">resend invitation</a></div>\n</div>'});
define("text!templates/userInfo.html",[],function(){return'<div class="update-user-info">\n    <div class="message"></div>\n    <div class="column2"><input type="text" class="shaded firstname right-gap" placeholder="First Name *" id="signupFirstName"></div>\n    <div class="column2"><input type="text" class="shaded lastname left-gap" placeholder="Last Name *" id="signupLastName"></div>\n    <div class="clearfix"></div>\n    <div class="column">\n        <input type="text" class="shaded email" placeholder="Email *" id="signupUsername">\n    </div>\n    <div class="error-message"></div>\n</div>'});
define("plan/collaboration","modules/analytics modules/mixpanel modules/ajax modules/utils modules/events text!templates/newCollaborator.html text!templates/manageCollaborator.html text!templates/userInfo.html jquery jqueryui qtip".split(" "),function(a,c,d,e,h,g,f,b){function j(b,a,c,d,k,l,h){for(var i=$("<div></div>"),f=0;f<b;f++){var j=$(g);j.find(".title").text((e.numToStr(f+1)||"Add")+" "+c);i.append(j)}i.append($("<a>").append($("<i>").addClass("fa fa-plus")).append(d).addClass("add-more"));
i.dialog({resizable:!1,modal:!0,draggable:!1,title:a,width:"560px",dialogClass:"dlg-collab add-collaborator",buttons:{Send:function(){var b=i.find(".collaborator"),a=!1,c=[];b.each(function(){var b=$(this),d=b.find(".name"),b=b.find(".email"),i=d.val().trim(),l=b.val().trim();0===i.length&&0===l.length||(i.length&&e.validateEmail(l)&&e.isName(i)?c.push({name:i,email:l,role:k}):(a=!0,!i.length||!e.isName(i)?e.showErrorTooltip(d,"Please provide a valid name"):e.hideErrorTooltip(d),e.validateEmail(l)?
e.hideErrorTooltip(b):e.showErrorTooltip(b,"Please provide valid email")))});a||(c.length?(e.params.add("plan.collaborators.add.collaborators",c),e.params.add("plan.collaborators.add.role",k),e.params.add("plan.collaborators.add.commentParentId",l),e.params.add("post-login-url",location.href),r.requireUserNameExists({success:function(b,a){r.sendAddCollaboratorsRequest("collaboration.add-collaborator-dialog",c,k,l,i,b,a,h)}},!0)):e.showErrorTooltip(b.eq(0).find(".name"),"Please provide name"))}},open:function(){e.setupDialogOverlay(i,
!1);i.on("click",".add-more",function(){var b=$(g);b.find(".title").text((e.numToStr(i.find(".collaborator").length+1)||"Add")+" "+c);b.insertBefore($(this));i.dialog({position:{my:"center",at:"center",of:window}})})},close:function(b){$(".qtip-default.error").qtip("destroy");i.dialog("destroy").remove();h&&h.close&&h.close(b)}})}function m(b,g,n,j,k){if(!$(".dlg-collab.manage-collaborator").length){var l=$("<div></div>"),v=function(b){l.empty();for(var v=0;v<b.length;v++){var g=$(f);g.find(".name").text(b[v].name);
b[v].email&&g.find(".email").text(b[v].email);g.data("collaborator",b[v]);e.display(g.find(".invite"),b[v].inviteUrl&&!k);e.display(g.find(".delete.clickable-text"),!k);l.append(g)}l.off("click.x").on("click.x",".delete",function(){var b=$(this),k=b.parents(".collaborator"),i=k.data("collaborator"),e=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button" value="'+n+'"></div>');e.click(function(){b.qtip("api").destroy();d.makeAJAXcall({type:"POST",url:window.contextPath+
i.deleteUrl,success:function(){a.trackEvent("collaboration.manage-collaborator-dialog","delete-collaborator",j.toLowerCase());c.logEvent("delete_collaborator",{role:j});r.removeCollaboratorData({collaborator:i});h.triggerEvent("collaboration","collaborator-remove",{collaborator:i});k.remove();l.find(".collaborator").length||l.dialog("close")}})});b.qtip({overwrite:!0,content:e,position:{my:"top right",at:"top right",container:l},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},
events:{show:function(){k.addClass("dim")},hide:function(b,a){k.removeClass("dim");a.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}})});$(".collaborator .invite .resend").blur().off("click").on("click",function(){var b=$(this).parents(".collaborator"),k=b.data("collaborator");b.find(".invite").hide(100);d.makeAJAXcall({type:"POST",url:window.contextPath+k.inviteUrl,success:function(){a.trackEvent("collaboration.manage-collaborator-dialog","resend-invite",k.role.toLowerCase());
c.logEvent("resend_invite",{role:k.role});b.find(".invite").html("invitation sent successfully.");b.find(".invite").show(100)}})})};l.dialog({resizable:!1,modal:!0,draggable:!1,title:b,width:"465px",dialogClass:"dlg-collab manage-collaborator",open:function(){e.setupDialogOverlay(l,!1);v(g);l.dialog({position:{my:"center",at:"center",of:window}})},create:function(){var b="COTRAVELER"===j?"co-traveler":"friend";$(".dlg-collab.manage-collaborator").append('<div class="small-action add-cotraveler-from-manage"><a href="javascript:void(0);"><i class="fa fa-plus"></i>Add more '+
b+" to this plan</a></div>");$(".add-cotraveler-from-manage").off("click").on("click",function(){$(".dlg-collab.manage-collaborator").hide();var b=function(b){b&&("FRIEND"===j&&b.friends?v(b.friends):"COTRAVELER"===j&&b.cotravelers&&v(b.cotravelers))},a=function(b){$(".dlg-collab.manage-collaborator").show();b&&(b.handleObj&&"click"===b.handleObj.origType)&&l.dialog("close")};"COTRAVELER"===j?r.showAddCotravelerDialog(1,{success:b,close:a}):r.showAddFriendDialog(1,null,{success:b,close:a})})},close:function(){l.dialog("destroy").remove()}})}}
function q(b,a,c,d,k){var l={};l[d]=function(a){a=$(a.currentTarget);if(!a.data("clicked")){var c=b.find(".update-user-info"),l=c.find(".firstname"),h=c.find(".lastname"),f=c.find(".email"),l=l.val().trim(),h=h.val().trim(),f=f.is(":visible")?f.val().trim():void 0,g=!1,j='<div class="error-message">';l||(g=!0,j="Please provide first name");h||(g=!0,j=j+(j?"<br />":"")+"Please provide last name");if(!f||!e.validateEmail(f))g=!0,j+=j?"<br />":"",j+="Please provide a valid email address";var n=c.find(".error-message");
n.html("");g&&(n.length?n.html(j):c.find(".message").after());g||(c={firstname:l,lastname:h,email:f},a.data("clicked",!0),a.data("orginal-text",d),a.data("processing-text",r.collaborationTemplates.buttons.toProcessingText(d)),k.success(b,c))}};b.dialog({resizable:!1,modal:!0,draggable:!1,title:a,width:"465px",dialogClass:c,buttons:l,open:function(){e.setupDialogOverlay(b,!1);var a=b.find(".update-user-info").find(".email");window.registeredUserLoggedIn?a.hide():a.show()},create:function(){window.registeredUserLoggedIn||
(e.params.add("post-login-url",location.href),$("."+c).append('<div class="footer"><span class="account-text">Have an account?</span> <a class="login-link" href="javascript:void(0);">Log in to inspirock</a></div>'),$("."+c+" .login-link").off("click").on("click",function(){e.login()}))},close:function(){$(".qtip").qtip("destroy");b.dialog("destroy").remove();k&&k.close&&k.close()}})}var r={collaborationTemplates:{buttons:{"Request Access":"Requesting ...","ok, That's me":"Saving ...",toProcessingText:function(b){return r.collaborationTemplates.buttons[b]?
r.collaborationTemplates.buttons[b]:"Processing ..."}}},loginErrorModal:function(b){var a=$(document.createElement("div"));a.html("<p><center>"+b+"</center></p>");a.dialog({title:"Error",resizable:!1,modal:!0,draggable:!1,width:"350px",dialogClass:"errorDialog",buttons:{Login:function(){a.dialog("close");e.login()}},close:function(){a.dialog("destroy").remove()},open:function(){e.setupDialogOverlay(a,!1)}})},sendAddCollaboratorsRequest:function(b,f,g,j,k,l,v,i){d.makeAJAXcall({type:"POST",data:{collaborators:e.stringify(f),
commentParentId:j,user:e.stringify(v)},url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/collaborators",synchronize:!0,success:function(d){if(!l||r.userCreationSuccess(d,l))d&&d.error&&d.needsLogin?r.loginErrorModal(d.message):(a.trackEvent(b,"add-collaborator",g.toLowerCase()),c.logEvent("add_collaborator",{role:g}),h.triggerEvent("collaboration","mmt_track_link",{linkName:"Add "+g.toLowerCase()}),$("#plan").data("collaborationEnabled",!0),r.addCollaboratorData({collaborators:f}),h.triggerEvent("collaboration",
"collaborator-add",{collaborators:f}),i&&i.success&&i.success(d.additionalData),k&&k.dialog("close"))}})},showReadonlyCollaborationDialog:function(b,a){var c="COTRAVELER"===a?"co-travelers":"friends";m('Visible to <span class="bold">'+b.length+" "+c+"</span>",b,"",a?a:"",!0)},showAddFriendDialog:function(b,a,c){j(b,'Ask more <span class="bold">friends</span>',"friend","Add more friends","FRIEND",a,c)},showAddCotravelerDialog:function(b,a){j(b,'Add <span class="bold">co-travelers</span>',"co-traveler",
"Add more co-travelers","COTRAVELER",null,a)},showManageCotravelerDialog:function(){d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/cotravelers",success:function(b){m('Manage <span class="bold">co-travelers</span>',b,"delete co-traveler?","COTRAVELER")}})},showManageFriendDialog:function(){d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/friends",success:function(b){m('Visible to <span class="bold">'+b.length+" friend"+(1===
b.length?"":"s")+"</span>",b,"delete friend?","FRIEND")}})},addCollaboratorData:function(b){var a=$("#plan"),c=a.data("collaboratorNames"),d=a.data("cotravelerNames"),k;for(k in b.collaborators)c&&(c+=","),c+=b.collaborators[k].name;a.data("collaboratorNames",c);for(k in b.collaborators)"COTRAVELER"===b.collaborators[k].role&&(d&&(d+=","),d+=b.collaborators[k].name);a.data("cotravelerNames",d)},removeCollaboratorData:function(b){var a=$("#plan"),c=a.data("collaboratorNames").split(","),d=c.indexOf(b.collaborator.name),
k=a.data("cotravelerNames").split(","),b=k.indexOf(b.collaborator.name);-1<d&&(c.splice(d,1),a.data("collaboratorNames",e.joinArray(c,",")));-1<b&&(k.splice(b,1),a.data("cotravelerNames",e.joinArray(k,",")))},requireUserNameExists:function(a,c){if($("#plan").data("currentUserFirstname"))a&&a.success&&a.success();else{var d=c||'<div class="first">We don\'t seem to have your name...</div><div class="second">Please add your name to your profile so your friends know who you are:</div>',e=$("<div></div>").append(b);
e.find(".message").html(d);q(e,'Tell us <span class="bold">who you are</span>',"dlg-update-user-info","ok, That's me",a);a&&a.open&&a.open(e)}},requestAccessDialog:function(a){if($("#plan").data("currentUserFirstname"))a&&a.success&&a.success();else{var c=$("<div></div>").append(b);q(c,"Request Access","dlg-request-access-user-info","Request Access",a)}},isFriend:function(){return"OWNER"!==$("#plan").data("planUserRole")&&"COTRAVELER"!==$("#plan").data("planUserRole")},formatCollaboratorNames:function(b){for(var b=
b.split(","),a=b.length,c="",d=0;d<a;d++)if(0<d&&(d===a-1||2===d)?c+=" & ":0<d&&(c+=", "),2>d||3>=a)c+=b[d].trim();else{c+='<a href="javascript:void(0);" class="show-others">';c+=a-3+1;c+=" others</a>";break}return c},userCreationSuccess:function(b,c){if(b&&b.additionalData){if(b.additionalData.needsLogin)return r.loginErrorModal(b.additionalData.message),!1;if(b.additionalData.needsReload)return e.showErrorModal(b.additionalData.errorMessage,{"Reload Now":function(){window.location.href=document.location.pathname+
e.addUrlParam(document.location.search,"force_reload","")}}),!1}if(!b||!b.additionalData||!b.additionalData.signupUsername)return!0;if(c&&b&&b.errors&&b.errors.length){var d=c.find(".update-user-info"),f=d.find(".firstname"),k=d.find(".lastname"),d=d.find(".email"),l;for(l in b.errors){l=b.errors[l];"signupFirstName"===l.field?e.showErrorTooltip(f,l.error):"signupLastName"===l.field?e.showErrorTooltip(k,l.error):"signupUsername"===l.field&&e.showErrorTooltip(d,l.error);break}return!1}b.additionalData&&
b.additionalData.tempAccountCreated?(a.trackEvent("collaboration.user-info-dialog","create-temp-account"),e.showFlash("An account has been created for you and details have been sent to "+b.additionalData.email,!0),h.triggerEvent("collaboration","login",b.additionalData)):(a.trackEvent("collaboration.user-info-dialog","update-user-name"),h.triggerEvent("collaboration","login",b.additionalData),e.showFlash("An account has been created for you and details have been sent to "+b.additionalData.email,!0));
$("#plan").data("currentUserFirstname",!0);c.dialog("close");return!0}};return r});define("text!templates/commentsModal.html",[],function(){return'<div id="commentsModal">\n    <div class="bubbles">\n        <span class="fa fa-comment-o bubble1"></span>\n        <span class="fa fa-comment-o bubble2"></span>\n    </div>\n    <div class="content">\n        <div class="line1">\n            <span class="user"></span> has <span class="num-questions"></span> for you:\n        </div>\n        <div class="line1-alternative hidden">Someone has added you to the conversation about:</div>\n        <div class="question"></div>\n    </div>\n</div>'});
define("plan/collabQuestionsDialog",["modules/utils","text!templates/commentsModal.html"],function(a,c){function d(){if(g.length){var c=g[b];$("#commentsModal .content .user").html($("#plan").data("planOwnerFirstname"));$("#commentsModal .content .question").html(a.unescape(c.content.message))}}function e(){1<g.length&&q.removeClass("hidden");g.length===b+1?j.addClass("disabled"):j.removeClass("disabled");0===b?m.addClass("disabled"):m.removeClass("disabled")}var h={},g=[],f=!1,b=0,j,m,q,r,p=$("#plan"),
t=p.data("userId"),p=p.data("planUserRole"),n="OWNER"===p||"COTRAVELER"===p;h.addComments=function(h,k){if(k.parentId==k.itemId&&"1"!==a.getParameterByName("sto"))if(h){if(!(n||void 0===a.params.get("token"))){if(!f){r=$("<div></div>");var l=$(c);r.append(l);l="FRIEND"===$("#plan").data("collab-invite-role");a.display(r.find(".line1"),!l);a.display(r.find(".line1-alternative"),l);r.dialog({resizable:!1,modal:!0,draggable:!1,title:'Welcome to <span class="bold">'+$("#plan").data("planOwnerFirstname")+
"'s plan</span>",width:"560px",dialogClass:"dlg-collab inverted questions",buttons:{"ANSWER THIS":function(){var a=g[b];$("html,body").scrollTo("#comments-list-"+a.content.itemId,{duration:"slow",offsetTop:"50"});$("#comments-list-"+a.content.itemId+" .hide-show .fa").hasClass("fa-chevron-up")||$("#comments-list-"+a.content.itemId+" .action").trigger("click");$("#comments-list-"+a.content.itemId+" .response .new-comment").focus();r.dialog("destroy").remove()}},open:function(){a.setupDialogOverlay(r,
!1);q=$(".dlg-collab.questions .footer");m=q.find(".prev");j=q.find(".next");m.off("click").on("click",function(){$(this).hasClass("disabled")||(b--,e(),d())});j.off("click").on("click",function(){$(this).hasClass("disabled")||(b++,e(),d())})},create:function(){r.parent(".dlg-collab.questions").append('<div class="footer hidden"><div class="nav clearfix"><a href="javascript:void(0);" class="prev">&lsaquo; last question</a><a href="javascript:void(0);" class="next">next question &rsaquo;</a></div></div>')},
close:function(){r.dialog("destroy").remove()}});f=!0}l={};l.content=k;l.read=!1;g.push(l);l=1===g.length?"a question":g.length+" questions";$("#commentsModal .content .num-questions").html(l);1===g.length&&d();e()}}else{a:{for(l=0;l<g.length;l++)if(t==k.userId&&k.itemId==g[l].content.parentId)break a;l=-1}0<=l&&(g.splice(l,1),g.length<=b&&b--,0===g.length&&r.dialog("destroy").remove(),l=1===g.length?"a question":g.length+" questions",$("#commentsModal .content .num-questions").html(l),d(),e())}};
return h});define("text!templates/askQuestionWithNoCollab.html",[],function(){return'<div class="clearfix">\n    <textarea class="new-question" placeholder="Ask your question here... *"></textarea>\n    <div class="friends-info">\n    <input type="text" class="name" placeholder="Friend\'s Name * (so we know who\u2019s who)">\n    <input type="text" class="email" placeholder="Friend\'s Email * (we\'ll send an invitation to join this plan)">\n    </div>\n    <button class="cta-button small ask-question">Send</button>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Ask more friends</span>\n</div>'});
define("text!templates/askQuestionWithCollab.html",[],function(){return'<div class="with-collab clearfix">\n    <textarea class="new-question" placeholder="Ask your question here... *"></textarea>\n    <button class="cta-button small ask-question">Send</button>\n    <span class="collaborators">Visible to: <span class="names"></span></span>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Add a friend to this conversation</span>\n</div>'});
define("text!templates/conversation.html",[],function(){return'<li class="conversation">\n    <div class="question clearfix">\n        <div class="bubbles">\n            <i class="fa fa-comment-o bubble1"></i>\n            <i class="fa fa-comment-o bubble2"></i>\n        </div>\n        <div class="title"><span class="qtext"></span> <a href="javascript:void(0);" class="delete"><i class="fa fa-times"></i> delete</a></div>\n        <div class="hide-show text-link">\n            <span class="action">post a comment</span>\n            <i class="fa fa-chevron-down"></i>\n        </div>\n    </div>\n    <div class="comments hidden">\n        <div class="load-more-comments hidden">load more replies</div>\n        <ul class="comments-list"></ul>\n        <div class="response"></div>\n    </div>\n</li>'});
define("text!templates/postComment.html",[],function(){return'<div class="with-collab clearfix">\n    <textarea class="new-comment" placeholder="Post a comment here..."></textarea>\n    <button class="cta-button small post-comment">POST</button>\n    <span class="collaborators">Visible to: <span class="names"></span></span>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Add a friend to this conversation</span>\n</div>'});define("text!templates/postQuestion.html",[],function(){return'<div class="with-collab clearfix">\n    <textarea class="new-comment" placeholder="Post a question here..."></textarea>\n    <button class="cta-button small post-comment">POST</button>\n    <span class="collaborators">Visible to: <span class="names"></span></span>\n    <span class="add-friends clickable-text"><i class="fa fa-plus"></i>Add a friend to this conversation</span>\n</div>'});
define("text!templates/startConversation.html",[],function(){return'<li class="conversation" data-placeholder="true">\n    <div class="question clearfix">\n        <div class="bubbles">\n            <i class="fa fa-comment-o bubble1"></i>\n            <i class="fa fa-comment-o bubble2"></i>\n        </div>\n        <div class="title">Ask your friends</div>\n        <div class="desc">Get advice and recommendations from people you know who have been here before.</div>\n        <div class="hide-show text-link"><span class="action">start a conversation</span><i class="fa fa-chevron-down"></i></div>\n    </div>\n    <div class="comments hidden">\n        <div class="response"></div>\n    </div>\n</li>'});
define("text!templates/addFriends.html",[],function(){return'<div class="friends-info">\n<input type="text" class="name" placeholder="Name * (so you know who\'s who as you plan)">\n<input type="text" class="email" placeholder="Email * (we\'ll send an invitation to join this plan)">\n</div>'});define("text!templates/confirmUser.html",[],function(){return'<div id="confirmUser">\n    <div class="bubbles">\n        <span class="fa fa-comment-o bubble1"></span>\n        <span class="fa fa-comment-o bubble2"></span>\n    </div>\n    <div class="content">\n        <div class="line1">First things first...</div>\n        <div class="desc main">We want to make sure we keep track of who\'s who around here. This invitation was sent to</div>\n        <div class="desc alternative">We want to make sure we keep track of who\'s who around here. <span class="sentByname"></span> sent this invitation to</div>\n        <div class="desc">"<span class="name"></span>"</div>\n        <div class="desc">Is that you?</div>\n    </div>\n</div>'});
define("text!templates/noQuestionFriend.html",[],function(){return'<div class="line1">Got Advice?</div>\n<div class="line2">Your friend hasn\'t asked a specific question, but you can still give them feedback</div>'});define("text!templates/commentsWithoutQuestion.html",[],function(){return'<div class="line1">You\'ve got a Comment</div>\n<div class="line2">Your friends have begun to comment on your plan. If you\'d still like to ask them a specific question, you can. \n    <a href="javascript:void(0);" class="post-a-question">Post a question &raquo;</a></div>'});
define("plan/comments","modules/ajax modules/events text!templates/userComment.html moment modules/utils plan/collaboration plan/collabQuestionsDialog text!templates/askQuestionWithNoCollab.html text!templates/askQuestionWithCollab.html text!templates/conversation.html text!templates/postComment.html text!templates/postQuestion.html text!templates/startConversation.html text!templates/addFriends.html text!templates/confirmUser.html text!templates/noQuestionFriend.html text!templates/commentsWithoutQuestion.html modules/analytics modules/mixpanel".split(" "),
function(a,c,d,e,h,g,f,b,j,m,q,r,p,t,n,z,k,l,v){function i(b){var a=$(d);a.attr("id","comments-list-"+b.id);a.find(".username").text(b.author||"Anonymous");a.find(".time").text(b&&b.timestamp?e.utc(b.timestamp).fromNow():"");a.find(".message .answer").text(h.unescape(b.message));b.userId===$("#plan").data("user-id")||"FRIEND"!==$("#plan").data("planUserRole")?a.find(".message .delete").data("comment-id",b.id):a.find(".message .delete").remove();a.data("comment",b);return a}function L(b,a){if(0===
a){var c=b.data("questionPresent");b.find(".hide-show .action").text(c?"post a comment":"start a conversation");if(b.data("dummy")||g.isFriend()&&!c)c=b.parents(".collab-area"),J(c,null)}else b.find(".hide-show .action").text(a+(1<a?" replies":" reply"))}function y(b){var a=b.data("comment"),c=$("#comments-list-"+a.parentId),d=!1;$.each(c.find("li"),function(c,k){k=$(k);k.data("comment").timestamp>a.timestamp&&(k.hasClass("hidden")&&b.addClass("hidden"),k.before(b),d=!0)});d||c.append(b)}function J(b,
a){var c=b.find(".conversation"),c=c.data("reuse")?c:$(m);!a||!a.userId?("OWNER"!==$("#plan").data("planUserRole")&&"COTRAVELER"!==$("#plan").data("planUserRole")?c.find(".question .title .qtext").html(z):c.find(".question .title .qtext").html(k),c.find(".question .delete").addClass("hidden"),c.data("dummy",!0)):(c.find(".question .title .qtext").text(h.unescape(a.message)),h.display(c.find(".question .delete"),"OWNER"===$("#plan").data("planUserRole")||"COTRAVELER"===$("#plan").data("planUserRole")),
c.data("questionPresent",!0));a&&(c.data("commentId",a.id),c.find(".comments-list").attr("id","comments-list-"+a.id),c.find(".question .delete").data("comment-id",a.id),c.find(".question .delete").data("comment-parentId",a.parentId));c.find(".response.inline").addClass("hidden");c.data("reuse")||b.find(".conversation").remove();c.data("reuse",!0);b.append(c)}function u(b,a,c){var d=b.parents(".comments"),k=d.siblings(".new-comment-btn"),l=d.find(".load-more-comments");c?(b.append(a),a=b.children().length,
2<a&&(b.children().addClass("hidden").slice(-2).removeClass("hidden"),l.text("load more comments ("+(a-2)+" hidden)"),l.removeClass("hidden").click(function(){b.children().removeClass("hidden");l.addClass("hidden")}))):(y(a),k.removeClass("hidden"));a=b.children().length;L(b.parents(".conversation"),a)}function N(b,a){var c=$("#plan").data("collaboratorNames");if(b&&c){a.find(".response .collaborators").removeClass("hidden");a.find(".response .collaborators .names").html(g.formatCollaboratorNames(c));
var c=c.split(","),d=[];$.each(c,function(b,a){d.push({name:a})});a.find(".response .collaborators .names .show-others").off("click").on("click",function(){g.showReadonlyCollaborationDialog(d)})}else a.find(".response .collaborators .names").html(""),a.find(".response .collaborators").addClass("hidden")}function M(b,d,k,e,A,f,j){if(e.fullname){var K=e.fullname.split(" ");e.firstname=K[0];e.lastname=1<K.length?K.slice(1).join(" "):"";delete e.fullname}j&&(e.user=h.stringify(j));a.makeAJAXcall({url:k,
type:"POST",data:e,complete:function(){A&&A.complete&&A.complete()},success:function(a){if(g.userCreationSuccess(a,f))if(a&&a.needsLogin)g.loginErrorModal(a.message);else if(a&&a.errors&&a.errors.length){var k="",h;for(h in a.errors)k&&(k+="<br />"),k+=a.errors[h].error;f?f.find(".error-message").html(k):A&&A.error&&A.error(a)}else a=a.additionalData.comment,A&&A.success&&A.success(),k=$("#comments-list-"+a.parentId),k.length||(k=$("#comments-list-"+a.itemId),a.parentId!=a.itemId&&(J(k,{id:a.parentId,
parentId:a.itemId}),k=$("#comments-list-"+a.parentId))),k.length&&(B.push(a.id),a.parentId==a.itemId?J(k,a):(h=i(a),y(h),h=k.children().length,L(k.parents(".conversation"),h)),c.triggerEvent("comments","comment-added",a)),$("#plan").data("currentUserFirstname",!0),$("#plan").data("hasEmail",!0),e.collaborators&&(a=JSON.parse(e.collaborators),$("#plan").data("collaborationEnabled",!0),g.addCollaboratorData({collaborators:a}),c.triggerEvent("collaboration","collaborator-add",{collaborators:a})),l.trackEvent(b,
"post-comment"),v.logEvent("post_comment",{parentId:d}),e.isQuestion&&c.triggerEvent("collaboration","mmt_track_link",{linkName:"Start Conversation"})}})}function w(a,c){a.removeClass("hidden");c.find(".fa").removeClass("fa-chevron-down").addClass("fa-chevron-up");var d=c.parents(".conversation"),k=$("#plan").data("collaborationEnabled"),l=$("#plan").data("collaboratorNames");d.data("placeholder")?k&&l?d.find(".response").html(j):d.find(".response").html(b):d.find(".comments .response").html(q);N(k,
d);d=d.find(".response input, .response textarea").eq(0);d.length&&d.focus()}function C(b){b=$("#comments-list-"+b).parents(".collab-area");b.find(".conversation").remove();b.append(p);L(b.find(".conversation"),0)}function s(b){var b=$("#comments-list-"+b),a=b.data("comment");b.remove();b=$("#comments-list-"+a.parentId);L(b.parents(".conversation"),b.children().length)}function P(b,c,d,k){var d=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button" value="'+d+'"></div>'),
l=$(document.createElement("div"));d.click(function(){b.qtip("api").destroy();a.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/comment/"+c+"/delete",type:"POST",success:function(b){k&&k(b)}})});l.append(d);b.qtip({overwrite:!0,content:l,position:{my:"center left",at:"center left"},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(b,a){a.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}})}function O(b,
a){var c=$("#comments-list-"+b),d=c.parents(".conversation"),k=d.find(".hide-show"),l=c.parents(".collab-area"),e=k.parents(".question").siblings(".comments");w(e,k);$("html").scrollTo("#"+l.attr("id"),{duration:"slow",offsetTop:"50"});d.find(".new-comment").focus();c.is("ul")?a&&d.addClass("highlight"):(a&&c.addClass("highlight"),c.removeClass("hidden"))}function R(b,a){O(a.commentId,!1)}function D(b,a){var d=a.comments;if(d&&d.length){H=H.concat(d);d.sort(function(b,a){return b.itemId==b.parentId?
-1:b.timestamp-a.timestamp});for(var k=0;k<d.length;k++){var l=d[k],e=K,A=$("#comments-list-"+l.parentId);A.length||(A=$("#comments-list-"+l.itemId),l.parentId!=l.itemId&&(J(A,{id:l.parentId,parentId:l.itemId}),A=$("#comments-list-"+l.parentId)));A.length&&0>B.indexOf(l.id)&&(l.userId&&B.push(l.id),l.parentId==l.itemId?J(A,l):(l=i(l),u(A,l,e)))}c.triggerEvent("comments","comments-loaded",d)}!K&&(a.notifications&&a.notifications.length)&&$.each(a.notifications,function(b,a){"DELETE_COMMENT"===a.action&&
a.extra.commentId&&(a.extra.commentParentId==a.itemId?C(a.extra.commentId):s(a.extra.commentId));"ADD"===a.action&&"COLLABORATOR"===a.itemType&&(g.addCollaboratorData({collaborators:[{name:a.extra.collaboratorName,role:a.extra.collaboratorRole}]}),x());if(("REMOVE"===a.action||"LEAVE"===a.action)&&"COLLABORATOR"===a.itemType)g.removeCollaboratorData({collaborator:{name:a.extra.collaboratorName,role:a.extra.collaboratorRole}}),x(),$("#plan").data("userId")===a.itemId&&(window.location.href=document.location.pathname+
h.addUrlParam(document.location.search,"force_reload",""))});K&&((d=$("#plan").data("response-comment-id"))&&O(d,!0),d=h.params.get("plan.comments.post"),k=h.params.get("plan.collaborators.add"),d&&(d.data.user&&delete d.data.user,M("collaboration.post-login-action",d.parentId,d.url,d.data)),k&&g.sendAddCollaboratorsRequest("collaboration.post-login-action",k.collaborators,k.role,k.commentParentId),h.params.flush(),x(),$.each($(".conversation"),function(){var b=$(this).find(".comments-list li");L($(this),
b.length)}));K=!1}function x(){var b=$("#plan").data("collaborationEnabled");$.each($(".conversation"),function(){N(b,$(this))})}function A(){$(".comment").each(function(){var b=$(this),a=b.data("comment");b.find(".time").text(a&&a.timestamp?e.utc(a.timestamp).fromNow():"")})}var f={},B=[],K=!0,H=[];f.refreshComments=function(){H.sort(function(b,a){return b.timestamp-a.timestamp});for(var b=0;b<H.length;b++){var a=H[b],d=$("#comments-list-"+a.parentId);d.length||(d=$("#comments-list-"+a.itemId),a.parentId!=
a.itemId&&(J(d,{id:a.parentId,parentId:a.itemId}),d=$("#comments-list-"+a.itemId)));if(d.length)if(a.parentId==a.itemId)J(d,a);else{var k=i(a);u(d,k,!0)}}c.triggerEvent("comments","comment-added",a)};f.prepareCommentAreas=function(b){b.off("click.askquestion").on("click.askquestion",".ask-question,.post-comment",function(){var b=$(this),a=b.siblings("textarea"),c=a.parents(".collab-area").data("postUrl"),d=a.siblings(".friends-info"),k,e,A=a.parents(".conversation").data("commentId")||a.parents(".collab-area").data("commentParentId"),
i={message:a.val().trim(),parentId:A,fullname:$("#plan").data("collabInviteName")};i.isQuestion=b.parents(".inline").length?!0:!1;if(0===i.message.length)h.showErrorTooltip(a,"Please enter a comment"),a.off("blur").on("blur",function(){a.val().length&&h.hideErrorTooltip(a)});else{var v=function(){d.each(function(){k=$(this).find(".name").val().trim();e=$(this).find(".email").val().trim();if(!k.length&&!e.length)return h.hideErrorTooltip($(this).find(".email")),!0;k.length&&h.validateEmail(e)&&(i.collaborators.push({name:k,
email:e}),h.hideErrorTooltip($(this).find(".email")));k.length||(h.showErrorTooltip($(this).find(".name"),"Please provide your friend's name."),f=!0);h.isName(k)||(h.showErrorTooltip($(d[0]).find(".name"),"Friend's name cannot contain following characters <br /> (0-9<>[]{}()?/:;\"!@#$%^&*_+=)."),f=!0);e||(h.showErrorTooltip($(this).find(".email"),"Please provide your friend's email."),f=!0);h.validateEmail(e)||(h.showErrorTooltip($(this).find(".email"),"Please provide an valid email Id."),f=!0)})};
if(d.length){i.collaborators=[];var f=!1;v();if(f||0===i.collaborators.length){d.find(".name,.email").off("blur").on("blur",function(){v()});0===i.collaborators.length&&(k.length||h.showErrorTooltip($(d[0]).find(".name"),"Please provide your friend's name."),h.isName(k)||h.showErrorTooltip($(d[0]).find(".name"),"Friend's name cannot contain following characters <br /> (0-9<>[]{}()?/:;\"!@#$%^&*_+=)."),e||h.showErrorTooltip($(d[0]).find(".email"),"Please provide your friend's email."),h.validateEmail(e)||
h.showErrorTooltip($(this).find(".email"),"Please provide an valid email Id."));return}i.collaborators=JSON.stringify(i.collaborators)}h.params.add("plan.comments.post.data",i);h.params.add("plan.comments.post.url",c);h.params.add("plan.comments.post.parentId",A);h.params.add("post-login-url",location.href);a.attr("disabled","disabled");var B=function(b,d){M("collaboration",A,c,i,j,b,d);a.removeAttr("disabled")},j={success:function(b){a.val("");b&&b.dialog("close")},complete:function(){a.removeAttr("disabled")},
error:function(b){g.requireUserNameExists({success:B,close:function(){a.removeAttr("disabled")},open:function(a){if(b&&b.additionalData)for(var c in b.additionalData)a.find("#"+c).val(b.additionalData[c]);if(b&&b.additionalData){c="";for(var d in b.errors)c&&(c+="<br />"),c+=b.errors[d].error;a.find(".error-message").html(c)}}})}};if(!window.registeredUserLoggedIn&&!$("#plan").data("currentUserFirstname")&&"OWNER"!==$("#plan").data("planUserRole")){var K={success:B,close:function(){a.removeAttr("disabled")}};
$("#plan").data("plan-id");var m={},y=$("<div></div>");y.append(n);b="FRIEND"===$("#plan").data("collab-invite-role");h.display(y.find(".main"),!b);h.display(y.find(".alternative"),b);y.find(".name").text($("#plan").data("collabInviteName"));y.find(".sentByname").text($("#plan").data("collab-invite-user"));y.dialog({resizable:!1,modal:!0,draggable:!1,title:'Welcome to <span class="bold">'+$("#plan").data("planOwnerFirstname")+"'s plan</span>",width:"560px",dialogClass:"dlg-collab inverted confirm-user",
buttons:{"Yes, That's me":function(){m.token=$("#plan").data("collabInviteToken");y.dialog("close");K.success(null,m)},"No, Enter My Name":function(){y.dialog("close");g.requireUserNameExists({success:function(b,a){$("#plan").data("collabInviteToken","");K&&K.success&&K.success(b,a);l.trackEvent("collaboration.confirm-user-dialog","confirm-user","other")}},'<div class="second">Please add your name to your profile so your friends know who you are:</div>')}},open:function(){h.setupDialogOverlay(y,!1)},
close:function(){y.dialog("destroy").remove();K&&K.close&&K.close()}})}else g.requireUserNameExists({success:B,close:function(){a.removeAttr("disabled")}})}});b.off("click.addfriends").on("click.addfriends",".add-friends",function(){var b=$(this).siblings(".friends-info"),a=$(this).parents(".collab-area").data("commentParentId");b.length?$(b.last()).after(t):g.showAddFriendDialog(1,a)});b.off("click.tgl-comment").on("click.tgl-comment",".collab-area .hide-show,.collab-area .conversation .question .qtext",
function(){var b=$(this),a=b.parents(".question").siblings(".comments");b.hasClass("hide-show")||(b=$(b).parents(".title").siblings(".hide-show"));b.find(".fa").hasClass("fa-chevron-up")?(a.addClass("hidden"),b.find(".fa").removeClass("fa-chevron-up").addClass("fa-chevron-down"),b.parents(".collab-area").find(".error-qtip").qtip("destroy")):w(a,b);c.triggerEvent("comments","comment-toggle",{})});b.off("click.postAquestion").on("click.postAquestion",".post-a-question",function(){$(this).hasClass("hidden")||
($(this).parents(".question").append('<div class="response inline">'+r+"</div>"),x(),$(this).addClass("hidden"))});b.off("click.deleteComment").on("click.deleteComment",".message .delete",function(){var b=$(this).data("comment-id");P($(this),b,"Delete comment?",function(){s(b);l.trackEvent("collaboration","delete-comment")})});b.off("click.deleteQuestion").on("click.deleteQuestion",".question .delete",function(){var b=$(this).data("comment-id");P($(this),b,"Delete question?",function(){C(b);l.trackEvent("collaboration",
"delete-comment")})});b.off("click.newcomments").on("click.newcomments",".collab-area .new-comment-btn",function(){var b=$(this),a=b.siblings(".comments");b.addClass("hidden");a.each(function(){var b=$(this).children(".comments-list"),a=b.children(":visible").first();a.length?b.children().filter(function(){return $(this).data("comment").timestamp>a.data("comment").timestamp}).removeClass("hidden"):b.children().removeClass("hidden")})})};f.initialize=function(){c.addObserver("poll","comments",D);c.addObservers(["collaborator-add",
"collaborator-remove"],"comments",x);c.addObserver("scroll-to-comment","comments",R);window.setInterval(A,2E4)};return f});
(function(a){a.widget("ui.selectmenu",{options:{appendTo:"body",typeAhead:1E3,style:"dropdown",positionOptions:null,width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,escapeHtml:!1,bgImage:function(){}},_create:function(){var c=this,d=this.options,e=this.element.uniqueId().attr("id");this.ids=[e,e+"-button",e+"-menu"];this._safemouseup=!0;this.isOpen=!1;this.newelement=a("<a />",{"class":"ui-selectmenu ui-widget ui-state-default ui-corner-all",id:this.ids[1],role:"button",
href:"#nogo",tabindex:this.element.attr("disabled")?1:0,"aria-haspopup":!0,"aria-owns":this.ids[2]});this.newelementWrap=a("<span />").append(this.newelement).insertAfter(this.element);(e=this.element.attr("tabindex"))&&this.newelement.attr("tabindex",e);this.newelement.data("selectelement",this.element);this.selectmenuIcon=a('<span class="ui-selectmenu-icon ui-icon"></span>').prependTo(this.newelement);this.newelement.prepend('<span class="ui-selectmenu-status" />');this.element.bind({"click.selectmenu":function(a){c.newelement.focus();
a.preventDefault()}});this.newelement.bind("mousedown.selectmenu",function(a){c._toggle(a,!0);"popup"==d.style&&(c._safemouseup=!1,setTimeout(function(){c._safemouseup=!0},300));a.preventDefault()}).bind("click.selectmenu",function(a){a.preventDefault()}).bind("keydown.selectmenu",function(d){var e=!1;switch(d.keyCode){case a.ui.keyCode.ENTER:e=!0;break;case a.ui.keyCode.SPACE:c._toggle(d);break;case a.ui.keyCode.UP:d.altKey?c.open(d):c._moveSelection(-1);break;case a.ui.keyCode.DOWN:d.altKey?c.open(d):
c._moveSelection(1);break;case a.ui.keyCode.LEFT:c._moveSelection(-1);break;case a.ui.keyCode.RIGHT:c._moveSelection(1);break;case a.ui.keyCode.TAB:e=!0;break;case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.HOME:c.index(0);break;case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.END:c.index(c._optionLis.length);break;default:e=!0}return e}).bind("keypress.selectmenu",function(a){0<a.which&&c._typeAhead(a.which,"mouseup");return!0}).bind("mouseover.selectmenu",function(){d.disabled||a(this).addClass("ui-state-hover")}).bind("mouseout.selectmenu",
function(){d.disabled||a(this).removeClass("ui-state-hover")}).bind("focus.selectmenu",function(){d.disabled||a(this).addClass("ui-state-focus")}).bind("blur.selectmenu",function(){d.disabled||a(this).removeClass("ui-state-focus")});a(document).bind("mousedown.selectmenu-"+this.ids[0],function(d){c.isOpen&&!a(d.target).closest("#"+c.ids[1]).length&&c.close(d)});this.element.bind("click.selectmenu",function(){c._refreshValue()}).bind("focus.selectmenu",function(){c.newelement&&c.newelement[0].focus()});
d.width||(d.width=this.element.outerWidth());this.newelement.width(d.width);this.element.hide();this.list=a("<ul />",{"class":"ui-widget ui-widget-content","aria-hidden":!0,role:"listbox","aria-labelledby":this.ids[1],id:this.ids[2]});this.listWrap=a("<div />",{"class":"ui-selectmenu-menu"}).append(this.list).appendTo(d.appendTo);this.list.bind("keydown.selectmenu",function(d){var e=!1;switch(d.keyCode){case a.ui.keyCode.UP:d.altKey?c.close(d,!0):c._moveFocus(-1);break;case a.ui.keyCode.DOWN:d.altKey?
c.close(d,!0):c._moveFocus(1);break;case a.ui.keyCode.LEFT:c._moveFocus(-1);break;case a.ui.keyCode.RIGHT:c._moveFocus(1);break;case a.ui.keyCode.HOME:c._moveFocus(":first");break;case a.ui.keyCode.PAGE_UP:c._scrollPage("up");break;case a.ui.keyCode.PAGE_DOWN:c._scrollPage("down");break;case a.ui.keyCode.END:c._moveFocus(":last");break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:c.close(d,!0);a(d.target).parents("li:eq(0)").trigger("mouseup");break;case a.ui.keyCode.TAB:e=!0;c.close(d,!0);a(d.target).parents("li:eq(0)").trigger("mouseup");
break;case a.ui.keyCode.ESCAPE:c.close(d,!0);break;default:e=!0}return e}).bind("keypress.selectmenu",function(a){0<a.which&&c._typeAhead(a.which,"focus");return!0}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return!1});a(window).bind("resize.selectmenu-"+this.ids[0],a.proxy(c.close,this))},_init:function(){var c=this,d=this.options,e=[];this.element.find("option").each(function(){var b=a(this);e.push({value:b.attr("value"),text:c._formatText(b.text(),b),selected:b.attr("selected"),
disabled:b.attr("disabled"),classes:b.attr("class"),typeahead:b.attr("typeahead"),parentOptGroup:b.parent("optgroup"),bgImage:d.bgImage.call(b)})});var h="popup"==c.options.style?" ui-state-active":"";this.list.html("");if(e.length)for(var g=0;g<e.length;g++){var f={role:"presentation"};e[g].disabled&&(f["class"]="ui-state-disabled");var b={html:e[g].text||"&nbsp;",href:"#nogo",tabindex:-1,role:"option","aria-selected":!1};e[g].disabled&&(b["aria-disabled"]=!0);e[g].typeahead&&(b.typeahead=e[g].typeahead);
b=a("<a/>",b).bind("focus.selectmenu",function(){a(this).parent().mouseover()}).bind("blur.selectmenu",function(){a(this).parent().mouseout()});f=a("<li/>",f).append(b).data("index",g).addClass(e[g].classes).data("optionClasses",e[g].classes||"").bind("mouseup.selectmenu",function(b){c._safemouseup&&(!c._disabled(b.currentTarget)&&!c._disabled(a(b.currentTarget).parents("ul > li.ui-selectmenu-group ")))&&(c.index(a(this).data("index")),c.select(b),c.close(b,!0));return!1}).bind("click.selectmenu",
function(){return!1}).bind("mouseover.selectmenu",function(b){!a(this).hasClass("ui-state-disabled")&&!a(this).parent("ul").parent("li").hasClass("ui-state-disabled")&&(b.optionValue=c.element[0].options[a(this).data("index")].value,c._trigger("hover",b,c._uiHash()),c._selectedOptionLi().addClass(h),c._focusedOptionLi().removeClass("ui-selectmenu-item-focus ui-state-hover"),a(this).removeClass("ui-state-active").addClass("ui-selectmenu-item-focus ui-state-hover"))}).bind("mouseout.selectmenu",function(b){a(this).is(c._selectedOptionLi())&&
a(this).addClass(h);b.optionValue=c.element[0].options[a(this).data("index")].value;c._trigger("blur",b,c._uiHash());a(this).removeClass("ui-selectmenu-item-focus ui-state-hover")});e[g].parentOptGroup.length?(b="ui-selectmenu-group-"+this.element.find("optgroup").index(e[g].parentOptGroup),this.list.find("li."+b).length?this.list.find("li."+b+":last ul").append(f):a('<li role="presentation" class="ui-selectmenu-group '+b+(e[g].parentOptGroup.attr("disabled")?' ui-state-disabled" aria-disabled="true"':
'"')+'><span class="ui-selectmenu-group-label">'+e[g].parentOptGroup.attr("label")+"</span><ul></ul></li>").appendTo(this.list).find("ul").append(f)):f.appendTo(this.list);if(d.icons)for(var j in d.icons)f.is(d.icons[j].find)&&(f.data("optionClasses",e[g].classes+" ui-selectmenu-hasIcon").addClass("ui-selectmenu-hasIcon"),b=d.icons[j].icon||"",f.find("a:eq(0)").prepend('<span class="ui-selectmenu-item-icon ui-icon '+b+'"></span>'),e[g].bgImage&&f.find("span").css("background-image",e[g].bgImage))}else a('<li role="presentation"><a href="#nogo" tabindex="-1" role="option"></a></li>').appendTo(this.list);
g="dropdown"==d.style;this.newelement.toggleClass("ui-selectmenu-dropdown",g).toggleClass("ui-selectmenu-popup",!g);this.list.toggleClass("ui-selectmenu-menu-dropdown ui-corner-bottom",g).toggleClass("ui-selectmenu-menu-popup ui-corner-all",!g).find("li:first").toggleClass("ui-corner-top",!g).end().find("li:last").addClass("ui-corner-bottom");this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",g).toggleClass("ui-icon-triangle-2-n-s",!g);"dropdown"==d.style?this.list.width(d.menuWidth?d.menuWidth:
d.width):this.list.width(d.menuWidth?d.menuWidth:d.width-d.handleWidth);this.list.css("height","auto");g=this.listWrap.height();j=a(window).height();j=d.maxHeight?Math.min(d.maxHeight,j):j/3;g>j&&this.list.height(j);this._optionLis=this.list.find("li:not(.ui-selectmenu-group)");this.element.attr("disabled")?this.disable():this.enable();this._refreshValue();this._selectedOptionLi().addClass("ui-selectmenu-item-focus");clearTimeout(this.refreshTimeout);this.refreshTimeout=window.setTimeout(function(){c._refreshPosition()},
200)},destroy:function(){this.element.removeData(this.widgetName).removeClass("ui-selectmenu-disabled ui-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu");a(window).unbind(".selectmenu-"+this.ids[0]);a(document).unbind(".selectmenu-"+this.ids[0]);this.newelementWrap.remove();this.listWrap.remove();this.element.unbind(".selectmenu").show();a.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(a,d){var e=this,h=String.fromCharCode(a).toLowerCase(),g=null,f=null;e._typeAhead_timer&&
(window.clearTimeout(e._typeAhead_timer),e._typeAhead_timer=void 0);e._typeAhead_chars=(void 0===e._typeAhead_chars?"":e._typeAhead_chars).concat(h);2>e._typeAhead_chars.length||e._typeAhead_chars.substr(-2,1)===h&&e._typeAhead_cycling?(e._typeAhead_cycling=!0,g=h):(e._typeAhead_cycling=!1,g=e._typeAhead_chars);for(var h=("focus"!==d?this._selectedOptionLi().data("index"):this._focusedOptionLi().data("index"))||0,b=0;b<this._optionLis.length;b++)if(this._optionLis.eq(b).text().substr(0,g.length).toLowerCase()===
g)if(e._typeAhead_cycling){if(null===f&&(f=b),b>h){f=b;break}}else f=b;null!==f&&this._optionLis.eq(f).find("a").trigger(d);e._typeAhead_timer=window.setTimeout(function(){e._typeAhead_timer=void 0;e._typeAhead_chars=void 0;e._typeAhead_cycling=void 0},e.options.typeAhead)},_uiHash:function(){var c=this.index();return{index:c,option:a("option",this.element).get(c),value:this.element[0].value}},open:function(a){if("true"!=this.newelement.attr("aria-disabled")){var d=this.options,e=this._selectedOptionLi(),
h=e.find("a");this._closeOthers(a);this.newelement.addClass("ui-state-active");this.list.attr("aria-hidden",!1);this.listWrap.addClass("ui-selectmenu-open");"dropdown"==d.style?this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"):this.list.css("left",-5E3).scrollTop(this.list.scrollTop()+e.position().top-this.list.outerHeight()/2+e.outerHeight()/2).css("left","auto");this._refreshPosition();h.length&&h[0].focus();this.isOpen=!0;this._trigger("open",a,this._uiHash())}},close:function(a,
d){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.listWrap.removeClass("ui-selectmenu-open"),this.list.attr("aria-hidden",!0),"dropdown"==this.options.style&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),d&&this.newelement.focus(),this.isOpen=!1,this._trigger("close",a,this._uiHash()))},change:function(a){this.element.trigger("change");this._trigger("change",a,this._uiHash())},select:function(a){if(this._disabled(a.currentTarget))return!1;
this._trigger("select",a,this._uiHash())},widget:function(){return this.listWrap.add(this.newelementWrap)},_closeOthers:function(c){a(".ui-selectmenu.ui-state-active").not(this.newelement).each(function(){a(this).data("selectelement").selectmenu("close",c)});a(".ui-selectmenu.ui-state-hover").trigger("mouseout")},_toggle:function(a,d){this.isOpen?this.close(a,d):this.open(a)},_formatText:function(c,d){this.options.format?c=this.options.format(c,d):this.options.escapeHtml&&(c=a("<div />").text(c).html());
return c},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find(".ui-selectmenu-item-focus")},_moveSelection:function(a,d){if(!this.options.disabled){var e=parseInt(this._selectedOptionLi().data("index")||0,10)+a;0>e&&(e=0);e>this._optionLis.size()-1&&(e=this._optionLis.size()-1);if(e===d)return!1;this._optionLis.eq(e).hasClass("ui-state-disabled")?(0<a?++a:--a,
this._moveSelection(a,e)):this._optionLis.eq(e).trigger("mouseover").trigger("mouseup")}},_moveFocus:function(a,d){var e=isNaN(a)?parseInt(this._optionLis.filter(a).data("index"),10):parseInt(this._focusedOptionLi().data("index")||0,10)+a;0>e&&(e=0);e>this._optionLis.size()-1&&(e=this._optionLis.size()-1);if(e===d)return!1;var h="ui-selectmenu-item-"+Math.round(1E3*Math.random());this._focusedOptionLi().find("a:eq(0)").attr("id","");this._optionLis.eq(e).hasClass("ui-state-disabled")?(0<a?++a:--a,
this._moveFocus(a,e)):this._optionLis.eq(e).find("a:eq(0)").attr("id",h).focus();this.list.attr("aria-activedescendant",h)},_scrollPage:function(a){var d=Math.floor(this.list.outerHeight()/this._optionLis.first().outerHeight());this._moveFocus("up"==a?-d:d)},_setOption:function(a,d){this.options[a]=d;"disabled"==a&&(d&&this.close(),this.element.add(this.newelement).add(this.list)[d?"addClass":"removeClass"]("ui-selectmenu-disabled ui-state-disabled").attr("aria-disabled",d).attr("tabindex",d?1:0))},
disable:function(a,d){"undefined"==typeof a?this._setOption("disabled",!0):this._toggleEnabled(d||"option",a,!1)},enable:function(a,d){"undefined"==typeof a?this._setOption("disabled",!1):this._toggleEnabled(d||"option",a,!0)},_disabled:function(c){return a(c).hasClass("ui-state-disabled")},_toggleEnabled:function(a,d,e){var h=this.element.find(a).eq(d);if(a="optgroup"===a?this.list.find("li.ui-selectmenu-group-"+d):this._optionLis.eq(d))a.toggleClass("ui-state-disabled",!e).attr("aria-disabled",
!e),e?h.removeAttr("disabled"):h.attr("disabled","disabled")},index:function(c){if(arguments.length)if(!this._disabled(a(this._optionLis[c]))&&c!=this._selectedIndex())this.element[0].selectedIndex=c,this._refreshValue(),this.change();else return!1;else return this._selectedIndex()},value:function(a){if(arguments.length&&a!=this.element[0].value)this.element[0].value=a,this._refreshValue(),this.change();else return this.element[0].value},_refreshValue:function(){var a="popup"==this.options.style?
" ui-state-active":"",d="ui-selectmenu-item-"+Math.round(1E3*Math.random());this.list.find(".ui-selectmenu-item-selected").removeClass("ui-selectmenu-item-selected"+a).find("a").attr("aria-selected","false").attr("id","");this._selectedOptionLi().addClass("ui-selectmenu-item-selected"+a).find("a").attr("aria-selected","true").attr("id",d);var a=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"",e=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):
"";this.newelement.removeClass(a).data("optionClasses",e).addClass(e).find(".ui-selectmenu-status").html(this._selectedOptionLi().find("a:eq(0)").html());this.list.attr("aria-activedescendant",d)},_refreshPosition:function(){var c=this.options,d={of:this.newelement,my:"left top",at:"left bottom",collision:"flip"};if("popup"==c.style){var e=this._selectedOptionLi();d.my="left top"+(this.list.offset().top-e.offset().top-(this.newelement.outerHeight()+e.outerHeight())/2);d.collision="fit"}this.listWrap.removeAttr("style").zIndex(this.element.zIndex()+
2).position(a.extend(d,c.positionOptions))}})})(jQuery);define("selectmenu",["jquery","jqueryui"],function(){});
define("plan/visits","modules/analytics modules/mixpanel modules/utils modules/ajax modules/events moment jquery selectmenu".split(" "),function(a,c,d,e,h,g){var f={removeFromPlan:function(b){var a=b.visitId;e.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+a+"/delete",type:"POST",data:{view:b.view},synchronize:!0,success:function(a){void 0!==b.successCB&&b.successCB(a)},complete:function(){void 0!==b.completeCB&&b.completeCB()}})},displayVisitDialog:function(b){e.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/visit/"+b.visitId,type:"GET",success:function(a){var c=$(document.createElement("div"));c.html(a);var h=c.find(".visitDate"),g=$(window).scrollTop();c.dialog({title:b.visitName,resizable:!1,modal:!0,draggable:!1,dialogClass:"visitReservedDialog",buttons:{Cancel:function(){c.dialog("close")},Save:function(){var a={date:h.val(),startTime:c.find(".visitStartTime").val(),endTime:c.find(".visitEndTime").val(),notes:c.find(".notesTextArea").val(),view:b.view};e.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/visit/"+b.visitId,type:"POST",data:a,synchronize:!0,success:function(a){b.successCB(a)},complete:function(){c.dialog("close")}})},Delete:function(){b.deleteData.completeCB=function(){c.dialog("close")};f.removeFromPlan(b.deleteData)}},open:function(){d.setupDialogOverlay(c,!1)},close:function(){"DayByDay"===b.view&&($(this).dialog("destroy").remove(),void 0!==b.closeCB&&b.closeCB(g))}})}})},showAddVisitDialog:function(b){a.trackEvent(b.analyticsCategory,"add-attraction",
b.attractionName.toLowerCase());var f={};b.attractionId&&(f.attractionId=b.attractionId);b.additionalPostData&&(f.stayId=b.additionalPostData.stayId);e.makeAJAXcall({type:"GET",data:f,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/addVisitDialog",success:function(f){var j=$(f),r=j.find("#destination"),p=j.find("#day"),t=j.find("#startTime"),n=j.find("#endTime"),z=j.find("#attraction"),k=j.find("#stayDates"),l=j.find("#needsNewDestination"),v=j.find(".error-message");if(0>=l.length)var i=
function(){p.empty();p.append('<option value="-1">Select Day</option>');k.find("[data-destination-id="+r.val()+"]").each(function(){for(var b=g.utc($(this).data("startDate"),"MMM D, YYYY"),a=$(this).data("startDayNumber"),c=$(this).data("endDayNumber");a<=c;a++)p.append('<option value="'+a+'"> Day '+a+" / "+b.format("MMM D")+"</option>"),b.add(1,"day")});p.selectmenu("destroy");p.selectmenu({appendTo:j})};j.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-add-activity",buttons:[{html:"Add",
click:function(d){var k=$(d.currentTarget),d={};if(0<l.length)d.attractionId=l.data("attractionId"),d.destinationId=l.data("destinationId"),b.additionalPostData&&$.extend(d,b.additionalPostData),k.prop("disabled",!0),e.makeAJAXcall({type:"POST",data:d,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visitAndStay",synchronize:!0,success:function(c){b.successCB&&b.successCB(c);c={uiSource:b.uiSource};h.triggerEvent(b.eventSource,"stay-add",c);h.triggerEvent(b.eventSource,"visit-add",c);a.trackEvent(b.analyticsCategory,
"add-attraction-confirm",b.attractionName.toLowerCase());j.dialog("close")},error:function(){j.dialog("close")},complete:function(){k.prop("disabled",!1);b.completeCB&&b.completeCB()}});else{var i=z.data("inspirockAutocomplete").getSelectedItem(),f=void 0!==i?i.id:void 0,g=r.val(),m=parseInt(p.val(),10),w=parseInt(t.val(),10),C=parseInt(n.val(),10);f&&(d.destinationId=g,d.attractionId=f,b.additionalPostData&&$.extend(d,b.additionalPostData),b.userTimeInputRequired&&(-1===m||-1===w||-1===C)?v.html("Please choose the schedule."):
-1!==w&&-1!==C&&w>=C?v.html("Start Time must be lesser than End Time"):-1!==m&&(-1!==w&&-1!==C)&&(d.dayNumber=m,d.fromTime=w,d.toTime=C,k.prop("disabled",!0),e.makeAJAXcall({type:"POST",data:d,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit",synchronize:!0,success:function(d){b.successCB&&b.successCB(d);h.triggerEvent(b.eventSource,"visit-add",{uiSource:b.uiSource});a.trackEvent(b.analyticsCategory,"add-attraction-confirm",i.value.toLowerCase());c.logEvent("add_attraction_saved",
{source:b.uiSource});j.dialog("close")},complete:function(){k.prop("disabled",!1);b.completeCB&&b.completeCB()}})))}}}],open:function(){d.setupDialogOverlay(j,!1);c.logEvent("add_attraction_dialog_show",{source:b.uiSource});if(!(0<l.length)){z.inspirockAutocomplete({appendTo:j.parents(".ui-dialog"),url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/attractionAutocomplete?destinationId="+r.val()});z.data("inspirockAutocomplete").setItem({id:z.data("id"),label:z.data("label"),value:z.data("label")});
t.selectmenu({appendTo:j});n.selectmenu({appendTo:j});t.linkToEndTimeSelect(n);var a=function(){var b=$(this);if(-1===parseInt(b.val(),10)){var a=b.data("valueOnOpen");b.selectmenu("value",a);a=b.find("option[value="+a+"]").index();$("#"+b.attr("id")+"-menu").find("li").eq(a).find("a").trigger("focus")}};t.on("selectmenuopen",a);n.on("selectmenuopen",a);b.prePopulateAttraction&&(z.data("id",b.prePopulateAttraction.id),z.data("label",b.prePopulateAttraction.label));p.selectmenu({appendTo:j});b.hideDestinationSelect?
(r.addClass("hidden"),b.defaultDestinationId&&r.find('option[value="'+b.defaultDestinationId+'"]').attr("selected","selected")):(r.selectmenu({change:function(){i();z.data("inspirockAutocomplete").clearPreviousItems()}}),b.defaultDestinationId&&r.selectmenu("value",b.defaultDestinationId));i()}},close:function(){j.dialog("destroy").remove();b.completeCB&&b.completeCB()}})},complete:function(){b.completeCB&&b.completeCB()}})},addSchedulableAttraction:function(b){var c={attractionId:b.attractionId,
stayId:b.stayId,view:b.view};b.additionalPostParams&&$.extend(c,b.additionalPostParams);e.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit",type:"POST",data:c,synchronize:!0,suppressErrorDialog:!0,error:function(){b.errorCB&&b.errorCB()},success:function(c){b.successCB&&b.successCB(c);h.triggerEvent(b.eventSource,"visit-add",{uiSource:b.uiSource});a.trackEvent(b.analyticsCategory,"add-attraction",b.attractionName.toLowerCase())},complete:function(){b.completeCB&&b.completeCB()}})},
addNonSchedulableAttraction:function(b){var a={analyticsCategory:b.analyticsCategory,eventSource:b.eventSource,defaultDestinationId:b.destinationId,attractionId:b.attractionId,attractionName:b.attractionName,hideDestinationSelect:!0,userTimeInputRequired:!0,uiSource:b.uiSource,additionalPostData:$.extend({view:b.view,stayId:b.stayId},b.additionalPostParams),successCB:function(a){b.successCB&&b.successCB(a)},completeCB:function(){b.completeCB&&b.completeCB()}};f.showAddVisitDialog(a)}};return f});
(function(a){"function"===typeof define&&define.amd?define("autosize",["jquery"],a):a(window.jQuery||window.$)})(function(a){var c={className:"autosizejs",append:"",callback:!1,resizeDelay:10},d="fontFamily fontSize fontWeight fontStyle letterSpacing textTransform wordSpacing textIndent".split(" "),e,h=a('<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>').data("autosize",
!0)[0];h.style.lineHeight="99px";"99px"===a(h).css("lineHeight")&&d.push("lineHeight");h.style.lineHeight="";a.fn.autosize=function(g){g=a.extend({},c,g||{});h.parentNode!==document.body&&a(document.body).append(h);return this.each(function(){function c(){var b,k,i,f;if(e!==j){var y={};e=j;h.className=g.className;q=parseInt(m.css("maxHeight"),10);a.each(d,function(b,a){y[a]=m.css(a)});a(h).css(y);"oninput"in j&&(b=j.style.width,j.style.width="0px",j.style.width=b)}h.value=j.value+g.append;h.style.overflowY=
j.style.overflowY;k=parseInt(j.style.height,10);"getComputedStyle"in window?(f=window.getComputedStyle(j),i=j.getBoundingClientRect().width,a.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(b,a){i-=parseInt(f[a],10)}),h.style.width=i+"px"):h.style.width=Math.max(m.width(),0)+"px";h.scrollTop=0;h.scrollTop=9E4;b=h.scrollTop;q&&b>q?(j.style.overflowY="scroll",b=q):(j.style.overflowY="hidden",b<r&&(b=r));b+=p;k!==b&&(j.style.height=b+"px",t&&g.callback.call(j,j))}function b(){clearTimeout(z);
z=setTimeout(function(){m.width()!==k&&c()},parseInt(g.resizeDelay,10))}var j=this,m=a(j),q,r,p=0,t=a.isFunction(g.callback),n={height:j.style.height,overflow:j.style.overflow,overflowY:j.style.overflowY,wordWrap:j.style.wordWrap,resize:j.style.resize},z,k=m.width();if(!m.data("autosize")){m.data("autosize",!0);if("border-box"===m.css("box-sizing")||"border-box"===m.css("-moz-box-sizing")||"border-box"===m.css("-webkit-box-sizing"))p=m.outerHeight()-m.height();r=Math.max(parseInt(m.css("minHeight"),
10)-p||0,m.height());m.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:"none"===m.css("resize")||"vertical"===m.css("resize")?"none":"horizontal"});if("onpropertychange"in j)if("oninput"in j)m.on("input.autosize keyup.autosize",c);else m.on("propertychange.autosize",function(){"value"===event.propertyName&&c()});else m.on("input.autosize",c);if(!1!==g.resizeDelay)a(window).on("resize.autosize",b);m.on("autosize.resize",c);m.on("autosize.resizeIncludeStyle",function(){e=null;
c()});m.on("autosize.destroy",function(){e=null;clearTimeout(z);a(window).off("resize",b);m.off("autosize").off(".autosize").css(n).removeData("autosize")});c()}})}});
define("plan/notes",["modules/ajax","modules/utils","jquery","autosize"],function(a,c){var d={},e=function(a,d){var e=a.find("textarea"),b=a.data("originalNotes"),j=a.find(".notesText");d?(j.remove(),e.trigger("autosize.resize")):0===b.length?(e.remove(),j.remove()):(j=$("<div></div>"),j.addClass("notesText"),a.append(j),b=c.encodeHtml(b).replace(/(\r\n|\n|\r)/gm,"<br>"),j.html(b),e.remove())};d.prepareNotes=function(c,d,f){var b=c.find(".add-notes-button");c.data("remoteURL",d);c.data("notesChangedCallback",
f);b.click(function(){if(!(c.data("blurTime")&&100>(new Date).getTime()-c.data("blurTime"))){var b=$("<textarea></textarea>");b.attr("placeholder",c.data("placeholder"));b.data("previousNotes",c.data("originalNotes"));c.append(b);b.autosize();var d=c.data("originalNotes");b.val(d.toString().replace("<br>","\n"));b.off("blur").on("blur",function(){var d=$.trim(b.val()),f=b.data("previousNotes");c.data("originalNotes",d);d!==f&&(b.data("previousNotes",d),a.makeAJAXcall({type:"POST",url:c.data("remoteURL"),
data:{notes:d},success:function(){c.data("notesChangedCallback")&&c.data("notesChangedCallback").apply(b)},error:function(){b.data("previousNotes",f)}}));e(c,!1);c.data("blurTime",(new Date).getTime())});e(c,!0);b.focus()}});e(c,!1)};return d});
define("plan/reserveds",["modules/utils","modules/ajax","selectmenu","jquery","jqueryui"],function(a,c){var d={removeFromPlan:function(a){var d=a.reservedId;c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved/"+d+"/delete",type:"POST",data:{view:a.view},synchronize:!0,success:function(c){void 0!==a.successCB&&a.successCB(c)},complete:function(){void 0!==a.completeCB&&a.completeCB()}})},displayReservedItemDialog:function(e){c.makeAJAXcall({url:window.contextPath+"/plan/"+
$("#plan").data("planId")+"/reserved/"+e.reservedId,type:"GET",success:function(h){if(!$(".visitReservedDialog").length){var g=$(document.createElement("div"));g.html(h);var f=$(window).scrollTop(),b=g.find(".reservedStartTime"),j=g.find(".reservedEndTime"),m=g.find(".notesTextArea"),q=g.find("#reservedTitle");g.dialog({title:"Edit reserved item",resizable:!1,modal:!0,draggable:!1,dialogClass:"visitReservedDialog",position:e.position,buttons:[{html:"Delete",click:function(){e.deleteData.completeCB=
function(){g.dialog("close")};d.removeFromPlan(e.deleteData)}},{html:"Save Changes",click:function(){var a={name:q.val().trim(),date:e.date,startTime:b.val(),endTime:j.val(),notes:m.val(),view:e.view};c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved/"+e.reservedId,type:"POST",synchronize:!0,data:a,success:function(b){void 0!==e.successCB&&e.successCB(b)},complete:function(){g.dialog("close")}})}}],close:function(){"DayByDay"===e.view&&void 0!==e.closeCB&&e.closeCB(f);
g.dialog("destroy").remove()},open:function(){a.setupDialogOverlay(g,!0);g.find("select").selectmenu({appendTo:g});b.linkToEndTimeSelect(j);g.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Save Changes')").addClass("disabled");b.add(j).add(m).change(function(){g.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Save Changes')").removeClass("disabled")});q.keyup(function(){g.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Save Changes')").removeClass("disabled")})}})}}})}};
return d});
define("modules/hotelbooking","modules/analytics modules/mixpanel modules/ajax modules/events moment jquery".split(" "),function(a,c,d,e,h){var g={logMixpanelBookingEvent:function(a,b,d,e,g){var r=h.duration(h(g)-h(e)).asDays()+1,d={destinationName:a,countryName:b,bookingAgent:d,startDate:h(e).format("MM[/]DD[/]YYYY"),endDate:h(g).format("MM[/]DD[/]YYYY"),duration:r};c.logEvent("book_plan",d);c.incrementProperty("bookingCount",1);c.unionProperties({bookingDestinations:a,bookingCountries:b})},logBookingEvent:function(c,
b){a.trackEvent(c,"book-plan",b.toLowerCase());e.triggerEvent(c,"mmt_track_link",{linkName:"Find a Hotel"});var d=$("#plan");d.length&&a.trackEvent("book-plan","book-plan",d.data("#planId"))},openExpedia:function(a,b,c,d){var e=b.data("destinationName"),r=b.data("countryName"),p=h(c).format("MM[/]DD[/]YYYY"),t=h(d).format("MM[/]DD[/]YYYY");g.logMixpanelBookingEvent(b.data("destinationName"),b.data("countryName"),"expedia.com",c,d);a="http://www.dpbolvw.net/click-"+a+"?url="+encodeURIComponent("http://www.expedia.com/Hotel-Search?#&destination="+
e+", "+r+"&startDate="+p+"&endDate="+t+"&adults=2");window.open(a,"_blank")},openBookingURL:function(a,b,c){var d=a.data("bookingUrl"),e=a.data("bookingCheckinDateFormat"),g=a.data("bookingCheckoutDateFormat"),a=a.data("bookingNightsFormat"),b=h(b),c=h(c),e=b.format(e);a?(g=h.duration(c.diff(b,"days",!0)),d=d+e+a+g):g&&(g=c.format(g),d=d+e+g);window.open(d,"_blank")}};return g});
define("jQueryExtensions/photoSlider",["jquery","jqueryui"],function(){$.fn.preparePhotoSlider=function(){function a(){var c=e.children(":visible");if(0!==c.length){var d=c.eq(0);n=(n+1)%e.children(":visible").length;var c=parseInt(e.css("margin-left"),10),v=-d.width(),i=Math.abs(c-v)/j;z=window.setTimeout(function(){e.animate({"margin-left":v+"px"},i,"linear",function(){b.find(".bullet").removeClass("active").eq(n).addClass("active");e.append(d).css({"margin-left":0});a()})},5E3)}}var c=$(this),
d=c.find(".slide-wrapper"),e=c.find("ul.slides"),h=e.children(":visible"),g=c.find(".prev"),f=c.find(".next"),b=c.find(".nav-thumbs"),j=1;if(!(1>=h.length)){var m=function(){var b=e.children(":visible");if(0===b.length)g.addClass("disabled"),f.addClass("disabled");else{var a=$(b.get(0));Math.round(a.offset().left)<Math.round(d.offset().left)?g.removeClass("disabled"):g.addClass("disabled");b=b.last();Math.round(b.offset().left+b.outerWidth())<=Math.round(d.offset().left+d.outerWidth())?f.addClass("disabled"):
f.removeClass("disabled")}};f.hover(function(){if(!f.hasClass("disabled")){var b=e.children(":visible").last(),a=parseInt(e.css("margin-left"),10),b=e.offset().left-b.offset().left,a=a-b,c=Math.abs(a)/0.18;0!==a&&e.filter(":not(:animated)").animate({marginLeft:b+"px"},c,"linear",function(){m()})}},function(){e.data("inClick")||(e.stop(),m())});f.click(function(){e.data("inClick",!0);e.is(":animated")&&e.stop();var b=e.children(":visible");if(0!==b.length){var a=b.last();if(!(Math.round(a.offset().left+
a.outerWidth())<=Math.round(d.offset().left+d.outerWidth()))){var c;b.each(function(){if(Math.round($(this).offset().left)>Math.round(d.offset().left))return c=$(this),!1});var i=parseInt(e.css("margin-left"),10),b=e.offset().left-c.offset().left;c.index()===a.index()&&(b+=d.outerWidth()-c.outerWidth());a=Math.abs(i-b)/j;e.animate({"margin-left":b+"px"},a,"linear",function(){e.data("inClick",!1);m()})}}});g.hover(function(){if(!g.hasClass("disabled")){var b=0;e.children(":visible").each(function(){b+=
$(this).outerWidth(!0)+4});var a=parseInt(e.css("margin-left"),10)-0,c=Math.abs(a)/0.18;0!==a&&e.filter(":not(:animated)").animate({marginLeft:"0px"},c,"linear",function(){m()})}},function(){e.data("inClick")||(e.stop(),m())});g.click(function(){e.data("inClick",!0);e.is(":animated")&&e.stop();var b=e.children(":visible");if(0!==b.length){var a=$(b.get(0));if(!(Math.round(a.offset().left)>=Math.round(d.offset().left))){var c;b.each(function(){Math.round($(this).offset().left)<Math.round(d.offset().left)&&
(c=$(this))});a=parseInt(e.css("margin-left"),10);b=e.offset().left-c.offset().left;a=Math.abs(a-b)/j;e.animate({"margin-left":b+"px"},a,"linear",function(){e.data("inClick",!1);m()})}}});var q=!1,r,p,t;c.off("touchstart").on("touchstart",function(b){var a=0;e.children(":visible").each(function(){a+=$(this).outerWidth(!0)+4});a>$(this).width()&&(q=!0,r=b.originalEvent.touches[0].pageX,p=parseInt(e.css("marginLeft"),10),t=$(this).width()-a)});c.off("touchend").on("touchend",function(){q=!1;m($(this))});
c.off("touchmove").on("touchmove",function(b){if(q){var a=p+(b.originalEvent.touches[0].pageX-r),a=Math.min(a,0),a=Math.max(a,t);parseInt(e.css("marginLeft"),10)!==a&&(e.css({marginLeft:a+"px"}),b.preventDefault())}});var n=0,z;b.find(".bullet").click(function(){e.stop();window.clearTimeout(z);z=void 0;var c=$(this).data("slide"),d=$(this).index();b.find(".bullet").removeClass("active").eq(d).addClass("active");for(c=e.find("#"+c);0!==c.index();){var h=e.children(":visible").eq(0);e.append(h)}e.css({"margin-left":0});
n=d;a()});e.data("autoSlide")&&a()}}});
(function(a,c,d,e){var h=d("html"),g=d(a),f=d(c),b=d.fancybox=function(){b.open.apply(this,arguments)},j=navigator.userAgent.match(/msie/i),m=null,q=c.createTouch!==e,r=function(b){return b&&b.hasOwnProperty&&b instanceof d},p=function(b){return b&&"string"===d.type(b)},t=function(b){return p(b)&&0<b.indexOf("%")},n=function(a,c){var d=parseInt(a,10)||0;c&&t(a)&&(d*=b.getViewport()[c]/100);return Math.ceil(d)},z=function(b,a){return n(b,a)+"px"};d.extend(b,{version:"2.1.5",defaults:{padding:15,margin:20,
width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!q,fitToView:!0,aspectRatio:!1,topRatio:0.5,leftRatio:0.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3E3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},
keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+
(j?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,
openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:d.noop,beforeLoad:d.noop,afterLoad:d.noop,beforeShow:d.noop,afterShow:d.noop,beforeChange:d.noop,beforeClose:d.noop,afterClose:d.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,
isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(a,c){if(a&&(d.isPlainObject(c)||(c={}),!1!==b.close(!0)))return d.isArray(a)||(a=r(a)?d(a).get():[a]),d.each(a,function(h,i){var f={},g,j,n,m,t;"object"===d.type(i)&&(i.nodeType&&(i=d(i)),r(i)?(f={href:i.data("fancybox-href")||i.attr("href"),title:i.data("fancybox-title")||i.attr("title"),isDom:!0,element:i},d.metadata&&d.extend(!0,f,
i.metadata())):f=i);g=c.href||f.href||(p(i)?i:null);j=c.title!==e?c.title:f.title||"";m=(n=c.content||f.content)?"html":c.type||f.type;!m&&f.isDom&&(m=i.data("fancybox-type"),m||(m=(m=i.prop("class").match(/fancybox\.(\w+)/))?m[1]:null));p(g)&&(m||(b.isImage(g)?m="image":b.isSWF(g)?m="swf":"#"===g.charAt(0)?m="inline":p(i)&&(m="html",n=i)),"ajax"===m&&(t=g.split(/\s+/,2),g=t.shift(),t=t.shift()));n||("inline"===m?g?n=d(p(g)?g.replace(/.*(?=#[^\s]+$)/,""):g):f.isDom&&(n=i):"html"===m?n=g:!m&&!g&&f.isDom&&
(m="inline",n=i));d.extend(f,{href:g,type:m,content:n,title:j,selector:t});a[h]=f}),b.opts=d.extend(!0,{},b.defaults,c),c.keys!==e&&(b.opts.keys=c.keys?d.extend({},b.defaults.keys,c.keys):!1),b.group=a,b._start(b.opts.index)},cancel:function(){var a=b.coming;a&&!1!==b.trigger("onCancel")&&(b.hideLoading(),b.ajaxLoad&&b.ajaxLoad.abort(),b.ajaxLoad=null,b.imgPreload&&(b.imgPreload.onload=b.imgPreload.onerror=null),a.wrap&&a.wrap.stop(!0,!0).trigger("onReset").remove(),b.coming=null,b.current||b._afterZoomOut(a))},
close:function(a){b.cancel();!1!==b.trigger("beforeClose")&&(b.unbindEvents(),b.isActive&&(!b.isOpen||!0===a?(d(".fancybox-wrap").stop(!0).trigger("onReset").remove(),b._afterZoomOut()):(b.isOpen=b.isOpened=!1,b.isClosing=!0,d(".fancybox-item, .fancybox-nav").remove(),b.wrap.stop(!0,!0).removeClass("fancybox-opened"),b.transitions[b.current.closeMethod]())))},play:function(a){var c=function(){clearTimeout(b.player.timer)},d=function(){c();b.current&&b.player.isActive&&(b.player.timer=setTimeout(b.next,
b.current.playSpeed))},e=function(){c();f.unbind(".player");b.player.isActive=!1;b.trigger("onPlayEnd")};if(!0===a||!b.player.isActive&&!1!==a){if(b.current&&(b.current.loop||b.current.index<b.group.length-1))b.player.isActive=!0,f.bind({"onCancel.player beforeClose.player":e,"onUpdate.player":d,"beforeLoad.player":c}),d(),b.trigger("onPlayStart")}else e()},next:function(a){var c=b.current;c&&(p(a)||(a=c.direction.next),b.jumpto(c.index+1,a,"next"))},prev:function(a){var c=b.current;c&&(p(a)||(a=
c.direction.prev),b.jumpto(c.index-1,a,"prev"))},jumpto:function(a,c,d){var i=b.current;i&&(a=n(a),b.direction=c||i.direction[a>=i.index?"next":"prev"],b.router=d||"jumpto",i.loop&&(0>a&&(a=i.group.length+a%i.group.length),a%=i.group.length),i.group[a]!==e&&(b.cancel(),b._start(a)))},reposition:function(a,c){var e=b.current,i=e?e.wrap:null,f;i&&(f=b._getPosition(c),a&&"scroll"===a.type?(delete f.position,i.stop(!0,!0).animate(f,200)):(i.css(f),e.pos=d.extend({},e.dim,f)))},update:function(a){var c=
a&&a.type,d=!c||"orientationchange"===c;d&&(clearTimeout(m),m=null);b.isOpen&&!m&&(m=setTimeout(function(){var e=b.current;e&&!b.isClosing&&(b.wrap.removeClass("fancybox-tmp"),(d||"load"===c||"resize"===c&&e.autoResize)&&b._setDimension(),"scroll"===c&&e.canShrink||b.reposition(a),b.trigger("onUpdate"),m=null)},d&&!q?0:300))},toggle:function(a){b.isOpen&&(b.current.fitToView="boolean"===d.type(a)?a:!b.current.fitToView,q&&(b.wrap.removeAttr("style").addClass("fancybox-tmp"),b.trigger("onUpdate")),
b.update())},hideLoading:function(){f.unbind(".loading");d("#fancybox-loading").remove()},showLoading:function(){var a,c;b.hideLoading();a=d('<div id="fancybox-loading"><div></div></div>').click(b.cancel).appendTo("body");f.bind("keydown.loading",function(a){if(27===(a.which||a.keyCode))a.preventDefault(),b.cancel()});b.defaults.fixed||(c=b.getViewport(),a.css({position:"absolute",top:0.5*c.h+c.y,left:0.5*c.w+c.x}))},getViewport:function(){var c=b.current&&b.current.locked||!1,d={x:g.scrollLeft(),
y:g.scrollTop()};c?(d.w=c[0].clientWidth,d.h=c[0].clientHeight):(d.w=q&&a.innerWidth?a.innerWidth:g.width(),d.h=q&&a.innerHeight?a.innerHeight:g.height());return d},unbindEvents:function(){b.wrap&&r(b.wrap)&&b.wrap.unbind(".fb");f.unbind(".fb");g.unbind(".fb")},bindEvents:function(){var a=b.current,c;a&&(g.bind("orientationchange.fb"+(q?"":" resize.fb")+(a.autoCenter&&!a.locked?" scroll.fb":""),b.update),(c=a.keys)&&f.bind("keydown.fb",function(f){var i=f.which||f.keyCode,g=f.target||f.srcElement;
if(27===i&&b.coming)return!1;!f.ctrlKey&&!f.altKey&&(!f.shiftKey&&!f.metaKey&&(!g||!g.type&&!d(g).is("[contenteditable]")))&&d.each(c,function(c,l){if(1<a.group.length&&l[i]!==e)return b[c](l[i]),f.preventDefault(),!1;if(-1<d.inArray(i,l))return b[c](),f.preventDefault(),!1})}),d.fn.mousewheel&&a.mouseWheel&&b.wrap.bind("mousewheel.fb",function(c,e,l,f){for(var g=d(c.target||null),h=!1;g.length&&!h&&!g.is(".fancybox-skin")&&!g.is(".fancybox-wrap");)h=g[0]&&!(g[0].style.overflow&&"hidden"===g[0].style.overflow)&&
(g[0].clientWidth&&g[0].scrollWidth>g[0].clientWidth||g[0].clientHeight&&g[0].scrollHeight>g[0].clientHeight),g=d(g).parent();if(0!==e&&!h&&1<b.group.length&&!a.canShrink){if(0<f||0<l)b.prev(0<f?"down":"left");else if(0>f||0>l)b.next(0>f?"up":"right");c.preventDefault()}}))},trigger:function(a,c){var e,i=c||b.coming||b.current;if(i){d.isFunction(i[a])&&(e=i[a].apply(i,Array.prototype.slice.call(arguments,1)));if(!1===e)return!1;i.helpers&&d.each(i.helpers,function(c,e){if(e&&b.helpers[c]&&d.isFunction(b.helpers[c][a]))b.helpers[c][a](d.extend(!0,
{},b.helpers[c].defaults,e),i)});f.trigger(a)}},isImage:function(a){return p(a)&&a.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(a){return p(a)&&a.match(/\.(swf)((\?|#).*)?$/i)},_start:function(a){var c={},e,i,a=n(a);e=b.group[a]||null;if(!e)return!1;c=d.extend(!0,{},b.opts,e);e=c.margin;i=c.padding;"number"===d.type(e)&&(c.margin=[e,e,e,e]);"number"===d.type(i)&&(c.padding=[i,i,i,i]);c.modal&&d.extend(!0,c,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,
mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}});c.autoSize&&(c.autoWidth=c.autoHeight=!0);"auto"===c.width&&(c.autoWidth=!0);"auto"===c.height&&(c.autoHeight=!0);c.group=b.group;c.index=a;b.coming=c;if(!1===b.trigger("beforeLoad"))b.coming=null;else{i=c.type;e=c.href;if(!i)return b.coming=null,b.current&&b.router&&"jumpto"!==b.router?(b.current.index=a,b[b.router](b.direction)):!1;b.isActive=!0;if("image"===i||"swf"===i)c.autoHeight=c.autoWidth=!1,c.scrolling="visible";"image"===i&&(c.aspectRatio=
!0);"iframe"===i&&q&&(c.scrolling="scroll");c.wrap=d(c.tpl.wrap).addClass("fancybox-"+(q?"mobile":"desktop")+" fancybox-type-"+i+" fancybox-tmp "+c.wrapCSS).appendTo(c.parent||"body");d.extend(c,{skin:d(".fancybox-skin",c.wrap),outer:d(".fancybox-outer",c.wrap),inner:d(".fancybox-inner",c.wrap)});d.each(["Top","Right","Bottom","Left"],function(a,b){c.skin.css("padding"+b,z(c.padding[a]))});b.trigger("onReady");if("inline"===i||"html"===i){if(!c.content||!c.content.length)return b._error("content")}else if(!e)return b._error("href");
"image"===i?b._loadImage():"ajax"===i?b._loadAjax():"iframe"===i?b._loadIframe():b._afterLoad()}},_error:function(a){d.extend(b.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:a,content:b.coming.tpl.error});b._afterLoad()},_loadImage:function(){var a=b.imgPreload=new Image;a.onload=function(){this.onload=this.onerror=null;b.coming.width=this.width/b.opts.pixelRatio;b.coming.height=this.height/b.opts.pixelRatio;b._afterLoad()};a.onerror=function(){this.onload=
this.onerror=null;b._error("image")};a.src=b.coming.href;!0!==a.complete&&b.showLoading()},_loadAjax:function(){var a=b.coming;b.showLoading();b.ajaxLoad=d.ajax(d.extend({},a.ajax,{url:a.href,error:function(a,c){b.coming&&"abort"!==c?b._error("ajax",a):b.hideLoading()},success:function(c,d){"success"===d&&(a.content=c,b._afterLoad())}}))},_loadIframe:function(){var a=b.coming,c=d(a.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",q?"auto":a.iframe.scrolling).attr("src",a.href);
d(a.wrap).bind("onReset",function(){try{d(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(a){}});a.iframe.preload&&(b.showLoading(),c.one("load",function(){d(this).data("ready",1);q||d(this).bind("load.fb",b.update);d(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show();b._afterLoad()}));a.content=c.appendTo(a.inner);a.iframe.preload||b._afterLoad()},_preloadImages:function(){var a=b.group,c=b.current,d=a.length,e=c.preload?Math.min(c.preload,
d-1):0,f,g;for(g=1;g<=e;g+=1)f=a[(c.index+g)%d],"image"===f.type&&f.href&&((new Image).src=f.href)},_afterLoad:function(){var a=b.coming,c=b.current,e,i,f,g,h;b.hideLoading();if(a&&!1!==b.isActive)if(!1===b.trigger("afterLoad",a,c))a.wrap.stop(!0).trigger("onReset").remove(),b.coming=null;else{c&&(b.trigger("beforeChange",c),c.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove());b.unbindEvents();e=a.content;i=a.type;f=a.scrolling;d.extend(b,{wrap:a.wrap,skin:a.skin,
outer:a.outer,inner:a.inner,current:a,previous:c});g=a.href;switch(i){case "inline":case "ajax":case "html":a.selector?e=d("<div>").html(e).find(a.selector):r(e)&&(e.data("fancybox-placeholder")||e.data("fancybox-placeholder",d('<div class="fancybox-placeholder"></div>').insertAfter(e).hide()),e=e.show().detach(),a.wrap.bind("onReset",function(){d(this).find(e).length&&e.hide().replaceAll(e.data("fancybox-placeholder")).data("fancybox-placeholder",!1)}));break;case "image":e=a.tpl.image.replace("{href}",
g);break;case "swf":e='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+g+'"></param>',h="",d.each(a.swf,function(a,b){e+='<param name="'+a+'" value="'+b+'"></param>';h+=" "+a+'="'+b+'"'}),e+='<embed src="'+g+'" type="application/x-shockwave-flash" width="100%" height="100%"'+h+"></embed></object>"}(!r(e)||!e.parent().is(a.inner))&&a.inner.append(e);b.trigger("beforeShow");a.inner.css("overflow","yes"===f?"scroll":
"no"===f?"hidden":f);b._setDimension();b.reposition();b.isOpen=!1;b.coming=null;b.bindEvents();if(b.isOpened){if(c.prevMethod)b.transitions[c.prevMethod]()}else d(".fancybox-wrap").not(a.wrap).stop(!0).trigger("onReset").remove();b.transitions[b.isOpened?a.nextMethod:a.openMethod]();b._preloadImages()}},_setDimension:function(){var a=b.getViewport(),c=0,e=!1,i=!1,e=b.wrap,f=b.skin,g=b.inner,h=b.current,i=h.width,j=h.height,m=h.minWidth,p=h.minHeight,w=h.maxWidth,q=h.maxHeight,s=h.scrolling,r=h.scrollOutside?
h.scrollbarWidth:0,O=h.margin,R=n(O[1]+O[3]),D=n(O[0]+O[2]),x,A,B,K,H,F,T,I,U;e.add(f).add(g).width("auto").height("auto").removeClass("fancybox-tmp");O=n(f.outerWidth(!0)-f.width());x=n(f.outerHeight(!0)-f.height());A=R+O;B=D+x;K=t(i)?(a.w-A)*n(i)/100:i;H=t(j)?(a.h-B)*n(j)/100:j;if("iframe"===h.type){if(U=h.content,h.autoHeight&&1===U.data("ready"))try{U[0].contentWindow.document.location&&(g.width(K).height(9999),F=U.contents().find("body"),r&&F.css("overflow-x","hidden"),H=F.outerHeight(!0))}catch(X){}}else if(h.autoWidth||
h.autoHeight)g.addClass("fancybox-tmp"),h.autoWidth||g.width(K),h.autoHeight||g.height(H),h.autoWidth&&(K=g.width()),h.autoHeight&&(H=g.height()),g.removeClass("fancybox-tmp");i=n(K);j=n(H);I=K/H;m=n(t(m)?n(m,"w")-A:m);w=n(t(w)?n(w,"w")-A:w);p=n(t(p)?n(p,"h")-B:p);q=n(t(q)?n(q,"h")-B:q);F=w;T=q;h.fitToView&&(w=Math.min(a.w-A,w),q=Math.min(a.h-B,q));A=a.w-R;D=a.h-D;h.aspectRatio?(i>w&&(i=w,j=n(i/I)),j>q&&(j=q,i=n(j*I)),i<m&&(i=m,j=n(i/I)),j<p&&(j=p,i=n(j*I))):(i=Math.max(m,Math.min(i,w)),h.autoHeight&&
"iframe"!==h.type&&(g.width(i),j=g.height()),j=Math.max(p,Math.min(j,q)));if(h.fitToView)if(g.width(i).height(j),e.width(i+O),a=e.width(),R=e.height(),h.aspectRatio)for(;(a>A||R>D)&&i>m&&j>p&&!(19<c++);)j=Math.max(p,Math.min(q,j-10)),i=n(j*I),i<m&&(i=m,j=n(i/I)),i>w&&(i=w,j=n(i/I)),g.width(i).height(j),e.width(i+O),a=e.width(),R=e.height();else i=Math.max(m,Math.min(i,i-(a-A))),j=Math.max(p,Math.min(j,j-(R-D)));r&&"auto"===s&&(j<H&&i+O+r<A)&&(i+=r);g.width(i).height(j);e.width(i+O);a=e.width();R=
e.height();e=(a>A||R>D)&&i>m&&j>p;i=h.aspectRatio?i<F&&j<T&&i<K&&j<H:(i<F||j<T)&&(i<K||j<H);d.extend(h,{dim:{width:z(a),height:z(R)},origWidth:K,origHeight:H,canShrink:e,canExpand:i,wPadding:O,hPadding:x,wrapSpace:R-f.outerHeight(!0),skinSpace:f.height()-j});!U&&h.autoHeight&&(j>p&&j<q&&!i)&&g.height("auto")},_getPosition:function(a){var c=b.current,d=b.getViewport(),e=c.margin,g=b.wrap.width()+e[1]+e[3],f=b.wrap.height()+e[0]+e[2],e={position:"absolute",top:e[0],left:e[3]};c.autoCenter&&c.fixed&&
!a&&f<=d.h&&g<=d.w?e.position="fixed":c.locked||(e.top+=d.y,e.left+=d.x);e.top=z(Math.max(e.top,e.top+(d.h-f)*c.topRatio));e.left=z(Math.max(e.left,e.left+(d.w-g)*c.leftRatio));return e},_afterZoomIn:function(){var a=b.current;a&&(b.isOpen=b.isOpened=!0,b.wrap.css("overflow","visible").addClass("fancybox-opened"),b.update(),(a.closeClick||a.nextClick&&1<b.group.length)&&b.inner.css("cursor","pointer").bind("click.fb",function(c){!d(c.target).is("a")&&!d(c.target).parent().is("a")&&(c.preventDefault(),
b[a.closeClick?"close":"next"]())}),a.closeBtn&&d(a.tpl.closeBtn).appendTo(b.skin).bind("click.fb",function(a){a.preventDefault();b.close()}),a.arrows&&1<b.group.length&&((a.loop||0<a.index)&&d(a.tpl.prev).appendTo(b.outer).bind("click.fb",b.prev),(a.loop||a.index<b.group.length-1)&&d(a.tpl.next).appendTo(b.outer).bind("click.fb",b.next)),b.trigger("afterShow"),!a.loop&&a.index===a.group.length-1?b.play(!1):b.opts.autoPlay&&!b.player.isActive&&(b.opts.autoPlay=!1,b.play()))},_afterZoomOut:function(a){a=
a||b.current;d(".fancybox-wrap").trigger("onReset").remove();d.extend(b,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null});b.trigger("afterClose",a)}});b.transitions={getOrigPosition:function(){var a=b.current,c=a.element,d=a.orig,e={},g=50,f=50,h=a.hPadding,j=a.wPadding,m=b.getViewport();!d&&a.isDom&&c.is(":visible")&&(d=c.find("img:first"),d.length||(d=c));r(d)?(e=d.offset(),d.is("img")&&(g=d.outerWidth(),f=d.outerHeight())):
(e.top=m.y+(m.h-f)*a.topRatio,e.left=m.x+(m.w-g)*a.leftRatio);if("fixed"===b.wrap.css("position")||a.locked)e.top-=m.y,e.left-=m.x;return{top:z(e.top-h*a.topRatio),left:z(e.left-j*a.leftRatio),width:z(g+j),height:z(f+h)}},step:function(a,c){var d,e,g=c.prop;e=b.current;var f=e.wrapSpace,h=e.skinSpace;if("width"===g||"height"===g)d=c.end===c.start?1:(a-c.start)/(c.end-c.start),b.isClosing&&(d=1-d),e="width"===g?e.wPadding:e.hPadding,e=a-e,b.skin[g](n("width"===g?e:e-f*d)),b.inner[g](n("width"===g?
e:e-f*d-h*d))},zoomIn:function(){var a=b.current,c=a.pos,e=a.openEffect,g="elastic"===e,f=d.extend({opacity:1},c);delete f.position;g?(c=this.getOrigPosition(),a.openOpacity&&(c.opacity=0.1)):"fade"===e&&(c.opacity=0.1);b.wrap.css(c).animate(f,{duration:"none"===e?0:a.openSpeed,easing:a.openEasing,step:g?this.step:null,complete:b._afterZoomIn})},zoomOut:function(){var a=b.current,c=a.closeEffect,d="elastic"===c,e={opacity:0.1};d&&(e=this.getOrigPosition(),a.closeOpacity&&(e.opacity=0.1));b.wrap.animate(e,
{duration:"none"===c?0:a.closeSpeed,easing:a.closeEasing,step:d?this.step:null,complete:b._afterZoomOut})},changeIn:function(){var a=b.current,c=a.nextEffect,d=a.pos,e={opacity:1},g=b.direction,f;d.opacity=0.1;"elastic"===c&&(f="down"===g||"up"===g?"top":"left","down"===g||"right"===g?(d[f]=z(n(d[f])-200),e[f]="+=200px"):(d[f]=z(n(d[f])+200),e[f]="-=200px"));"none"===c?b._afterZoomIn():b.wrap.css(d).animate(e,{duration:a.nextSpeed,easing:a.nextEasing,complete:b._afterZoomIn})},changeOut:function(){var a=
b.previous,c=a.prevEffect,e={opacity:0.1},g=b.direction;"elastic"===c&&(e["down"===g||"up"===g?"top":"left"]=("up"===g||"left"===g?"-":"+")+"=200px");a.wrap.animate(e,{duration:"none"===c?0:a.prevSpeed,easing:a.prevEasing,complete:function(){d(this).trigger("onReset").remove()}})}};b.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!q,fixed:!0},overlay:null,fixed:!1,el:d("html"),create:function(a){a=d.extend({},this.defaults,a);this.overlay&&this.close();this.overlay=
d('<div class="fancybox-overlay"></div>').appendTo(b.coming?b.coming.parent:a.parent);this.fixed=!1;a.fixed&&b.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(a){var c=this,a=d.extend({},this.defaults,a);this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(a);this.fixed||(g.bind("resize.overlay",d.proxy(this.update,this)),this.update());a.closeClick&&this.overlay.bind("click.overlay",function(a){if(d(a.target).hasClass("fancybox-overlay"))return b.isActive?
b.close():c.close(),!1});this.overlay.css(a.css).show()},close:function(){var a,b;g.unbind("resize.overlay");this.el.hasClass("fancybox-lock")&&(d(".fancybox-margin").removeClass("fancybox-margin"),a=g.scrollTop(),b=g.scrollLeft(),this.el.removeClass("fancybox-lock"),g.scrollTop(a).scrollLeft(b));d(".fancybox-overlay").remove().hide();d.extend(this,{overlay:null,fixed:!1})},update:function(){var a="100%",b;this.overlay.width(a).height("100%");j?(b=Math.max(c.documentElement.offsetWidth,c.body.offsetWidth),
f.width()>b&&(a=f.width())):f.width()>g.width()&&(a=f.width());this.overlay.width(a).height(f.height())},onReady:function(a,b){var c=this.overlay;d(".fancybox-overlay").stop(!0,!0);c||this.create(a);a.locked&&this.fixed&&b.fixed&&(c||(this.margin=f.height()>g.height()?d("html").css("margin-right").replace("px",""):!1),b.locked=this.overlay.append(b.wrap),b.fixed=!1);!0===a.showEarly&&this.beforeShow.apply(this,arguments)},beforeShow:function(a,b){var c,e;b.locked&&(!1!==this.margin&&(d("*").filter(function(){return"fixed"===
d(this).css("position")&&!d(this).hasClass("fancybox-overlay")&&!d(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),c=g.scrollTop(),e=g.scrollLeft(),this.el.addClass("fancybox-lock"),g.scrollTop(c).scrollLeft(e));this.open(a)},onUpdate:function(){this.fixed||this.update()},afterClose:function(a){this.overlay&&!b.coming&&this.overlay.fadeOut(a.speedOut,d.proxy(this.close,this))}};b.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(a){var c=
b.current,e=c.title,g=a.type;d.isFunction(e)&&(e=e.call(c.element,c));if(p(e)&&""!==d.trim(e)){c=d('<div class="fancybox-title fancybox-title-'+g+'-wrap">'+e+"</div>");switch(g){case "inside":g=b.skin;break;case "outside":g=b.wrap;break;case "over":g=b.inner;break;default:g=b.skin,c.appendTo("body"),j&&c.width(c.width()),c.wrapInner('<span class="child"></span>'),b.current.margin[2]+=Math.abs(n(c.css("margin-bottom")))}c["top"===a.position?"prependTo":"appendTo"](g)}}};d.fn.fancybox=function(a){var c,
e=d(this),g=this.selector||"",h=function(f){var h=d(this).blur(),j=c,m,n;!f.ctrlKey&&!f.altKey&&!f.shiftKey&&!f.metaKey&&!h.is(".fancybox-wrap")&&(m=a.groupAttr||"data-fancybox-group",n=h.attr(m),n||(m="rel",n=h.get(0)[m]),n&&""!==n&&"nofollow"!==n&&(h=g.length?d(g):e,h=h.filter("["+m+'="'+n+'"]'),j=h.index(this)),a.index=j,!1!==b.open(h,a)&&f.preventDefault())},a=a||{};c=a.index||0;!g||!1===a.live?e.unbind("click.fb-start").bind("click.fb-start",h):f.undelegate(g,"click.fb-start").delegate(g+":not('.fancybox-item, .fancybox-nav')",
"click.fb-start",h);this.filter("[data-fancybox-start=1]").trigger("click");return this};f.ready(function(){var c,g;d.scrollbarWidth===e&&(d.scrollbarWidth=function(){var a=d('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),b=a.children(),b=b.innerWidth()-b.height(99).innerWidth();a.remove();return b});if(d.support.fixedPosition===e){c=d.support;g=d('<div style="position:fixed;top:20px;"></div>').appendTo("body");var f=20===g[0].offsetTop||15===g[0].offsetTop;g.remove();
c.fixedPosition=f}d.extend(b.defaults,{scrollbarWidth:d.scrollbarWidth(),fixed:d.support.fixedPosition,parent:d("body")});c=d(a).width();h.addClass("fancybox-lock-test");g=d(a).width();h.removeClass("fancybox-lock-test");d("<style type='text/css'>.fancybox-margin{margin-right:"+(g-c)+"px;}</style>").appendTo("head")})})(window,document,jQuery);define("fancybox",["jquery"],function(){});
define("jQueryExtensions/readMore",["jquery"],function(){function a(a){a.data.$desc.css({height:"auto","max-height":"none"});a.data.$moreLink.addClass("hidden");a.data.$lessLink.removeClass("hidden")}function c(a){var c=parseFloat(a.data.$desc.css("lineHeight")),h=a.data.$desc.data("collapsedLines")||5;a.data.$desc.css({height:h*c,"max-height":""});a.data.$moreLink.removeClass("hidden");a.data.$lessLink.addClass("hidden")}$.fn.readMore=function(d,e){if($(this).length&&d.length&&e.length){var h={$desc:$(this),
$moreLink:d,$lessLink:e},g;g=$(this);var f=g.get(0).scrollHeight,b=parseFloat(g.css("lineHeight")),f=Math.round(f/b);g=g.data("collapsedLines")||5;f>g?(d.removeClass("hidden"),g=!0):g=!1;g&&(d.off("click").on("click",h,a),e.off("click").on("click",h,c))}}});
define("plan/details","modules/analytics modules/ajax modules/utils modules/hotelbooking plan/visits modules/events modules/attributions plan/history plan/loading plan/planUtils modules/map modules/modal jquery jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager jQueryExtensions/photoSlider fancybox jqueryui selectmenu jQueryExtensions/readMore".split(" "),function(a,c,d,e,h,g,f,b,j,m,q,r){function p(b){var d=$(this),e=d.data("destinationId"),f=d.data("name"),h=b.data.detailsPane,e={destinationId:e,
destinationName:f,view:"destinationDetails",viewDestinationId:d.parents(".destination-details").data("destinationId")};d.prop("disabled",!0);j.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");c.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",data:e,synchronize:!0,complete:function(){d.prop("disabled",!1);j.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"))},success:function(c){a.trackEvent("destination-details.top-cities-map",
"add-destination",f.toLowerCase());g.triggerEvent(b.data.eventSource,"stay-add",{uiSource:b.data.uiSource});h.html(c);l.initialize(h,b.data.eventSource,b.data.analyticsCategoryPrefix,"explore.destinations.details")}})}function t(b){var d=$(this),e=d.data("destinationId"),f=d.data("name"),h=b.data.detailsPane,i=d.data("eventSrc"),e={destinationId:e,destinationName:f,view:"destinationDetails",viewDestinationId:d.parents(".destination-details").data("destinationId")};d.prop("disabled",!0);j.showLoading($("#exploreLoadingPane"),
$("#exploreMainPane"),"Updating Your Plan...");r.loading();c.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",data:e,synchronize:!0,complete:function(){d.prop("disabled",!1);j.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"));r.loadingComplete()},success:function(c){a.trackEvent("destination-details.nearby-nightstays-map","add-destination",f.toLowerCase());g.triggerEvent(b.data.eventSource,"stay-add",{uiSource:b.data.uiSource});h.html(c);l.initialize(h,
b.data.eventSource,b.data.analyticsCategoryPrefix,i)}})}function n(b){var d=$(this),e=d.data("destinationId"),f=d.data("name"),h=b.data.detailsPane,e={destinationId:e,destinationName:f,view:"destinationDetails",viewDestinationId:d.parents(".destination-details").data("destinationId")};d.prop("disabled",!0);j.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");c.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",data:e,synchronize:!0,
complete:function(){d.prop("disabled",!1);j.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"))},success:function(c){a.trackEvent("destination-details.nearby-nightstays-map","add-destination",f.toLowerCase());g.triggerEvent(b.data.eventSource,"stay-add",{uiSource:b.data.uiSource});h.html(c);l.initialize(h,b.data.eventSource,b.data.analyticsCategoryPrefix,"explore.destinations.details")}})}function z(b){var d=$(this),e=b.data.detailsPane,f=d.parents(".destination-details").data("destinationId"),
h=d.data("visitId");d.prop("disabled",!0);c.makeAJAXcall({type:"POST",data:{view:"destinationDetails",viewDestinationId:f},synchronize:!0,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+h+"/delete",success:function(c){e.html(c);g.triggerEvent(b.data.eventSource,"visit-remove",{uiSource:b.data.uiSource});a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","delete-attraction-confirm");l.initialize(e,b.data.eventSource,b.data.analyticsCategoryPrefix,b.data.uiSource)},
complete:function(){d.prop("disabled",!1)}})}function k(){var a=$(this),b=a.parents(".destination-highlights").find(".highlight-attrs."+a.data("target"));a.addClass("active").siblings(".tab").removeClass("active");b.removeClass("hidden").siblings(".highlight-attrs").addClass("hidden");if(!b.data("fetched")){b.html('<img class="progress-indicator" src="'+window.contextPath+'/res/images/assets/ajax-loader.gif" />');b.data("fetched",!0);var d=b.parents(".destination-details").data("destinationId");c.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/destinations/"+d+"/attractions/"+a.data("target"),type:"GET",success:function(a){b.html(a);b.find(".pages").preparePaging(b.find(".paging"));f.updatePhotoAttributions()},error:function(){b.data("fetched",!1)}})}}var l={},v=function(b){var d=$(this),e=b.data.detailsPane,f=d.parents(".destination-details"),h=f.data("destinationId"),i=f.data("name"),f={destinationId:h,destinationName:i,view:"destinationDetails"};d.prop("disabled",!0);j.showLoading($("#exploreLoadingPane"),
$("#exploreMainPane"),"Updating Your Plan...");r.loading();c.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",data:f,synchronize:!0,complete:function(){d.prop("disabled",!1);j.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"));r.loadingComplete()},success:function(c){a.trackEvent(b.data.analyticsCategoryPrefix+".destination-details","add-destination",i.toLowerCase());g.triggerEvent(b.data.eventSource,"stay-add",{uiSource:b.data.uiSource});e.html(c);
l.initialize(e,b.data.eventSource,b.data.analyticsCategoryPrefix,"explore.destinations.details")}})},i=function(a){var b=a.data.detailsPane,c=$(this).parents(".attraction"),d=c.data("attractionId"),e=c.data("name"),g=c.data("isSchedulable"),f=c.data("stayId"),i=c.parents(".destination-details"),j=i.data("destinationId"),k=b.find(".highlight-tabs .tab.active");r.isOpen()&&r.loading();g&&""!==f?h.addSchedulableAttraction({attractionId:d,attractionName:e,stayId:f,analyticsCategory:a.data.analyticsCategoryPrefix+
".destination-details.highlights",eventSource:a.data.eventSource,view:"destinationDetails",uiSource:"explore.destinations.details.highlights",additionalPostParams:{viewDestinationId:i.data("destinationId")},successCB:function(c){b.html(c);l.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,"explore.destinations.details.highlights");b.find(".highlight-tabs [data-target="+k.data("target")+"]").trigger("click")},completeCB:function(){r.loadingComplete()},errorCB:function(){h.addNonSchedulableAttraction({attractionId:d,
attractionName:e,stayId:f,destinationId:j,analyticsCategory:a.data.analyticsCategoryPrefix+".destination-details.highlights",eventSource:a.data.eventSource,view:"destinationDetails",uiSource:"explore.destinations.details.highlights",additionalPostParams:{viewDestinationId:i.data("destinationId")},successCB:function(c){b.html(c);l.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,"explore.destinations.details.highlights");b.find(".highlight-tabs [data-target="+k.data("target")+"]").trigger("click")},
completeCB:function(){r.loadingComplete()}})}}):h.addNonSchedulableAttraction({attractionId:d,attractionName:e,stayId:f,destinationId:j,analyticsCategory:a.data.analyticsCategoryPrefix+".destination-details.highlights",eventSource:a.data.eventSource,view:"destinationDetails",uiSource:"explore.destinations.details.highlights",additionalPostParams:{viewDestinationId:i.data("destinationId")},successCB:function(c){b.html(c);l.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,"explore.destinations.details.highlights");
b.find(".highlight-tabs [data-target="+k.data("target")+"]").trigger("click")},completeCB:function(){r.loadingComplete()}})},L=function(b){var d=$(this),e=b.data.detailsPane,f=$(this).parents(".in-plan").data("visitId"),h=$(this).parents(".attraction-details").data("attractionName");d.prop("disabled",!0);c.makeAJAXcall({type:"POST",data:{view:"attractionDetails"},synchronize:!0,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+f+"/delete",success:function(c){e.html(c);g.triggerEvent(b.data.eventSource,
"visit-remove",{uiSource:b.data.uiSource});a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","delete-attraction-confirm",h.toLowerCase());l.initialize(e,b.data.eventSource,b.data.analyticsCategoryPrefix,b.data.uiSource)},complete:function(){d.prop("disabled",!1)}})},y=function(a){var b=$(this),c=a.data.detailsPane,d=b.parents(".in-plan"),e=d.data("targetStay"),g=d.parents(".attraction-details").data("attractionId"),f=d.data("destinationId"),i=d.parents(".attraction-details").data("attractionName"),
j=a.data.uiSource;b.prop("disabled",!0);h.addSchedulableAttraction({attractionId:g,attractionName:i,stayId:e,analyticsCategory:a.data.analyticsCategoryPrefix+".attraction-details",eventSource:a.data.eventSource,uiSource:j,view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails",successCB:function(b){c.html(b);l.initialize(c,a.data.eventSource,a.data.analyticsCategoryPrefix,a.data.uiSource)},errorCB:function(){h.addNonSchedulableAttraction({attractionId:g,attractionName:i,
stayId:e,destinationId:f,analyticsCategory:a.data.analyticsCategoryPrefix+".attraction-details",eventSource:a.data.eventSource,uiSource:j,view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails",successCB:function(b){c.html(b);l.initialize(c,a.data.eventSource,a.data.analyticsCategoryPrefix,j)}})},completeCB:function(){b.prop("disabled",!1)}})},J=function(){var a=$(this),b=a.parents(".nearby-attractions");a.hasClass("active")||(a.addClass("active"),a.hasClass("nearbyAttractions-list")?
(a.siblings(".nearbyAttractions-map").removeClass("active"),b.find(".map-holder").addClass("hidden"),b.find(".page-clipper").removeClass("hidden")):(b.find(".map-holder").removeClass("hidden"),a.siblings(".nearbyAttractions-list").removeClass("active"),b.find(".page-clipper").addClass("hidden"),b.find(".map-holder").trigger("isVisible")))},u=function(a,b,c,d){var e=b.data("attractionId");b[0]===d[0]?(d.find(".plan-schedule").find(".add-nearbyAttraction-button").remove(),d.find(".plan-schedule").append('<div class="in-your-plan">In your plan<div>'),
a=a.find(" .nearby-attractions .large-map").find(".add-nearbyAttraction-button"),d.data("inPlan",!0),a.each(function(){var a=$(this);if(a.data("attractionId")===e)return a.remove().parents(".plan-schedule").append('<div class="in-your-plan">In your plan<div>'),!1})):b[0]===c[0]&&(c.parents(".plan-schedule").empty().html('<div class="in-your-plan">In your plan<div>'),a.find(".nearby-attractions .page-clipper").find(".nearbyAttr-tile").each(function(){var a=$(this);if(a.data("attractionId")===e)return a.find(".plan-schedule").find(".add-nearbyAttraction-button").remove(),
a.find(".plan-schedule").append('<div class="in-your-plan">In your plan<div>'),a.data("inPlan",!0),!1}))},N=function(b){var d=$(this),e=b.data.detailsPane,f=$(this).parents(".nearbyAttr-tile"),i=0<f.length?f:d,j=i.data("targetStay"),k=i.data("attractionId"),l=i.data("name"),m=i.data("destinationId"),n=i.data("inPlan"),x=i.data("containerInPlan"),s=i.data("isSchedulable");n||(x?s?(d.prop("disabled",!0),h.addSchedulableAttraction({attractionId:k,attractionName:l,stayId:j,analyticsCategory:".attraction-details",
eventSource:"nearbySchedulableAttraction-add",view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails",uiSource:b.data.uiSource+".nearby",destinationId:m,successCB:function(){a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","add-attraction",l.toLowerCase());u(e,i,d,f)},errorCB:function(){h.addNonSchedulableAttraction({attractionId:k,attractionName:l,stayId:j,destinationId:m,analyticsCategory:".attraction-details",eventSource:"nearbySchedulableAttraction",
view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails",uiSource:b.data.uiSource+".nearby",successCB:function(){a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","add-attraction",l.toLowerCase());u(e,i,d,f)}})},completeCB:function(){d.prop("disabled",!1)}})):h.addNonSchedulableAttraction({attractionId:k,attractionName:l,stayId:j,destinationId:m,analyticsCategory:".attraction-details",eventSource:"nearbyNonSchedulableAttraction-add",uiSource:b.data.uiSource+
".nearby",view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails",successCB:function(){a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","add-attraction",l.toLowerCase());u(e,i,d,f)}}):(d.prop("disabled",!0),n={destinationId:m,attractionId:k,view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails"},c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visitAndStay",type:"POST",data:n,synchronize:!0,suppressErrorDialog:!0,
success:function(){var c={uiSource:b.data.uiSource+".nearbyAttraction"};g.triggerEvent(b.data.eventSource,"visit-add",c);g.triggerEvent(b.data.eventSource,"stay-add",c);u(e,i,d,f);a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","add-attraction-destination",l.toLowerCase())},error:function(){h.addNonSchedulableAttraction({attractionId:k,attractionName:l,stayId:j,destinationId:m,analyticsCategory:".attraction-details",eventSource:"nearbySchedulableAttraction",view:$("#itinerary").is(":visible")?
"itineraryAttractionDetails":"attractionDetails",uiSource:b.data.uiSource+".nearby",successCB:function(){a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","add-attraction",l.toLowerCase());u(e,i,d,f)}})},complete:function(){d.prop("disabled",!1)}})));return!1},M=function(b){var d=b.data.detailsPane,e=$(this),f={destinationId:e.data("newDestinationId"),attractionId:e.parents(".attraction-details").data("attractionId"),view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":
"attractionDetails"};e.prop("disabled",!0);j.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating Your Plan...");c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visitAndStay",type:"POST",data:f,synchronize:!0,complete:function(){e.prop("disabled",!1);j.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"))},success:function(c){var f={uiSource:b.data.uiSource};g.triggerEvent(b.data.eventSource,"visit-add",f);g.triggerEvent(b.data.eventSource,"stay-add",
f);a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","add-attraction-destination",e.parents(".attraction-details").data("attractionName").toLowerCase());d.html(c);l.initialize(d,b.data.eventSource,b.data.analyticsCategoryPrefix,b.data.uiSource)}})},w=function(a){var b=a.data.detailsPane,c={viewDestinationId:b.find(".destination-details").data("destinationId"),view:"destinationDetails"};m.adjustRouteClick(a.data.analyticsCategoryPrefix+".details",c,function(c){g.triggerEvent(a.data.eventSource,
"stay-update",{uiSource:a.data.uiSource});b.html(c);l.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,a.data.uiSource)})},C=function(b){a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","click-website",$(this).data("type"))},s=function(b){var c=b.data.detailsPane,e=c.find(".start-trip-btn").data("isValidDomain"),f=c.find(".destination-details").data("destinationId");e?a.trackEvent(b.data.analyticsCategoryPrefix+".destination-details","click-start-trip",f,function(){window.location.href=
window.contextPath+"/trip-planner?domains="+f}):(b=c.find(".destination-details").data("name"),$(document.createElement("div")).text("Cannot generate itinerary for "+b+".").dialog({title:"Error",resizable:!1,modal:!0,draggable:!1,width:"350px",dialogClass:"invalid-domain-errorDialog",buttons:{Ok:function(){$(this).dialog("close")}},open:function(){d.setupDialogOverlay($(this),!1)},close:function(){$(this).dialog("destroy").remove()}}))},P=function(a){var b=a.data.detailsPane,c=$(this).parents(".in-plan"),
d=c.data("targetStay"),e=c.parents(".attraction-details").data("attractionId"),f=c.parents(".attraction-details").data("attractionName"),c=c.data("destinationId"),g=a.data.uiSource+".nearbyAttractions";h.addNonSchedulableAttraction({attractionId:e,attractionName:f,stayId:d,destinationId:c,analyticsCategory:a.data.analyticsCategoryPrefix+".attraction-details",eventSource:a.data.eventSource,uiSource:g,view:$("#itinerary").is(":visible")?"itineraryAttractionDetails":"attractionDetails",successCB:function(c){b.html(c);
l.initialize(b,a.data.eventSource,a.data.analyticsCategoryPrefix,g)}})},O=function(){var a=$(this).parents(".booking-area"),b=a.find(".startdatepicker").datepicker("getDate"),c=a.find(".enddatepicker").datepicker("getDate");b&&c&&(e.logBookingEvent("destination-details",a.data("name")),e.openBookingURL(a,b,c))},R=function(){var a=$(this),b=a.data("textToShow"),c=a.parents("li"),d=c.find("blockquote").html(),e=a.data("translated");c.find("blockquote").html(b);e?(a.data("translated",!1),a.find(".iconText").text("translate to English")):
(a.data("translated",!0),a.find(".iconText").text("show original"));a.data("textToShow",d)},D=function(b){var c=$(this).attr("href");a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","tour-detail-link",c)},x=function(b){var c=$(this).attr("href");a.trackEvent(b.data.analyticsCategoryPrefix+".attraction-details","viator-tour-link",c)};l.initialize=function(a,b,c,e){if(a.is(":visible")){var h=a.find(".nearby-attractions"),b={detailsPane:a,eventSource:b,analyticsCategoryPrefix:c,uiSource:e};
a.off("click.add-dest").on("click.add-dest",".add-destination-button",b,v).off("click.add-side-trip-dest").on("click.add-side-trip-dest",".destination-info .add-side-trip-dest",b,t).off("click.add-highlight").on("click.add-highlight",".destination-highlights .add-button",b,i).off("click.delete-attraction-btn").on("click.delete-attraction-btn",".delete-attraction-btn",b,L).off("click.delete-sidetrip").on("click.delete-sidetrip",".delete-sidetrip-button",b,z).off("click.add-attr").on("click.add-attr",
".add-attraction-button",b,y).off("click.add-destattr").on("click.add-destattr",".add-dest-with-attr",b,M).off("click.adjust").on("click.adjust",".adjust-route",b,w).off("click.website").on("click.website",".website",b,C).off("click.starttrip").on("click.starttrip",".start-trip-btn",b,s).off("click.add-attr-not-schedulable").on("click.add-attr-not-schedulable",".add-attr-not-schedulable",b,P).off("click.find-hotel").on("click.find-hotel",".booking-area .find-hotel",O).off("click.translate-review").on("click.translate-review",
".translateText",R).off("click.add-nearby-nightstay").on("click.nearby-nightstay",".nearby-nightstays .add-nearby-nightstay",b,n).off("click.add-dest-to-plan").on("click.add-dest-to-plan",".top-cities .add-to-plan",b,p).off("click.tour-click").on("click.tour-click",".tour-link",b,D).off("click.viator-tour-click").on("click.viator-tour-click",".viator-link",b,x).off("click.explore-all-attractions").on("click.explore-all-attractions",".explore-all-attraction button",function(){g.triggerEvent("details",
"explore-load-attraction-in-modal",{tab:r.getTab(),destinationId:$(this).data("destination-id")})});h.off("click.add-nearbyAttraction").on("click.nearbyAttraction",".add-nearbyAttraction-button",b,N).off("click.switchTabView").on("click.switchTabView",".nearbyAttractions-map, .nearbyAttractions-list",J);a.find(".photos").preparePhotoSlider(0.24);a.find(".fancybox").fancybox({prevEffect:"fade",nextEffect:"fade",prevSpeed:400,nextSpeed:300,helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.4)"}}}});
var j=a.find(".static-map");0!==j.length&&q.addToQueue(function(){var b=parseFloat(j.data("lat")),c=parseFloat(j.data("lng")),d=parseInt(j.data("zoom"),10),e=new window.google.maps.LatLng(b,c),b=$(document.createElement("div"));b.attr("id","detailsMap");b.css({width:"100%",height:"100%"});var f=new window.google.maps.Map(b[0],{zoom:d,center:e,zoomControl:!0,mapTypeId:window.google.maps.MapTypeId.ROADMAP,scaleControl:!0}),g=new window.google.maps.Marker({position:e,map:f}),h=new window.google.maps.InfoWindow({content:j.data("name")});
window.google.maps.event.addListener(g,"click",function(){h.open(f,g)});a.find("#mapImage").fancybox({width:"90%",height:"90%",fixed:!1,autoSize:!1,autoCenter:!0,content:b,helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.4)"}}},afterShow:function(){f&&(window.google.maps.event.trigger(f,"resize"),f.setCenter(e),f.setZoom(d))}})});a.find("select").selectmenu();if(a.find(".destination-details").length){b=a.find(".top-regions");b.find(".pages").preparePaging(b.find(".paging"));b=a.find(".highlight-attrs.popular");
b.find(".pages").preparePaging(b.find(".paging"));a.off("click.highlight-tab").on("click.highlight-tab",".highlight-tabs .tab",k);a.find(".destination-info .desc").readMore(a.find(".destination-info .read-more"),a.find(".destination-info .read-less"));a.find(".destination-where-to-stay .desc").readMore(a.find(".destination-where-to-stay .read-more"),a.find(".destination-where-to-stay .read-less"));var l=a.find(".route"),m=l.data("markerLabelStart"),u=!1;l.length&&(u=!0,l.find(".marker").each(function(a){$(this).css("background-color",
d.getColor(a))}));q.addToQueue(function(){var b=a.find(".destination-schedules");b.length&&(b.prepareMiniMap(b,b.find(".map-data"),u,m),l.linkToCalendarAndMinimap({staySelector:".marker-text",$calendar:b.find(".mini-calendar"),$minimap:b.find(".mini-map"),onlyHighlightedInteractive:!0,stayListTitleSelector:".marker-title"}));var c=a.find(".top-cities");c.length&&(c.prepareMiniMap(c,c.find(".idea,.currentDes,.planDes"),!1,void 0,void 0,!0),c.off("click.idealink").on("click.idealink",".idea .text-link",
function(){c.find(".large-map").data("infoWindowController").showInfoWindow($(this).parents(".idea").data("destinationId"),!0,!0);return!1}),c.find(".right-col").linkToCalendarAndMinimap({staySelector:".idea",stayListTitleSelector:".text-link",stayListHighlightedClass:"highlight",$minimap:c.find(".large-map"),onlyHighlightedInteractive:!0,highlightColor:"#000",listKey:"destinationId",mapKey:"destinationId"}));var d=a.find(".nearby-nightstays");d.length&&(d.prepareMiniMap(d,d.find(".idea,.currentDes,.planDes"),
!1,void 0,void 0,!0),d.off("click.idealink").on("click.idealink",".idea .text-link",function(){d.find(".large-map").data("infoWindowController").showInfoWindow($(this).parents(".idea").data("destinationId"),!0,!0);return!1}),d.find(".right-col").linkToCalendarAndMinimap({staySelector:".idea",stayListTitleSelector:".text-link",stayListHighlightedClass:"highlight",$minimap:d.find(".large-map"),onlyHighlightedInteractive:!0,highlightColor:"#000",listKey:"destinationId",mapKey:"destinationId"}))});a.find(".booking-area").each(function(){function a(b,
c){var d=b.datepicker("getDate");null!==d?c.datepicker("option","minDate",d):c.datepicker("option","minDate","+1d")}var b=$(this),c=b.find(".startdatepicker"),d=new Date(c.data("defaultDate")),e=b.find(".enddatepicker"),b=new Date(e.data("defaultDate"));c.datepicker({minDate:"+1d",maxDate:"+3y",dateFormat:"M dd, yy",onSelect:function(){a(c,e)}});c.datepicker("setDate",d);e.datepicker({dateFormat:"M dd, yy"});e.datepicker("setDate",b);a(c,e)})}else a.find(".attraction-details").length&&(h.find(".page-clipper .pages").preparePaging(h.find(".page-clipper .paging"),
!0),q.addToQueue(function(){h.find(".map-holder").prepareMiniMap(h.find(".map-holder"),h.find(".nearbyAttr-tile,.currentAttr,.planAttr"),!1,void 0,"attractionId",!0)}),f.updatePhotoAttributions(),a.find(".attraction-details").find(".greview").each(function(){$(this).find(".desc").readMore($(this).find(".read-more"),$(this).find(".read-less"))}))}};return l});
define("plan/exploreSearch",["modules/analytics","modules/ajax","jquery","jqueryui"],function(a,c){var d={},e,h,g,f;d.showLanding=function(){window.pageYOffset>g.offset().top-150&&$("html, body").animate({scrollTop:g.offset().top-150},300)};d.initialize=function(){e=$("#explore");h=e.find("#search");g=h.find("#explore-search");f=$(".explore-search-pane");var a={},d={id:void 0,label:"Start typing...",nightstay:!1,value:void 0,selectable:!1};d.li="<li>"+d.label+"</li>";var m={id:void 0,label:"Type another character...",
nightstay:!1,value:void 0,selectable:!1};m.li="<li>"+m.label+"</li>";var q={id:void 0,label:"Searching...",nightstay:!1,value:void 0,selectable:!1};q.li="<li>"+q.label+"</li>";var r={id:void 0,label:"Sorry, We did not recognize this place.",nightstay:!1,value:void 0,selectable:!0};r.li="<li>"+r.label+"</li>";g.autocomplete({minLength:0,appendTo:f,source:function(e,f){var g=e.term;a.hasOwnProperty(g)?f(a[g]):0===g.length?f([d]):1===g.length?f([m]):(f([q]),e.tab="explore",c.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/searchAutocomplete",type:"POST",data:e,success:function(c){try{c=JSON.parse(c),a[g]=c,0===c.length?f([r]):f(c)}catch(d){}}}))},select:function(a,b){(a.keyCode===$.ui.keyCode.ENTER||a.keyCode===$.ui.keyCode.TAB)&&$("#search-"+b.item.id).trigger("click");return!1},focus:function(){return!1},close:function(){},response:function(){}}).data("autocomplete")._renderItem=function(a,b){var c=RegExp(this.term,"gi"),d;if(!b.category)return c=$(b.li).html(),d=b.id?"":" invalid-data",
$(b.li).empty().addClass("ui-menu-item").attr("role","presentation").attr("data-value",b.value).append(!b.selectable?$('<span class="nonselectable">'+c+"</span>"):$("<a class="+d+">"+c+"</a>").addClass("ui-corner-all").addClass("menu-list")).appendTo(a);"destination"===b.category?d='<a id="search-'+b.id+'" class="destinationDetailsLink" data-link="'+window.contextPath+b.url+'" data-event-src="search"><div class="icon-wrap"><span class="sheet search-icon '+b.category+'"></span></div><div class="info"><span class="search-label">'+
b.label.replace(c,"<strong>$&</strong>")+"</span>":"attraction"===b.category&&(d='<a id="search-'+b.id+'" class="attractionDetailsLink" data-link="'+window.contextPath+b.url+'" data-event-src="search"><div class="icon-wrap"><span class="sheet search-icon '+b.category+'"></span></div><div class="info"><span class="search-label">'+b.label.replace(c,"<strong>$&</strong>")+"</span>");b.description&&(d+='<div class="search-desc">&nbsp;-&nbsp;'+b.description+"</div>");c=$(d+'</div><div class="clear"></div></a>');
return $("<li>").append(c).appendTo(a)}};return d});
define("plan/exploreAttractions","modules/analytics plan/history modules/ajax modules/events modules/attributions modules/modal modules/utils plan/visits plan/details plan/loading plan/dock plan/view plan/exploreSearch jquery jqueryui selectmenu".split(" "),function(a,c,d,e,h,g,f,b,j,m,q){function r(){c.pop()}function p(a,b){b.is(":visible")&&(a.removeClass("active"),a.find(".expand-options").addClass("fa-chevron-down").removeClass("fa-chevron-up"),b.addClass("hidden"))}function t(a,b){b.is(":visible")||
(a.addClass("active"),a.removeClass("hidden").siblings(".expandable").removeClass("hidden"),a.find(".expand-options").removeClass("fa-chevron-down").addClass("fa-chevron-up"),b.removeClass("hidden"),a.parents(".destination-filter").removeClass("active").siblings().find(".attraction-filter").addClass("hidden"))}function n(){N.find(".expandable").each(function(){var a=$(this),b=$("#"+a.data("targetId"));p(a,b)});N.find(".clickable").removeClass("active");N.find(".filters").find("input").prop("checked",
!1)}function z(){var b=N.find(".attraction-filter.active");if(0!==b.length){var d=b.data("destinationId"),e=$("#"+b.data("targetId")).find("input[type=checkbox]:checked").filter(".catgroup").map(function(){return parseInt(this.value,10)}).get(),f=$("#"+b.data("targetId")).find("input[type=checkbox]:checked").filter(".filterkey").map(function(){return this.value}).get(),h=w.find("#hideInPlan").is(":checked"),i=w.find("#sortBy").val(),d={destinationId:d,categoryFilters:e,otherFilters:f,hideInPlan:h,
sortBy:i,numResults:C,pageIndex:0},e={requestData:$.extend(!0,{dontScrollToTop:!0},d),targetId:b.data("targetId")},f=window.contextPath+"/plan/"+$("#plan").data("planId")+"/explore/attractions?view=browse&"+$.param(d);g.isOpen()||c.push("browseAttractions","explore",f,e);m.showLoading($("#exploreLoadingPane"),$("#attractions"),"Searching...");y.loadBrowseAttractions(b.data("targetId"),d);a.trackPageView("/plan/explore/attractions")}}function k(){var a=N.find(".attraction-filter.active"),b;a.length&&
(b=a.data("targetId"));a=w.data("requestData")||{};a.pageIndex=0;a.hideInPlan=w.find("#hideInPlan").is(":checked");a.sortBy=w.find("#sortBy").val();a.view="full";var d={requestData:$.extend(!0,{dontScrollToTop:!0},a),targetId:b},e=window.contextPath+"/plan/"+$("#plan").data("planId")+"/explore/attractions?view=browse&"+$.param(a);g.isOpen()||c.push("browseAttractions","explore",e,d);m.showLoading($("#exploreLoadingPane"),$("#attractions"),"Searching...");y.loadBrowseAttractions(b,a)}function l(){var b=
w.data("requestData"),e=$(this);if(!e.data("queryInProgress")){e.data("queryInProgress",!0);var f=$.extend(!0,{},b);f.pageIndex=0;f.numResults=(b.pageIndex+1)*C;f.dontScrollToTop=!0;delete f.view;var i=window.contextPath+"/plan/"+$("#plan").data("planId")+"/explore/attractions?view=browse&"+$.param(f);b.hideInPlan=w.find("#hideInPlan").is(":checked");f={requestData:f,targetId:window.history.state.data&&window.history.state.data.targetId?window.history.state.data.targetId:void 0};g.isOpen()||c.replace("browseAttractions",
"explore",i,f);b.numResults=C;b.view="partial";b.tab=g.getTab()?g.getTab():"explore";d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/browseAttractions",data:b,complete:function(){e.data("queryInProgress",!1)},success:function(c){var c=$(c).filter("li").clone(),d=w.find(".search-results");c.each(function(){var a=$(this);$("#"+a.attr("id")).length?console.log("duplicate "+a.attr("id")):d.append(a)});b.pageIndex+=1;w.data("requestData",b);c.length<C?e.addClass("hidden"):
e.removeClass("hidden");a.trackEvent("explore.filter-results","show-more");a.trackPageView("/plan/explore/attractions");h.updatePhotoAttributions()}})}}function v(){var a=$(this).parent(".expandable"),b=$("#"+a.data("targetId"));b.is(":visible")?p(a,b):b.length&&t(a,b);a.hasClass("attraction-filter")&&b.length&&(a.parents(".contents").find(".clickable").not(".expandable").removeClass("active"),a.parents(".destination-filter").removeClass("active").siblings().removeClass("active"),a.siblings(".attraction-filter").each(function(){var a=
$(this),b=$("#"+a.data("targetId"));p(a,b);a.removeClass("hidden")}));0===b.length&&(a.find(".expandable").removeClass("hidden"),a.addClass("active"),a.find(".attraction-filter").removeClass("active").siblings(".filters").addClass("hidden"),a.siblings(".expandable").removeClass("active").find(".expandable").addClass("hidden").removeClass("active").siblings(".filters").addClass("hidden"),a.find(".expand-options").addClass("fa-chevron-down").removeClass("fa-chevron-up"))}function i(){var a=$(this),
c=a.parents(".attraction"),d=c.data("attractionId"),e=c.data("name"),f=c.data("destinationId"),g=c.data("isSchedulable"),h=c.data("addToStay");""===h?b.showAddVisitDialog({analyticsCategory:"explore.filter-results",eventSource:"explore",attractionId:d,attractionName:e,hideDestinationSelect:!0,userTimeInputRequired:!1,uiSource:"explore.attractions.list",isSchedulable:g,additionalPostData:{view:"browseRow"},successCB:function(c){c=$(c);a.parents("li.attraction").replaceWith(c);if(!g){var f=c.data("addToStay"),
h=c.data("destinationId"),i=c.find(".add-button");b.addNonSchedulableAttraction({attractionId:d,attractionName:e,stayId:f,destinationId:h,analyticsCategory:"explore.filter-results",eventSource:"explore",view:"browseRow",uiSource:"explore.attractions.list",successCB:function(a){i.parents("li.attraction").replaceWith(a)}})}}}):g&&void 0!==h?(a.prop("disabled",!0),b.addSchedulableAttraction({attractionId:d,attractionName:e,stayId:h,analyticsCategory:"explore.filter-results",eventSource:"explore",view:"browseRow",
uiSource:"explore.attractions.list",successCB:function(b){a.parents("li.attraction").replaceWith(b)},errorCB:function(){b.addNonSchedulableAttraction({attractionId:d,attractionName:e,stayId:h,destinationId:f,analyticsCategory:"explore.filter-results",eventSource:"explore",view:"browseRow",uiSource:"explore.attractions.list",successCB:function(b){a.parents("li.attraction").replaceWith(b)}})},completeCB:function(){a.prop("disabled",!1)}})):g||b.addNonSchedulableAttraction({attractionId:d,attractionName:e,
stayId:h,destinationId:f,analyticsCategory:"explore.filter-results",eventSource:"explore",view:"browseRow",uiSource:"explore.attractions.list",successCB:function(b){a.parents("li.attraction").replaceWith(b)}})}function L(){e.triggerEvent("explore-attractions","mmt_track_link",{linkName:"In your plan"})}var y={},J,u,N,M,w,C=10;y.restoreBrowseLeftPaneState=function(a,b){n();t(N.find(".expandable").filter("[data-target-id="+a+"]"),$("#"+a));var c=$("#"+a).find("input[type=checkbox]"),d;if(b.categoryFilters)for(d=
0;d<b.categoryFilters.length;d++)c.filter("[value="+b.categoryFilters[d]+"]").prop("checked",!0);if(b.otherFilters)for(d=0;d<b.otherFilters.length;d++)c.filter("[value="+b.otherFilters[d]+"]").prop("checked",!0)};y.exploreAttraction=function(){};y.loadAttractionsInModal=function(a,b,c,f){a={path:"/plan/"+$("#plan").data("planId")+"/"+a+"/",history:{id:"browseAttractions",tabId:a,url:"/plan/"+$("#plan").data("planId")+"/"+a+"/modal/explore/attractions/"+b,data:{detailsUrl:"/plan/"+$("#plan").data("planId")+
"/"+a+"/modal/explore/attractions/"+b,backText:"",eventSource:a,modal:"explore",tab:a,destinationId:b}}};g.open({element:$("#explore"),data:c?c:a,open:function(a){var c=function(){f&&f();q.disableDock("explore-attractions-left-pane");a.off("click.modalAttrDetailPageLink").on("click.modalAttrDetailPageLink",".attractionDetailsLink,.attLink",y.attractionDetailsPageLinks);a.off("click.modalDestDetailPageLink").on("click.modalDestDetailPageLink",".destinationDetailsLink,.destLink",function(){e.triggerEvent("exploreAttractions",
"explore-destination-details-click",{target:$(this)})})};m.showLoading($("#exploreLoadingPane"),$("#attractions"),"Loading...");d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/explore/attractions",type:"GET",data:{destinationId:b},complete:function(){m.hideLoading($("#exploreLoadingPane"),$("#attractions"))},success:function(a){e.triggerEvent("explore-attractions","load-explore-contents",a);h.updatePhotoAttributions();$("#exploreAttractionsMainPane, #exploreAttractionsLeftPane").removeClass("hidden");
c&&c()}});a.off("click.claimPlan").on("click.claimPlan",".claimPlanLink",function(){e.triggerEvent("exploreAttractions","claimPlan",{})})},close:function(){q.enableDock("explore-attractions-left-pane")}})};y.loadBrowseAttractions=function(b,c){c.tab=g.getTab()?g.getTab():"explore";d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/browseAttractions",data:c,complete:function(){m.hideLoading($("#exploreLoadingPane"),$("#attractions"))},success:function(d){w.removeClass("hidden").siblings().addClass("hidden");
w.html(d);d=$.extend(!0,{},c);d.pageIndex=c.pageIndex+Math.floor(c.numResults/C);w.data("requestData",d);w.find(".load-more").addClass("hidden");w.find("select").selectmenu({appendTo:w});w.find(".search-results").find("li").length<C?w.find(".load-more").addClass("hidden"):w.find(".load-more").removeClass("hidden");d=w.find(".more-filters");d.hasClass("disabled")&&(d.find("#hideInPlan").prop("disabled","disabled"),d.find("select").selectmenu("disable"));c.dontScrollToTop||window.pageYOffset>w.offset().top-
23&&$("html, body").animate({scrollTop:w.offset().top-23},300);a.trackNonInteractionEvent("explore","filter-attractions");a.trackNonInteractionEvent("explore","filter-attractions-hide-in-plan",c.hideInPlan);a.trackNonInteractionEvent("explore","filter-attractions-sort",c.sortBy);if(void 0!==b)if(d=$("#"+b).find("input[type=checkbox]:checked").map(function(){return $(this).next("label").text().toLowerCase()}).get(),0<d.length){var e;for(e=0;e<d.length;e++)a.trackNonInteractionEvent("explore","filter-attractions-category",
d[e])}else a.trackNonInteractionEvent("explore","filter-attractions-category","none");h.updatePhotoAttributions()}})};y.loadAttractionDetails=function(b){var c=b.url,d=b.analyticsEventCategory,f=c.split("/"),i=f[f.length-1],k;"a"===i.charAt(0)?k="attraction":"d"===i.charAt(0)&&(k="destination");if("attraction"===k||"destination"===k)i=f[f.length-2]+"-"+f[f.length-1],d&&(a.trackPageView(c,i.toLowerCase()),a.trackNonInteractionEvent(d,k+"-details",i.toLowerCase()));-1!==c.indexOf("modal")&&(c="/plan/"+
f[2]+c.split("modal")[1]);d="";for(k=3;k<f.length&&"modal"!==f[k];)d.length&&(d+="/"),d+=f[k++];g.open({data:b.addnlData,ajaxParams:{url:c,data:{view:"partial"},type:"GET",func:{success:function(a){h.updatePhotoAttributions();return $("<div />").append('<div class="details-pane attractions">'+a+"</div>").html()}}},open:function(a){j.initialize($(".modal-box .details-pane"),"details","explore","explore.destinations.details");a.off("click.modalAttrDetailPageLink").on("click.modalAttrDetailPageLink",
".attractionDetailsLink,.attLink",y.attractionDetailsPageLinks);a.off("click.modalDestDetailPageLink").on("click.modalDestDetailPageLink",".destinationDetailsLink,.destLink",function(){e.triggerEvent("exploreAttractions","explore-destination-details-click",{target:$(this)})});a.off("click.claimPlan").on("click.claimPlan",".claimPlanLink",function(){e.triggerEvent("exploreAttractions","claimPlan",{})})}})};y.gotoBrowseNightlife=function(a,b){var c="filter-destination-"+a,d={destinationId:a,categoryFilters:[29],
otherFilters:[],hideInPlan:!1,sortBy:"popularity",numResults:C,pageIndex:0};y.loadAttractionsInModal(b,a,null,function(){y.restoreBrowseLeftPaneState(c,d);y.loadBrowseAttractions(c,d)})};y.gotoBrowseDestination=function(a){var b="filter-destination-"+a,a={destinationId:a,categoryFilters:[],otherFilters:[],hideInPlan:!1,sortBy:"popularity",numResults:C,pageIndex:0};$.extend(!0,{dontScrollToTop:!0},a);e.triggerEvent("explore-attractions","show-tab-explore",{addToHistory:!1});m.showLoading($("#exploreLoadingPane"),
$("#attractions"),"Searching...");e.triggerEvent("explore-attractions","explore-subnav",{targetId:"attractions",subnavLinkId:"attractionslink",preventShowLanding:!0});w.removeClass("hidden").siblings().addClass("hidden");y.restoreBrowseLeftPaneState(b,a);y.loadBrowseAttractions(b,a)};y.attractionDetailsPageLinks=function(){var a=$(this);!a.data("link")&&(!a.data("detailsUrl")&&!a.attr("href"))&&(a=$(this).parents(".data-holder"));$("#explore-search").val("");var b=a.data("link")||a.attr("href")||
a.data("detailsUrl"),c=location.pathname,d=c.split("/"),g=$("#plan").data("planId"),h="/plan/"+g,b=-1===b.indexOf(h)?h+"/"+d[d.indexOf(g)+1]+"/modal"+b:f.planTabUrl()+"/modal"+b.replace(h,""),d=a.parents(".tab-content"),g="";0<d.length&&(g+=d.attr("id"));g+="."+(a.data("eventSrc")||a.parents(".data-holder").data("eventSrc"));h="back";0<a.parents("#results").length&&(h="back to results");e.triggerEvent("plan","explore-subnav",{targetId:"attractions",subnavLinkId:"attractionslink",preventShowLanding:!0});
e.triggerEvent("plan","explore-attraction-details",{url:b,analyticsEventCategory:g,shouldScroll:!0,backText:h,addnlData:{path:c,history:{id:"exploreAttractionDetails",tabId:d.attr("id"),url:b,data:{detailsUrl:b,backText:h,eventSource:g,modal:"explore"}}}});return!1};y.showLanding=function(){w.removeClass("hidden").siblings().addClass("hidden");n();$("#exploreAttractionsMainPane, #exploreAttractionsLeftPane").removeClass("hidden")};y.initialize=function(){J=$("#explore");J.find("#exploreSubnavPane");
u=J.find("#attractions");N=J.find("#exploreAttractionsLeftPane");M=u.find("#exploreAttractionsMainPane");w=M.find("#exploreAttractionResultsPane");e.addObserver("explore-attraction-details","explore-attractions",function(a,b){y.loadAttractionDetails(b)});M.off("click.back").on("click.back",".subnav-actions .action-back",r);N.off("click.expandable").on("click.expandable",".expandable .expandable-title",v).off("click.attractionfilter").on("click.attractionfilter",".attraction-filter.city",z).off("change.attractionfilter").on("change.attractionfilter",
".filter",z);w.off("change.hideInPlan").on("change.hideInPlan","#hideInPlan",k).off("change.sortBy").on("change.sortBy","#sortBy",k).off("click.loadMore").on("click.loadMore",".load-more",l).off("click.addBrowseAttraction").on("click.addBrowseAttraction","li.attraction .add-button",i).off("click.inplan").on("click.inplan",".calendarLink",L);w.find("select").selectmenu({appendTo:w});w.data("requestData",{hideInPlan:w.find("#hideInPlan").is(":checked"),sortBy:"popularity",view:"full",pageIndex:1,numResults:C,
destinationId:N.find(".attraction-filter.city.active").data("destinationId")})};return y});
define("plan/daybyday","modules/analytics modules/ajax modules/events plan/visits plan/notes plan/reserveds plan/exploreAttractions plan/view plan/comments jquery jqueryui qtip".split(" "),function(a,c,d,e,h,g,f,b,j){var m={},q,r=!1,p=function(){var b=$(this),c=b.parents(".visit-row"),f=c.data("visitId"),g=c.data("name"),c=$(document.createElement("div")),h=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button" value="Delete Attraction?"></div>');h.click(function(){b.qtip("api").destroy();
a.trackEvent("itinerary.list.visit","delete-attraction-confirm",g.toLowerCase());e.removeFromPlan({visitId:f,view:"daybyday",successCB:function(a){q.html(a);m.initialize();d.triggerEvent("daybyday","visit-remove",{uiSource:"itinerary.daybyday"});q.trigger("refreshed")}})});c.append(h);b.qtip({overwrite:!0,content:c,position:{my:"top right",at:"top right",container:$("#itinerary")},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(a,b){b.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",
tip:{corner:!1}}});a.trackEvent("itinerary.list.visit","delete-attraction",g.toLowerCase())},t=function(){var b=$(this),c=b.parents(".reserved-row").data("reservedId"),e=$(document.createElement("div")),f=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button" value="Delete Blocked Time?"></div>');f.click(function(){b.qtip("api").destroy();a.trackEvent("itinerary.list.reserved","delete-reserved-confirm");g.removeFromPlan({reservedId:c,view:"daybyday",successCB:function(a){q.html(a);
m.initialize();d.triggerEvent("daybyday","reserved-remove",{source:"itinerary.daybyday"});q.trigger("refreshed")}})});e.append(f);b.qtip({overwrite:!0,content:e,position:{my:"top right",at:"top right"},show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(a,b){b.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}});a.trackEvent("itinerary.list.reserved","delete-reserved")},n=function(){var b=$(this).parents(".visit-row"),e=b.data("visitId"),
f=b.data("duration"),g=b.data("name"),b=f+30;c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+e+"/duration",data:{duration:b,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){q.html(b);m.initialize();d.triggerEvent("daybyday","visit-update",{uiSource:"itinerary.daybyday.addTime"});q.trigger("refreshed");a.trackEvent("itinerary.list.visit","change-duration",g.toLowerCase())}})},z=function(){var b=$(this).parents(".visit-row"),e=b.data("visitId"),f=b.data("name"),
b=b.data("duration");30<b&&(b-=30,c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+e+"/duration",data:{duration:b,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){q.html(b);m.initialize();d.triggerEvent("daybyday","visit-update",{source:"itinerary.daybyday.minusTime"});q.trigger("refreshed");a.trackEvent("itinerary.list.visit","change-duration",f.toLowerCase())}}))},k=function(){var b=$(this).parents(".reserved-row"),e=b.data("reservedId"),b=b.data("duration")+
30;c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved/"+e+"/duration",data:{duration:b,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){q.html(b);m.initialize();d.triggerEvent("daybyday","reserved-update",{uiSource:"itinerary.daybyday.addTime"});q.trigger("refreshed");a.trackEvent("itinerary.list.reserved","change-duration")}})},l=function(){var b=$(this).parents(".reserved-row"),e=b.data("reservedId"),b=b.data("duration");30<b&&(b-=30,c.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/reserved/"+e+"/duration",data:{duration:b,view:"daybyday"},type:"POST",synchronize:!0,success:function(b){q.html(b);m.initialize();d.triggerEvent("daybyday","reserved-update",{uiSource:"itinerary.daybyday.minusTime"});q.trigger("refreshed");a.trackEvent("itinerary.list.reserved","change-duration")}}))},v=function(){a.trackEvent("itinerary.list.hop","click-directions")},i=function(){var a=$(this).data("destinationId");f.gotoBrowseNightlife(a,"itinerary")},L=function(){var a=
$(this).data("destinationId");f.loadAttractionsInModal("itinerary",a)},y=function(){var a=$(this).siblings(".options-content"),b=$(this).find(".fa");a.hasClass("hidden")?(b.removeClass("fa-chevron-down"),b.addClass("fa-chevron-up"),a.removeClass("hidden")):(b.removeClass("fa-chevron-up"),b.addClass("fa-chevron-down"),a.addClass("hidden"))};m.refreshIfInvalid=function(a,d){var e=$(window).scrollTop();r&&!q.data("refreshInProgress")?(q.empty(),q.data("refreshInProgress",!0),c.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/daybyday",type:"GET",complete:function(){q.data("refreshInProgress",!1)},success:function(c){q.html(c);m.initialize();r=!1;q.trigger("refreshed");void 0!==a&&void 0!==d?b.scrollElementIntoView("itineraryDay"+d,-115,!0):$(window).scrollTop(e)}})):void 0!==a&&void 0!==d&&b.scrollElementIntoView("itineraryDay"+d,-115,!0)};m.isDirty=function(){return r};var J=function(){r=!0},u=function(){if($("#plan").data("editEnabled")){var a=$(this),b=a.siblings(".reserved-title"),
c=b.siblings(".blocked-time-tag");b.removeClass("hidden").prop("disabled",!1);a.addClass("hidden");c.addClass("hidden");b.focus()}},N=function(){var a=$(this),b=a.siblings(".blocked-static-title"),e=a.siblings(".blocked-time-tag"),f=a.parents(".reserved-row"),g=f.find("textarea"),h=a.val().trim(),f={reservedId:f.data("reservedId"),name:h,date:f.data("startDate"),startTime:f.data("startTime"),endTime:f.data("endTime"),notes:g.val(),view:"dayByDay-edit-reservedTitle"};a.prop("disabled",!0);c.makeAJAXcall({url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/reserved/"+f.reservedId,type:"POST",data:f,success:function(){""===h||null===h?(b.text("Blocked Time"),e.removeClass("hidden")):b.text(h);a.addClass("hidden");b.removeClass("hidden");d.triggerEvent("daybyday","reserved-update",{uiSource:"itinerary.daybyday.title"})}})};m.initialize=function(){q=$("#daybyday");d.addObservers("visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update".split(" "),"daybyday",J);
q.find(".reserved-row").each(function(){var a=$(this),b=a.find(".notes"),a=a.data("reservedId");h.prepareNotes(b,window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved/"+a+"/notes",function(){d.triggerEvent("daybyday","reserved-update",{uiSource:"itinerary.daybyday.updateNote"})})});q.off("click.visit-delete").on("click.visit-delete",".visit-row .delete",p);q.off("click.visit-addTime").on("click.visit-addTime",".visit-row .addTime",n);q.off("click.visit-reduceTime").on("click.visit-reduceTime",
".visit-row .reduceTime",z);q.off("click.reserved-delete").on("click.reserved-delete",".reserved-row .delete",t);q.off("click.reserved-addTime").on("click.reserved-addTime",".reserved-row .addTime",k);q.off("click.reserved-reduceTime").on("click.reserved-reduceTime",".reserved-row .reduceTime",l);q.off("click.directions").on("click.directions",".directions",v);q.off("click.nightlife-row").on("click.nightlife-row",".nightlife-row",i);q.off("click.gap-row").on("click.gap-row",".gap-row .right-col",
L);q.off("click.options").on("click.options",".options",y);q.find(".reserved-row").off("click.reservedTitle").on("click.reservedTitle",".blocked-static-title",u);q.find(".reserved-row").off("blur.reservedTitle").on("blur.reservedTitle",".reserved-title",N);j.prepareCommentAreas(q)};return m});
(function(a){"function"===typeof define&&define.amd?define("fullCalendar",["jquery","moment"],a):a(jQuery,moment)})(function(a,c){function d(b){function c(e,f){a.isPlainObject(f)&&a.isPlainObject(b[e])&&!/(Time|Duration)$/.test(e)?b[e]=d({},b[e],f):void 0!==f&&(b[e]=f)}for(var e=1;e<arguments.length;e++)a.each(arguments[e],c);return b}function e(e,f){function i(){setTimeout(function(){!s.start&&a("body").is(":visible")&&l()},0)}function j(){return e.is(":visible")}function A(b){if(!s||b!=s.name)aa++,
s&&(w("viewDestroy",s,s,s.element),t(),s.triggerEventDestroy(),r(),s.element.remove(),I.deactivateButton(s.name)),I.activateButton(b),s=new ea[b](a("<div class='fc-view fc-view-"+b+"' />").appendTo(J),G),l(),y(),aa--}function l(a){(!s.start||a||!S.isWithin(s.intervalStart,s.intervalEnd))&&j()&&m(a)}function m(a){aa++;s.start&&(w("viewDestroy",s,s,s.element),t(),D());r();a&&(S=s.incrementDate(S,a));s.render(S.clone());K();y();(s.afterRender||k)();I.updateTitle(s.title);G.getNow().isWithin(s.intervalStart,
s.intervalEnd)?I.disableButton("today"):I.enableButton("today");w("viewRender",s,s,s.element);aa--;!u.lazyFetching||Pa(s.start,s.end)?Ja(s.start,s.end):p()}function n(){j()&&(t(),D(),B(),K(),p())}function B(){M=u.contentHeight?u.contentHeight:u.height?u.height-(C?C.height():0)-z(J):Math.round(J.width()/Math.max(u.aspectRatio,0.5))}function K(){void 0===M&&B();aa++;s.setHeight(M);s.setWidth(J.width());aa--;V=e.outerWidth()}function v(a){if(!aa&&a.target===window)if(s.start){var b=++N;setTimeout(function(){if(b==
N&&(!aa&&j())&&V!=(V=e.outerWidth()))aa++,n(),s.trigger("windowResize",Ka),aa--},u.windowResizeDelay)}else i()}function q(a){D();p(a)}function p(a){j()&&(s.renderEvents(da,a),s.trigger("eventAfterAllRender"))}function D(){s.triggerEventDestroy();s.clearEvents();s.clearEventData()}function t(){s&&s.unselect()}function r(){J.css({width:"100%",height:J.height(),overflow:"hidden"})}function y(){J.css({width:"",height:"",overflow:""})}function w(a,b){if(u[a])return u[a].apply(b||Ka,Array.prototype.slice.call(arguments,
2))}function H(b,c){var d=b.target,e=a(d);if(!e.parents(".fc").length){var f=u.dropAccept;if(a.isFunction(f)?f.call(d,e):e.is(f))ba=d,s.dragStart(ba,b,c)}}function Q(a,b){ba&&(s.dragStop(ba,a,b),ba=null)}var G=this,f=f||{},u=d({},fa,f),F;(F=u.lang in ca?ca[u.lang]:ca[fa.lang])&&(u=d({},fa,F,f));u.isRTL&&(u=d({},fa,ja,F||{},f));G.options=u;G.render=function(b){J?j()&&(B(),m(b)):(e.addClass("fc"),u.isRTL?e.addClass("fc-rtl"):e.addClass("fc-ltr"),u.theme&&e.addClass("ui-widget"),J=a("<div class='fc-content' />").prependTo(e),
I=new h(G,u),(C=I.render())&&e.prepend(C),A(u.defaultView),u.handleWindowResize&&a(window).resize(v),a("body").is(":visible")||i())};G.destroy=function(){s&&(w("viewDestroy",s,s,s.element),s.triggerEventDestroy());a(window).unbind("resize",v);u.droppable&&a(document).off("dragstart",H).off("dragstop",Q);s.selectionManagerDestroy&&s.selectionManagerDestroy();I.destroy();J.remove();e.removeClass("fc fc-ltr fc-rtl ui-widget")};G.refetchEvents=function(){D();Ja(s.start,s.end)};G.reportEvents=function(a){da=
a;p()};G.reportEventChange=function(a){q(a)};G.rerenderEvents=q;G.changeView=A;G.select=function(a,b){s.select(a,b)};G.unselect=t;G.prev=function(){l(-1)};G.next=function(){l(1)};G.prevYear=function(){S.add("years",-1);l()};G.nextYear=function(){S.add("years",1);l()};G.today=function(){S=G.getNow();l()};G.gotoDate=function(a){S=G.moment(a);l()};G.incrementDate=function(a){S.add(c.duration(a));l()};G.getDate=function(){return S.clone()};G.getCalendar=function(){return G};G.getView=function(){return s};
G.option=function(a,b){if(void 0===b)return u[a];if("height"==a||"contentHeight"==a||"aspectRatio"==a)u[a]=b,n()};G.trigger=w;var L=b(c.langData(u.lang));u.monthNames&&(L._months=u.monthNames);u.monthNamesShort&&(L._monthsShort=u.monthNamesShort);u.dayNames&&(L._weekdays=u.dayNames);u.dayNamesShort&&(L._weekdaysShort=u.dayNamesShort);null!=u.firstDay&&(F=b(L._week),F.dow=u.firstDay,L._week=F);G.defaultAllDayEventDuration=c.duration(u.defaultAllDayEventDuration);G.defaultTimedEventDuration=c.duration(u.defaultTimedEventDuration);
G.moment=function(){var a;"local"===u.timezone?(a=W.moment.apply(null,arguments),a.hasTime()&&a.local()):a="UTC"===u.timezone?W.moment.utc.apply(null,arguments):W.moment.parseZone.apply(null,arguments);a._lang=L;return a};G.getIsAmbigTimezone=function(){return"local"!==u.timezone&&"UTC"!==u.timezone};G.rezoneDate=function(a){return G.moment(a.toArray())};G.getNow=function(){var a=u.now;"function"===typeof a&&(a=a());return G.moment(a)};G.calculateWeekNumber=function(a){var b=u.weekNumberCalculation;
if("function"===typeof b)return b(a);if("local"===b)return a.week();if("ISO"===b.toUpperCase())return a.isoWeek()};G.getEventEnd=function(a){return a.end?a.end.clone():G.getDefaultEventEnd(a.allDay,a.start)};G.getDefaultEventEnd=function(a,b){var c=b.clone();a?c.stripTime().add(G.defaultAllDayEventDuration):c.add(G.defaultTimedEventDuration);G.getIsAmbigTimezone()&&c.stripZone();return c};G.formatRange=function(a,b,c){"function"===typeof c&&(c=c.call(G,u,L));return R(a,b,c,null,u.isRTL)};G.formatDate=
function(a,b){"function"===typeof b&&(b=b.call(G,u,L));return P(a,x(b))};g.call(G,u);var Pa=G.isFetchNeeded,Ja=G.fetchEvents,Ka=e[0],I,C,J,s,V,M,N=0,aa=0,S,da=[],ba;S=null!=u.defaultDate?G.moment(u.defaultDate):G.getNow();if(u.droppable)a(document).on("dragstart",H).on("dragstop",Q)}function h(b,c){function d(e){var g=a("<td class='fc-header-"+e+"'/>");(e=c.header[e])&&a.each(e.split(" "),function(d){0<d&&g.append("<span class='fc-header-space'/>");var e;a.each(this.split(","),function(d,h){if("title"==
h)g.append("<span class='fc-header-title'><h2>&nbsp;</h2></span>"),e&&e.addClass(f+"-corner-right"),e=null;else{var E;b[h]?E=b[h]:ea[h]&&(E=function(){m.removeClass(f+"-state-hover");b.changeView(h)});if(E){var j=v(c.themeButtonIcons,h),k=v(c.buttonIcons,h),l=v(c.defaultButtonText,h),A=v(c.buttonText,h),j=A?i(A):j&&c.theme?"<span class='ui-icon ui-icon-"+j+"'></span>":k&&!c.theme?"<span class='fc-icon fc-icon-"+k+"'></span>":i(l||h),m=a("<span class='fc-button fc-button-"+h+" "+f+"-state-default'>"+
j+"</span>").click(function(){m.hasClass(f+"-state-disabled")||E()}).mousedown(function(){m.not("."+f+"-state-active").not("."+f+"-state-disabled").addClass(f+"-state-down")}).mouseup(function(){m.removeClass(f+"-state-down")}).hover(function(){m.not("."+f+"-state-active").not("."+f+"-state-disabled").addClass(f+"-state-hover")},function(){m.removeClass(f+"-state-hover").removeClass(f+"-state-down")}).appendTo(g);L(m);e||m.addClass(f+"-corner-left");e=m}}});e&&e.addClass(f+"-corner-right")});return g}
this.render=function(){f=c.theme?"ui":"fc";if(c.header)return e=a("<table class='fc-header' style='width:100%'/>").append(a("<tr/>").append(d("left")).append(d("center")).append(d("right")))};this.destroy=function(){e.remove()};this.updateTitle=function(a){e.find("h2").html(a)};this.activateButton=function(a){e.find("span.fc-button-"+a).addClass(f+"-state-active")};this.deactivateButton=function(a){e.find("span.fc-button-"+a).removeClass(f+"-state-active")};this.disableButton=function(a){e.find("span.fc-button-"+
a).addClass(f+"-state-disabled")};this.enableButton=function(a){e.find("span.fc-button-"+a).removeClass(f+"-state-disabled")};var e=a([]),f}function g(b){function c(b,e){d(b,function(c){var d=a.isArray(b.events),f,g;if(e==t){if(c)for(f=0;f<c.length;f++)g=c[f],d||(g=l(g,b)),g&&y.push(g);r--;r||K(y)}})}function d(c,e){var f,g=W.sourceFetchers,h;for(f=0;f<g.length;f++){h=g[f].call(m,c,q.clone(),D.clone(),b.timezone,e);if(!0===h)return;if("object"==typeof h){d(h,e);return}}if(f=c.events)a.isFunction(f)?
(i(),f.call(m,q.clone(),D.clone(),b.timezone,function(a){e(a);k()})):a.isArray(f)?e(f):e();else if(c.url){var j=c.success,l=c.error,A=c.complete;f=a.isFunction(c.data)?c.data():c.data;f=a.extend({},f||{});g=N(c.startParam,b.startParam);h=N(c.endParam,b.endParam);var n=N(c.timezoneParam,b.timezoneParam);g&&(f[g]=q.format());h&&(f[h]=D.format());b.timezone&&"local"!=b.timezone&&(f[n]=b.timezone);i();a.ajax(a.extend({},wa,c,{data:f,success:function(b){var b=b||[],c=u(j,this,arguments);a.isArray(c)&&
(b=c);e(b)},error:function(){u(l,this,arguments);e()},complete:function(){u(A,this,arguments);k()}}))}else e()}function e(b){var c=W.sourceNormalizers,d;a.isFunction(b)||a.isArray(b)?d={events:b}:"string"===typeof b?d={url:b}:"object"===typeof b&&(d=a.extend({},b),"string"===typeof d.className&&(d.className=d.className.split(/\s+/)));if(d){a.isArray(d.events)&&(d.events=a.map(d.events,function(a){return l(a,d)}));for(b=0;b<c.length;b++)c[b].call(m,d);return d}}function g(a){return("object"==typeof a?
a.events||a.url:"")||a}function h(b){return a.isFunction(b)?a.grep(y,b):null!=b?(b+="",a.grep(y,function(a){return a._id==b})):y}function i(){G++||n("loading",null,!0,B())}function k(){--G||n("loading",null,!1,B())}function l(c,d){var e={},g,h,i;b.eventDataTransform&&(c=b.eventDataTransform(c));d&&d.eventDataTransform&&(c=d.eventDataTransform(c));g=m.moment(c.start||c.date);if(g.isValid()){h=null;if(c.end&&(h=m.moment(c.end),!h.isValid()))return;i=c.allDay;void 0===i&&(i=N(d?d.allDayDefault:void 0,
b.allDayDefault),i=void 0!==i?i:!g.hasTime()&&(!h||!h.hasTime()));i?(g.hasTime()&&g.stripTime(),h&&h.hasTime()&&h.stripTime()):(g.hasTime()||(g=m.rezoneDate(g)),h&&!h.hasTime()&&(h=m.rezoneDate(h)));a.extend(e,c);d&&(e.source=d);e._id=c._id||(void 0===c.id?"_fc"+xa++:c.id+"");e.className=c.className?"string"==typeof c.className?c.className.split(/\s+/):c.className:[];e.allDay=i;e.start=g;e.end=h;b.forceEventDuration&&!e.end&&(e.end=x(e));f(e);return e}}function A(c,d,e){var g=c._allDay,i=c._start,
E=c._end,k=!1,l,n,B;!d&&!e&&(d=c.start,e=c.end);if(l=c.allDay!=g?c.allDay:!(d||e).hasTime())d&&(d=d.clone().stripTime()),e&&(e=e.clone().stripTime());d&&(n=l?j(d,i.clone().stripTime()):j(d,i));l!=g?k=!0:e&&(B=j(e||m.getDefaultEventEnd(l,d||i),d||i).subtract(j(E||m.getDefaultEventEnd(g,i),i)));var c=h(c._id),oa=k,Ia=n,K=B,v=m.getIsAmbigTimezone(),x=[];a.each(c,function(a,c){var d=c._allDay,e=c._start,g=c._end,h=null!=l?l:d,i=e.clone(),E=!oa&&g?g.clone():null;h?(i.stripTime(),E&&E.stripTime()):(i.hasTime()||
(i=m.rezoneDate(i)),E&&!E.hasTime()&&(E=m.rezoneDate(E)));if(!E&&(b.forceEventDuration||+K))E=m.getDefaultEventEnd(h,i);i.add(Ia);E&&E.add(Ia).add(K);if(v&&(+Ia||+K))i.stripZone(),E&&E.stripZone();c.allDay=h;c.start=i;c.end=E;f(c);x.push(function(){c.allDay=d;c.start=e;c.end=g;f(c)})});return{dateDelta:n,durationDelta:B,undo:function(){for(var a=0;a<x.length;a++)x[a]()}}}var m=this;m.isFetchNeeded=function(a,b){return!q||a.clone().stripZone()<q.clone().stripZone()||b.clone().stripZone()>D.clone().stripZone()};
m.fetchEvents=function(a,b){q=a;D=b;y=[];var d=++t,e=p.length;r=e;for(var f=0;f<e;f++)c(p[f],d)};m.addEventSource=function(a){if(a=e(a))p.push(a),r++,c(a,t)};m.removeEventSource=function(b){p=a.grep(p,function(a){return!(a&&b&&g(a)==g(b))});y=a.grep(y,function(a){return!(a.source&&b&&g(a.source)==g(b))});K(y)};m.updateEvent=function(a){a.start=m.moment(a.start);a.end&&(a.end=m.moment(a.end));A(a);var b,c,d,e;for(b=0;b<y.length;b++)if(c=y[b],c._id==a._id&&c!==a)for(d=0;d<s.length;d++)e=s[d],void 0!==
a[e]&&(c[e]=a[e]);K(y)};m.renderEvent=function(a,b){var c=l(a);c&&(c.source||(b&&(v.events.push(c),c.source=v),y.push(c)),K(y))};m.removeEvents=function(b){var c,d;null==b?b=function(){return!0}:a.isFunction(b)||(c=b+"",b=function(a){return a._id==c});y=a.grep(y,b,!0);for(d=0;d<p.length;d++)a.isArray(p[d].events)&&(p[d].events=a.grep(p[d].events,b,!0));K(y)};m.clientEvents=h;m.mutateEvent=A;var n=m.trigger,B=m.getView,K=m.reportEvents,x=m.getEventEnd,v={events:[]},p=[v],q,D,t=0,r=0,G=0,y=[];a.each((b.events?
[b.events]:[]).concat(b.eventSources||[]),function(a,b){var c=e(b);c&&p.push(c)});var s="title url allDay className editable color backgroundColor borderColor textColor".split(" ")}function f(a){a._allDay=a.allDay;a._start=a.start.clone();a._end=a.end?a.end.clone():null}function b(a){var b=function(){};b.prototype=a;return new b}function j(a,b){return c.duration({days:a.clone().stripTime().diff(b.clone().stripTime(),"days"),ms:a.time()-b.time()})}function m(b,c,d){b.unbind("mouseover").mouseover(function(b){for(var e=
b.target,f;e!=this;)f=e,e=e.parentNode;if(void 0!==(e=f._fci))f._fci=void 0,f=c[e],d(f.event,f.element,f),a(b.target).trigger(b);b.stopPropagation()})}function q(b,c,d){for(var e=0,f;e<b.length;e++)f=a(b[e]),f.width(Math.max(0,c-(p(f)+n(f)+(d?t(f):0))))}function r(b,c,d){for(var e=0,f;e<b.length;e++)f=a(b[e]),f.height(Math.max(0,c-z(f,d)))}function p(b){return(parseFloat(a.css(b[0],"paddingLeft",!0))||0)+(parseFloat(a.css(b[0],"paddingRight",!0))||0)}function t(b){return(parseFloat(a.css(b[0],"marginLeft",
!0))||0)+(parseFloat(a.css(b[0],"marginRight",!0))||0)}function n(b){return(parseFloat(a.css(b[0],"borderLeftWidth",!0))||0)+(parseFloat(a.css(b[0],"borderRightWidth",!0))||0)}function z(b,c){return(parseFloat(a.css(b[0],"paddingTop",!0))||0)+(parseFloat(a.css(b[0],"paddingBottom",!0))||0)+((parseFloat(a.css(b[0],"borderTopWidth",!0))||0)+(parseFloat(a.css(b[0],"borderBottomWidth",!0))||0))+(c?(parseFloat(a.css(b[0],"marginTop",!0))||0)+(parseFloat(a.css(b[0],"marginBottom",!0))||0):0)}function k(){}
function l(a,b){return a-b}function v(a,b){a=a||{};if(void 0!==a[b])return a[b];for(var c=b.split(/(?=[A-Z])/),d=c.length-1,e;0<=d;d--)if(e=a[c[d].toLowerCase()],void 0!==e)return e;return a["default"]}function i(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function L(a){a.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1})}function y(a){a.children().removeClass("fc-first fc-last").filter(":first-child").addClass("fc-first").end().filter(":last-child").addClass("fc-last")}
function J(a,b){var c=a.source||{},d=a.color,e=c.color,f=b("eventColor"),g=a.backgroundColor||d||c.backgroundColor||e||b("eventBackgroundColor")||f,d=a.borderColor||d||c.borderColor||e||b("eventBorderColor")||f,c=a.textColor||c.textColor||b("eventTextColor"),e=[];g&&e.push("background-color:"+g);d&&e.push("border-color:"+d);c&&e.push("color:"+c);return e.join(";")}function u(b,c,d){a.isFunction(b)&&(b=[b]);if(b){var e,f;for(e=0;e<b.length;e++)f=b[e].apply(c,d)||f;return f}}function N(){for(var a=
0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a]}function M(b,d,e){var f=b[0],g=1==b.length&&"string"===typeof f,h,i,j;if(c.isMoment(f))b=c.apply(null,b),f._ambigTime&&(b._ambigTime=!0),f._ambigZone&&(b._ambigZone=!0);else if("[object Date]"===Object.prototype.toString.call(f)||f instanceof Date||void 0===f)b=c.apply(null,b);else{i=h=!1;if(g)if(Ba.test(f))f+="-01",b=[f],i=h=!0;else{if(j=Qa.exec(f))h=!j[5],i=!0}else a.isArray(f)&&(i=!0);b=d?c.utc.apply(c,b):c.apply(null,b);h?(b._ambigTime=
!0,b._ambigZone=!0):e&&(i?b._ambigZone=!0:g&&b.zone(f))}return new w(b)}function w(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])}function C(a){var b=[],c=!1,d=!1,e;for(e=0;e<a.length;e++)b.push(W.moment(a[e])),c=c||b[e]._ambigTime,d=d||b[e]._ambigZone;for(e=0;e<b.length;e++)c?b[e].stripTime():d&&b[e].stripZone();return b}function s(a,b){return c.fn.format.call(a,b)}function P(a,b){var c="",d;for(d=0;d<b.length;d++)c+=O(a,b[d]);return c}function O(a,b){var c;return"string"===typeof b?b:(c=
b.token)?Ma[c]?Ma[c](a):s(a,c):b.maybe&&(c=P(a,b.maybe),c.match(/[1-9]/))?c:""}function R(a,b,c,d,e){var a=W.moment.parseZone(a),b=W.moment.parseZone(b),c=a.lang().longDateFormat(c)||c,d=d||" - ",c=x(c),f,g,h="",i,j="",k="",l="",m="";for(g=0;g<c.length;g++){f=D(a,b,c[g]);if(!1===f)break;h+=f}for(i=c.length-1;i>g;i--){f=D(a,b,c[i]);if(!1===f)break;j=f+j}for(f=g;f<=i;f++)k+=O(a,c[f]),l+=O(b,c[f]);if(k||l)m=e?l+d+k:k+d+l;return h+m+j}function D(a,b,c){var d;if("string"===typeof c)return c;if(c=c.token)if((d=
Ra[c.charAt(0)])&&a.isSame(b,d))return s(a,c);return!1}function x(a){return a in ya?ya[a]:ya[a]=A(a)}function A(a){for(var b=[],c=/\[([^\]]*)\]|\(([^\)]*)\)|(LT|(\w)\4*o?)|([^\w\[\(]+)/g,d;d=c.exec(a);)d[1]?b.push(d[1]):d[2]?b.push({maybe:A(d[2])}):d[3]?b.push({token:d[3]}):d[5]&&b.push(d[5]);return b}function B(b,c,d){function e(b){if(!h("selectable")){var d=c.moment(a(this).data("date"));j("dayClick",this,d,b)}}function f(a,c,d){d&&X.build();a=B(a,c);for(c=0;c<a.length;c++)d=a[c],d=X.rect(d.row,
d.leftCol,d.row,d.rightCol,b),k(d,b).click(e).mousedown(m)}var g=this;g.renderBasic=function(d,f,k){S=d;N=f;W=k;ba=h("theme")?"ui":"fc";ha=h("columnFormat");pa=h("weekNumbers");r||(I=a("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(b));var d=ba+"-widget-header",E,f="<thead><tr>";pa&&(f+="<th class='fc-week-number "+d+"'>"+i(h("weekNumberTitle"))+"</th>");for(k=0;k<N;k++)E=A(0,k),f+="<th class='fc-day-header fc-"+Da[E.day()]+" "+d+"'>"+i(x(E,ha))+"</th>";
var d="<table class='fc-border-separate' style='width:100%' cellspacing='0'>"+(f+"</tr></thead>"),f=ba+"-widget-content",l,n;l="<tbody>";for(k=0;k<S;k++){l+="<tr class='fc-week'>";pa&&(n=A(k,0),l+="<td class='fc-week-number "+f+"'><div>"+i(v(n))+"</div></td>");for(E=0;E<N;E++){n=A(k,E);var B=g.intervalStart.month(),K=c.getNow().stripTime(),q="",G=ba+"-widget-content",G=["fc-day","fc-"+Da[n.day()],G];n.month()!=B&&G.push("fc-other-month");n.isSame(K,"day")?G.push("fc-today",ba+"-state-highlight"):
n<K?G.push("fc-past"):G.push("fc-future");q+="<td class='"+G.join(" ")+"' data-date='"+n.format()+"'><div>";W&&(q+="<div class='fc-day-number'>"+n.date()+"</div>");q+="<div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>";l+=q}l+="</tr>"}d=d+(l+"</tbody>")+"</table>";p&&p.remove();p=a(d).appendTo(b);D=p.find("thead");t=D.find(".fc-day-header");r=p.find("tbody");u=r.find("tr");s=r.find(".fc-day");w=u.find("td:first-child");H=u.eq(0).find(".fc-day > div");F=u.eq(0).find(".fc-day-content > div");
y(D.add(D.find("tr")));y(u);u.eq(0).addClass("fc-first");u.filter(":last").addClass("fc-last");s.each(function(b,c){var d=A(Math.floor(b/N),b%N);j("dayRender",g,d,a(c))});s.click(e).mousedown(m)};g.setHeight=function(b){C=b;var b=Math.max(C-D.height(),0),c,d,e;"variable"==h("weekMode")?c=d=Math.floor(b/(1==S?2:6)):(c=Math.floor(b/S),d=b-c*(S-1));w.each(function(b,f){b<S&&(e=a(f),e.find("> div").css("min-height",(b==S-1?d:c)-z(e)))})};g.setWidth=function(a){J=a;U.clear();T.clear();M=0;pa&&(M=D.find("th.fc-week-number").outerWidth());
V=Math.floor((J-M)/N);q(t.slice(0,-1),V)};g.renderDayOverlay=f;g.defaultSelectionEnd=function(a){return a.clone().stripTime().add("days",1)};g.renderSelection=function(a,b){f(a,b,!0)};g.clearSelection=function(){l()};g.reportDayClick=function(a,b){var c=n(a);j("dayClick",s[c.row*N+c.col],a,b)};g.dragStart=function(a,b){Z.start(function(a){l();if(a){var a=A(a),b=a.clone().add(c.defaultAllDayEventDuration);f(a,b)}},b)};g.dragStop=function(a,b,c){var d=Z.stop();l();d&&j("drop",a,A(d),b,c)};g.getHoverListener=
function(){return Z};g.colLeft=function(a){return U.left(a)};g.colRight=function(a){return U.right(a)};g.colContentLeft=function(a){return T.left(a)};g.colContentRight=function(a){return T.right(a)};g.getIsCellAllDay=function(){return!0};g.allDayRow=function(a){return u.eq(a)};g.getRowCnt=function(){return S};g.getColCnt=function(){return N};g.getColWidth=function(){return V};g.getDaySegmentContainer=function(){return I};G.call(g,b,c,d);la.call(g);na.call(g);K.call(g);var h=g.opt,j=g.trigger,k=g.renderOverlay,
l=g.clearOverlays,m=g.daySelectionMousedown,A=g.cellToDate,n=g.dateToCell,B=g.rangeToSegments,x=c.formatDate,v=c.calculateWeekNumber,p,D,t,r,u,s,w,H,F,I,J,C,V,M,S,N,W,X,Z,U,T,ba,ha,pa;L(b.addClass("fc-grid"));X=new Q(function(b,c){var d,e,f;t.each(function(b,g){d=a(g);e=d.offset().left;b&&(f[1]=e);f=[e];c[b]=f});f[1]=e+d.outerWidth();u.each(function(c,g){c<S&&(d=a(g),e=d.offset().top,c&&(f[1]=e),f=[e],b[c]=f)});f[1]=e+d.outerHeight()});Z=new aa(X);U=new da(function(a){return H.eq(a)});T=new da(function(a){return F.eq(a)})}
function K(){var a=this;a.renderEvents=function(b,c){a.renderDayEvents(b,c)};a.clearEvents=function(){a.getDaySegmentContainer().empty()};Z.call(a)}function H(b,d,e){function f(){var c;c=ta+"-widget-header";var e,g,h;g="<thead><tr>";D("weekNumbers")?(e=C(0,0),e=N(e),e=ya?e+D("weekNumberTitle"):D("weekNumberTitle")+e,g+="<th class='fc-agenda-axis fc-week-number "+c+"'>"+i(e)+"</th>"):g+="<th class='fc-agenda-axis "+c+"'>&nbsp;</th>";for(h=0;h<ja;h++)e=C(0,h),g+="<th class='fc-"+Da[e.day()]+" fc-col"+
h+" "+c+"'>"+M(e,Oa)+"</th>";c="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>"+(g+("<th class='fc-agenda-gutter "+c+"'>&nbsp;</th></tr></thead>"));h=ta+"-widget-header";g=ta+"-widget-content";var j;e=d.getNow().stripTime();var k,l,E;E=""+("<tbody><tr><th class='fc-agenda-axis "+h+"'>&nbsp;</th>");k="";for(h=0;h<ja;h++)j=C(0,h),l=["fc-col"+h,"fc-"+Da[j.day()],g],j.isSame(e,"day")?l.push(ta+"-state-highlight","fc-today"):j<e?l.push("fc-past"):l.push("fc-future"),
j="<td class='"+l.join(" ")+"'><div><div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>",k+=j;E=E+k+("<td class='fc-agenda-gutter "+g+"'>&nbsp;</td></tr></tbody>");c=c+E+"</table>";W&&W.remove();W=a(c).appendTo(b);X=W.find("thead");Z=X.find("th").slice(1,-1);U=W.find("tbody");T=U.find("td").slice(0,-1);Y=T.find("> div");O=T.find(".fc-day-content > div");R=T.eq(0);ba=Y.eq(0);y(X.add(X.find("tr")));y(U.add(U.find("tr")))}function g(a){if(!D("selectable")){var b=
Math.min(ja-1,Math.floor((a.pageX-W.offset().left-za)/Ea)),c=C(0,b),e=this.parentNode.className.match(/fc-slot(\d+)/);e&&(e=parseInt(e[1],10),c.add(ua+e*P),c=d.rezoneDate(c));t("dayClick",T[b],c,a)}}function h(a,b,c){c&&ra.build();a=S(a,b);for(b=0;b<a.length;b++)c=a[b],c=ra.rect(c.row,c.leftCol,c.row,c.rightCol,ha),u(c,ha).click(g).mousedown(I)}function j(a,b){for(var a=a.clone().stripZone(),b=b.clone().stripZone(),c=0;c<ja;c++){var d=C(0,c),e=d.clone().add("days",1),f=d<a?a:d,h=e<b?e:b;f<h&&(e=ra.rect(0,
c,0,c,ka),f=A(f,d),d=A(h,d),e.top=f,e.height=d-f,u(e,ka).click(g).mousedown(x))}}function k(a){return D("allDaySlot")&&!a.row}function m(a){var b=C(0,a.col),a=a.row;D("allDaySlot")&&a--;0<=a&&(b.time(c.duration(ua+a*sa)),b=d.rezoneDate(b));return b}function A(a,b){return n(c.duration(a.clone().stripZone()-b.clone().stripTime()))}function n(a){if(a<ua)return 0;if(a>=Ga)return qa.height();var b=(a-ua)/P,a=Math.floor(b),b=b-a,c=Ba[a];void 0===c&&(c=Ba[a]=qa.find("tr").eq(a).find("td div")[0].offsetTop);
a=c-1+b*Fa;return a=Math.max(a,0)}function B(b,c){var d=D("selectHelper");ra.build();if(d){var e=V(b).col;if(0<=e&&e<ja){var e=ra.rect(0,e,0,e,ka),f=A(b,b),h=A(c,b);if(h>f){e.top=f;e.height=h-f;e.left+=2;e.width-=5;if(a.isFunction(d)){if(d=d(b,c))e.position="absolute",ia=a(d).css(e).appendTo(ka)}else e.isStart=!0,e.isEnd=!0,ia=a(J({title:"",start:b,end:c,className:["fc-select-helper"],editable:!1},e)),ia.css("opacity",D("dragOpacity"));ia&&(ia.click(g).mousedown(x),ka.append(ia),q(ia,e.width,!0),
r(ia,e.height,!0))}}}else j(b,c)}function K(){s();ia&&(ia.remove(),ia=null)}function x(b){if(1==b.which&&D("selectable")){H(b);var c;Aa.start(function(a,b){K();if(a&&a.col==b.col&&!k(a)){var d=m(b),e=m(a);c=[d,d.clone().add(sa),e,e.clone().add(sa)].sort(l);B(c[0],c[3])}else c=null},b);a(document).one("mouseup",function(a){Aa.stop();c&&(+c[0]==+c[1]&&v(c[0],a),w(c[0],c[3],a))})}}function v(a,b){t("dayClick",T[V(a).col],a,b)}var p=this;p.renderAgenda=function(d){ja=d;ta=D("theme")?"ui":"fc";ya=D("isRTL");
Oa=D("columnFormat");ua=c.duration(D("minTime"));Ga=c.duration(D("maxTime"));P=c.duration(D("slotDuration"));sa=(sa=D("snapDuration"))?c.duration(sa):P;if(W)f();else{var e=ta+"-widget-header",h=ta+"-widget-content",j,k,l,E=0===P.asMinutes()%15;f();ha=a("<div style='position:absolute;z-index:2;left:0;width:100%'/>").appendTo(b);D("allDaySlot")?(pa=a("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(ha),d="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'><tr><th class='"+
e+" fc-agenda-axis'>"+(D("allDayHTML")||i(D("allDayText")))+"</th><td><div class='fc-day-content'><div style='position:relative'/></div></td><th class='"+e+" fc-agenda-gutter'>&nbsp;</th></tr></table>",va=a(d).appendTo(ha),Ca=va.find("tr"),Ca.find("td").click(g).mousedown(I),ha.append("<div class='fc-agenda-divider "+e+"'><div class='fc-agenda-divider-inner'/></div>")):pa=a([]);ma=a("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>").appendTo(ha);ka=a("<div style='position:relative;width:100%;overflow:hidden'/>").appendTo(ma);
La=a("<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(ka);d="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'><tbody>";j=c.duration(+ua);for(wa=0;j<Ga;)k=p.start.clone().time(j),l=k.minutes(),d+="<tr class='fc-slot"+wa+" "+(!l?"":"fc-minor")+"'><th class='fc-agenda-axis "+e+"'>"+(!E||!l?M(k,D("axisFormat")):"&nbsp;")+"</th><td class='"+h+"'><div style='position:relative'>&nbsp;</div></td></tr>",j.add(P),wa++;qa=a(d+"</tbody></table>").appendTo(ka);
qa.find("td").click(g).mousedown(x)}};p.setWidth=function(){Ha.clear();xa.clear();var b=X.find("th:first");va&&(b=b.add(va.find("th:first")));b=b.add(qa.find("th:first"));za=0;q(b.width("").each(function(b,c){za=Math.max(za,a(c).outerWidth())}),za);b=W.find(".fc-agenda-gutter");va&&(b=b.add(va.find("th.fc-agenda-gutter")));var c=ma[0].clientWidth;(ea=ma.width()-c)?(q(b,ea),b.show().prev().removeClass("fc-last")):b.hide().prev().addClass("fc-last");Ea=Math.floor((c-za)/ja);q(Z.slice(0,-1),Ea)};p.setHeight=
function(a){void 0===a&&(a=Na);Na=a;Ba={};var b=U.position().top,c=ma.position().top,a=Math.min(a-b,qa.height()+c+1);ba.height(a-z(R));ha.css("top",b);ma.height(a-c-1);b=qa.find("tr:first").height()+1;c=qa.find("tr:eq(1)").height();Fa=(b+c)/2;fa=P/sa;ca=Fa/fa};p.afterRender=function(){var a=function(){ma.scrollTop(b)},b=n(c.duration(D("scrollTime")))+1;a();setTimeout(a,0)};p.computeDateTop=A;p.getIsCellAllDay=k;p.allDayRow=function(){return Ca};p.getCoordinateGrid=function(){return ra};p.getHoverListener=
function(){return Aa};p.colLeft=function(a){return Ha.left(a)};p.colRight=function(a){return Ha.right(a)};p.colContentLeft=function(a){return xa.left(a)};p.colContentRight=function(a){return xa.right(a)};p.getDaySegmentContainer=function(){return pa};p.getSlotSegmentContainer=function(){return La};p.getSlotContainer=function(){return ka};p.getRowCnt=function(){return 1};p.getColCnt=function(){return ja};p.getColWidth=function(){return Ea};p.getSnapHeight=function(){return ca};p.getSnapDuration=function(){return sa};
p.getSlotHeight=function(){return Fa};p.getSlotDuration=function(){return P};p.getMinTime=function(){return ua};p.getMaxTime=function(){return Ga};p.defaultSelectionEnd=function(a){return a.hasTime()?a.clone().add(P):a.clone().add("days",1)};p.renderDayOverlay=h;p.renderSelection=function(a,b){a.hasTime()||b.hasTime()?B(a,b):D("allDaySlot")&&h(a,b,!0)};p.clearSelection=K;p.reportDayClick=v;p.dragStart=function(a,b){Aa.start(function(a){s();if(a){var a=m(a),b=a.clone();a.hasTime()?(b.add(d.defaultTimedEventDuration),
j(a,b)):(b.add(d.defaultAllDayEventDuration),h(a,b))}},b)};p.dragStop=function(a,b,c){var d=Aa.stop();s();d&&t("drop",a,m(d),b,c)};G.call(p,b,d,e);la.call(p);na.call(p);F.call(p);var D=p.opt,t=p.trigger,u=p.renderOverlay,s=p.clearOverlays,w=p.reportSelection,H=p.unselect,I=p.daySelectionMousedown,J=p.slotSegHtml,C=p.cellToDate,V=p.dateToCell,S=p.rangeToSegments,M=d.formatDate,N=d.calculateWeekNumber,W,X,Z,U,T,Y,O,R,ba,ha,pa,va,Ca,ma,ka,La,qa,ia,Na,za,Ea,ea,P,Fa,sa,fa,ca,ja,wa,ra,Aa,Ha,xa,Ba={},ta,
ya,ua,Ga,Oa;L(b.addClass("fc-agenda"));ra=new Q(function(b,c){var d,e,f;Z.each(function(b,g){d=a(g);e=d.offset().left;b&&(f[1]=e);f=[e];c[b]=f});f[1]=e+d.outerWidth();D("allDaySlot")&&(d=Ca,e=d.offset().top,b[0]=[e,e+d.outerHeight()]);for(var g=ka.offset().top,h=ma.offset().top,i=h+ma.outerHeight(),j=0;j<wa*fa;j++)b.push([Math.max(h,Math.min(i,g+ca*j)),Math.max(h,Math.min(i,g+ca*(j+1)))])});Aa=new aa(ra);Ha=new da(function(a){return Y.eq(a)});xa=new da(function(a){return O.eq(a)})}function F(){function b(a,
c){var d="<",g=a.url,k=J(a,f),l=["fc-event","fc-event-vert"];h(a)&&l.push("fc-event-draggable");c.isStart&&l.push("fc-event-start");c.isEnd&&l.push("fc-event-end");l=l.concat(a.className);a.source&&(l=l.concat(a.source.className||[]));d=g?d+("a href='"+i(a.url)+"'"):d+"div";d+=" class='"+l.join(" ")+"' style='position:absolute;top:"+c.top+"px;left:"+c.left+"px;"+k+"'><div class='fc-event-inner'><div class='fc-event-time'>"+i(e.getEventTimeText(a))+"</div><div class='fc-event-title'>"+i(a.title||"")+
"</div></div><div class='fc-event-bg'></div>";c.isEnd&&j(a)&&(d+="<div class='ui-resizable-handle ui-resizable-s'>===</div>");return d+("</"+(g?"a":"div")+">")}function d(a,b,c){var i=b.find("div.fc-event-time");if(h(a)){var l=function(){W();v&&(t?(i.hide(),b.draggable("option","grid",null),aa(F,L)):(F&&i.text(e.getEventTimeText(F,a.end?L:null)),i.css("display",""),b.draggable("option","grid",[n,p])))},A=e.getCoordinateGrid(),m=u(),n=y(),p=s(),B=w(),K,D,v,q,t,r,H,Q,ga,z,oa,F,L;b.draggable({scroll:!1,
grid:[n,p],axis:1==m?"y":!1,opacity:f("dragOpacity"),revertDuration:f("dragRevertDuration"),start:function(c,d){g("eventDragStart",b[0],a,c,d);S(a,b);A.build();K=b.position();D=A.cell(c.pageX,c.pageY);v=q=!0;t=r=x(D);z=oa=ga=H=Q=0;L=F=null},drag:function(c,d){var e=A.cell(c.pageX,c.pageY);if(v=!!e){t=x(e);H=Math.round((d.position.left-K.left)/n);if(H!=Q){var e=G(0,D.col),f=D.col+H,f=Math.max(0,f),f=Math.min(m-1,f);ga=G(0,f).diff(e,"days")}t||(z=Math.round((d.position.top-K.top)/p))}if(v!=q||t!=r||
H!=Q||z!=oa)t?(F=a.start.clone().stripTime().add("days",ga),L=F.clone().add(Y.defaultAllDayEventDuration)):(F=a.start.clone().add(z*B).add("days",ga),L=P(a).add(z*B).add("days",ga)),l(),q=v,r=t,Q=H,oa=z;b.draggable("option","revert",!v)},stop:function(c,d){W();g("eventDragStop",b[0],a,c,d);v&&(t||ga||z)?M(b[0],a,F,c,d):(v=!0,t=!1,z=ga=H=0,l(),b.css("filter",""),b.css(K),C(a,b))}})}if(c.isEnd&&j(a)){var I,J,V=s(),da=w(),X;b.resizable({handles:{s:".ui-resizable-handle"},grid:V,start:function(c,d){I=
J=0;S(a,b);g("eventResizeStart",b[0],a,c,d)},resize:function(c,d){I=Math.round((Math.max(V,b.height())-d.originalSize.height)/V);if(I!=J){X=P(a).add(da*I);var f;f=I?e.getEventTimeText(a.start,X):e.getEventTimeText(a);i.text(f);J=I}},stop:function(c,d){g("eventResizeStop",b[0],a,c,d);I?N(b[0],a,X,c,d):C(a,b)}})}k(a,b)}var e=this;e.renderEvents=function(c,e){var h,i=c.length,j=[],k=[];for(h=0;h<i;h++)c[h].allDay?j.push(c[h]):k.push(c[h]);f("allDaySlot")&&(X(j,e),l());var i=u(),j=da(),A=la(),E,D,x,r;
h=[];for(D=0;D<i;D++){E=G(0,D);x=k;r=E.clone().time(j);E=E.clone().time(A);r=r.clone().stripZone();E=E.clone().stripZone();for(var y=[],s=void 0,w=x.length,H=void 0,Q=void 0,F=void 0,J=F=Q=void 0,C=void 0,s=0;s<w;s++)H=x[s],Q=H.start.clone().stripZone(),F=P(H).stripZone(),F>r&&Q<E&&(Q<r?(Q=r.clone(),J=!1):J=!0,F>E?(F=E.clone(),C=!1):C=!0,y.push({event:H,start:Q,end:F,isStart:J,isEnd:C}));r=E=y.sort(V);x=void 0;x=[];s=y=E=void 0;for(E=0;E<r.length;E++){y=r[E];for(s=0;s<x.length&&U(y,x[s]).length;s++);
(x[s]||(x[s]=[])).push(y)}r=x[0];H=w=s=y=E=E=void 0;for(E=0;E<x.length;E++){y=x[E];for(s=0;s<y.length;s++){w=y[s];w.forwardSegs=[];for(H=E+1;H<x.length;H++)U(w,x[H],w.forwardSegs)}}if(r){for(E=0;E<r.length;E++)T(r[E]);for(E=0;E<r.length;E++)I(r[E],0,0)}r=[];s=y=E=void 0;for(E=0;E<x.length;E++){y=x[E];for(s=0;s<y.length;s++)r.push(y[s])}E=r;for(x=0;x<E.length;x++)r=E[x],r.col=D,h.push(r)}i=h.length;w="";D=B();H=f("isRTL");for(k=0;k<i;k++)j=h[k],A=j.event,x=K(j.start,j.start),r=K(j.end,j.start),E=v(j.col),
y=q(j.col),Q=y-E,s=Q*(j.forwardCoord-j.backwardCoord),f("slotEventOverlap")&&(s=Math.max(2*(s-10),s)),H?(J=y-j.backwardCoord*Q,Q=J-s):(Q=E+j.backwardCoord*Q,J=Q+s),Q=Math.max(Q,E),J=Math.min(J,y),s=J-Q,j.top=x,j.left=Q,j.outerWidth=s,j.top=x+1,j.outerHeight=r-x-2,w+=b(A,j);D[0].innerHTML=w;r=D.children();for(k=0;k<i;k++)j=h[k],A=j.event,x=a(r[k]),E=g("eventRender",A,A,x),!1===E?x.remove():(E&&!0!==E&&(x.remove(),x=a(E).css({position:"absolute",top:j.top,left:j.left}).appendTo(D)),j.element=x,A._id===
e?d(A,x,j):x[0]._fci=k,L(A,x));m(D,h,d);for(k=0;k<i;k++)if(j=h[k],x=j.element)j.vsides=z(x,!0),j.hsides=p(x)+n(x)+t(x),A=x.find(".fc-event-title"),A.length&&(j.contentTop=A[0].offsetTop);for(k=0;k<i;k++)if(j=h[k],x=j.element)x[0].style.width=Math.max(0,j.outerWidth-j.hsides)+"px",D=Math.max(0,j.outerHeight-j.vsides),x[0].style.height=D+"px",A=j.event,void 0!==j.contentTop&&10>D-j.contentTop&&(x.find("div.fc-event-time").text(O(A.start,f("timeFormat"))+" - "+A.title),x.find("div.fc-event-title").remove()),
g("eventAfterRender",A,A,x)};e.clearEvents=function(){A().empty();B().empty()};e.slotSegHtml=b;Z.call(e);var f=e.opt,g=e.trigger,h=e.isEventDraggable,j=e.isEventResizable,k=e.eventElementHandlers,l=e.setHeight,A=e.getDaySegmentContainer,B=e.getSlotSegmentContainer,D=e.getHoverListener,K=e.computeDateTop,x=e.getIsCellAllDay,v=e.colContentLeft,q=e.colContentRight,G=e.cellToDate,u=e.getColCnt,y=e.getColWidth,s=e.getSnapHeight,w=e.getSnapDuration,H=e.getSlotHeight,Q=e.getSlotDuration,F=e.getSlotContainer,
L=e.reportEventElement,C=e.showEvents,S=e.hideEvents,M=e.eventDrop,N=e.eventResize,aa=e.renderDayOverlay,W=e.clearOverlays,X=e.renderDayEvents,da=e.getMinTime,la=e.getMaxTime,Y=e.calendar,O=Y.formatDate,P=Y.getEventEnd;e.draggableDayEvent=function(a,b,d){function e(){k||(b.width(i).height("").draggable("option","grid",null),k=!0)}var h=d.isStart,i,j,k=!0,l,E=D(),A=y(),m=da(),n=Q(),x=H(),p=w(),B=s();b.draggable({opacity:f("dragOpacity","month"),revertDuration:f("dragRevertDuration"),start:function(c,
d){g("eventDragStart",b[0],a,c,d);S(a,b);i=b.width();E.start(function(c,d){W();if(c){j=!1;var f=G(0,d.col);l=G(0,c.col).diff(f,"days");c.row?h?k&&(b.width(A-10),r(b,Y.defaultTimedEventDuration/n*x),b.draggable("option","grid",[A,1]),k=!1):j=!0:(aa(a.start.clone().add("days",l),P(a).add("days",l)),e());j=j||k&&!l}else e(),j=!0;b.draggable("option","revert",j)},c,"drag")},stop:function(d,f){E.stop();W();g("eventDragStop",b[0],a,d,f);if(j)e(),b.css("filter",""),C(a,b);else{var h=a.start.clone().add("days",
l),i;k||(i=Math.round((b.offset().top-F().offset().top)/B),i=c.duration(m+i*p),h=Y.rezoneDate(h.clone().time(i)));M(b[0],a,h,d,f)}}})}}function T(a){var b=a.forwardSegs,c=0,d,e;if(void 0===a.forwardPressure){for(d=0;d<b.length;d++)e=b[d],T(e),c=Math.max(c,1+e.forwardPressure);a.forwardPressure=c}}function I(a,b,c){var d=a.forwardSegs;if(void 0===a.forwardCoord){d.length?(d.sort(X),I(d[0],b+1,c),a.forwardCoord=d[0].backwardCoord):a.forwardCoord=1;a.backwardCoord=a.forwardCoord-(a.forwardCoord-c)/(b+
1);for(b=0;b<d.length;b++)I(d[b],0,a.forwardCoord)}}function U(a,b,c){for(var c=c||[],d=0;d<b.length;d++)a.end>b[d].start&&a.start<b[d].end&&c.push(b[d]);return c}function X(a,b){return b.forwardPressure-a.forwardPressure||(a.backwardCoord||0)-(b.backwardCoord||0)||V(a,b)}function V(a,b){return a.start-b.start||a.end-a.start-(b.end-b.start)||parseInt(a.event.id,10)-parseInt(b.event.id,10)}function G(b,d,e){function f(b,c){var d=D[b];return a.isPlainObject(d)&&!/(Time|Duration)$/.test(b)?v(d,c||e):
d}function g(a,b){return d.trigger.apply(d,[a,b||n].concat(Array.prototype.slice.call(arguments,2),[n]))}function h(a,b,c){var a=p[a._id],d,e=a.length;for(d=0;d<e;d++)if(!b||a[d][0]!=b[0])a[d][c]()}function i(a,b){var c=n.getColCnt(),d=s?-1:1,e=s?c-1:0;"object"==typeof a&&(b=a.col,a=a.row);return a*c+(b*d+e)}function j(a){var b=n.start.day(),a=a+t[b];return 7*Math.floor(a/q)+y[(a%q+q)%q]-b}function k(a){return n.start.clone().add("days",a)}function l(a){return a.clone().stripTime().diff(n.start,"days")}
function A(a){var b=n.start.day(),a=a+b;return Math.floor(a/7)*q+t[(a%7+7)%7]-t[b]}function m(a){var b=n.getColCnt();return{row:Math.floor(a/b),col:(a%b+b)%b*(s?-1:1)+(s?b-1:0)}}var n=this;n.element=b;n.calendar=d;n.name=e;n.opt=f;n.trigger=g;n.isEventDraggable=function(a){var b=a.source||{};return N(a.startEditable,b.startEditable,f("eventStartEditable"),a.editable,b.editable,f("editable"))};n.isEventResizable=function(a){var b=a.source||{};return N(a.durationEditable,b.durationEditable,f("eventDurationEditable"),
a.editable,b.editable,f("editable"))};n.clearEventData=function(){p={};B=[]};n.reportEventElement=function(a,b){B.push({event:a,element:b});p[a._id]?p[a._id].push(b):p[a._id]=[b]};n.triggerEventDestroy=function(){a.each(B,function(a,b){n.trigger("eventDestroy",b.event,b.event,b.element)})};n.eventElementHandlers=function(a,b){b.click(function(c){if(!b.hasClass("ui-draggable-dragging")&&!b.hasClass("ui-resizable-resizing"))return g("eventClick",this,a,c)}).hover(function(b){g("eventMouseover",this,
a,b)},function(b){g("eventMouseout",this,a,b)})};n.showEvents=function(a,b){h(a,b,"show")};n.hideEvents=function(a,b){h(a,b,"hide")};n.eventDrop=function(a,b,c,e,f){var h=d.mutateEvent(b,c,null);g("eventDrop",a,b,h.dateDelta,function(){h.undo();x(b._id)},e,f);x(b._id)};n.eventResize=function(a,b,c,e,f){var h=d.mutateEvent(b,null,c);g("eventResize",a,b,h.durationDelta,function(){h.undo();x(b._id)},e,f);x(b._id)};var x=d.reportEventChange,p={},B=[],D=d.options,K=c.duration(D.nextDayThreshold);n.getEventTimeText=
function(a){var b,c;2===arguments.length?(b=arguments[0],c=arguments[1]):(b=a.start,c=a.end);return c&&f("displayEventEnd")?d.formatRange(b,c,f("timeFormat")):d.formatDate(b,f("timeFormat"))};n.isHiddenDay=function(a){c.isMoment(a)&&(a=a.day());return r[a]};n.skipHiddenDays=function(a,b,c){a=a.clone();for(b=b||1;r[(a.day()+(c?b:0)+7)%7];)a.add("days",b);return a};n.getCellsPerWeek=function(){return q};n.dateToCell=function(a){a=l(a);a=A(a);return m(a)};n.dateToDayOffset=l;n.dayOffsetToCellOffset=
A;n.cellOffsetToCell=m;n.cellToDate=function(){var a=i.apply(null,arguments),a=j(a);return k(a)};n.cellToCellOffset=i;n.cellOffsetToDayOffset=j;n.dayOffsetToDate=k;n.rangeToSegments=function(a,b){var c=n.getRowCnt(),d=n.getColCnt(),e=[],f=l(a),g=l(b),h=+b.time();h&&h>=K&&g++;for(var g=Math.max(g,f+1),h=A(f),i=A(g)-1,k=0;k<c;k++){var E=k*d,x=E+d-1,E=Math.max(h,E),x=Math.min(i,x);if(E<=x){var p=m(E),B=m(x),p=[p.col,B.col].sort(),E=j(E)==f,x=j(x)+1==g;e.push({row:k,leftCol:p[0],rightCol:p[1],isStart:E,
isEnd:x})}}return e};var b=f("hiddenDays")||[],r=[],q,t=[],y=[],s=f("isRTL");!1===f("weekends")&&b.push(0,6);for(var G=0,u=0;7>G;G++)t[G]=u,r[G]=-1!=a.inArray(G,b),r[G]||(y[u]=G,u++);q=u;if(!q)throw"invalid hiddenDays";}function Z(){function b(c,j,k){for(var l=G(),A=j?a("<div/>"):l,m=[],x=0;x<c.length;x++){for(var B=c[x],u=z(B.start,N(B)),w=0;w<u.length;w++)u[w].event=B;m.push.apply(m,u)}c=e("isRTL");for(x=0;x<m.length;x++)B=m[x],w=(c?B.isStart:B.isEnd)?y:q,u=((c?B.isEnd:B.isStart)?s:r)(B.leftCol),
w=w(B.rightCol),B.left=u,B.outerWidth=w-u;x="";for(c=0;c<m.length;c++){var B=m[c],u="",w=e("isRTL"),H=B.event,Q=H.url,F=["fc-event","fc-event-hori"];g(H)&&F.push("fc-event-draggable");B.isStart&&F.push("fc-event-start");B.isEnd&&F.push("fc-event-end");F=F.concat(H.className);H.source&&(F=F.concat(H.source.className||[]));var I=J(H,e),u=Q?u+("<a href='"+i(Q)+"'"):u+"<div",u=u+(" class='"+F.join(" ")+"' style='position:absolute;left:"+B.left+"px;"+I+"'><div class='fc-event-inner'>");!H.allDay&&B.isStart&&
(u+="<span class='fc-event-time'>"+i(d.getEventTimeText(H))+"</span>");u+="<span class='fc-event-title'>"+i(H.title||"")+"</span></div>";H.allDay&&(B.isEnd&&h(H))&&(u+="<div class='ui-resizable-handle ui-resizable-"+(w?"w":"e")+"'>&nbsp;&nbsp;&nbsp;</div>");u+="</"+(Q?"a":"div")+">";x+=u}A[0].innerHTML=x;A=A.children();j&&l.append(A);for(j=0;j<m.length;j++)l=m[j],x=l.event,c=A.eq(j),x=f("eventRender",x,x,c),!1===x?c.remove():(x&&!0!==x&&(x=a(x).css({position:"absolute",left:l.left}),c.replaceWith(x),
c=x),l.element=c);S(m,function(a,b){a.hsides=p(b)+n(b)+t(b)});S(m,function(a,b){b.width(Math.max(0,a.outerWidth-a.hsides))});S(m,function(a,b){a.outerHeight=b.outerHeight(!0)});l=D();A=K();j=[];x=D();c=[];for(u=0;u<m.length;u++)w=m[u],B=w.row,w.element&&(c[B]?c[B].push(w):c[B]=[w]);for(B=0;B<x;B++){u=c;w=B;H=[];Q=c[B]||[];Q.sort(Y);F=[];for(I=0;I<Q.length;I++){for(var L=Q[I],C=0;C<F.length;C++){var V;a:{V=F[C];for(var ga=0;ga<V.length;ga++){var M=V[ga];if(M.leftCol<=L.rightCol&&M.rightCol>=L.leftCol){V=
!0;break a}}V=!1}if(!V)break}F[C]?F[C].push(L):F[C]=[L]}Q=F;for(F=0;F<Q.length;F++)H.push.apply(H,Q[F]);u[w]=H}for(x=0;x<l;x++){B=c[x];u=[];for(Q=0;Q<A;Q++)u.push(0);for(w=0;w<B.length;w++){Q=H=B[w];F=u.slice(H.leftCol,H.rightCol+1);F=Math.max.apply(Math,F);Q.top=F;for(Q=H.leftCol;Q<=H.rightCol;Q++)u[Q]=H.top+H.outerHeight}j.push(Math.max.apply(Math,u))}c=D();l=[];for(A=0;A<c;A++)l[A]=v(A).find("div.fc-day-content > div");var oa=[];if(k)for(k=0;k<l.length;k++)l[k].height(j[k]);for(k=0;k<l.length;k++)oa.push(l[k].position().top);
S(m,function(a,b){b.css("top",oa[a.row]+a.top)});return m}function c(a,b,e){g(a)&&d.draggableDayEvent(a,b,e);a.allDay&&(e.isEnd&&h(a))&&d.resizableDayEvent(a,b,e);k(a,b)}var d=this;d.renderDayEvents=function(a,d){var e=b(a,!1,!0);S(e,function(a,b){j(a.event,b)});var g=G();S(e,function(a,b,e){var f=a.event;f._id===d?c(f,b,a):b[0]._fci=e});m(g,e,c);S(e,function(a,b){f("eventAfterRender",a.event,a.event,b)})};d.draggableDayEvent=function(a,b){var c=Q(),d,g;b.draggable({delay:50,opacity:e("dragOpacity"),
revertDuration:e("dragRevertDuration"),start:function(e,h){f("eventDragStart",b[0],a,e,h);A(a,b);c.start(function(c,e,f,h){b.draggable("option","revert",!c||!f&&!h);w();c?(e=F(e),d=F(c).diff(e,"days"),g=a.start.clone().add("days",d),u(g,N(a).add("days",d))):d=0},e,"drag")},stop:function(e,h){c.stop();w();f("eventDragStop",b[0],a,e,h);d?x(b[0],a,g,e,h):(b.css("filter",""),l(a,b))}})};d.resizableDayEvent=function(c,d,g){var h=e("isRTL")?"w":"e",i=d.find(".ui-resizable-"+h),j=!1;L(d);d.mousedown(function(a){a.preventDefault()}).click(function(a){j&&
(a.preventDefault(),a.stopImmediatePropagation())});i.mousedown(function(e){function i(b){f("eventResizeStop",d[0],c,b,{});a("body").css("cursor","");k.stop();w();n&&B(d[0],c,x,b,{});setTimeout(function(){j=!1},0)}if(1==e.which){j=!0;var k=Q(),m=d.css("top"),n,x,E,p=a.extend({},c),D=M(V(c.start));H();a("body").css("cursor",h+"-resize").one("mouseup",i);f("eventResizeStart",d[0],c,e,{});k.start(function(d,e){if(d){var f=I(e),i=I(d),i=Math.max(i,D);n=C(i)-C(f);x=N(c).add("days",n);if(n){p.end=x;var f=
E,j=g.row,i=b([p],!0,!1),k=[];S(i,function(a,b){a.row===j&&b.css("top",m);k.push(b[0])});E=k;E=a(E);E.find("*").css("cursor",h+"-resize");f&&f.remove();A(c)}else E&&(l(c),E.remove(),E=null);w();u(c.start,x)}},e)}})};var e=d.opt,f=d.trigger,g=d.isEventDraggable,h=d.isEventResizable,j=d.reportEventElement,k=d.eventElementHandlers,l=d.showEvents,A=d.hideEvents,x=d.eventDrop,B=d.eventResize,D=d.getRowCnt,K=d.getColCnt,v=d.allDayRow,r=d.colLeft,q=d.colRight,s=d.colContentLeft,y=d.colContentRight,G=d.getDaySegmentContainer,
u=d.renderDayOverlay,w=d.clearOverlays,H=d.clearSelection,Q=d.getHoverListener,z=d.rangeToSegments,F=d.cellToDate,I=d.cellToCellOffset,C=d.cellOffsetToDayOffset,V=d.dateToDayOffset,M=d.dayOffsetToCellOffset,N=d.calendar.getEventEnd}function S(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.element;e&&b(d,e,c)}}function Y(a,b){return b.rightCol-b.leftCol-(a.rightCol-a.leftCol)||b.event.allDay-a.event.allDay||a.event.start-b.event.start||(a.event.title||"").localeCompare(b.event.title)}function na(){function b(d){var e=
g("unselectCancel");(!e||!a(d.target).parents(e).length)&&c(d)}function c(a){A&&(A=!1,k(),h("unselect",null,a))}function d(a,b,c){A=!0;h("select",null,a,b,c)}var e=this;e.select=function(a,b){c();a=f.moment(a);b=b?f.moment(b):i(a);j(a,b);d(a,b)};e.unselect=c;e.reportSelection=d;e.daySelectionMousedown=function(b){var f=e.cellToDate,h=e.getIsCellAllDay,i=e.getHoverListener(),A=e.reportDayClick;if(1==b.which&&g("selectable")){c(b);var m;i.start(function(a,b){k();a&&h(a)?(m=[f(b),f(a)].sort(l),j(m[0],
m[1].clone().add("days",1))):m=null},b);a(document).one("mouseup",function(a){i.stop();m&&(+m[0]==+m[1]&&A(m[0],a),d(m[0],m[1].clone().add("days",1),a))})}};e.selectionManagerDestroy=function(){a(document).off("mousedown",b)};var f=e.calendar,g=e.opt,h=e.trigger,i=e.defaultSelectionEnd,j=e.renderSelection,k=e.clearSelection,A=!1;if(g("selectable")&&g("unselectAuto"))a(document).on("mousedown",b)}function la(){this.renderOverlay=function(d,e){var f=c.shift();f||(f=a("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>"));
f[0].parentNode!=e[0]&&f.appendTo(e);b.push(f.css(d).show());return f};this.clearOverlays=function(){for(var a;a=b.shift();)c.push(a.hide().unbind())};var b=[],c=[]}function Q(a){var b,c;this.build=function(){b=[];c=[];a(b,c)};this.cell=function(a,d){var e=b.length,f=c.length,g,h=-1,i=-1;for(g=0;g<e;g++)if(d>=b[g][0]&&d<b[g][1]){h=g;break}for(g=0;g<f;g++)if(a>=c[g][0]&&a<c[g][1]){i=g;break}return 0<=h&&0<=i?{row:h,col:i}:null};this.rect=function(a,d,e,f,g){g=g.offset();return{top:b[a][0]-g.top,left:c[d][0]-
g.left,width:c[f][1]-c[d][0],height:b[e][1]-b[a][0]}}}function aa(b){function c(a){void 0===a.pageX&&(a.pageX=a.originalEvent.pageX,a.pageY=a.originalEvent.pageY);a=b.cell(a.pageX,a.pageY);if(Boolean(a)!==Boolean(g)||a&&(a.row!=g.row||a.col!=g.col))a?(f||(f=a),e(a,f,a.row-f.row,a.col-f.col)):e(a,f),g=a}var d,e,f,g;this.start=function(h,i,j){e=h;f=g=null;b.build();c(i);d=j||"mousemove";a(document).bind(d,c)};this.stop=function(){a(document).unbind(d,c);return g}}function da(a){var b=this,c={},d={},
e={};b.left=function(b){return d[b]=void 0===d[b]?(c[b]=c[b]||a(b)).position().left:d[b]};b.right=function(d){return e[d]=void 0===e[d]?b.left(d)+(c[d]=c[d]||a(d)).width():e[d]};b.clear=function(){c={};d={};e={}}}var fa={lang:"en",defaultTimedEventDuration:"02:00:00",defaultAllDayEventDuration:{days:1},forceEventDuration:!1,nextDayThreshold:"09:00:00",defaultView:"month",aspectRatio:1.35,header:{left:"title",center:"",right:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberTitle:"W",weekNumberCalculation:"local",
lazyFetching:!0,startParam:"start",endParam:"end",timezoneParam:"timezone",timezone:!1,titleFormat:{month:"MMMM YYYY",week:"ll",day:"LL"},columnFormat:{month:"ddd",week:function(a,b){var c=b.longDateFormat("L"),c=c.replace(/^Y+[^\w\s]*|[^\w\s]*Y+$/g,"");return c=a.isRTL?c+" ddd":"ddd "+c},day:"dddd"},timeFormat:{"default":function(a,b){return b.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"t")}},displayEventEnd:{month:!1,basicWeek:!1,"default":!0},isRTL:!1,
defaultButtonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",today:"today",month:"month",week:"week",day:"day"},buttonIcons:{prev:"left-single-arrow",next:"right-single-arrow",prevYear:"left-double-arrow",nextYear:"right-double-arrow"},theme:!1,themeButtonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e",prevYear:"seek-prev",nextYear:"seek-next"},unselectAuto:!0,dropAccept:"*",numDaysDisplay:4,handleWindowResize:!0,windowResizeDelay:200},ca={en:{columnFormat:{week:"ddd M/D"}}},
ja={header:{left:"next,prev today",center:"",right:"title"},buttonIcons:{prev:"right-single-arrow",next:"left-single-arrow",prevYear:"right-double-arrow",nextYear:"left-double-arrow"},themeButtonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w",nextYear:"seek-prev",prevYear:"seek-next"}},W=a.fullCalendar={version:"2.0.2"},ea=W.views={};a.fn.fullCalendar=function(b){var c=Array.prototype.slice.call(arguments,1),d=this;this.each(function(f,g){var h=a(g),i=h.data("fullCalendar");"string"===typeof b?
i&&a.isFunction(i[b])&&(i=i[b].apply(i,c),f||(d=i),"destroy"===b&&h.removeData("fullCalendar")):i||(i=new e(h,b),h.data("fullCalendar",i),i.render())});return d};W.langs=ca;W.datepickerLang=function(b,c,e){var f=ca[b];f||(f=ca[b]={});d(f,{isRTL:e.isRTL,weekNumberTitle:e.weekHeader,titleFormat:{month:e.showMonthAfterYear?"YYYY["+e.yearSuffix+"] MMMM":"MMMM YYYY["+e.yearSuffix+"]"},defaultButtonText:{prev:e.prevText.replace(/&.*?;/g,""),next:e.nextText.replace(/&.*?;/g,""),today:e.currentText.replace(/&.*?;/g,
"")}});a.datepicker&&(a.datepicker.regional[c]=a.datepicker.regional[b]=e,a.datepicker.regional.en=a.datepicker.regional[""],a.datepicker.setDefaults(e))};W.lang=function(a,b){var c;b&&((c=ca[a])||(c=ca[a]={}),d(c,b||{}));fa.lang=a};W.sourceNormalizers=[];W.sourceFetchers=[];var wa={dataType:"json",cache:!1},xa=1;W.applyAll=u;var Da="sun mon tue wed thu fri sat".split(" "),Ba=/^\s*\d{4}-\d\d$/,Qa=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?)?$/;W.moment=
function(){return M(arguments)};W.moment.utc=function(){var a=M(arguments,!0);a.hasTime()&&a.utc();return a};W.moment.parseZone=function(){return M(arguments,!0,!0)};w.prototype=b(c.fn);w.prototype.clone=function(){return M([this])};w.prototype.time=function(a){if(null==a)return c.duration({hours:this.hours(),minutes:this.minutes(),seconds:this.seconds(),milliseconds:this.milliseconds()});delete this._ambigTime;!c.isDuration(a)&&!c.isMoment(a)&&(a=c.duration(a));var b=0;c.isDuration(a)&&(b=24*Math.floor(a.asDays()));
return this.hours(b+a.hours()).minutes(a.minutes()).seconds(a.seconds()).milliseconds(a.milliseconds())};w.prototype.stripTime=function(){var a=this.toArray();c.fn.utc.call(this);this.year(a[0]).month(a[1]).date(a[2]).hours(0).minutes(0).seconds(0).milliseconds(0);this._ambigZone=this._ambigTime=!0;return this};w.prototype.hasTime=function(){return!this._ambigTime};w.prototype.stripZone=function(){var a=this.toArray(),b=this._ambigTime;c.fn.utc.call(this);this.year(a[0]).month(a[1]).date(a[2]).hours(a[3]).minutes(a[4]).seconds(a[5]).milliseconds(a[6]);
b&&(this._ambigTime=!0);this._ambigZone=!0;return this};w.prototype.hasZone=function(){return!this._ambigZone};w.prototype.zone=function(a){null!=a&&(delete this._ambigTime,delete this._ambigZone);return c.fn.zone.apply(this,arguments)};w.prototype.local=function(){var a=this.toArray(),b=this._ambigZone;delete this._ambigTime;delete this._ambigZone;c.fn.local.apply(this,arguments);b&&this.year(a[0]).month(a[1]).date(a[2]).hours(a[3]).minutes(a[4]).seconds(a[5]).milliseconds(a[6]);return this};w.prototype.utc=
function(){delete this._ambigTime;delete this._ambigZone;return c.fn.utc.apply(this,arguments)};w.prototype.format=function(a){return a?P(this,x(a)):this._ambigTime?s(this,"YYYY-MM-DD"):this._ambigZone?s(this,"YYYY-MM-DD[T]HH:mm:ss"):s(this)};w.prototype.toISOString=function(){return this._ambigTime?s(this,"YYYY-MM-DD"):this._ambigZone?s(this,"YYYY-MM-DD[T]HH:mm:ss"):c.fn.toISOString.apply(this,arguments)};w.prototype.isWithin=function(a,b){var c=C([this,a,b]);return c[0]>=c[1]&&c[0]<c[2]};a.each(["isBefore",
"isAfter","isSame"],function(a,b){w.prototype[b]=function(a,d){var e=C([this,a]);return c.fn[b].call(e[0],e[1],d)}});var Ma={t:function(a){return s(a,"a").charAt(0)},T:function(a){return s(a,"A").charAt(0)}};W.formatRange=R;var Ra={Y:"year",M:"month",D:"day",d:"day",A:"second",a:"second",T:"second",t:"second",H:"second",h:"second",m:"second",s:"second"},ya={};ea.month=function(a,b){var c=this;c.incrementDate=function(a,b){return a.clone().stripTime().add("months",b).startOf("month")};c.render=function(a){c.intervalStart=
a.clone().stripTime().startOf("month");c.intervalEnd=c.intervalStart.clone().add("months",1);c.start=c.intervalStart.clone();c.start=c.skipHiddenDays(c.start);c.start.startOf("week");c.start=c.skipHiddenDays(c.start);c.end=c.intervalEnd.clone();c.end=c.skipHiddenDays(c.end,-1,!0);c.end.add("days",(7-c.end.weekday())%7);c.end=c.skipHiddenDays(c.end,-1,!0);a=Math.ceil(c.end.diff(c.start,"weeks",!0));"fixed"==c.opt("weekMode")&&(c.end.add("weeks",6-a),a=6);c.title=b.formatDate(c.intervalStart,c.opt("titleFormat"));
c.renderBasic(a,c.getCellsPerWeek(),!0)};B.call(c,a,b,"month")};ea.basicWeek=function(a,b){var c=this;c.incrementDate=function(a,b){return a.clone().stripTime().add("weeks",b).startOf("week")};c.render=function(a){c.intervalStart=a.clone().stripTime().startOf("week");c.intervalEnd=c.intervalStart.clone().add("weeks",1);c.start=c.skipHiddenDays(c.intervalStart);c.end=c.skipHiddenDays(c.intervalEnd,-1,!0);c.title=b.formatRange(c.start,c.end.clone().subtract(1),c.opt("titleFormat")," \u2014 ");c.renderBasic(1,
c.getCellsPerWeek(),!1)};B.call(c,a,b,"basicWeek")};ea.basicDay=function(a,b){var c=this;c.incrementDate=function(a,b){var d=a.clone().stripTime().add("days",b);return d=c.skipHiddenDays(d,0>b?-1:1)};c.render=function(a){c.start=c.intervalStart=a.clone().stripTime();c.end=c.intervalEnd=c.start.clone().add("days",1);c.title=b.formatDate(c.start,c.opt("titleFormat"));c.renderBasic(1,1,!1)};B.call(c,a,b,"basicDay")};d(fa,{weekMode:"fixed"});ea.agendaWeek=function(a,b){var c=this;c.incrementDate=function(a,
b){return a.clone().stripTime().add("weeks",b).startOf("week")};c.render=function(a){c.intervalStart=a.clone().stripTime().startOf("week");c.intervalEnd=c.intervalStart.clone().add("weeks",1);c.start=c.skipHiddenDays(c.intervalStart);c.end=c.skipHiddenDays(c.intervalEnd,-1,!0);c.title=b.formatRange(c.start,c.end.clone().subtract(1),c.opt("titleFormat")," \u2014 ");c.renderAgenda(c.getCellsPerWeek())};H.call(c,a,b,"agendaWeek")};ea.inspirockAgendaWeek=function(a,b){var c=this;c.incrementDate=function(a,
b){return a.clone().stripTime().add("days",b)};c.render=function(a){c.intervalStart=a.clone().stripTime();c.intervalEnd=c.intervalStart.clone().add("days",c.opt("numDaysDisplay"));c.start=c.skipHiddenDays(c.intervalStart);c.end=c.skipHiddenDays(c.intervalEnd,-1,!0);c.title=b.formatRange(c.start,c.end.clone().subtract(1),c.opt("titleFormat")," \u2014 ");c.renderAgenda(c.opt("numDaysDisplay"))};H.call(c,a,b,"inspirockAgendaWeek")};ea.agendaDay=function(a,b){var c=this;c.incrementDate=function(a,b){var d=
a.clone().stripTime().add("days",b);return d=c.skipHiddenDays(d,0>b?-1:1)};c.render=function(a){c.start=c.intervalStart=a.clone().stripTime();c.end=c.intervalEnd=c.start.clone().add("days",1);c.title=b.formatDate(c.start,c.opt("titleFormat"));c.renderAgenda(1)};H.call(c,a,b,"agendaDay")};d(fa,{allDaySlot:!0,allDayText:"all-day",scrollTime:"06:00:00",slotDuration:"00:30:00",axisFormat:function(a,b){return b.longDateFormat("LT").replace(":mm","(:mm)").replace(/(\Wmm)$/,"($1)").replace(/\s*a$/i,"a")},
timeFormat:{agenda:function(a,b){return b.longDateFormat("LT").replace(/\s*a$/i,"")}},dragOpacity:{agenda:0.5},minTime:"00:00:00",maxTime:"24:00:00",slotEventOverlap:!0})});
define("jQueryExtensions/linkToEndTimeSelect",["jquery","jqueryui"],function(){$.fn.linkToEndTimeSelect=function(a){var c=$(this);c.off("change.linkToEndTimeSelect").on("change.linkToEndTimeSelect",function(){var d=parseInt(c.val(),10),e=parseInt(a.val(),10);-1!==d&&d>=e&&1440>=d+30&&a.selectmenu("value",d+30);return!0});a.off("change.linkToEndTimeSelect").on("change.linkToEndTimeSelect",function(){var d=parseInt(c.val(),10),e=parseInt(a.val(),10);-1!==e&&(-1===d||d>=e)&&0<=e-30&&c.selectmenu("value",
e-30);return!0})}});
define("plan/calendar","modules/analytics modules/utils modules/ajax modules/events modules/attributions plan/visits plan/reserveds moment plan/exploreAttractions jquery jqueryui jQueryExtensions/inspirockAutocomplete qtip fullCalendar jQueryExtensions/linkToEndTimeSelect selectmenu".split(" "),function(a,c,d,e,h,g,f,b,j){function m(){var a=$("#calendarBox");if(a.is(":visible")){var b=a.find(".fc-header"),c=$(".itinerary-subnav-pane"),d=b.find(".fc-button-prev"),b=b.find(".fc-button-next"),e=a.offset().top,
f=a.height(),g=$(window).scrollTop(),h=$(window).height(),a=Math.max(e,g),f=Math.min(e+f,g+h),a=(f-a)/2;c.hasClass("dock-top")&&(a=Math.max(e,c.offset().top+c.height()),a=(f-a)/2+Math.max(0,c.offset().top+c.height()-e));a=Math.max(a,0);d.css({top:a+"px"});b.css({top:a+"px"})}}function q(){e.addObserver("scroll","calendar",m);var a=n.data("fullCalendar");a&&a.getView().afterRender()}function r(){e.removeObserver("scroll","calendar")}var p={},t,n,z,k,l,v,i=!1,L,y=!0,J=!1;p.getCurrentStay=function(){var a=
n.fullCalendar("getDate").utc(),b;for(b=z.length-1;0<=b;b--){var c=z[b];if(a&&a>=c.startDay)return{stayId:c.id,destinationId:c.destinationId,destinationName:c.name}}};var u=function(b,f){if($("#plan").data("editEnabled")&&!b.utc().isBefore(k)&&!b.utc().isAfter(l)&&!b.utc().isSame(l)){var g={};g.date=b.utc().format("MMM D, YYYY");g.startTime=b.utc().format("HH:mm");g.position={my:"center bottom-20",of:f,collision:"fit"};g.view="CalendarData";g.successCB=function(a){p.loadCalendarEvents(a)};if(!i){var h=
{};h.date=g.date;h.startTime=g.startTime;i=!0;d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/addVisitOrReservedDialog",type:"GET",data:h,complete:function(){i=!1},success:function(b){if(!$(".visitReservedDialog").length){var f=$(b),h=f.find(".add-data"),i=h.data("destinationId"),j=f.find("#blockedButton"),k=f.find(".search-area"),l=f.find(".time-selects"),m=f.find("#explore-search");f.dialog({title:"Add Attraction or Reserved item ",resizable:!1,modal:!0,draggable:!1,
dialogClass:"visitReservedDialog",position:g.position,buttons:[{html:"Add",click:function(){var b={};if(j.is(":checked"))b={name:f.find("#reservedTitle").val().trim(),stayId:h.data("stayId"),dayNumber:f.find(".add-data").data("dayNumber"),fromTime:f.find(".time-start .from").val(),toTime:f.find(".time-end .to").val(),view:g.view},d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved",data:b,synchronize:!0,success:function(b){g.successCB(b);e.triggerEvent("calendar",
"reserved-add",{uiSource:"itinerary.calendar.addDialog"});a.trackEvent("itinerary.calendar.add-dialog","add-reserved")},complete:function(){f.dialog("close")}});else{var k=m.data("inspirockAutocomplete").getSelectedItem();void 0===k?c.showErrorTooltip(m,"Enter an attraction name",null,{position:{container:f,my:"left center",at:"right center",effect:!1,viewport:$(window)}}):(b={attractionId:k.id,stayId:h.data("stayId"),dayNumber:f.find(".add-data").data("dayNumber"),fromTime:f.find(".time-start .from").val(),
toTime:f.find(".time-end .to").val(),destinationId:i,view:g.view},d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit",data:b,synchronize:!0,success:function(b){g.successCB(b);e.triggerEvent("calendar","visit-add",{uiSource:"itinerary.calendar.addDialog"});a.trackEvent("itinerary.calendar.add-dialog","add-attraction",k.value.toLowerCase())},complete:function(){f.dialog("close")}}))}}}],close:function(){c.hideErrorTooltip(m);f.dialog("destroy").remove()},open:function(){c.setupDialogOverlay(f,
!0);f.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Add')").addClass("disabled");m.inspirockAutocomplete({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/attractionAutocomplete?destinationId="+i,appendTo:f.parents(".ui-dialog"),onSelect:function(){c.hideErrorTooltip(m)}});f.find(".event").change(function(){l.removeClass("hidden");f.find(".start-select-time .from").data("selectmenu")||(f.find("select").selectmenu({appendTo:f}),
f.find(".time-start .from").linkToEndTimeSelect(f.find(".time-end .to")));f.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Add')").removeClass("disabled");c.hideErrorTooltip(m);j.is(":checked")?(m.data("inspirockAutocomplete").clearPreviousItems(),f.find(".reserved-title").removeClass("hidden"),k.addClass("hidden"),l.appendTo(f)):(f.find(".reserved-title").addClass("hidden"),k.removeClass("hidden"),l.appendTo(k))})}})}}})}}},N=function(b,
h){if($("#plan").data("editEnabled")){var k={},l={};if("Visit"===b.eventType){var m,n,u,v;m=b.start.format("MMM D, YYYY");n=b.id;u=b.title;v={my:"center bottom-20",of:h,collision:"fit"};i||(i=!0,d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+n,type:"GET",complete:function(){i=!1},success:function(b){var f=$(document.createElement("div"));f.html(b);var h=f.find(".from"),i=f.find(".to"),k=parseInt(h.val(),10),l=parseInt(i.val(),10);f.dialog({title:"Current destination",
resizable:!1,modal:!0,draggable:!1,dialogClass:"visitReservedDialog",position:v,buttons:[{html:"Delete",click:function(){var b={successCB:function(b){p.loadCalendarEvents(b);e.triggerEvent("calendar","visit-remove",{uiSource:"itinerary.calendar.replanDialog.remove"});a.trackEvent("itinerary.calendar.edit-visit-dialog","delete-visit",u.toLowerCase())}};b.visitId=n;b.view="CalendarData";b.completeCB=function(){f.dialog("close")};g.removeFromPlan(b)}},{html:"Save Changes",click:function(){var b={},b=
parseInt(h.val(),10),c=parseInt(i.val(),10);if(k!==b||l!==c)b={date:m,startTime:b,endTime:c,view:"CalendarData"},d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+n,data:b,synchronize:!0,success:function(b){p.loadCalendarEvents(b);e.triggerEvent("calendar","visit-update",{uiSource:"itinerary.calendar.replanDialog.replan"});a.trackEvent("itinerary.calendar.edit-visit-dialog","update-visit",u.toLowerCase())},complete:function(){f.dialog("close")}})}}],open:function(){c.setupDialogOverlay(f,
!0);f.find("select").selectmenu({appendTo:f});h.linkToEndTimeSelect(i);f.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Save Changes')").addClass("disabled");h.add(i).change(function(){f.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Save Changes')").removeClass("disabled")});f.find(".title-text,.detail-link").off("click.calendar").on("click.calendar",j.attractionDetailsPageLinks)},
close:function(){f.dialog("destroy").remove()}})}}))}else"Reserved"===b.eventType&&(k.reservedId=b.id,k.view="CalendarData",k.reservedName=b.title,k.date=b.start.format("MMM D, YYYY"),k.successCB=function(a){p.loadCalendarEvents(a);e.triggerEvent("calendar","reserved-update",{uiSource:"itinerary.calendar.replanDialog.replan"})},k.position={my:"center bottom-20",of:h,collision:"fit"},l.reservedId=k.reservedId,l.view="CalendarData",l.successCB=function(a){p.loadCalendarEvents(a);e.triggerEvent("calendar",
"reserved-remove",{uiSource:"itinerary.calendar.replanDialog.remove"})},k.deleteData=l,f.displayReservedItemDialog(k))}},M=function(b){var c=$(b.currentTarget).data("eventId"),d=$(b.currentTarget).data("eventType"),h=$(b.currentTarget).data("title"),i={successCB:function(a){p.loadCalendarEvents(a);a={uiSource:"itinerary.calendar"};"Visit"===d?e.triggerEvent("calendar","visit-remove",a):"Reserved"===d?e.triggerEvent("calendar","reserved-remove",a):"Hop"===d&&e.triggerEvent("calendar","hop-remove",
a)}};"Visit"===d?(i.visitId=c,i.view="CalendarData",a.trackEvent("itinerary.calendar.main","delete-visit",h.toLowerCase()),g.removeFromPlan(i)):"Reserved"===d&&(i.reservedId=c,i.view="CalendarData",a.trackEvent("itinerary.calendar.main","delete-reserved"),f.removeFromPlan(i));b.stopPropagation()},w=function(b,c,f){if(b.start.isBefore(b.minTime)||b.end.isAfter(b.maxTime))f();else{var c=60*b.start.hours()+b.start.minutes(),g=60*b.end.hours()+b.end.minutes();g<c&&(g=1440);c={date:b.start.format("MMM D, YYYY"),
startTime:c,endTime:g,view:"CalendarData"};"Visit"===b.eventType?(a.trackEvent("itinerary.calendar.main","resize-visit",b.title.toLowerCase()),d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit/"+b.id,type:"POST",data:c,synchronize:!0,success:function(a){p.loadCalendarEvents(a);e.triggerEvent("calendar","visit-update",{uiSource:"itinerary.calendar.resize"})},error:function(){window.console.log("error on server?");f()},complete:function(){}})):"Reserved"===b.eventType&&
(a.trackEvent("itinerary.calendar.main","resize-reserved"),c.name=b.title,c.notes=b.notes,d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved/"+b.id,type:"POST",data:c,synchronize:!0,success:function(a){p.loadCalendarEvents(a);e.triggerEvent("calendar","reserved-update",{uiSource:"itinerary.calendar.resize"})},error:function(){window.console.log("error on server?");f()},complete:function(){}}))}},C=function(a,b,c){t.find("#calendarStaySeparators").removeClass("hidden");
c.helper.data("qtip")&&c.helper.qtip("api").hide()},s=function(){t.find("#calendarStaySeparators").addClass("hidden")},P=function(b,c,f){if(b.start<b.minTime||b.end>b.maxTime)f();else{var c=60*b.start.hours()+b.start.minutes(),g=60*b.end.hours()+b.end.minutes();g<c&&(g=1440);c={date:b.start.format("MMM D, YYYY"),startTime:c,endTime:g,view:"CalendarData"};"Visit"===b.eventType?(a.trackEvent("itinerary.calendar.main","drag-drop-visit",b.title.toLowerCase()),d.makeAJAXcall({url:window.contextPath+"/plan/"+
$("#plan").data("planId")+"/visit/"+b.id,type:"POST",data:c,synchronize:!0,success:function(a){p.loadCalendarEvents(a);e.triggerEvent("calendar","visit-update",{uiSource:"itinerary.calendar.drop"})},error:function(){window.console.log("error on server?");f()},complete:function(){}})):"Reserved"===b.eventType&&(a.trackEvent("itinerary.calendar.main","drag-drop-reserved"),c.name=b.title,c.notes=b.notes,d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved/"+b.id,type:"POST",
data:c,synchronize:!0,success:function(a){p.loadCalendarEvents(a);e.triggerEvent("calendar","reserved-update",{uiSource:"itinerary.calendar.drop"})},error:function(){window.console.log("error on server?");f()},complete:function(){}}))}};p.getStartDay=function(){if(n.data("fullCalendar"))return b.duration(n.fullCalendar("getDate").utc()-v).asDays()+1};var O=function(a,b,c){a.qtip({content:b,overwrite:!0,show:{solo:n},hide:{delay:50,fixed:!0},position:{my:"left middle",at:"right top",target:c?a.find(".fc-event-title"):
"",adjust:{x:c?-4:0,y:c?12:15},container:n,viewport:$(window)},style:{classes:"error-qtip qtip-light qtip-shadow",tip:{width:18,height:10}}})};p.goToDay=function(a){var b=function(){var b=v.clone().add("days",a-1);n.data("fullCalendar")&&(n.fullCalendar("gotoDate",b.clone().add("days",3)),n.fullCalendar("gotoDate",b))};y?(t.one("refreshed",b),p.refreshIfInvalid(!0)):b()};p.reloadTabWithDestinationInView=function(a,b){var c=t.find(".navigationLink.stay-list-title").filter(function(){return $(this).data("stayId")===
b});c.hasClass("stay-list-title")&&(c=$(c.siblings(".day-list").find(".day-list-title")[0]));c=c.data("dayNumber");c=v.clone().add("days",c-1);p.reloadTab(a,c)};p.loadCalendarEvents=function(c,d){for(var e=c.stays,f=c.events,g=[],h=Math.max(0,c.dayStartTime-30),i=0,j,m,p=!$("#plan").data("editEnabled"),r,i=Math.floor(h/60),h=h%60,h=(9<i?i:"0"+i)+":"+(9<h?h:"0"+h)+":00",i=0;i<e.length;i++){var q=e[i];q.startDay=b.unix(q.startDay).utc();q.endDay=b.unix(q.endDay).add("days",1).utc()}z=e;for(i=0;i<f.length;i++){q=
{id:f[i].id,title:f[i].title,start:b.unix(f[i].start).utc(),end:b.unix(f[i].end).utc(),duration:b.duration(f[i].duration,"minutes"),eventType:f[i].eventType,minTime:b.unix(f[i].minTime).utc(),maxTime:b.unix(f[i].maxTime).utc(),conflict:f[i].conflict,dataId:f[i].dataId,detailsUrl:f[i].detailsUrl,notes:f[i].notes,sideTrip:f[i].sideTrip};m&&q.start.date()!==m.start.date()&&("Hop"===m.eventType&&(m.last=!0),j=m=void 0);if("Hop"===f[i].eventType){if(j&&q.end.isBefore(q.start)){j.nextHopError=!0;continue}m&&
"Reserved"===m.eventType&&(q.title="");q.className="hopEvent";m||(q.first=!0);q.editable=!1;q.requiredDuration=b.duration(30*Math.floor((q.duration.asMinutes()+29)/30),"minutes")}else"Visit"===f[i].eventType||"Reserved"===f[i].eventType?(j&&(!0===j.nextHopError&&(q.prevHopError=!0),q.start.isBefore(j.end)&&(j.overlapped=!0,q.overlapped=!0)),m&&("Hop"===m.eventType&&"Reserved"===q.eventType)&&(m.title=""),q.className="Visit"===q.eventType?"visitEvent":"reservedEvent bg-stripe",q.editable=!p,j=q):"Travel"===
f[i].eventType&&(q.className="travelEvent bg-stripe",q.editable=!1,q.end=b.unix(f[i].start).utc()+72E5,m&&"Hop"===m.eventType&&(m.last=!0));m&&(m.nextId=q.id,q.prevId=m.id);m=q;g.push(q)}m&&"Hop"===m.eventType&&(m.last=!0);k=b.unix(c.start).utc();l=b.unix(c.end).utc().add("days",1);v=b.unix(c.start).utc();L=b.unix(c.end).utc().add("days",3);n.data("fullCalendar")?(n.find(".qtip").each(function(){$(this).qtip("api").destroy()}),n.fullCalendar("removeEvents"),n.fullCalendar("addEventSource",g)):(n.fullCalendar({defaultView:"inspirockAgendaWeek",
header:{left:"prev",center:"",right:"next"},height:718,events:g,allDayDefault:!1,ignoreTimezone:!1,allDaySlot:!1,allDaySlotClick:!1,allDayText:"",numDaysDisplay:4,slotEventOverlap:!1,scrollTime:h,columnFormat:{week:'[<div class="day">]ddd[,] MMM D[</div>'+(p?'<div class="read-only-space"></div>':"")+"]"},axisFormat:'[<div class="time-wrap"><span class="time">]ht[</span></div>]',eventClick:N,eventDragStart:C,eventDragStop:s,eventDrop:P,eventResize:w,dayClick:u,eventRender:function(b,c){c.attr("id",
"event-"+b.id);if("Reserved"===b.eventType||"Visit"===b.eventType){c.find(".fc-event-inner .fc-event-title").html(b.title);b.notes&&c.find(".fc-event-inner").append('<div class="cal-notes">&ldquo;'+b.notes.replace(/\n/g,"<br/>")+"&rdquo;</div>");if(p)"Visit"===b.eventType&&c.addClass("itineraryAttractionDetails").data("eventSrc","calendar.visit").data("detailsUrl",b.detailsUrl);else{var d=$('<div data-event-id="'+b.id+'" data-event-type="'+b.eventType+'" data-title="'+b.title+'" class="deleteEvent fa fa-times"></input>');
d.click(M);c.append(d)}for(d=0;b.start.isAfter(e[d].startDay)&&!b.start.isBefore(e[d].endDay);)d++;$(document.createElement("div")).addClass("bar").appendTo(c);if(b.conflict||b.overlapped)c.addClass("conflict bg-stripe"),b.conflict?r=$('<div><div class="title">Error:</div><div class="content">You are visiting when the attraction is closed.</div></div>'):b.overlapped&&(r=$('<div><div class="title">Error:</div><div class="content">You have 2 activities scheduled at this time.</div></div>')),r.length&&
O(c,r,!1);b.nextHopError&&$(document.createElement("div")).addClass("next-hop-broken").appendTo(c);b.prevHopError&&$(document.createElement("div")).addClass("prev-hop-broken").appendTo(c)}else if("Hop"===b.eventType){var d=b.duration.asMilliseconds()>b.end.diff(b.start),f=b.end.diff(b.start)>b.requiredDuration.asMilliseconds();b.first?c.addClass("first endpoint"):b.last&&c.addClass("last endpoint");var g=$(document.createElement("div"));g.addClass("hop-line-top");c.find(".fc-event-inner").append(g);
g=$(document.createElement("div"));g.addClass("hop-line-bottom");c.find(".fc-event-inner").append(g);f?(d=100*(b.requiredDuration.asMilliseconds()/b.end.diff(b.start)),c.find(".fc-event-inner").append($(document.createElement("div")).addClass("fc-event-solid-time").css({height:d+"%"})),d=$(document.createElement("div")).addClass("fc-event-filler-time").css({top:d+"%"}),c.find(".fc-event-inner").append(d)):d?(c.addClass("under"),c.find(".fc-event-inner").append($(document.createElement("div")).addClass("fc-event-solid-time").css({height:"100%"})),
r=$('<div><div class="title">Error:</div><div class="content">Travel time is longer than your schedule has allowed.</div></div>'),O(c,r,!0)):c.find(".fc-event-inner").append($(document.createElement("div")).addClass("fc-event-solid-time").css({height:"100%"}));d=b.end.diff(b.start);0===d?c.addClass("dot-only"):18E5>=d&&c.addClass("short");b.title||c.find(".fc-event-title").remove();(b.first||b.last)&&!b.sideTrip&&c.find(".fc-event-title").remove();b.detailsUrl&&c.find(".fc-event-title").click(function(){a.trackEvent("itinerary.calendar.hop",
"click-directions");window.open(b.detailsUrl,"_blank")});b.notes&&c.find(".fc-event-title").append('<span class="cal-notes"> ('+b.notes.replace(/\n/g,"<br/>")+")</span>")}else"Travel"===b.eventType&&b.notes&&c.find(".fc-event-title").append('<div class="cal-notes"> ('+b.notes.replace(/\n/g,"<br/>")+")</div>")},viewRender:function(a){n.find(".fc-button-prev").empty().append('<span class="fa fa-angle-left" />');n.find(".fc-button-next").empty().append('<span class="fa fa-angle-right" />');a.start>v?
n.find(".fc-button-prev").show():n.find(".fc-button-prev").hide();a.end<=L?n.find(".fc-button-next").show():n.find(".fc-button-next").hide();var b=t.find("#calendarStayBox"),c=t.find("#calendarStaySeparators");b.empty();c.empty();c.css({right:n.children(".fc-content").find(".fc-agenda-days thead .fc-agenda-gutter").width()+"px"});var d=a.start,a=a.end,f=d.clone().utc(),g=0,h=e[g],d=d.diff(k,"days");$("#itinerary .itinerary-left-pane .day-box:not(.alldays)").removeClass("active").eq(d).addClass("active");
for(var i=0,d=0,j;f<a;)if(f>=h.startDay&&f<h.endDay){if(i++,d++,f.add("days",1),f>=h.endDay||f>=a)j=$(document.createElement("div")).addClass("columnHeader").text(h.name).css({width:25*i+"%"}).appendTo(b),4!==d&&$(document.createElement("div")).addClass("separator").css({left:25*d+"%"}).appendTo(c),i=0}else if(f>=h.endDay&&f<a)if(g++,g<e.length)h=e[g];else break;else f<a&&f.add("days",1);4>d&&void 0!==j&&$(document.createElement("div")).css({width:25*(4-d)+"%"}).appendTo(b);n.find(".fc-content").find(".fc-agenda-days").find("thead").find(".fc-agenda-axis").html('<div class="day">&nbsp;</div>');
n.find(".fc-content").find(".fc-agenda-days").find("thead").find(".fc-agenda-gutter").html('<div class="day">&nbsp;</div>');p&&(a=$('<div id="viewModeCalendar" class="view-mode-calendar"><span class="tagline">You are viewing a shared plan.</span><span class="save-plan-text">Create a similar plan to customize or edit the itinerary.</span><button class="cta-button small claimPlanLink create-similar">Create a similar plan</button></div>'),a.css("top",b.height()+n.children(".fc-content").find(".fc-agenda-days thead .fc-agenda-gutter .day").height()),
c.append(a))},eventAfterAllRender:function(){n.fullCalendar("clientEvents",function(a){if("Hop"===a.eventType){var b=n.find("#event-"+a.id),c=n.find("#event-"+a.prevId),a=n.find("#event-"+a.nextId),d=0,e=0;0<c.length&&0<a.length?(d=Math.max(c.position().left,a.position().left),e=Math.min(c.position().left+c.width(),a.position().left+a.width())):0<c.length?(d=c.position().left,e=c.position().left+c.width()):0<a.length&&(d=a.position().left,e=a.position().left+a.width());e<=d?b.remove():b.css({left:d+
"px",width:e-d+"px"});(0<c.length&&c.hasClass("conflict")||0<a.length&&a.hasClass("conflict"))&&b.find(".cal-notes").remove()}});n.find(".qtip").each(function(){$(this).qtip("destroy")})}}),n.fullCalendar("gotoDate",b.unix(c.start).utc().add("days",4)),n.fullCalendar("gotoDate",b.unix(c.start).utc()));d&&(n.fullCalendar("gotoDate",d.clone().add("days",4)),n.fullCalendar("gotoDate",d));t.trigger("refreshed");y=!1};p.refreshIfInvalid=function(a){!y&&J&&(J=!1,e.triggerEvent("notifications","optimize-click",
{}));if(y){var b;a&&n.data("fullCalendar")&&(b=n.fullCalendar("getDate"));var c=b;d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/calendarEvents",success:function(a){p.loadCalendarEvents(a,c);J&&(J=!1,e.triggerEvent("calendar","optimize-click",{}))}})}};var R=function(){y=!0};p.isDirty=function(){return y};p.isOptimize=function(){return J};p.initialize=function(){t=$("#calendar");n=t.find("#calendarBox");y=!0;t.off("isVisible").on("isVisible",q).off("isHidden").on("isHidden",
r);e.addObservers("visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update".split(" "),"calendar",R);e.addObserver("optimize-route","calendar",function(){J=!0});t.is(":visible")&&p.refreshIfInvalid("same")};return p});
define("plan/itineraryMap","modules/utils modules/ajax modules/events modules/attributions modules/map jquery".split(" "),function(a,c,d,e,h){var g={},f,b=!1,j=[],m=[],q=[],r,p,t={},n,z,k,l,v,i={},L=0,y=$("#mapCanvas").data("unit"),J=!1,u=[],N,M=function(){if(b)return!0;if(!a.isGoogleMapsApiAvailable())return!1;var c={center:new window.google.maps.LatLng(0,0),zoomControl:!0,mapTypeId:window.google.maps.MapTypeId.ROADMAP,scaleControl:!0,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]};
f=new window.google.maps.Map(document.getElementById("mapCanvas"),c);N=new window.google.maps.DirectionsService;b=!0;var d=window.google.maps.event.addListener(f,"idle",function(){var b=p.find(".gm-style-cc:not(.gmnoprint):contains(' m'),.gm-style-cc:not(.gmnoprint):contains(' km')").filter(function(){return"MILES"===y&&(a.endsWith($(this).text()," km")||a.endsWith($(this).text()," m"))||"KILOMETERS"===y&&!a.endsWith($(this).text()," km")&&!a.endsWith($(this).text()," m")});b.length&&b.click();window.google.maps.event.removeListener(d)});
return!0},w=function(a,b,c){c=new window.google.maps.DirectionsRenderer({suppressMarkers:!0,polylineOptions:{strokeColor:c,strokeOpacity:0.57,strokeWeight:4},preserveViewport:!0});c.setMap(a);c.setDirections(b);u.push(c)},C=function(a,b,c,d,e,g,h){if(1<b.length){var j={},k=b.length,l=[],m=0;j.origin=new window.google.maps.LatLng(b[0].lat,b[0].lng);j.destination=new window.google.maps.LatLng(b[k-1].lat,b[k-1].lng);j.travelMode=window.google.maps.DirectionsTravelMode.DRIVING;for(m=1;m<k-1;m++)l.push({location:new window.google.maps.LatLng(b[m].lat,
b[m].lng)});j.waypoints=l;if("DRIVING"===g)i.hasOwnProperty(a)?w(d,i[a],c):e.route(j,function(b,e){e===window.google.maps.DirectionsStatus.OK?(i[a]=b,L===h&&w(d,b,c)):window.console.log("Unable to get route")});else if("LINES"===g){e=[];for(g=0;g<b.length;g++)e.push(new window.google.maps.LatLng(b[g].lat,b[g].lng));b=new window.google.maps.Polyline({path:e,geodesic:!0,strokeColor:"#000000",strokeOpacity:0.57,strokeWeight:4});b.setMap(d);d===f&&q.push(b)}}},s=function(a){M();L+=1;if(1<j.length){var b;
r=new window.google.maps.LatLngBounds;for(var c=[],d=0,d=0;d<j.length;d++){var e=j[d],g=new window.google.maps.LatLng(e.lat,e.lng);r.extend(g);void 0!==b&&e.legendOption!==b.legendOption&&(0<c.length&&C(b.legendOption,c,b.routeColor,f,N,a,L),c=[]);c.push(e);b=e}C(c[0].legendOption,c,c[0].routeColor,f,N,a,L);f.fitBounds(r)}},P=function(){for(var a=0,a=0;a<u.length;a++)u[a].setMap(null);for(;0<q.length;)q.pop().setMap(null);u=[]},O=function(a,b){var c="param-"+a;z="DRIVING";$(".legendOption").addClass("hidden");
$("*[id^='"+c+"']").removeClass("hidden");var d=[],e=$("*[id^='"+c+"']");e.each(function(a){$(e[a]).find("li").each(function(){if($(this).data("isVisit")){var b=$(this),c;c=b.parent().hasClass("legend-stay-list")?b.index()+1:b.data("markerLabel");d.push({lat:b.data("lat"),lng:b.data("lng"),label:c,color:5,routeColor:"#000000",legendOption:$(e[a]).attr("id"),title:b.find(".name").text(),link:b.data("link")})}})});0===d.length&&(c=e.first().parent("ol.legend-day-list"),d.push({lat:c.data("lat"),lng:c.data("lng"),
label:void 0,color:void 0,routeColor:void 0,legendOption:void 0,title:void 0,link:c.data("link")}));j=d;for(M();0<m.length;)m.pop().setMap(null);P();g.hideInfoWindow(void 0,!0);t={};if(1===j.length&&void 0===j[0].title)r=new window.google.maps.LatLngBounds,c=new window.google.maps.LatLng(j[0].lat,j[0].lng),r.extend(c),f.setCenter(r.getCenter()),f.setZoom(10);else{r=new window.google.maps.LatLngBounds;for(var h=0,h=0;h<j.length;h++){var i=j[h],c=new window.google.maps.LatLng(i.lat,i.lng),k='<div class="info-window-content itineraryAttractionDetails" data-details-url="'+
i.link+'" data-event-src="map-infowindow">',k=k+('<h5 class="clickable-text">'+i.title+"</h5>"),k=k+"</div>",k=new window.google.maps.InfoWindow({content:k,position:c,disableAutoPan:!1,pixelOffset:new window.google.maps.Size(0,-30,"px","px")});t[i.link]=k;i=new window.LabelMapMarker(i.label,i.color,!1,c,k,f,g);i.setMap(f);m.push(i);r.extend(c)}1===j.length?(f.setCenter(r.getCenter()),f.setZoom(10)):f.fitBounds(r)}c=document.getElementById("show-directions");b&&c.checked?s(z):P()};g.directionsEnabled_change=
function(){M()?($("#mapCanvas #noMapMessage").hide(),document.getElementById("show-directions").checked?s(z):P()):$("#mapCanvas #noMapMessage").show()};var R=function(a,b,c){a?(k.removeClass("hidden").siblings().addClass("hidden"),k.find(".dayNo").text(a),k.find(".stayName").text(b),k.find(".date").text(c)):(l.removeClass("hidden").siblings().addClass("hidden"),l.find(".stayName").text(b),l.find(".date").text(c))};g.gotoMapAllDestinations=function(){v.hide();p.find(".show-directions").hide();p.find("#mapCanvas").css("width",
"100%").trigger("resize");var a=v.find(".legendOption"),a=a.first().data("dateText")+" - "+a.last().data("dateText");R(void 0,"Full Plan Map",a);O("stay-",!1)};g.gotoMapStay=function(a){v.hide();p.find(".show-directions").hide();p.find("#mapCanvas").css("width","100%").trigger("resize");var b="stay-"+a+"-slot-",c=$("#param-stay-"+a),a=c.data("stayName"),c=c.children(),c=c.first().data("dateText")+" - "+c.last().data("dateText");R(void 0,a,c);O(b,!1)};g.gotoMapDay=function(a,b){v.show();p.find(".show-directions").show();
p.find("#mapCanvas").css("width","").trigger("resize");var c="stay-"+a+"-slot-"+b,d=$("#param-stay-"+a).data("stayName"),e=$("#param-stay-"+a+"-slot-"+b).data("dateText");R(b,d,e);d=document.getElementById("show-directions").checked;O(c,d)};g.gotoMap=function(){var a=v.find(".legendOption").first(),b=a.parents("ol.legend-day-list");g.gotoMapDay(b.data("stayId"),a.data("dayNumber"))};g.refreshIfInvalid=function(a,b){J?(p.empty(),c.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+
"/map",type:"GET",success:function(c){p.html(c);x();p.trigger("refreshed");i={};void 0!==a&&void 0!==b?g.gotoMapDay(a,b):g.gotoMap();J=!1}})):void 0!==a&&void 0!==b&&g.gotoMapDay(a,b)};var D=function(){J=!0};g.isDirty=function(){return J};g.showInfoWindow=function(a,b,c){c&&(void 0!==n&&n!==a)&&n.close();b&&(n=a);a.open(f)};g.hideInfoWindow=function(a,b){b&&void 0!==n&&(n.close(),n=void 0);void 0!==a&&a!==n&&a.close()};var x=function(){p=$("#maps");k=p.find(".map-day-title");l=p.find(".map-stay-title");
v=p.find(".map-legend");b=!1;f=void 0;j=[];m=[];q=[];r=void 0;p.find("#show-directions").change(g.directionsEnabled_change);$("#maps .map-legend").find(".legend-day-list").each(function(){var a=0;$(this).find(".legendOption").each(function(){$(this).find("li").each(function(){if($(this).data("isVisit")){var b;b="";var c=a;do{var d=c%26,c=Math.floor(c/26);b=String.fromCharCode(d+65)+b;c-=1}while(0<=c);$(this).data("markerLabel",b);c=$(this).find(".map-marker-circle");c.css({"background-color":"#fa8c00"});
c.text(b);a+=1}})})});p.find(".legend-stay-list li, .legend-day-list > li > ul > li.visit-name").mouseover(function(){g.showInfoWindow(t[$(this).data("link")],!1,!1)});p.find(".legend-stay-list li, .legend-day-list > li > ul > li.visit-name").mouseout(function(){g.hideInfoWindow(t[$(this).data("link")],!1)});p.find(".legend-stay-list li, .legend-day-list > li > ul > li.visit-name").click(function(){g.showInfoWindow(t[$(this).data("link")],!0,!0)});var a=function(){f&&r&&(window.google.maps.event.trigger(f,
"resize"),1===j.length?(f.setCenter(r.getCenter()),f.setZoom(10)):f.fitBounds(r))};p.find("#mapCanvas").on("resize",a);p.off("isVisible.init").on("isVisible.init",a);d.addObservers("visit-add visit-remove visit-update reserved-add reserved-remove reserved-update".split(" "),"map",D)};g.initialize=function(){x();if(p.is(":visible")){var a=$("#itineraryLeftPane").find(".day-box").filter(".active"),b=a.data("dayNumber"),c=a.parents(".stay").data("stayId");h.addToQueue(function(){g.refreshIfInvalid(c,
b)})}};return g});
define("plan/itinerary","modules/analytics modules/mixpanel modules/utils modules/ajax modules/events plan/history plan/daybyday plan/calendar plan/itineraryMap modules/attributions plan/details plan/loading plan/dock plan/view plan/exploreDestinations plan/exploreAttractions moment modules/map jquery jqueryui jQueryExtensions/inspirockAutocomplete jQueryExtensions/photoSlider qtip selectmenu".split(" "),function(a,c,d,e,h,g,f,b,j,m,q,r,p,t,n,z,k,l){function v(){var a=$("#pageHeader:visible"),b=$("#itinerary-carousel:visible"),
c=$(".plan-heading:visible");$(".planHeaderWrapper");var d=$(".itinerary-main-pane"),e=$(".itinerary-left-pane");a.outerHeight();d.outerHeight();a=a.outerHeight(!0)+c.outerHeight(!0)+b.outerHeight(!0)+23+12;Z.position();F.position();p.dockView("itinerary-left-pane",e,a,d.offset().top+d.outerHeight()+c.outerHeight(),d.offset().top+d.outerHeight()-K.offset().top,!1,!1,null);p.dockView("itinerary-subnav-pane",F,a,Number.MAX_VALUE,Number.MAX_VALUE,!1,!1);t.scrollAndUpdate()}function i(){la=!0}function L(){if(!Y&&
!d.getCookie("itintip")){var a=F.find(".subnav-tabs");a.is(":visible")&&(Y=window.setTimeout(function(){!d.getCookie("itintip")&&(a.is(":visible")&&!a.find("#calendarlink").hasClass("active"))&&(d.addCookie("itintip",1,99999),F.find("#calendarlink").qtip({overwrite:!0,content:{text:'<div class="fa fa-times close"></div><div><div class="calendar-view"><div><strong>Calendar view</strong></div><div class="calendar-text">Edit your itinerary quickly and easily in the drag & drop calendar view.</div></div><div class="clear"></div></div>'},
position:{my:"top center",at:"bottom center",effect:!1,container:K},show:{event:!1,ready:!0},hide:{event:!1,fixed:!0,inactive:1E4},events:{show:function(a,b){b.elements.content.off("click.close").on("click.close",".close",function(){b.hide()})},hide:function(){}},style:{classes:"itinerary-tip qtip-light qtip-shadow",tip:{corner:!0,width:20,height:10,mimic:"center top"}}}));Y=null},5E3))}}function y(){var a=F.find("#calendarlink").qtip("api");a&&a.hide();Y&&(window.clearTimeout(Y),Y=null)}function J(){q.initialize(V,
"itinerary","itinerary","itinerary.attractions.details")}function u(){g.pop()}function N(){var b=$(this),c=b.attr("id"),d=b.data("target");a.trackEvent("itinerary.subnav","click-sub-view",d);g.push("itinerary","itinerary",b.data("url"),{targetId:d,subnavLinkId:c});B.switchToSubnav(d,c,!0)}function M(){var b=$("#calendarlink"),c=b.attr("id"),d=b.data("target");a.trackEvent("itinerary.subnav","click-edit");g.push("itinerary","itinerary",b.data("url"),{targetId:d,subnavLinkId:c});B.switchToSubnav(d,
c,!0)}function w(){var c=$(this);G.removeClass("active");c.addClass("active");a.trackEvent("itinerary.left-pane","click-day-box",c.hasClass("alldays")?"alldays":c.data("dayNumber"));V.is(":visible")&&(g.push("daybyday","itinerary",K.data("url"),{subnavLinkId:"daybydaylink"}),B.switchToSubnav("daybyday","daybydaylink"));if(I.is(":visible")){var d="itineraryDay"+c.data("dayNumber");t.scrollElementIntoView(d,-115)}else if(X.is(":visible"))if(c.hasClass("alldays")){var e=c.parents(".stay");l.addToQueue(function(){j.gotoMapStay(e.data("stayId"))})}else l.addToQueue(function(){j.gotoMapDay(c.parents(".stay").data("stayId"),
c.data("dayNumber"))});else U.is(":visible")&&b.goToDay(c.data("dayNumber"));setTimeout(function(){H.scrollTop($("#itineraryLeftPane").scrollTop()+c.position().top)},550)}function C(){if(!X.is(":visible")){var c=$(this).parents(".stay").find(".day-box").eq(0);G.removeClass("active");c.addClass("active");a.trackEvent("itinerary.left-pane","click-stay-title");V.is(":visible")&&(g.push("daybyday","itinerary",K.data("url"),{subnavLinkId:"daybydaylink"}),B.switchToSubnav("daybyday","daybydaylink"));I.is(":visible")?
(c="itineraryDay"+c.data("dayNumber"),t.scrollElementIntoView(c,-115)):U.is(":visible")&&b.goToDay(c.data("dayNumber"));v()}}function s(){a.trackEvent("itinerary.left-pane","click-full-map");l.addToQueue(function(){j.gotoMapAllDestinations()})}function P(){var g=$(this);if(!g.hasClass("claimPlanLink")&&!(0<g.children(".claimPlanLink").length)&&!g.data("requestInProgress")){g.data("requestInProgress",!0);a.trackEvent("itinerary.subnav","add-item");var i=I.is(":visible")?"daybyday":"CalendarData",j=
I.is(":visible")?"daybyday":"calendar",l="itinerary."+j;e.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/addItemDialog",complete:function(){g.data("requestInProgress",!1)},success:function(g){function m(){n.find(".day-column:visible").data("qtip")&&n.find(".day-column:visible").data("qtip").destroy();return!0}var n=$(g),p=n.find("#activityDay"),x=n.find("#activityStartTime"),q=n.find("#activityEndTime"),A=n.find("#blockedDay"),u=n.find("#blockedStartTime"),r=
n.find("#blockedEndTime"),v=n.find("#attraction"),t=n.find("#stayDates"),s=n.find(".error-message"),y=function(a,b){b.empty();b.append('<option value="-1">Day / Date</option>');a?t.find("[data-destination-id="+a+"]").each(function(){for(var a=k.utc($(this).data("startDate"),"MMM D, YYYY"),c=$(this).data("startDayNumber"),d=$(this).data("endDayNumber");c<=d;c++)b.append('<option value="'+c+'"> Day '+c+" / "+a.format("MMM D")+"</option>"),a.add(1,"day")}):t.children(".stay-date").each(function(){for(var a=
k.utc($(this).data("startDate"),"MMM D, YYYY"),c=$(this).data("startDayNumber"),d=$(this).data("endDayNumber");c<=d;c++)b.append('<option value="'+c+'"> Day '+c+" / "+a.format("MMM D")+"</option>"),a.add(1,"day")});b.selectmenu("destroy");b.selectmenu({appendTo:n,open:m})};n.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-add-item",buttons:[{html:"Add To Itinerary",click:function(){var g=n.find("#activityButton"),k=n.find("#blockedButton"),m,t;s.html("");if(g.is(":checked")){var y=
v.data("inspirockAutocomplete").getSelectedItem();if(!y||0>=y.length)d.showErrorTooltip($(this).find("#attraction"),"Enter an attraction name",null,{position:{container:n,effect:!1,viewport:$(window),my:"top right",at:"bottom right"}});else{t=y.id;var w=y.destinationId,D=y.isSchedulable,g=parseInt(p.val(),10),k=parseInt(x.val(),10);m=parseInt(q.val(),10);-1!==k&&-1!==m&&k>=m?s.html("Start Time must be lesser than End Time"):!D&&(-1===k||-1===m||-1===g)?(k={position:{container:n,effect:!1,viewport:$(window),
my:"top left",at:"bottom left"}},-1===g?d.showErrorTooltip(n.find(".day-column:visible"),"Please choose the schedule.",null,k):d.showErrorTooltip(n.find("#activityStartTime").parents(".column3"),"Please choose the start time.",null,k)):(t={view:i,destinationId:w,attractionId:t},D||(t.dayNumber=g,t.fromTime=k,t.toTime=m),e.makeAJAXcall({type:"POST",data:t,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/visit",synchronize:!0,success:function(d){"daybyday"===i?(I.html(d),f.initialize(),I.trigger("refreshed")):
"CalendarData"===i?b.loadCalendarEvents(d):(K.html(d),B.initialize());h.triggerEvent(j,"visit-add",{uiSource:l});a.trackEvent("itinerary.subnav","add-attraction-confirm",y.value.toLowerCase());c.logEvent("add_item_saved",{source:j,type:"attraction"});h.triggerEvent("itinerary","mmt_track_link",{linkName:"Add Attraction"});n.dialog("close")}}))}}else k.is(":checked")?(g=parseInt(A.val(),10),k=parseInt(u.val(),10),m=parseInt(r.val(),10),D=$("#reservedTitle").val().trim(),-1!==k&&-1!==m&&k>=m&&(null===
D||""===D)?s.html("Please enter the title and choose the schedule."):(t={view:i},-1!==g&&-1!==k&&-1!==m?(t.dayNumber=g,t.fromTime=k,t.toTime=m,t.name=D,e.makeAJAXcall({type:"POST",data:t,url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/reserved",synchronize:!0,success:function(d){"daybyday"===i?(I.html(d),f.initialize(),I.trigger("refreshed")):"CalendarData"===i?b.loadCalendarEvents(d):(K.html(d),B.initialize());h.triggerEvent(j,"reserved-add",{uiSource:l});a.trackEvent("itinerary.subnav",
"add-reserved-confirm");c.logEvent("add_item_saved",{source:j,type:"reserved"});h.triggerEvent("route","mmt_track_link",{linkName:"Add Reserved"});n.dialog("close")}})):D?(k={position:{container:n,effect:!1,viewport:$(window),my:"top left",at:"bottom left"}},-1===g?d.showErrorTooltip(n.find(".day-column:visible"),"Please choose the schedule.",null,k):d.showErrorTooltip(n.find("#blockedStartTime").parents(".column3"),"Please choose the start time.",null,k)):d.showErrorTooltip(n.find("#reservedTitle"),
"Please enter reserved item title.",null,{position:{container:n,effect:!1,viewport:$(window),my:"top right",at:"bottom right"}}))):d.showErrorTooltip(n.find("#activityButton"),"Please choose any one of the Activity.")}}],open:function(){d.setupDialogOverlay(n,!1);c.logEvent("add_item_dialog_show",{source:j});var a=n.find(".event"),b=n.find(".blocked-options"),e=n.find(".activity-options"),f=n.find(".attraction-search-container");v.inspirockAutocomplete({url:window.contextPath+"/plan/"+$("#plan").data("planId")+
"/attractionAutocomplete",appendTo:n.parents(".ui-dialog"),onSelect:function(a,b){b.isSchedulable||e.removeClass("hidden");y(b.destinationId,p);d.hideErrorTooltip(f)},onDelete:function(){e.addClass("hidden")}});u.selectmenu({appendTo:n,open:m});r.selectmenu({appendTo:n,open:m});u.linkToEndTimeSelect(r);A.selectmenu({appendTo:n,open:m});x.selectmenu({appendTo:n,open:m});q.selectmenu({appendTo:n,open:m});x.linkToEndTimeSelect(q);p.selectmenu({appendTo:n,open:m});var g=function(){var a=$(this);if(-1===
parseInt(a.val(),10)){var b=a.data("valueOnOpen");a.selectmenu("value",b);b=a.find("option[value="+b+"]").index();a=$("#"+a.attr("id")+"-menu");b=a.children("li").eq(b);b.find("a").trigger("focus");a.scrollTop(a.scrollTop()+b.position().top)}};u.on("selectmenuopen",g);r.on("selectmenuopen",g);x.on("selectmenuopen",g);q.on("selectmenuopen",g);y(void 0,A);a.click(function(){$(this).is(":checked")&&"activity"===$(this).val()?($(".qtip").qtip("destroy"),f.removeClass("hidden"),b.addClass("hidden")):$(this).is(":checked")&&
"blocked"===$(this).val()&&($(".qtip").qtip("destroy"),f.addClass("hidden"),e.addClass("hidden"),b.removeClass("hidden"))})},close:function(){d.hideErrorTooltip($(this).find(".attraction-search-container"));$(".qtip").qtip("destroy");n.dialog("destroy").remove()}})}})}}function O(){var f=$(this);if(!f.hasClass("disabled")){f.addClass("disabled");var g=I.is(":visible")?"list":"calendar",i=I.is(":visible")?"daybyday":"calendar",j=1;"calendar"===g&&(j=b.getStartDay());e.makeAJAXcall({type:"GET",url:window.contextPath+
"/plan/"+$("#plan").data("planId")+"/optimize",complete:function(){f.removeClass("disabled")},success:function(f){var k;I.is(":visible")||X.is(":visible")?(k=G.filter(".active").parents(".stay"),k={stayId:k.data("stayId"),destinationId:k.data("destinationId"),destinationName:k.data("name")}):k=U.is(":visible")?b.getCurrentStay():void 0;var m=k.stayId;a.trackEvent("itinerary.subnav","optimize",k.destinationName.toLowerCase());var l=$(f);l.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-optimize",
buttons:[{html:"Optimize",click:function(d){$(d.currentTarget).prop("disabled",!0);var f=l.find("select").val(),k=l.find("select").find(":selected").text();r.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan...");e.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay/"+f+"/optimize",synchronize:!0,data:{view:"itinerary",itinerarySubNav:g},success:function(d){K.html(d);B.initialize();"calendar"===i&&b.goToDay(j);d={uiSource:"itinerary."+
i+".recalculate"};c.logEvent("recalculate_dialog_saved",{source:i});h.triggerEvent("itinerary","stay-update",d);a.trackEvent("itinerary.subnav","optimize-confirm",k.toLowerCase());h.triggerEvent("itinerary","mmt_track_link",{linkName:"Recalculate"})},complete:function(){$(d.currentTarget).prop("disabled",!1);r.hideLoading($("#planRecalculating"),$("#resultpageContent"))}});l.dialog("close")}}],open:function(){d.setupDialogOverlay(l,!1);c.logEvent("recalculate_dialog_show",{source:i});l.find("select").val(m);
l.find("select").selectmenu({appendTo:l});var a=l.find(".selected-destination"),b=l.find("#optimizeStay");a.text(l.find("#optimizeStay :selected").text());b.change(function(){a.text(l.find("#optimizeStay :selected").text())})},close:function(){l.dialog("destroy").remove()}})}})}}function R(){v();h.addObserver("scroll","itinerary",function(a,b){var c=$(window).height()-S.height()-40;$(window).scrollTop()+$(window).height()>Z.offset().top&&(c-=Z.height()+40);T.height()<c&&(c=T.height()+F.height()-10);
220>c&&(c=$(window).height()-F.position().top-F.height()-Z.height()-100);H.find(".stays").css("max-height",c-100);if(!0!==b.manualScrollEvent&&T.is(":visible")){var e=$("#itinerary .itinerary-left-pane:visible .day-box:visible"),c=$("#itinerary #daybyday:visible .day-block"),f=$("#itinerary .itinerary-left-pane:visible"),g=$(window).scrollTop(),h;c.each(function(a){if($(this).offset().top+0.75*$(this).outerHeight(!0)>g+d.getFloatingBarsHeight())return a=e.eq(a),a.hasClass("active")||(e.removeClass("active"),
a.addClass("active")),0>a.position().top?(h=a.position().top+f.scrollTop()-100,f.scrollTop(h)):a.position().top+a.outerHeight(!0)+100>f.innerHeight()&&(h=a.position().top+f.scrollTop()+a.outerHeight(!0)+100-f.innerHeight(),f.scrollTop(h)),!1})}})}function D(){p.undockView("itinerary-left-pane");p.undockView("itinerary-subnav-pane");y();h.removeObserver("scroll","itinerary")}function x(a,b){t.scrollElementIntoView("itinerary-item-"+b.itemId,-115)}function A(a,b){na.push(b)}var B={},K,H,F,T,I,U,X,V,
G,Z,S,Y,na=[],la=!1;B.refreshIfInvalid=function(a){if(la)r.showLoading($("#planRecalculating"),$("#resultpageContent"),"Loading..."),K.empty(),e.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/itinerary",type:"GET",success:function(b){K.html(b);B.initialize();a&&a.subnav&&("daybyday"===a.subnav?B.showDayByDay():"calendar"===a.subnav&&B.showCalendar());v();la=!1;K.trigger("refreshed");B.performPostRefreshActions()},complete:function(){r.hideLoading($("#planRecalculating"),
$("#resultpageContent"))}});else{if(a&&a.subnav&&"daybyday"===a.subnav)B.showDayByDay();else{var b=F.find(".subnavlink.active");B.switchToSubnav(b.data("target"),b.attr("id"))}B.performPostRefreshActions()}};B.isDirty=function(){return la};B.isOptimize=function(){return b.isOptimize()};B.switchToSubnav=function(d,e,g){var h=F.find(".subnav-tabs .subnavlink.active").data("target"),i=$("#"+d);"minidetails"===d?F.find(".subnav-tabs").addClass("hidden"):F.find(".subnav-tabs").removeClass("hidden");e&&
$("#"+e).addClass("active").siblings().removeClass("active");a.setPageType("In-Plan Page");a.trackPageView("/plan/itinerary/"+d);c.trackPageView("/plan/itinerary/"+d,"",{planId:$("#plan").data("planId")});F.find(".back").addClass("hidden");e=K.find(".subnav-actions");"daybyday"===d?(e.find(".add-item").parents("li").addClass("hidden"),e.find(".optimize").parents("li").addClass("hidden"),e.find(".customize-btn").parents("li").removeClass("hidden"),e.find(".back-to-itinerary").addClass("hidden")):"calendar"===
d?(e.find(".add-item").parents("li").removeClass("hidden"),e.find(".optimize").parents("li").addClass("hidden"),e.find(".customize-btn").parents("li").addClass("hidden"),e.find(".back-to-itinerary").addClass("hidden")):"maps"===d?(e.find(".add-item").parents("li").addClass("hidden"),e.find(".optimize").parents("li").addClass("hidden"),e.find(".customize-btn").parents("li").addClass("hidden"),e.find(".back-to-itinerary").addClass("hidden")):"minidetails"===d&&(e.find(".add-item").parents("li").addClass("hidden"),
e.find(".optimize").parents("li").addClass("hidden"),e.find(".customize-btn").parents("li").addClass("hidden"),e.find(".back-to-itinerary").removeClass("hidden"));"daybyday"===d||"maps"===d||"minidetails"===d?(H.removeClass("hidden"),F.removeClass("full-width"),T.removeClass("full-width")):"calendar"===d&&(H.addClass("hidden"),F.addClass("full-width"),T.addClass("full-width"),y());H.removeClass("daybyday maps minidetails calendar").addClass(d);i.removeClass("hidden").siblings().addClass("hidden");
var k,l;if(g||"maps"===d)e=G.filter(".active"),l=e.data("dayNumber"),k=e.parents(".stay").data("stayId"),0>l&&(l=e.parents(".stay").find(".day-box").first().data("dayNumber"));h!==d&&$(window).scrollTop()>T.offset().top-120&&$(window).scrollTop(T.offset().top-120);"daybyday"===d?f.refreshIfInvalid(k,l):"maps"===d?j.refreshIfInvalid(k,l):"calendar"===d&&(g?b.goToDay(l):b.refreshIfInvalid(!0));v();"minidetails"!==d?L():y();i.trigger("isVisible")};B.showItineraryDetails=function(a,b){e.makeAJAXcall({type:"GET",
url:a,data:{view:"partial"},complete:function(){r.hideLoading($("#itineraryLoadingPane"),$("#itineraryMainPane"))},success:function(a){B.switchToSubnav("minidetails",void 0);V.html(a);r.hideLoading($("#itineraryLoadingPane"),$("#itineraryMainPane"));J();a=V.find(".in-plan").first();a.length&&(a=a.data("dayNumber"),G.removeClass("active"),G.filter("[data-day-number="+a+"]").addClass("active"));"overview.stay-highlights"===b&&F.find(".back-to-itinerary .title").text("back");"itinerary.visit-row"!==
b&&(F.find(".back-to-itinerary").addClass("hidden"),F.find(".back").removeClass("hidden"));v();$(window).scrollTop()>V.offset().top-120&&$(window).scrollTop(V.offset().top-120)}})};B.showDayByDay=function(){B.switchToSubnav("daybyday","daybydaylink")};B.showCalendar=function(){var a=F.find(".subnav-tabs").find("#calendarlink"),b=a.attr("id"),c=a.data("target");g.push("itinerary","itinerary",a.data("url"),{targetId:c,subnavLinkId:b});B.switchToSubnav("calendar","calendarlink")};B.showDayByDayDay=function(a){var b=
f.isDirty();B.switchToSubnav("daybyday","daybydaylink");if(b)I.one("refreshed",function(){t.scrollElementIntoView("itineraryDay"+a,-115)});else t.scrollElementIntoView("itineraryDay"+a,-115)};B.performPostRefreshActions=function(){for(var a in na)switch(na[a].action){case "goto-calendar":h.triggerEvent("overview","goto-calendar",na[a])}na=[]};B.initialize=function(){K=$("#itinerary");var c=$("#itinerary-carousel");c.find(".photos").preparePhotoSlider(2);H=K.find("#itineraryLeftPane");F=K.find("#itinerarySubnavPane");
T=K.find("#itineraryMainPane");I=T.find("#daybyday");U=T.find("#calendar");X=T.find("#maps");V=T.find("#minidetails");G=H.find(".day-box");G.first().addClass("active");Z=$("footer");$(".page-content");S=$("#planHeader");h.addObservers(["plan-update","stay-add","stay-remove","stay-update"],"itinerary",i);h.addObserver("refresh-itinerary","itinerary",function(a,b){B.refreshIfInvalid(b)});h.addObserver("goto-calendar","itinerary",function(a,c){B.showCalendar();b.goToDay(c.dayNumber)});h.addObserver("itinerary-subnav",
"itinerary",function(a,b){B.switchToSubnav(b.targetId,b.subnavLinkId)});h.addObserver("itinerary-details","itinerary",function(a,b){b.url&&B.showItineraryDetails(b.url,b.eventSource)});h.addObserver("scroll-to-item","itinerary",x);h.addObserver("optimize-click","itinerary",O);h.addObserver("itinerary-post-refresh-actions","itinerary",A);H.off("click.day-box").on("click.day-box",".day-box",w);H.off("click.stayTitle").on("click.stayTitle",".stay > .title",C);H.off("click.fullmap").on("click.fullmap",
".fullmap",s);F.find(".customize-btn").off("click").on("click",M);F.find(".subnavlink").off("click").on("click",N);F.find(".optimize").off("click").on("click",O);F.find(".add-item").off("click").on("click",P);F.find(".back-to-itinerary").off("click").on("click",u);F.find(".back").off("click").on("click",u);K.off("isVisible").on("isVisible",R);I.off("refreshed.dock").on("refreshed.dock",v);U.off("refreshed.dock").on("refreshed.dock",v);X.off("refreshed.dock").on("refreshed.dock",v);K.is(":visible")&&
v();V.is(":visible")&&J();l.addToQueue(j.initialize);b.initialize();f.initialize();K.off("isVisible.tooltip").on("isVisible.tooltip",L);K.off("isHidden").on("isHidden",D);c.off("click.startTrip").on("click.startTrip",".start-planning-now",function(){var b=$(this).siblings(".bold").text();a.trackEvent("attraction-landing.inspirock-carousel","start-plan-click",b,function(){window.location.href=window.contextPath+"/trip-planner"})})};return B});
define("plan/tabs","modules/events modules/analytics modules/mixpanel modules/ajax plan/dock modules/attributions plan/history plan/view plan/itinerary plan/overview jquery".split(" "),function(a,c,d,e,h,g,f,b,j,m){var q={},r,p=function(j,m,p,k,l){var q=$("#"+j);"overview"===j?($(".plan-heading").find(".plan-text").addClass("hidden"),$(".plan-heading").find(".plan-hero").removeClass("hidden"),$(".plan-heading").removeClass("hidden"),$(".plan-header-wrap .back-to-overview").addClass("hidden")):($(".plan-heading").find(".plan-text").removeClass("hidden"),
$(".plan-heading").find(".plan-hero").addClass("hidden"),$(".plan-heading").addClass("hidden"),$(".plan-header-wrap .back-to-overview").removeClass("hidden"));$("#planHeader").find("#action-alerts").qtip("hide");p&&(p=q.data("url"),f.push(j,j,p,void 0),c.trackEvent("nav","tab",j.toLowerCase()));k=k||j;c.setPageType("In-Plan Page");c.setProperty("page","/plan/"+k);c.trackPageView("/plan/"+k);a.triggerEvent("home","mmt_track_planpage",{channel:"inspirock funnel",page:"plan"+j});"itinerary"!==k&&"explore"!==
k&&d.trackPageView("/plan/"+k,"Plan "+k,{planId:$("#plan").data("planId")});r.find("li").removeClass("active");r.find(".tab-"+j).addClass("active");"notifications"===j?$("#action-alerts").addClass("highlighted"):$("#action-alerts").removeClass("highlighted");k=q.siblings().filter(".active");q.siblings().removeClass("active").addClass("hidden");q.addClass("active").removeClass("hidden");k.trigger("isHidden");q.trigger("isVisible");"overview"===j?a.triggerEvent("view","refresh-overview",{}):"route"===
j?a.triggerEvent("view","refresh-route",{}):"itinerary"===j?(j={},m&&(j.subnav="daybyday"),a.triggerEvent("view","refresh-itinerary",j)):"hotels"===j?a.triggerEvent("view","refresh-hotels",{}):"explore"===j?(j={},m&&(j.showLanding=!0),a.triggerEvent("view","refresh-explore",j)):"notifications"===j&&a.triggerEvent("view","refresh-notifications",{});m={dockTopAt:$(".plan-header").offset().top};h.changeDockAttr("tabdock",m);l||(m=$("#planHeader"),l=$(window).scrollTop(),m=m.offset().top,l>m&&window.scrollTo(0,
m+1));e.keepSessionAlive();b.scrollAndUpdate();g.updatePhotoAttributions()};q.gotoOverviewTab=function(a,b){$("#overview").is(":visible")||p("overview",b,a,void 0)};q.gotoRouteTab=function(a,b){$("#overview").is(":visible")||(m.isDirty()?($("#overview").one("refreshed",function(){$("#route").find(".routeLink").trigger("click")}),p("overview",b,a,void 0)):(p("overview",b,a,void 0),$("#route").find(".routeLink").trigger("click")))};q.gotoExploreTab=function(a,b){$("#explore").is(":visible")||p("explore",
b,a,void 0)};q.gotoItineraryTab=function(a,b){(!$("#itinerary").is(":visible")||j.isDirty()||j.isOptimize())&&p("itinerary",b,a,void 0)};q.gotoHotelsTab=function(a,b){$("#hotels").is(":visible")||p("hotels",b,a,void 0)};q.gotoNotificationsTab=function(a){$("#notifications").is(":visible")||p("notifications",!1,a,void 0)};q.initialize=function(){var b=$("#resultpageContent .tab-content:visible"),c=b.attr("id"),d=$("#planHeader .plan-header-wrap");r=$("#plan-nav").find(".tabs");h.dockView("tabdock",
d,$("#pageHeader").height(),Number.MAX_VALUE,Number.MAX_VALUE,!1,!1);var e,g,j,i={};"itinerary"===c?(e=$("#itinerary").find(".itinerary-subnav-pane").find(".subnavlink").filter(".active"),d=e.attr("id"),g=e.data("target"),e=e.data("url"),-1===location.pathname.indexOf("/modal/")&&f.replace(c,c,e,{targetId:g,subnavLinkId:d})):"explore"===c?(e=$("#explore").find(".explore-subnav-pane").find(".subnavlink").filter(".active"),d=e.attr("id"),g=e.data("target"),j=c,e=e.data("url"),i.targetId=g,i.subnavLinkId=
d,"destinationslink"===d&&$("#"+g).find(".explore-destination-details-pane").is(":visible")?(j="exploreDestinationDetails",e=$("#"+g).find(".explore-destination-details-pane").find(".destination-details").data("url"),i.detailsUrl=e):"attractionslink"===d&&$("#"+g).find(".explore-attraction-details-pane").is(":visible")&&(j="exploreAttractionDetails",e=$("#"+g).find(".explore-attraction-details-pane").find(".attraction-details").data("url"),i.detailsUrl=e),-1===location.pathname.indexOf("/modal/")&&
f.replace(j,c,e,i)):-1===location.pathname.indexOf("/modal/")&&f.replace(c,c,b.data("url"),void 0);$("#plan-nav ul.tabs > li,.back-to-overview").click(function(a,b,c){var b=a.hasOwnProperty("originalEvent")||b?!0:!1,a=a.hasOwnProperty("originalEvent")?!0:!1,d=$(this).data("target");p(d,b,a,c);return!1});b.trigger("isVisible");p(c,!1,!1,void 0,!0);a.addObserver("show-tab-route","tabs",function(a,b){q.gotoRouteTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-explore","tabs",function(a,b){q.gotoExploreTab(b.addToHistory,
b.tabClick)});a.addObserver("show-tab-itinerary","tabs",function(a,b){q.gotoItineraryTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-hotels","tabs",function(a,b){q.gotoHotelsTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-overview","tabs",function(a,b){q.gotoOverviewTab(b.addToHistory,b.tabClick)});a.addObserver("show-tab-notifications","tabs",function(a,b){q.gotoNotificationsTab(b.addToHistory)})};return q});
define("plan/exploreDestinations","modules/analytics plan/tabs modules/ajax modules/events modules/attributions plan/details plan/loading plan/dock plan/view plan/exploreAttractions modules/map modules/modal modules/utils jquery jqueryui qtip jQueryExtensions/linkToCalendarAndMap jQueryExtensions/pager".split(" "),function(a,c,d,e,h,g,f,b,j,m,q,r,p){function t(){var b=$(this),c=b.parents("li.destination"),g=c.data("destinationId"),h=c.data("name"),c={destinationId:g,destinationName:h,view:"exploreDestinations"};
b.prop("disabled",!0);f.showLoading($("#exploreLoadingPane"),$("#exploreMainPane"),"Updating your plan...");d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay",data:c,synchronize:!0,complete:function(){b.prop("disabled",!1);f.hideLoading($("#exploreLoadingPane"),$("#exploreMainPane"))},success:function(b){e.triggerEvent("explore-destinations","stay-add",{uiSource:"explore.destinations.recommendation"});e.triggerEvent("explore-destinations","load-explore-contents",
b);l.find(".more-filters").addClass("hidden");a.trackEvent("explore.filter-results","add-destination",h.toLowerCase())}})}function n(a){var b=a.data("link")||a.attr("href"),c=location.pathname,d=c.split("/"),e=$("#plan").data("planId"),f="/plan/"+e,b=-1===b.indexOf(f)?f+"/"+d[d.indexOf(e)+1]+"/modal"+b:p.planTabUrl()+"/modal"+b.replace(f,""),d=a.parents(".tab-content");0===d.length&&(d=$(".tab-content:visible"));e="";0<d.length&&(e+=d.attr("id"));e+="."+(a.data("eventSrc")||a.parents(".data-holder").data("eventSrc"));
f="back";0<a.parents("#results").length&&(f="back to results");z.loadDestinationDetails(b,e,!0,f,{path:c,history:{id:"exploreDestinationDetails",tabId:d.attr("id"),url:b,data:{detailsUrl:b,backText:f,eventSource:e,modal:"explore"}}});return!1}var z={},k,l;z.loadDestinationDetails=function(b,d,f,j,k){var f=b.split("/"),l=f[f.length-1],n,j=b.split("?")[1];"a"===l.charAt(0)?n="attraction":"d"===l.charAt(0)&&(n="destination");if("attraction"===n||"destination"===n)l=f[f.length-2]+"-"+f[f.length-1],d&&
(a.trackPageView(b,l.toLowerCase()),a.trackNonInteractionEvent(d,n+"-details",l.toLowerCase()));var p;j&&(p=!0);-1!==b.indexOf("modal")&&(b="/plan/"+f[2]+b.split("modal")[1]);d="";for(n=3;n<f.length&&"modal"!==f[n];)""!==d&&(d+="/"),d+=f[n++];r.open({data:k,ajaxParams:{url:b,data:{view:"partial",expanded:p},type:"GET",func:{success:function(a){h.updatePhotoAttributions();return $("<div />").append('<div class="details-pane">'+a+"</div>").html()}}},open:function(a){g.initialize($(".modal-box .details-pane"),
"details","explore","explore.destinations.details");a.off("click.modalAttrDetailPageLink").on("click.modalAttrDetailPageLink",".attractionDetailsLink,.attLink",m.attractionDetailsPageLinks);a.off("click.modalDestDetailPageLink").on("click.modalDestDetailPageLink",".destinationDetailsLink,.destLink",z.destinationDetailsPageLinks);a.off("click.modalRouteLink").on("click.modalRouteLink",".routeLink",function(){e.triggerEvent("exploreDestinations","overview-post-refresh-actions",{action:"expandRouteSection",
destinationId:$(this).parents(".destination-details").data("destination-id")});a.close();$(".ui-dialog").remove();c.gotoOverviewTab(!0,!0)});a.off("click.modalHideRouteLink").on("click.modalHideRouteLink",".hideRouteLink",function(){e.triggerEvent("exploreDestinations","collapse-route-section",{})});a.off("click.claimPlan").on("click.claimPlan",".claimPlanLink",function(){e.triggerEvent("exploreAttractions","claimPlan",{})})}})};z.loadDestinationInModal=function(a){r.open({element:$("#explore"),data:{path:"/plan/"+
$("#plan").data("planId")+"/"+a+"/",history:{id:"browseDestinations",tabId:a,url:"/plan/"+$("#plan").data("planId")+"/"+a+"/modal/explore/destinations",data:{detailsUrl:"/plan/"+$("#plan").data("planId")+"/"+a+"/modal/explore/destinations",backText:"",eventSource:a,tab:a,modal:"explore"}}},open:function(a){e.triggerEvent("explore-destinations","prep-explore-for-modal",{$modal:a})},close:function(){b.enableDock("explore-attractions-left-pane")}})};z.destinationDetailsPageLinks=function(){var a=$(this);
n(a)};z.loadBrowseDestinations=function(b,c){f.showLoading($("#exploreLoadingPane"),$("#attractions"),"Searching...");d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/browseDestinations",data:{destinationId:c.destinationId},complete:function(){f.hideLoading($("#exploreLoadingPane"),$("#attractions"));l.find(".more-filters").addClass("hidden")},success:function(b){l.html(b);l.find(".load-more").addClass("hidden");a.trackPageView("/plan/explore/destinations")}})};
z.initialize=function(){k=$("#explore");l=k.find("#exploreAttractionResultsPane");k.find("#exploreAttractionsLeftPane");e.addObserver("explore-destination-details","explore-destinations",function(a,b){z.loadDestinationDetails(b.url,b.analyticsEventCategory,b.shouldScroll,b.backText)});e.addObserver("explore-destination-details-click","explore-destinations",function(a,b){n(b.target)});k.off("click.add-dest").on("click.add-dest","li.destination .add-button",t)};return z});
define("plan/overview","modules/analytics modules/utils modules/ajax modules/fbutil plan/history modules/events plan/route plan/loading modules/modal plan/view modules/map plan/comments plan/collaboration plan/exploreDestinations plan/exploreAttractions plan/dock jquery qtip jQueryExtensions/linkToCalendarAndMap jQueryExtensions/colorCalendar".split(" "),function(a,c,d,e,h,g,f,b,j,m,q,r,p,t){function n(){s.prepareMiniMap(s,s.find(".overview-stay-pane"),!0)}function z(){$(".tab-people > a").trigger("click");
h.push("people","people",$("#people").data("url"),void 0)}function k(){var a=$(this),b=a.parents(".travel-row").find(".options-content"),c=a.find(".fa");b.hasClass("hidden")?(c.removeClass("fa-chevron-down").addClass("fa-chevron-up"),b.removeClass("hidden"),a.find(".text-link").text("hide travel options")):(c.removeClass("fa-chevron-up").addClass("fa-chevron-down"),b.addClass("hidden"),a.find(".text-link").text("travel options"))}function l(){O=!0}function v(){var a=$(this).parents(".cotravelers-pane").find(".num-people"),
a=a.is(":visible")?a.val():1;p.showAddCotravelerDialog(10>=a?a:10)}function i(){for(var a=$("#plan").data("cotravelerNames").split(","),b=a.length,c="",d=0;d<b;d++)if(0<d&&(d===b-1||2===d)?c+=" & ":0<d&&(c+=", "),2>d||3>=b)c+=a[d].trim().split(" ")[0];else{c+=b-3+1;c+=" others";break}return c}function L(){var c=$(this),e=$(this).parents(".overview-stay-pane"),h=e.data("name"),i=e.data("stayId"),e=$('<div class="delete-confirm clickable"><input type="button" class="button cta-button" value="Delete Destination?"></div>'),
j=$(document.createElement("div"));a.trackEvent("overview.stay","delete-stay",h.toLowerCase());e.click(function(){c.qtip("api").destroy();b.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan...");a.trackEvent("overview.stay","delete-stay-confirm",h.toLowerCase());var e=f.isExpanded();d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/stay/"+i+"/delete",data:{view:"overview"},type:"POST",synchronize:!0,complete:function(){b.hideLoading($("#planRecalculating"),
$("#resultpageContent"))},success:function(a,b,c){s.html(a);C.initialize();e?f.expand():f.collapse();a={uiSource:"overview.stayRow",planName:c.getResponseHeader("Inspirock-Plan-Name"),startDate:c.getResponseHeader("Inspirock-Plan-StartDate"),endDate:c.getResponseHeader("Inspirock-Plan-EndDate"),displayDate:c.getResponseHeader("Inspirock-Plan-DisplayDate")};g.triggerEvent("overview","stay-remove",a)}})});j.append(e);c.qtip({overwrite:!0,content:j,position:{my:"top right",at:"top right",container:$("#route")},
show:{event:"click",delay:0,ready:!0},hide:{event:"unfocus",fixed:!0},events:{hide:function(a,b){b.destroy()}},style:{classes:"noShadow noBorder deleteConfirm",tip:{corner:!1}}})}function y(){if($("#plan").data("cotravelerNames")){s.find(".cotravelers-pane .no-cotravelers").addClass("hidden");s.find(".cotravelers-pane .yes-cotravelers").removeClass("hidden");s.find(".cotravelers-pane .yes-cotravelers .names").text(i());var a=$("#plan").data("cotravelerNames").split(","),b=[];$.each(a,function(a,c){b.push({name:c})});
s.find(".cotravelers-pane .yes-cotravelers .names .show-others").off("click").on("click",function(){p.showReadonlyCollaborationDialog(b)})}else s.find(".cotravelers-pane .no-cotravelers").removeClass("hidden"),s.find(".cotravelers-pane .yes-cotravelers").addClass("hidden")}function J(){g.triggerEvent("overview","mmt_track_link",{linkName:"Edit Itinerary"})}function u(a,b){R.push(b)}function N(){for(var a in R)switch(R[a].action){case "expandRouteSection":g.triggerEvent("overview","expand-route-section",
{addToHistory:!0,destinationId:R[a].destinationId})}R=[]}function M(){var a=$(this).parents(".overview-stay-pane"),b=a.data("stayId"),c=a.data("duration"),a=a.data("name");f.updateStayDuration(b,a,c+1,"overview.stay","overview.stayRow.plusminus")}function w(){var a=$(this).parents(".overview-stay-pane"),b=a.data("stayId"),c=a.data("duration"),a=a.data("name");1<c&&f.updateStayDuration(b,a,c-1,"overview.stay","overview.stayRow.plusminus")}var C={},s,P,O=!1,R=[];C.refreshIfInvalid=function(a,c){if(O||
!0===c){var e=f.isExpanded();b.showLoading($("#planRecalculating"),$("#resultpageContent"),"Loading...");s.empty();d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/overview",type:"GET",success:function(a){s.html(a);C.initialize();r.refreshComments();m.scrollAndUpdate();O=!1;s.trigger("refreshed");e?f.expand():f.collapse();N()},complete:function(){b.hideLoading($("#planRecalculating"),$("#resultpageContent"))}})}else N()};C.isDirty=function(){return O};C.initialize=function(){s=
$("#overview");$("#route");P=s.find("#overviewRoutePane");s.find(".overview-friends-pane");s.find(".add-friends").click(function(){g.triggerEvent("alerts","show-tab-collaboration",{addToHistory:!0})});g.addObservers("plan-update stay-add stay-remove stay-update visit-add visit-remove".split(" "),"overview",l);g.addObserver("refresh-overview","overview",C.refreshIfInvalid);g.addObservers(["collaborator-add","collaborator-remove"],"overview",y);g.addObserver("overview-post-refresh-actions","overview",
u);P.find(".mini-calendar").colorCalendar();P.linkToCalendarAndMinimap({staySelector:".stay-row,.stay",$calendar:P.find(".mini-calendar"),$minimap:P.find(".mini-map"),stayListTitleSelector:".title"});q.addToQueue(n);s.off("click.helper").on("click.helper",".friends-module .helper",z).off("click.options").on("click.options",".overview-travel-pane .content",k).off("click.plus-day").on("click.plus-day",".overview-stay-pane .plus-day",M).off("click.minus-day").on("click.minus-day",".overview-stay-pane .minus-day",
w);s.off("click.edit-itin").on("click.edit-itin",".dayByDayStayLink",J).off("click.delete").on("click.delete",".delete-overview-destination",L);s.find(".facebook-login-button").click(function(){e.loginToFB("overview.main")});s.off("click.add-cotraveler").on("click.add-cotraveler",".add-cotraveler",v);s.off("click.explore-all").on("click.explore-all",".explore-all-destination",function(){var b=$(this).data("eventSrc");a.trackEvent(b,"explore-destinations");t.loadDestinationInModal("overview")});r.prepareCommentAreas(s);
y();var b=s.find("#planDescriptionTextArea");b.off("blur").on("blur",function(){var a=$.trim(b.val());d.makeAJAXcall({type:"POST",url:b.data("remoteUrl"),data:{description:a},success:function(){},error:function(){}})});s.find(".stay-description-text-area").each(function(){$(this).off("blur").on("blur",function(){var a=$.trim($(this).val());d.makeAJAXcall({type:"POST",url:$(this).data("remoteUrl"),data:{description:a},success:function(){},error:function(){}})})});$(".num-people").off("keyup").on("keyup",
function(){10<$(this).val()&&$(this).val(10)});g.addObserver("overview-init","overview",function(){C.initialize()});f.initialize()};return C});
define("plan/hotels","modules/analytics modules/utils modules/ajax modules/events modules/mixpanel modules/attributions modules/hotelbooking plan/dock plan/view plan/exploreAttractions plan/exploreDestinations selectmenu jquery jqueryui jQueryExtensions/inspirockAutocomplete qtip jQueryExtensions/readMore".split(" "),function(a,c,d,e,h,g,f,b,j){function m(){var a=$("#pageHeader:visible"),c=$(".plan-heading:visible"),a=a.outerHeight(!0)+c.outerHeight(!0)+23+12;b.dockView("hotels-right-pane",i,a,v.offset().top+
v.height(),v.height(),!0,!1);j.scrollAndUpdate()}function q(){L=!0}function r(){var a=$(this).parents(".stay-row"),b=a.find(".startdatepicker").datepicker("getDate"),d=a.find(".enddatepicker").datepicker("getDate");!b||!d?c.showExclamationDialog("Uh oh!","Please select a valid start and end date.","Close"):(f.logBookingEvent("hotels",a.data("name")),f.openBookingURL(a,b,d))}function p(a,b){var c=a.datepicker("getDate");null!==c?b.datepicker("option","minDate",c):b.datepicker("option","minDate","+1d")}
function t(){var b=$(this);b.attr("disabled","disabled");d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/requestAgent",type:"GET",complete:function(){b.removeAttr("disabled")},success:function(b){var f=$(b);f.dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"dlg-requestAgent",width:"560px",open:function(){h.logEvent("request_agent_dialog_show",{});c.setupDialogOverlay(f,!1);var b=$("#agentSupportedCountries"),g=f.find("#number"),i=f.find("#email-input"),j=f.find("#additionalInfo"),
k=f.find("#user-name"),m=f.find("input[name=contactmethod]");b.selectmenu({appendTo:f});var l=function(a){window.setTimeout(function(){c.hideErrorTooltip(k);c.hideErrorTooltip(i);c.hideErrorTooltip(g)},a)},n=function(){c.hideErrorTooltip(k);c.hideErrorTooltip(i);c.hideErrorTooltip(g);var a=k.val().trim(),b=i.val().trim(),d=g.val().trim();return!a.length?(c.showErrorTooltip(k,"Name must be provided."),l(3E3),!1):!d.length?(c.showErrorTooltip(g,"Phone number must be provided."),l(3E3),!1):!c.isPhoneNumber(d)?
(c.showErrorTooltip(g,"Phone Number field should allow only numbers, - hyphen, + plus sign and a open closed braces."),l(3E3),!1):!b.length||!c.validateEmail(b)?(c.showErrorTooltip(i,"Provide a valid E-mail Address."),l(3E3),!1):!0};f.find(".cta-button").click(function(){if(c.validateEmailField(i,!1)){f.find(".cta-button").prop("disabled",!0);var l={};l.selectedCountry=b.val();l.accessedFromCountry=f.find(".cta-button").data("defaultCountry").trim();l.email=i.val().trim();l.name=k.val().trim();l.contactMethod=
m.filter(":checked").val();l.additionalInfo=j.val().trim();l.phoneNumber=g.val().trim();if(n()){var p=f.find(".cta-button").data("sendUrl");f.find(".spinner").show();f.find(".dialog-form").css("visibility","hidden");d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/"+p,type:"POST",data:l,success:function(b){var c=$(b);c.dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"dlg-message",width:"560px",open:function(){c.find(".cta-button").click(function(){c.dialog("close");
f.dialog("close")});a.trackEvent("hotels.travel-agent","send-request-"+p,c.find(".ok-button").data("agentRequestId"));h.logEvent("request_agent_sent",l);e.triggerEvent("route","mmt_track_link",{linkName:"Contact an Agent"})}})},error:function(a){var b=$(a);b.dialog({resizable:!1,draggable:!1,modal:!0,dialogClass:"dlg-message",width:"560px",open:function(){b.find(".cta-button").click(function(){b.dialog("close");f.dialog("close")})}})},complete:function(){f.find(".spinner").hide();f.find(".dialog-form").css("visibility",
"visible");f.find(".cta-button").prop("disabled",!1)}})}else f.find(".cta-button").prop("disabled",!1)}});a.trackEvent("hotels.travel-agent","show-dialog")},close:function(){c.hideErrorTooltip($(this).find("#email-input"));f.dialog("destroy").remove()}})}})}function n(){m();v.find(".advice-wrap").each(function(){$(this).find(".advice").readMore($(this).find(".read-more"),$(this).find(".read-less"))})}function z(){b.undockView("hotels-right-pane")}var k={},l,v,i,L=!1;k.refreshIfInvalid=function(){L&&
(l.empty(),d.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/hotels",type:"GET",success:function(a){l.html(a);k.initialize();m();L=!1;l.trigger("refreshed")}}))};k.isDirty=function(){return L};k.enableTravelAgents=function(){v.removeClass("no-travel-agents");i.removeClass("hidden")};k.initialize=function(){l=$("#hotels");l.length&&(v=l.find("#hotelsMainPane"),i=l.find("#requestAgentPane"),v.find(".hotel-search"),v.find(".stay-row").each(function(){var a=$(this),b=a.find(".startdatepicker"),
c=new Date(b.data("defaultDate")),d=a.find(".enddatepicker"),a=new Date(d.data("defaultDate"));b.datepicker({minDate:"+1d",maxDate:"+3y",dateFormat:"M dd, yy",onSelect:function(){p(b,d)}});b.datepicker("setDate",c);d.datepicker({dateFormat:"M dd, yy"});p(b,d);d.datepicker("setDate",a)}),e.addObservers(["plan-update","stay-add","stay-remove","stay-update"],"hotels",q),e.addObserver("refresh-hotels","hotels",k.refreshIfInvalid),v.off("click.find-hotel").on("click.find-hotel",".find-hotel-button",r),
i.off("click.request-agent").on("click.request-agent",".request-agent-button",t),l.off("isVisible").on("isVisible",n).off("isHidden").on("isHidden",z),l.is(":visible")&&n())};return k});
define("plan/explore","modules/analytics modules/mixpanel plan/history plan/loading plan/exploreAttractions plan/exploreDestinations plan/exploreSearch plan/view modules/events modules/ajax plan/dock modules/modal jquery".split(" "),function(a,c,d,e,h,g,f,b,j,m,q,r){function p(){var a=$("#pageHeader:visible"),c=$(".plan-heading:visible"),d=$(".explore-search-bar"),a=a.outerHeight(!0)+c.outerHeight(!0)+d.outerHeight(!0)+23+12;q.dockView("explore-attractions-left-pane",u,a,Number.MAX_VALUE,L.offset().top+
L.outerHeight()-i.offset().top,!1,!0,J);b.scrollAndUpdate()}function t(){q.undockView("explore-attractions-left-pane")}function n(a){i.html(a);v.initialize();b.scrollAndUpdate();N=!1;i.trigger("refreshed")}function z(){N=!0}function k(a,b){function c(){h.showLanding();d.off("click.modalAttrDetailPageLink").on("click.modalAttrDetailPageLink",".attractionDetailsLink,.attLink",h.attractionDetailsPageLinks);d.off("click.modalDestDetailPageLink").on("click.modalDestDetailPageLink",".destinationDetailsLink,.destLink",
function(){j.triggerEvent("exploreAttractions","explore-destination-details-click",{target:$(this)})});d.find(".destination-filter.country .expandable-title:first").click();q.disableDock("explore-attractions-left-pane");d.off("click.claimPlan").on("click.claimPlan",".claimPlanLink",function(){j.triggerEvent("exploreAttractions","claimPlan",{})})}var d=b.$modal;v.isDirty()?($("#explore").one("refreshed",function(){c()}),v.refreshIfInvalid()):c()}function l(){var a=$(this).parents(".destination-filter").data("destination-id"),
b=$(this).parents(".destination-filter").data("targetId"),a={destinationId:a,numResults:5,pageIndex:0},c={requestData:$.extend(!0,{dontScrollToTop:!0},a),targetId:b},e=window.contextPath+"/plan/"+$("#plan").data("planId")+"/explore/destinations?view=browse&"+$.param(a);r.isOpen()||d.push("browseDestinations","explore",e,c);g.loadBrowseDestinations(b,a)}var v={},i,L,y,J,u,N=!0;v.showLoading=function(){e.showLoading(y,L,"Loading...")};v.refreshIfInvalid=function(a){if(N||!0===a)e.showLoading($("#exploreLoadingPane"),
$("#attractions"),"Loading..."),i.empty(),m.makeAJAXcall({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/explore",type:"GET",complete:function(){e.hideLoading($("#exploreLoadingPane"),$("#attractions"))},success:function(a){n(a)}})};v.isDirty=function(){return N};v.initialize=function(){i=$("#explore");i.length&&(i.is(":visible")&&(N=!1),L=i.find("#exploreMainPane"),y=i.find("#exploreLoadingPane"),i.find("#attractions"),u=i.find("#exploreAttractionsLeftPane"),J=i.find("#exploreSubnavPane"),
u.off("click.destinationfilter").on("click.destinationfilter",".destination-filter.country .expandable-title.destination",l),j.addObserver("refresh-explore","explore",function(a,b){v.refreshIfInvalid(b.showLanding)}),j.addObserver("load-explore-contents","explore",function(a,b){n(b)}),j.addObserver("prep-explore-for-modal","explore",k),j.addObserver("explore-destinations-browse","explore",function(a,b){h.restoreBrowseLeftPaneState(b.targetId,b.requestData);g.loadBrowseDestinations(b.targetId,b.requestData)}),
j.addObserver("explore-destinations-browse-in-modal","explore",function(){g.loadDestinationInModal($("#resultpageContent .tab-content:visible").attr("id"))}),j.addObserver("explore-attraction-browse","explore",function(a,b){h.restoreBrowseLeftPaneState(b.targetId,b.requestData);h.loadBrowseAttractions(b.targetId,b.requestData)}),j.addObserver("explore-load-attraction-in-modal","explore",function(a,b){h.loadAttractionsInModal(b.tab,b.destinationId,b.history)}),j.addObservers("plan-update stay-add stay-remove stay-update visit-add visit-remove".split(" "),
"explore",z),L.off("isVisible").on("isVisible",p).off("isHidden").on("isHidden",t),L.is(":visible")&&p(),h.initialize(),g.initialize(),f.initialize())};return v});define("text!templates/shareEmail.html",[],function(){return'<div class="share-email">\n    <div class="plan-info">\n    <label class="share-url-label" for="plan-url">Plan URL (Anyone with this link can see this plan)</label><br />\n    <input type="text" id="plan-url" class="shaded"readonly />\n    </div>\n    \n    <div class="user-info">\n    <label class="share-url-label">Send this link to a friend</label><strong>\n    </div>\n</div>'});
define("text!templates/shareCollaborator.html",[],function(){return'<div class="collaborator">\n<input  type="text" class="shaded friendName" placeholder="Friend\'s Name *">\n<input  type="text" class="shaded email" placeholder="Friend\'s Email *">\n</div>'});
define("plan/planHeader","modules/analytics modules/mixpanel modules/ajax modules/events modules/utils plan/collaboration text!templates/shareEmail.html text!templates/shareCollaborator.html zeroClipboard selectmenu jquery jqueryui".split(" "),function(a,c,d,e,h,g,f,b){function j(){e.triggerEvent("plan-header","show-tab-overview",{addToHistory:!0})}function m(){c.logEvent("download_print",{});a.trackEvent("download.print-itinerary","print");a.trackEvent("print-plan","print-plan");var b=window.contextPath+
"/plan/"+$("#plan").data("planId")+"/print";window.open(b,"_blank")}function q(){c.logEvent("download_calendar",{});a.trackEvent("download.download-calendar","download-calendar")}function r(){var b=n.find("#action-share");b.qtip({overwrite:!0,content:{text:function(a,b){$.ajax({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/download",cache:!1}).then(function(a){b.set("content.text",a);h.copyToClipboard(b.elements.content.find(".copy-link"))},function(){});return'<div style="width:530px;"><img class="progress-indicator" src="'+
window.contextPath+'/res/images/assets/ajax-loader.gif" alt="loading"></div>'}},position:{my:"top right",at:"bottom center",adjust:{y:-12,x:13},effect:!1},show:{event:"click",delay:0},hide:{event:"unfocus"},events:{show:function(d,e){b.addClass("active");c.logEvent("download_share_show",{});a.trackEvent("plan-header","share-dialog",$("#plan").data("planId"));0===e.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(e.elements.content);e.elements.content.off("click.link").on("click.link",
".read-only-link",function(){$(this).select()});e.elements.content.off("click.social").on("click.social",".social-media-icons",function(){z.apply(this);b.qtip("api").hide()});e.elements.content.off("click.cotrav").on("click.cotrav",".see-all.co-travelers",function(){g.showManageCotravelerDialog();b.qtip("api").hide()});e.elements.content.off("click.friend").on("click.friend",".see-all.friends",function(){g.showManageFriendDialog();b.qtip("api").hide()});e.elements.content.off("click.print").on("click.print",
".print-container",m).off("click.calendar").on("click.calendar",".calendar-container",q).off("click.add-cotraveler").on("click.add-cotraveler",".add-cotraveler",function(){b.qtip("api").hide();var a=$(this).parents(".cotravelers-pane").find(".num-people"),a=a.is(":visible")?a.val():1;g.showAddCotravelerDialog(10>=a?a:10)})},hide:function(){b.removeClass("active")}},style:{classes:"share-dropdown qtip-light qtip-shadow",tip:{corner:!0,width:20,height:10,offset:80,mimic:"top center"}}})}function p(){n.find("#action-share").data("qtip")&&
(n.find("#action-share").data("qtip").destroy(),r())}var t={},n;t.showShareDialog=function(e){"email"===e?d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/readOnlyLink",success:function(e){var g=h.modal({title:"Email <span class='bold'>this plan</span>",message:f,dialogClass:"dlg-share-email",width:"560px",buttons:{Send:function(){var b=!1,e=g.find(".collaborator"),f=[],j=g.find(".yourName");0===j.val().trim().length?(h.showErrorTooltip(j,"You must enter your name"),
b=!0):h.hideErrorTooltip(j);for(var k=0;k<e.length;k++){var l=$(e[k]).find(".friendName"),m=$(e[k]).find(".email");0===l.val().trim().length?(h.showErrorTooltip(l,"You must enter friend's name"),b=!0):h.hideErrorTooltip(l);h.validateEmailField(m,!0)||(h.showErrorTooltip(m,"You must enter friend's email"),b=!0);f.push({friendName:l.val(),email:m.val()})}b||d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/share",data:{userInfo:JSON.stringify(f),fromName:j.val()},
success:function(){g.close();c.logEvent("share_email_sent",{});a.trackEvent("share-dialog","share","email");h.showOkDialog("Email sent","","OK")},complete:function(){}})}},create:function(){$(".dlg-request-access-sent").append('<div class="footer"><a href="javascript:void(0);" class="close">No thanks, I want to keep browsing this plan ></a></div>')},close:function(){$(".qtip.error").each(function(){$(this).data("qtip").destroy()})}});g.find(".user-info").append('<input  type="text" class="shaded yourName" placeholder="Your Name *">');
g.find(".user-info").append(b);g.find("#plan-url").val(e).select();g.append($("<a>").append($("<i>").addClass("fa fa-plus")).append("Add More Friends").addClass("add-more"));$(".dlg-share-email .add-more").off("click").on("click",function(){g.find(".user-info").append(b);g.dialog({position:{my:"center",at:"center",of:window}})})}}):d.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/shareDialog?target="+e,success:function(b){var d=$(b);d.dialog({resizable:!1,modal:!0,
draggable:!1,width:"560px",dialogClass:"dlg-share-new",open:function(){h.setupDialogOverlay(d,!1);d.find("#emails");d.find("#fromName");d.find("#notes");var b=d.find("#readonlylink"),e=d.find("#invite-button"),f=d.find(".share"),g=f.find(".share-button"),j=f.data("target"),k=window.encodeURIComponent(f.data("shareUrl")),l=window.encodeURIComponent(f.data("shareImg")),m=window.encodeURIComponent(f.data("shareTitle"));a.trackEvent("plan-header","share-dialog",j);c.logEvent("share_dialog_show",{target:j});
g.click(function(){a.trackEvent("share-dialog","share",j);c.logEvent("share_dialog_share_click",{target:j});var b=window.screen.height/2-218,d=window.screen.width/2-313;"facebook"===j?window.open("http://www.facebook.com/sharer.php?u="+k,"sharer","toolbar=0,status=0,width=626,height=256,top="+b+",left="+d):"twitter"===j?window.open("http://twitter.com/share?url="+k,"sharer","toolbar=0,status=0,width=626,height=256,top="+b+",left="+d):"google-plus"===j?window.open("http://plus.google.com/share?url="+
k,"sharer","toolbar=0,status=0,width=626,height=256,top="+b+",left="+d):"pinterest"===j&&window.open("http://pinterest.com/pin/create/button/?url="+k+"&media="+l+"&description="+m,"sharer","toolbar=0,status=0,width=626,height=256,top="+b+",left="+d);return!1});e.click(function(){});b.click(function(){$(this).focus().select()})},close:function(){$(this).dialog("destroy").remove()}})}})};var z=function(){var a=$(this).data("target");t.showShareDialog(a)};t.initialize=function(){$("#plan");n=$("#planHeader");
$("#resultpageContent");e.addObservers(["collaborator-add","collaborator-remove"],"plan-header",p);var b=n.find("#action-settings");b.qtip({overwrite:!0,content:{text:function(b,e){$.ajax({url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/settings",cache:!1}).then(function(b){e.set("content.text",b);var f=e.elements.content,g=f.find("#startTime").val(),h=f.find("#endTime").val(),j=f.find("input:radio[name=pace]:checked").val(),k=f.find("#startTime"),l=f.find("#endTime"),m=f.find("input:radio[name=pace]"),
b=f.find("#save-settings-btn");f.find("#publicPlan");k.selectmenu({appendTo:f});l.selectmenu({appendTo:f});var p=function(){var a;if(!(a=g!==k.val()?!0:!1))if(!(a=h!==l.val()?!0:!1))a=m.filter(":checked"),a=j!==a.val()?!0:!1;a?f.parents(".ui-dialog").find(".ui-button-text").text("Save and Recalculate"):f.parents(".ui-dialog").find(".ui-button-text").text("Save")};b.click(function(){var b={dayStartTime:parseInt(f.find("#startTime").val(),10),dayEndTime:parseInt(f.find("#endTime").val(),10),pace:f.find("input:radio[name=pace]:checked").val(),
distanceUnits:f.find("input:radio[name=distanceUnits]:checked").val(),publicPlan:f.find("#publicPlan").is(":checked")};b.dayStartTime>=b.dayEndTime||d.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/settings",data:b,synchronize:!0,success:function(){c.logEvent("settings_saved",b);a.trackEvent("settings-dialog","save-plan-settings",void 0,function(){n.find("#action-settings").qtip("toggle",!1);window.location.reload()})}})});k.on("change",p);l.on("change",p);m.on("change",
p);k.linkToEndTimeSelect(l)},function(){});return'<img class="progress-indicator" src="'+window.contextPath+'/res/images/assets/ajax-loader.gif" alt="loading">'}},position:{my:"top center",at:"bottom center",adjust:{y:-12},effect:!1},show:{event:"click",delay:0},hide:{event:"unfocus"},events:{show:function(d,e){b.addClass("active");c.logEvent("setting_dialog_show",{});a.trackEvent("plan-header","settings-dialog");0===e.elements.content.siblings(".qtip-fillerDiv").length&&$('<div class="qtip-fillerDiv"></div>').insertBefore(e.elements.content)},
hide:function(){b.removeClass("active")}},style:{classes:"settings-dropdown qtip-light qtip-shadow",tip:{corner:!0,width:20,height:10,offset:160}}});r();n.off("click.gotoOverview").on("click.gotoOverview",".left-chevron-wrap",j).off("click.titleGotoOverview").on("click.titleGotoOverview",".non-overview-header .plan-title > *",j).off("click.share").on("click.share",".action.share",z)};return t});
define("plan/customize",["modules/analytics","modules/mixpanel","modules/events","jquery"],function(a,c,d){var e={},h,g=!1,f=function(b,d){var e={action:b};0===b.indexOf("stay-")?e.objectType="destination":0===b.indexOf("visit-")?e.objectType="attraction":0===b.indexOf("reserved-")?e.objectType="reserved":0===b.indexOf("hop-")?e.objectType="hop":0===b.indexOf("plan-")&&(e.objectType="plan");$.extend(e,d);c.logEvent("customize_plan",e);g||(g=!0,a.trackNonInteractionEvent("customize-plan","customize-plan",
h.data("planId")))};e.initialize=function(){h=$("#plan");d.addObservers("plan-update stay-add stay-remove stay-update visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update".split(" "),"customize",f)};return e});define("text!templates/notification.html",[],function(){return'<div class="notification">\n    <div class="sheet notification-icon"></div>\n    <div class="content">\n        <div class="timestamp"></div>\n        <div class="title"></div>\n        <span class="action"></span>\n    </div>\n</div>'});
define("plan/notifications","modules/events modules/ajax plan/collaboration modules/analytics plan/loading moment modules/utils plan/planUtils text!templates/notification.html".split(" "),function(a,c,d,e,h,g,f,b,j){function m(a,b){return a.extra&&a.extra.hasOwnProperty(b)?a.extra[b]:""}function q(a,b){if(a.extra)for(var c=0;c<b.length;c++){var d=a.extra[b[c]];if(d)return d}return""}function r(a){return M.hasOwnProperty(a)?M[a]:""}function p(a){var b=m(a,"causedByItem");if("PLAN"===m(a,"causedByItemType")){if("route"===
b)return"the plan route";if("dates"===b)return"the plan dates"}return b}function t(a){var b=m(a,"commentParentId");return a.itemId==b?"question":"comment"}function n(c,d,g){var h=$("<div><h2>"+c+'</h2><div class="tagline"></div><div class="contents">'+d+"</div>");h.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",dialogClass:"dlg-helper",buttons:[{html:"OK",click:function(){h.dialog("close")}}],open:function(){f.setupDialogOverlay(h,!1);h.off("click.gotodestination").on("click.gotodestination",
".gotodestination",function(){e.trackEvent(g+".helpdialog","gotodestination");a.triggerEvent("notifications","show-tab-route",{addToHistory:!0});h.dialog("close")});h.off("click.editdates").on("click.editdates",".editdates",function(){e.trackEvent(g+".helpdialog","editdates");a.triggerEvent("notifications","show-tab-route",{addToHistory:!0});b.showEditDatesDialog("alerts");h.dialog("close")});h.off("click.gotocalendar").on("click.gotocalendar",".gotocalendar",function(){e.trackEvent(g+".helpdialog",
"gotocalendar");var b=parseInt($(this).data("dayNumber"),10);a.triggerEvent("notifications","show-tab-itinerary",{addToHistory:!0});a.triggerEvent("notifications","goto-calendar",{dayNumber:b});h.dialog("close")});h.off("click.recalculate").on("click.recalculate",".recalculate",function(){e.trackEvent(g+".helpdialog","recalculate");var b=parseInt($(this).data("dayNumber"),10);a.triggerEvent("notifications","itinerary-post-refresh-actions",{action:"goto-calendar",dayNumber:b});a.triggerEvent("notifications",
"optimize-route",{});a.triggerEvent("notifications","show-tab-itinerary",{addToHistory:!0});h.dialog("close")})},close:function(){$(this).dialog("destroy").remove()}})}function z(){C.find("#action-alerts").qtip("hide")}function k(b){z();var c=b.data.notification;$("#itinerary-item-"+c.itemId).length?(a.triggerEvent(b.data.source,"show-tab-itinerary",{addToHistory:!0}),a.triggerEvent(b.data.source,"scroll-to-item",{itemId:c.itemId})):(b=q(c,["attractionName","title"]),f.showErrorModal(b+" was deleted/rescheduled from this plan.",
{OK:function(){$(this).dialog("close")}}))}function l(b){z();var c=b.data.notification;$("#overview-stay-"+c.itemId).length?a.triggerEvent(b.data.source,"show-tab-route",{addToHistory:!0}):(b=m(c,"destinationName"),f.showErrorModal(b+" was deleted/rescheduled from this plan.",{OK:function(){$(this).dialog("close")}}))}function v(b){z();a.triggerEvent(b.data.source,"show-tab-overview",{addToHistory:!0})}function i(b){z();var c=b.data.notification;if($("#comments-list-"+c.extra.commentId).length)if("STAY"===
c.itemType||"PLAN"===c.itemType)a.triggerEvent(b.data.source,"show-tab-overview",{addToHistory:!0}),a.triggerEvent(b.data.source,"scroll-to-comment",{commentId:c.extra.commentId});else{if("VISIT"===c.itemType||"RESERVED"===c.itemType)a.triggerEvent(b.data.source,"show-tab-itinerary",{addToHistory:!0}),a.triggerEvent(b.data.source,"scroll-to-comment",{commentId:c.extra.commentId})}else $("#comments-list-"+c.itemId).length?f.showErrorModal("The comment was deleted from this plan.",{OK:function(){$(this).dialog("close")}}):
(b=m(c,"destinationName"),f.showErrorModal(b+" was deleted/rescheduled from this plan.",{OK:function(){$(this).dialog("close")}}))}function L(){s.find(".progress").removeClass("hidden");$("#notifications-list").addClass("hidden");s.find(".friends,.cotravelers").addClass("hidden");c.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/userNotifications",success:function(a){var b=a.notifications,c=a.alerts;$("#notifications-list").empty();if(!b.length&&!c.length)b=$(j),
b.find(".title").html("You have no plan notifications."),b.find(".notification-icon").addClass("info"),$("#notifications-list").append(b);else{c=c.concat(b);c.sort(function(a,b){return b.timestamp-a.timestamp});for(var d=0;d<c.length;d++)b=u.generateNotificationDisplay(c[d],"notifications"),$("#notifications-list").append(b)}b=a.friends;a=a.cotravelers;d=s.find(".collaborators-right");c=d.find(".friends");d=d.find(".cotravelers");c.removeClass("hidden").find(".count").text(b);c.find(".type").text(1===
b?"friend":"friends");d.removeClass("hidden").find(".count").text(a);d.find(".type").text(1===a?"co-traveler":"co-travelers");s.find(".progress").addClass("hidden");$("#notifications-list").removeClass("hidden");s.find(".friends,.cotravelers").removeClass("hidden")}})}function y(){d.showManageCotravelerDialog()}function J(){d.showManageFriendDialog()}var u={},N={VISIT:{ADD:["update","<b>%user%</b> added <b>Day %day%: %attr%</b>","See the change &raquo;","gotoItinerary"],REMOVE:["update","<b>%user%</b> removed <b>Day %day%: %attr%</b>",
"",""],UPDATE:["update","<b>%user%</b> udpated <b>Day %day%: %attr%</b>","See the change &raquo;","gotoItinerary"],COMMENT:["comment",'<b>%user%</b> commented on <b>Day %day%: %attr%</b> "%comment%"',"Go to comment &raquo;","gotoComment"]},STAY:{ADD:["update","<b>%user%</b> added <b>%dest%</b>","See the change &raquo;","gotoDestination"],REMOVE:["update","<b>%user%</b> removed <b>%dest%</b>","",""],UPDATE:["update","<b>%user%</b> updated <b>%dest%</b>","See the change &raquo;","gotoDestination"],
COMMENT:["comment",'<b>%user%</b> commented on <b>%dest%</b> "%comment%"',"Go to comment &raquo;","gotoComment"],DELETE_COMMENT:["comment","<b>%user%</b> has deleted a %comment_type%","",""],INSPIROCK_UPDATE:["update","<b>%user%</b> updated <b>%dest%</b> since %caused_by_user% %caused_by_action% %caused_by_item%","",""]},RESERVED:{ADD:["update","<b>%user%</b> added <b>%reserved%</b>","See the change &raquo;","gotoItinerary"],REMOVE:["update","<b>%user%</b> removed <b>%reserved%</b>","",""],UPDATE:["update",
"<b>%user%</b> updated <b>%reserved%</b>","See the change &raquo;","gotoItinerary"],COMMENT:["comment",'<b>%user%</b> commented on <b>%dest%</b> "%comment%"',"Go to comment &raquo;","gotoComment"]},PLAN:{ADD:["update","<b>%user%</b> added the plan","See the change &raquo;","gotoOverview"],REMOVE:["update","<b>%user%</b> removed the plan","",""],UPDATE:["update","<b>%user%</b> updated the plan","See the change &raquo;","gotoOverview"],COMMENT:["comment",'<b>%user%</b> commented on the plan "%comment%"',
"Go to comment &raquo;","gotoComment"]},COLLABORATOR:{ADD:["collaborator","<b>%user%</b> added <b>%collaborator_name%</b> as a %collaborator_role%","",""],REMOVE:["collaborator","<b>%user%</b> removed <b>%collaborator_name%</b> from this plan","",""],JOIN:["collaborator","<b>%collaborator_name%</b> has joined this plan as a %collaborator_role%","",""],LEAVE:["collaborator","<b>%collaborator_name%</b> has left this plan","",""],REQUEST:["collaborator","<b>%collaborator_name%</b> has requested %collaborator_role% access",
"",""],GRANT_ACCESS:["collaborator","<b>%collaborator_name%</b> has granted %collaborator_role% access","",""]}},M={ADD:"added",REMOVE:"removed",UPDATE:"updated"},w={login:{icon:"info",title:"Your plan is auto-saved. To save permanently, or to access it from other devices, log in now.",action:{type:"login",title:"Log In &raquo;"}},freetime:{icon:"exclamation",title:"You have gaps in your plan for %dest%.",action:{type:"fixgaps",title:"Help me fix this &raquo;"}},conflicts:{icon:"exclamation",title:"You have conflicts in your plan for %dest%.",
action:{type:"fixconflicts",title:"Help me fix this &raquo;"}},betterroute:{icon:"mapmarker",title:"You can visit destinations in a different order to save travel time.",action:{type:"fixroute",title:"Recalculate my destination route &raquo;"}},dayover:{icon:"exclamation",title:"Your plan is going <b>1 day past</b> your end date.",action:{type:"fixdays",title:"Help me fix this &raquo;"}},daysover:{icon:"exclamation",title:"Your plan is going <b>%numdays% days past</b> your end date.",action:{type:"fixdays",
title:"Help me fix this &raquo;"}},opendays:{icon:"exclamation",title:"You have <b>%numdays% open days</b> in your plan.",action:{type:"fixdays",title:"Help me fix this &raquo;"}},openday:{icon:"exclamation",title:"You have <b>1 open day</b> in your plan.",action:{type:"fixdays",title:"Help me fix this &raquo;"}}},C,s;u.getNotificationDisplayData=function(a){var b={},c=N[a.itemType][a.action],d=c[1].replace("%user%",a.fromUserName||"Anonymous").replace("%dest%",q(a,["destinationName","destinationNames"])).replace("%attr%",
m(a,"attractionName")).replace("%day%",m(a,"dayNumber")).replace("%reserved%",m(a,"title")).replace("%comment%",m(a,"comment")).replace("%comment_type%",t(a)).replace("%collaborator_name%",m(a,"collaboratorName")).replace("%collaborator_role%",m(a,"collaboratorRole").toLowerCase()).replace("%caused_by_item%",p(a)).replace("%caused_by_action%",r(m(a,"causedByAction"))).replace("%caused_by_user%",m(a,"causedByUser")===window.userId?"you":m(a,"causedByUserName"));b.title=d;d="inspirock"===a.fromUserId?
"inspirock "+c[0]:c[0];b.icon=d;b.action=c[2];b.actionClass=c[3];b.timestamp=g.utc(a.timestamp).fromNow();return b};u.getAlertDisplayData=function(a){var b={},c=w[a.type],d=c.title.replace("%dest%",q(a,["destinationName","destinationNames"])).replace("%numdays%",m(a,"numDays"));b.title=d;b.icon=c.icon;b.action=c.action.title;b.actionClass=c.action.type;b.timestamp=g.utc(a.timestamp).fromNow();return b};var P=function(a){var b=$(this).parents(".notification").data("notification"),c=m(b,"destinationId"),
d=m(b,"destinationName"),b=m(b,"dayNumber");e.trackEvent(a.data.source,"fixgaps");z();n("Fix Itinerary",'<div class="tagline">You have gaps in your itinerary for '+d+'</div><div class="clickable-text gotocalendar" data-day-number="'+b+'"><div class="fa fa-calendar"></div><div class="resolve-text"><div>Go to the calendar</div><div> to make adjustments.</div></div></div><div class="or-row"><div class="or-line"></div><span class="or-txt">or</span></div><div class="clickable-text recalculate" data-day-number="'+
b+'" data-destination-id="'+c+'" data-destination-name="'+d+'"><div class="fa fa-gears"></div><div class="resolve-text"><div>Recalculate</div><div> to fix it automatically</div></div></div><div class="clear"></div>',a.data.source)},O=function(a){var b=$(this).parents(".notification").data("notification"),c=m(b,"planDuration"),d=g.utc(m(b,"userStartDate"),"MMM DD, YYYY"),b=g.utc(m(b,"userEndDate"),"MMM DD, YYYY"),d=g.duration(b-d).add(1,"day").asDays()-c;e.trackEvent(a.data.source,"fixdays");z();var f=
1===d||-1===d?" day":" days",c="You have "+c+(1===c?" day":" days")+" in your plan which ",c=0<d?c+("leaves "+Math.abs(d)+f+" open before your end date of "+b.format("D MMM")+"."):c+("is "+Math.abs(d)+f+" past your end date of "+b.format("D MMM")+".");n("Fix Plan Days",'<div class="tagline">'+c+'</div><div class="clickable-text gotodestination"><div class="fa fa-map-marker"></div><div class="resolve-text"><div>Go to the Destinations</div><div> to change them or their duration.</div></div></div><div class="or-row"><div class="or-line"></div><span class="or-txt">or</span></div><div class="clickable-text editdates"><div class="fa fa-calendar"></div><div class="resolve-text"><div>Edit Dates</div><div> to change your start or end date.</div></div></div><div class="clear"></div>',
a.data.source)},R=function(b){a.triggerEvent("notifications","show-tab-route",{addToHistory:!0});e.trackEvent(b.data.source,"fixroute");z();var d={view:""};c.makeAJAXcall({type:"GET",url:window.contextPath+"/plan/"+$("#plan").data("planId")+"/optimizePathNotification",success:function(a){var b=$(a);b.dialog({resizable:!1,modal:!0,draggable:!1,width:"560px",position:{my:"top center",at:"bottom center"},dialogClass:"dlg-optimizepath-notification",buttons:[{html:"Cancel",click:function(){b.dialog("close")}},
{html:"Use this Route",click:function(){var a=b.parents(".ui-dialog").children(".ui-dialog-buttonpane").children(".ui-dialog-buttonset").find("button:contains('Use this Route')");a.prop("disabled",!0);var e="";b.find(".stay-row").map(function(){0!==$(this).index()&&(e+=",");e+=$(this).data("stayId")});var f=$.extend({stayOrder:e},d);b.dialog("close");h.showLoading($("#planRecalculating"),$("#resultpageContent"),"Updating Your Plan...");c.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+$("#plan").data("planId")+
"/adjustRoute",data:f,synchronize:!0,success:function(){window.location.reload()},complete:function(){a.prop("disabled",!1);h.hideLoading($("#planRecalculating"),$("#resultpageContent"))}})}}],open:function(){},close:function(){$(this).dialog("destroy").remove()}})}})},D=function(a){var b=$(this).parents(".notification").data("notification"),c=m(b,"destinationId"),d=m(b,"destinationName"),b=m(b,"dayNumber");e.trackEvent(a.data.source,"fixconflicts");z();n("Fix Itinerary",'<div class="tagline">You have conflicts in your itinerary for '+
d+'. You can...</div><div class="clickable-text gotocalendar" data-day-number="'+b+'"><div class="fa fa-calendar"></div><div class="resolve-text"><div>Go to the calendar</div><div> to make adjustments.</div></div></div><div class="or-row"><div class="or-line"></div><span class="or-txt">or</span></div><div class="clickable-text recalculate" data-day-number="'+b+'" data-destination-id="'+c+'" data-destination-name="'+d+'"><div class="fa fa-gears"></div><div class="resolve-text"><div>Recalculate</div><div> to fix it automatically</div></div></div><div class="clear"></div>',
a.data.source)};u.generateNotificationDisplay=function(a,b){var c;c=a.userId?u.getNotificationDisplayData(a):u.getAlertDisplayData(a);var d=$(j);d.find(".title").html(c.title);d.find(".notification-icon").addClass(c.icon);d.find(".action").html(c.action);d.find(".action").addClass(c.actionClass);d.find(".timestamp").html(c.timestamp);d.data("notification",a);c={source:b,notification:d.data("notification")};d.off("click.fixconflicts").on("click.fixconflicts",".fixconflicts",c,D).off("click.fixgaps").on("click.fixgaps",
".fixgaps",c,P).off("click.fixdays").on("click.fixdays",".fixdays",c,O).off("click.fixroute").on("click.fixroute",".fixroute",c,R).off("click.gotoItinerary").on("click.gotoItinerary",".gotoItinerary",c,k).off("click.gotoDestination").on("click.gotoDestination",".gotoDestination",c,l).off("click.gotoOverview").on("click.gotoOverview",".gotoOverview",c,v).off("click.gotoComment").on("click.gotoComment",".gotoComment",c,i);return d};u.initialize=function(){s=$("#notifications");C=$("#planHeader");a.addObserver("refresh-notifications",
"notifications",L);s.off("click.manageFriends").on("click.manageFriends",".manage-friends",J).off("click.manageCotravelers").on("click.manageCotravelers",".manage-cotravelers",y)};return u});
define("plan/alerts","modules/analytics modules/mixpanel modules/ajax modules/events moment plan/notifications jquery jqueryui qtip".split(" "),function(a,c,d,e,h,g){function f(){e.triggerEvent("alerts","show-tab-notifications",{addToHistory:!0})}function b(){t=$("html").qtip({content:'<img class="progress-indicator" src="'+window.contextPath+'/res/images/assets/ajax-loader.gif" alt="loading">Updating Your Plan...',show:{ready:!0},hide:{event:!1},position:{at:"bottom left",my:"bottom left"},style:{classes:"qtip-light qtip-popup"}})}
function j(){t&&t.length&&(t.qtip("destroy"),t=void 0)}function m(b,e){var j=e.notifications||[],m=e.alerts||[];n=j.concat(n);var m=m.concat(n),q;m.sort(function(a,b){return b.timestamp-a.timestamp});m.length&&(q=m[0].timestamp);var t=!1;m.length>k&&(m=m.slice(0,k),t=!0);l.empty();for(var M=0;M<m.length;M++){var w=m[M],C=g.generateNotificationDisplay(w,"alerts.dropdown");l.append(C)}t&&l.append(v);if(q>p.data("notificationSeenTimestamp")&&(r.find("#action-alerts").addClass("has-alerts"),q=document.createElement("div"),
j.length&&!z&&w.fromUserId!==p.data("userId"))){1<j.length?$("<div>You have "+j.length+" new notifications</div>").appendTo(q):(w=j[0],j=g.getNotificationDisplayData(w),$("<div>"+j.title+"</div>").appendTo(q));var s=$(q);$("html").qtip({content:s,events:{show:function(a,b){var c=window.setTimeout(function(){b.elements&&b.elements.target.qtip("destroy")},5E3);s.find(".fa-times").click(function(){window.clearTimeout(c);b.elements&&b.elements.target.qtip("destroy")})}},show:{ready:!0},hide:{event:!1},
position:{at:"bottom left",my:"bottom left"},style:{classes:"qtip-light qtip-popup"}})}var j=l.clone(!0,!0),P=$("#action-alerts");(w=P.qtip("api"))&&w.destroy();var O=j.find(".notification").length;O||(j=$('<div class="empty">You have no plan notifications.</div>'));P.qtip({content:j,show:{event:"click",delay:0},hide:{event:"unfocus",fixed:!0},position:{my:"top center",at:"bottom center",adjust:{y:-12},effect:!1},events:{show:function(b,e){P.addClass("active");if(P.hasClass("has-alerts")){r.find("#action-alerts").removeClass("has-alerts");
var g=h.utc().valueOf();d.makeAJAXcall({type:"POST",url:window.contextPath+"/notifications/see",data:{planId:p.data("planId"),timestamp:g},success:function(){p.data("notificationSeenTimestamp",g)}})}O&&(e.elements.content.off("click.all").on("click.all","#showAll",f),c.logEvent("alerts_showed",{}),a.trackEvent("alerts.dropdown","show"));$("#qtipBack").data("view","alerts").fadeIn("fast")},hide:function(){P.removeClass("active")}},style:{classes:"alerts-qtip qtip-light qtip-shadow",tip:{mimic:"top center",
width:18,height:10,offset:125}}});z=!1}var q={},r,p,t,n=[],z=!0,k=6,l=$("<div class='notifications'></div>"),v=$("<div class='show-all'><a id='showAll'>all notifications</a></div>");q.initialize=function(){r=$("#planHeader");p=$("#plan");e.addObservers(["synchronized-ajax-begin"],"alerts",b);e.addObservers(["synchronized-ajax-complete"],"alerts",j);e.addObserver("poll","alerts",m)};return q});
define("plan/poll",["modules/ajax","modules/events"],function(a,c){function d(){b&&b.abort();j&&(b=a.makeAJAXcall({url:window.contextPath+"/poll",type:"GET",suppressErrorDialog:!0,suppressAnalytics:!0,abortIfSynchronizedCallInProgress:!0,data:{planId:p.data("planId"),fromTimestamp:f},success:function(a){f=a.timestamp;c.triggerEvent("poll","poll",a)},complete:function(){b=null;var a=p.data("collaborationEnabled")&&"VIEWER"!==p.data("planUserRole")?m:q;g=setTimeout(d,a)},abort:function(){b=null;g=setTimeout(d,
r)}}))}function e(){g&&(window.clearTimeout(g),g=null);g=setTimeout(d,0)}var h={},g,f,b,j=!0,m=2E4,q=18E4,r=2E3,p;h.setEnabled=function(a){j=a};h.initialize=function(){p=$("#plan");c.addObservers("plan-update stay-add stay-remove stay-update visit-add visit-remove visit-update reserved-add reserved-remove reserved-update hop-add hop-remove hop-update collaborator-add".split(" "),"alerts",function(){e()});c.addObservers(["stop-poll"],"ajax",function(){h.setEnabled(!1)});e()};return h});
define("text!templates/collaborationPromo.html",[],function(){return'<div class="clearfix">\n    <div class="left">\n        <div class="sheet bubbles"></div>\n        <div class="line1">Get <span class="highlight">Friends\'</span> comments<br/>directly in your plan</div>\n        <div class="line2">Ask questions & get advice from<br/>friends who have been there.</div>\n    </div>\n    <div class="right">\n        <div class="sheet ticket"></div>\n        <div class="line1">Add <span class="highlight">Co-travelers</span> to plan<br/>along with you</div>\n        <div class="line2">Everyone can customize the plan and share ideas together.</div>\n    </div>\n</div>'});
define("text!templates/refreshPlanCotraveler.html",[],function(){return'<div class="refresh-plan">\n    <i class="fa fa-refresh"></i>\n    <span class="text">This plan has been updated by one of your co-travelers.</span>\n    <a href="javascript:void(0);" class="reload">Refresh Plan</a>\n</div>'});define("text!templates/refreshPlanFriend.html",[],function(){return'<div class="refresh-plan">\n    <i class="fa fa-refresh"></i>\n    <span class="text">This plan has been updated.</span>\n    <a href="javascript:void(0);" class="reload">Refresh Plan</a>\n</div>'});
define("text!templates/requestAccessDialog.html",[],function(){return'<div class="clearfix">\n    <div class="left">\n        <div class="sheet checklist"></div>\n        <div class="line1">This is my plan.</div>\n        <div class="line2">This Plan was created on another device or with another account.</div>\n        <button type="button" class="login ui-button cta-button small">Login</button>\n    </div>\n     <div class="middle">\n        <div class="sheet ticket"></div>\n        <div class="line1">I am a co-traveler on this plan.</div>\n        <div class="line2"><a href="javascript:void(0)" class="login">Log in</a> or Request Access to collaborate on this plan.</div>\n        <button type="button" class="request-access ui-button cta-button small" data-access-type="COTRAVELER">Request Access</button>\n    </div>\n    <div class="right">\n        <div class="sheet bubbles"></div>\n        <div class="line1">I want to give feedback to my friend.</div>\n        <div class="line2">Request Access to leave comments on this plan.</div>\n         <button type="button" class="request-access ui-button cta-button small" data-access-type="FRIEND">Request Access</button>\n    </div>\n</div>'});
define("text!templates/collabCotravelerWelcome.html",[],function(){return'<div class="clearfix">\n    <div>\n        <div class="sheet ticket"></div>\n        <div class="line1">Plan your trip to <span class="plan-name"></span><br/>with <span class="owner-name"></span>...</div>\n        <div class="line2">Welcome to Inspirock. Here we help you get the most out of your vacation. <span class="owner-name"></span> has already started a plan for your trip. As a co-traveler, you can edit and customize this plan along with them.</div>\n    </div>\n</div>'});
(function(a){function c(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(d)}}a.support.touch="ontouchend"in document;if(a.support.touch){var d=a.ui.mouse.prototype,e=d._mouseInit,h=d._mouseDestroy,g;d._touchStart=function(a){!g&&this._mouseCapture(a.originalEvent.changedTouches[0])&&(g=!0,this._touchMoved=
!1,c(a,"mouseover"),c(a,"mousemove"),c(a,"mousedown"))};d._touchMove=function(a){g&&(this._touchMoved=!0,c(a,"mousemove"))};d._touchEnd=function(a){g&&(c(a,"mouseup"),c(a,"mouseout"),this._touchMoved||c(a,"click"),g=!1)};d._mouseInit=function(){this.element.bind({touchstart:a.proxy(this,"_touchStart"),touchmove:a.proxy(this,"_touchMove"),touchend:a.proxy(this,"_touchEnd")});e.call(this)};d._mouseDestroy=function(){this.element.unbind({touchstart:a.proxy(this,"_touchStart"),touchmove:a.proxy(this,
"_touchMove"),touchend:a.proxy(this,"_touchEnd")});h.call(this)}}})(jQuery);define("touchpunch",["jquery","jqueryui"],function(){});
require("modules/analytics modules/mixpanel modules/header modules/ajax modules/utils modules/events plan/overview plan/route plan/itinerary plan/hotels plan/explore plan/comments plan/calendar plan/tabs plan/exploreAttractions plan/exploreDestinations plan/planHeader plan/customize plan/alerts plan/history plan/view plan/dock plan/loading plan/poll plan/notifications plan/collaboration modules/map moment text!templates/collaborationPromo.html text!templates/refreshPlanCotraveler.html text!templates/refreshPlanFriend.html text!templates/requestAccessDialog.html text!templates/collabCotravelerWelcome.html jquery jqueryui touchpunch".split(" "),function(a,
c,d,e,h,g,f,b,j,m,q,r,p,t,n,z,k,l,v,i,L,y,J,u,N,M,w,C,s,P,O,R,D){function x(){a.trackEvent("plan","back-to-top");$("html, body").animate({scrollTop:0},500)}function A(){if(!window.registeredUserLoggedIn&&!$(this).hasClass("create-similar")){var a=$("<div />");a.dialog({resizable:!1,modal:!0,title:"You must <strong>login to edit</strong>",draggable:!1,width:"460px",dialogClass:"dlg-login-create-similar inverted",buttons:{Login:function(){h.login()}},open:function(){},create:function(){$(".dlg-login-create-similar").append('<div class="footer"><div class="or-txt"><span>or</span></div><div>Do you want to add a similar plan to your account?</div><a class="create-similar-link" href="javascript:void(0);">Click here to create a similar plan.</a></div>');
$(".dlg-login-create-similar .create-similar-link").off("click").on("click",function(){a.dialog("close");B()})}})}else B()}function B(){e.makeAJAXcall({type:"GET",data:{inPlan:!0},url:window.contextPath+"/plan/"+I.data("planId")+"/claim",success:function(a){function b(a){var c=f.datepicker("getDate"),e=g.val(),h=parseInt(d.data("maxPlanLength"),10);if(null!==c){g.datepicker("option","minDate",c);var i=new Date(c.valueOf());i.setDate(c.getDate()+h-1);g.datepicker("option","maxDate",i)}else g.datepicker("option",
"minDate","+1d"),g.datepicker("option","maxDate","+"+h+"d");a&&g.val(e)}var c=$(a),d=c.find(".dates"),f=c.find("#startDate"),g=c.find("#endDate"),i=c.find(".claim-button");c.dialog({resizable:!1,modal:!0,draggable:!1,width:"460px",dialogClass:"dlg-claimPlan",open:function(){h.setupDialogOverlay(c,!1);f.datepicker({dateFormat:"M dd, yy",minDate:"+0d",onSelect:function(){b(!1)}}).click(function(){f.datepicker("show")});g.datepicker({dateFormat:"M dd, yy"}).click(function(){g.datepicker("show")});b(!0);
i.click(function(){var a=i.siblings(".error-message");if(f.val().length&&g.val().length){a.addClass("hidden");i.attr("disabled","disabled");var a={startDate:f.val(),endDate:g.val()},b=I.data("planId");e.makeAJAXcall({url:window.contextPath+"/planClaim?planID="+b,type:"POST",data:a,success:function(a){i.prop("disabled",!1);window.location=window.contextPath+a},complete:function(){i.removeAttr("disabled");c.dialog("close")}})}else a.text("Please provide start date and end date").removeClass("hidden")})},
close:function(){c.dialog("destroy").remove()}})}})}function K(){100<$(window).scrollTop()?$("#scrollToTop").appendTo("body").show():$("#scrollToTop").hide()}function H(a,b){if(!(b.version<=I.data("version"))){u.setEnabled(!1);var c=I.data("planUserRole"),c=-1<["FRIEND","VIEWER"].indexOf(c),d=I.data("collaborationEnabled");h.showFlash(c||!d?O:P).find(".refresh-plan a").on("click",function(){window.location.href=document.location.pathname+h.addUrlParam(document.location.search,"force_reload","")})}}
function F(){$(".plan-title .name").text(I.data("planName"));var a=C(I.data("planEndDate"),"DD MMM YYYY").diff(C(I.data("planStartDate"),"DD MMM YYYY"),"days")+1;$(".plan-title .num-days").text(a);$(".plan-title .units").text(1===a?"day":"days");$(".plan-title .subtitle").text(I.data("displayDate"))}var T={},I,U;T.itineraryDetailPageLink_click=function(){function b(){J.showLoading($("#itineraryLoadingPane"),$("#itineraryMainPane"),"Loading...");a.trackEvent(f,"itinerary-attraction-details",g.toLowerCase());
j.showItineraryDetails(d,f)}var c=$(this);c.data("detailsUrl")||(c=$(this).parents(".data-holder"));var d=c.data("detailsUrl"),e=c.parents(".tab-content"),f="";0<e.length&&(f+=e.attr("id"));var f=f+("."+c.data("eventSrc")),c=d.split("/"),g=c[c.length-3]+"-"+c[c.length-2];i.push("itineraryDetails","itinerary",d,{detailsUrl:d,eventSource:f});j.isDirty()?($("#itinerary").one("refreshed",b),t.gotoItineraryTab(!1)):(t.gotoItineraryTab(!1),b())};T.initialize=function(){U=$("#resultpageContent");I=$("#plan");
$("#planRecalculating");var b=$("#resultpageContent .tab-content:visible").attr("id");a.setProperty("page","/plan/"+b);var s=I.data("userType"),b=I.data("userId"),B={planId:I.data("planId"),userType:I.data("userType"),isOwner:"OWNER"===I.data("planUserRole"),domainType:I.data("domainType"),userId:b};c.setCommonProperties(B);"autoCookie"===s&&(s=c.getDistinctId(),B=h.getCookie("inspirock_mp_distinctId"),s===B?c.userLoggedIn(b):(c.userSignedUp(b),c.userLoggedIn(b),c.setPeopleProperties({accountType:"autoCookie",
userId:b}),s=c.getDistinctId(),h.addCookie("inspirock_mp_distinctId",s,99999)));I.data("editEnabled")&&!I.data("isCreateLogged")&&(I.data("isCreateLogged",!0),a.trackNonInteractionEvent("create-plan","create-plan",I.data("planId")),b=I.data("planParams"),s=C(I.data("creationDate"),"ddd MMM D hh:mm:ss z YYYY").hours(0).minutes(0).seconds(0).milliseconds(0),B=C(b.startDate,"ddd MMM D hh:mm:ss z YYYY").hours(0).minutes(0).seconds(0).milliseconds(0),b.daysAhead=C.duration(B-s).asDays(),window.registeredUserLoggedIn&&
c.incrementProperty("planCount",1),c.logEvent("create_plan",b),e.makeAJAXcall({type:"POST",url:window.contextPath+"/plan/"+I.data("planId")+"/analyticsRecorded",data:{event:"create"}}));$(window).load(function(){a.trackNonInteractionEvent("resultspage","load","complete")});$("#scrollToTop").click(x);var J=function(a,b,c,d,e){var f=$("#"+a),g=$("#plan-nav .tab-"+a),j=function(){var a=0;c&&(a=$("#"+c).offset().top-h.getFloatingBarsHeight());window.scrollTo(0,a);e&&e()};if(b=b.isDirty())f.one("refreshed",
j);d&&i.push(a,a,f.data("url"),void 0);g.trigger("click");b||j();return!1},P=function(b,c,d){var e=b.parents(".tab-content"),f="";0<e.length&&(f+=e.attr("id"));f+="."+b.data("eventSrc");a.trackEvent(f,c,d)};U.off("click.calendarLink").on("click.calendarLink",".calendarLink",function(){P($(this),"calendar-link","calendar");var a=$(this).data("dayNumber");return J("itinerary",j,void 0,!1,function(){t.gotoItineraryTab(!1);j.showCalendar();p.goToDay(a)})});U.off("click.dayByDayStayLink").on("click.dayByDayStayLink",
".dayByDayStayLink",function(){var a=$(this).data("dayNumber"),b=$(this).data("name");P($(this),"itinerary-list-link",b.toLowerCase());return J("itinerary",j,void 0,!0,function(){j.showDayByDayDay(a)})});U.off("click.hotelStayLink").on("click.hotelStayLink",".hotelStayLink",function(){var a=$(this).data("stayId"),b=$(this).data("name"),a="hotels-stay-"+a;P($(this),"hotel-stay-link",b.toLowerCase());return J("hotels",m,a,!0,void 0)});U.off("click.exploreDestinationLink").on("click.exploreDestinationLink",
".exploreDestinationLink",function(){var a=$(this).data("destinationId"),b=$(this).data("name");P($(this),"explore-destination-link",b.toLowerCase());return J("explore",q,void 0,!1,function(){n.gotoBrowseDestination(a)})});U.off("click.exploreLink").on("click.exploreLink",".exploreLink",function(){P($(this),"explore-link","explore");return J("explore",q,void 0,!0,void 0)});U.off("click.attrDetailPageLink").on("click.attrDetailPageLink",".attractionDetailsLink,.attLink",n.attractionDetailsPageLinks);
U.off("click.destDetailPageLink").on("click.destDetailPageLink",".destinationDetailsLink,.destLink",z.destinationDetailsPageLinks);U.off("click.moreDesc").on("click.moreDesc",".moreAttrDesc,.moreDestDesc",function(){var a=$(this),b=a.parents(".desc");a.hasClass("moreAttrDesc")?(a=a.parents(".data-holder").data("detailsUrl"),a=a.split("/"),a=a[a.length-2].substring(1),a=window.contextPath+"/attractions/"+a+"/description"):(a=a.data("link"),a=a.split("/"),a=a[a.length-1].substring(1),a=window.contextPath+
"/destinations/"+a+"/description");b.siblings(".desc-more").length?b.hide().siblings(".desc-more").show():e.makeAJAXcall({type:"GET",url:a,success:function(a){b.siblings(".desc-more").length?b.hide().siblings(".desc-more").show():$("<div>").text(a).addClass("desc-more").append($("<span>").addClass("text-link lessDesc").html("&nbsp;less &laquo;")).insertAfter(b.hide())}})});U.off("click.lessDesc").on("click.lessDesc",".lessDesc",function(){$(this).parents(".desc-more").hide().siblings(".desc").show()});
$("#pageContent").off("click.claimPlan").on("click.claimPlan",".claimPlanLink",A);U.off("click.itinDetailPageLink").on("click.itinDetailPageLink",".itineraryAttractionDetails",n.attractionDetailsPageLinks);d.initialize();i.initialize();j.initialize();f.initialize();m.initialize();q.initialize();N.initialize();l.initialize();v.initialize();k.initialize();y.initialize();L.initialize();t.initialize();r.initialize();u.initialize();w.initializeOnLoad();g.addObserver("scroll","plan",K);g.addObserver("itinerary-details",
"plan",function(a,b){b.scope&&T.itineraryDetailPageLink_click.call(b.scope)});g.addObserver("poll","plan",H);g.addObservers(["stay-add","stay-remove","stay-update","plan-delete","plan-update"],"plantitle",F);g.addObserver("claimPlan","plantitle",function(){A()});if("COTRAVELER"===I.data("planUserRole")&&h.params.get("token")){var O=$("<div>");O.html(D);O.find(".plan-name").text(I.data("planName"));O.find(".owner-name").html(M.formatCollaboratorNames(I.data("cotraveler-names")));var b=$("#plan").data("cotravelerNames").split(","),
R=[];$.each(b,function(a,b){R.push({name:b})});O.find(".show-others").off("click").on("click",function(){M.showReadonlyCollaborationDialog(R,"COTRAVELER")});O.dialog({resizable:!1,modal:!0,draggable:!1,title:'Welcome <span class="bold">co-traveler!</span>',width:"650px",dialogClass:"dlg-collab inverted cotraveler-welcome",buttons:{"LET'S GO!":function(){O.dialog("close")}},open:function(){h.setupDialogOverlay(O,!1)},close:function(){O.dialog("destroy").remove()}})}$("img.stay-img, img.visit-img, img.attr-img").error(function(){console.log($(this).attr("src"));
$(this).unbind("error").attr("src",window.contextPath+"/res/images/assets/no-image-graphic.jpg")});if(-1!==location.pathname.indexOf("/modal/"))switch(b="/plan/"+$("#plan").data("planId")+"/",b=location.pathname.split("/modal/")[0].replace(b,""),s=location.pathname.split("/modal/")[1],!0){case /explore.*attractions/.test(s):s=location.pathname.split("/");n.loadAttractionsInModal(b,s[s.length-1]);break;case /explore.*destinations/.test(s):z.loadDestinationInModal(b);break;case /.*d[0-9x]*$/.test(s):z.loadDestinationDetails(location.pathname,
b,!0,"",{path:"/plan/"+$("#plan").data("planId")+"/"+b+"/",history:{id:"exploreDestinationDetails",tabId:b,url:location.pathname,data:{detailsUrl:location.pathname,backText:"",eventSource:b,modal:"explore"}}});break;case /.*a[0-9 xy_ /]*$/.test(s):n.loadAttractionDetails({url:"/plan/"+$("#plan").data("planId")+"/"+s,analyticsEventCategory:"itinerary.attraction.modal.reload",shouldScroll:!0,backText:"back",addnlData:{path:"/plan/"+$("#plan").data("planId")+"/"+b+"/",history:{id:"exploreAttractionDetails",
tabId:b,url:location.pathname,data:{detailsUrl:location.pathname,backText:"",eventSource:b,modal:"explore"}}}})}};T.initialize();return T});define("plan",function(){});